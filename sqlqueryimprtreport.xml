<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

	<!--
		The SQL in these maps files has purposely been typed with more
		verbosity than is actually required. For example, many of the selects
		could have just used SELECT * FROM... instead of listing all of the
		columns. This is to demonstrate that even complex SQL can be handled
		and coded and formatted the way SQL was meant to be (i.e. not a bunch
		of concatenated strings in a Java class).
	-->
	<!-- This XML file will hold only the queries which would be used for Import module Reports -->
	<!-- Added by Varadaraj Muni 01-Sep-2010 -->
<sqlMap namespace="ImprtReportModule">
	
	<select id="imprt_rept_504"  parameterClass="cargo.cms.imprt.report.bo.DeclareDocCompleteBO"  resultClass="cargo.cms.imprt.report.bo.DeclareDocCompleteBO">
		SELECT evnt.TR_NO fltEventTrNo, 
		flt.FLT_KEY flightNoKey, TO_CHAR(flt.SCH_DATE,'DDMONYY') flightDate,  
		flt.ACT_TIME  ata, 
   		flt.CARR_CODE
  || flt.FLT_NO
  ||'/'
  || TO_CHAR(flt.SCH_DATE,'DDMONYY') flightKey,
   		PKG_COMMON.get_flt_ata(flt.FLT_KEY, flt.SCH_DATE, 'A') AS ataTime ,	
		NVL(shp.ManfShp, 0) noOfManfShpm, 
		NVL(shp.CARShp, 0) noOfShpmCAR,  NVL(shp.mtnCAR, 0) mtnCAR,NVL(shp.DIRShp, 0) noOfDIRShpm, NVL(shp.mtnDIR, 0) mtnDIR,  NVL(shp.CIR_Pcs, 0) noOfCIRShpm,  
		DECODE(TO_CHAR(evnt.DOC_COMPL_DATE,'DDMONYY'),NULL,' ',TO_CHAR(evnt.DOC_COMPL_DATE,'DDMONYY')) docComplDate,				
		evnt.DOC_COMPL_Time docComplTime,		
   			DECODE(ltrim(SUBSTR(TRIM(TO_CHAR(evnt.DOC_COMPL_Time,'0000')),0,2)|| ':'|| SUBSTR(TRIM(TO_CHAR(evnt.DOC_COMPL_Time,'0000')),3,4), ':'),NULL,' ',ltrim(SUBSTR(TRIM(TO_CHAR(evnt.DOC_COMPL_Time,'0000')),0,2)|| ':'|| SUBSTR(TRIM(TO_CHAR(evnt.DOC_COMPL_Time,'0000')),3,4), ':')) as docComplTimeDisp,				
		evnt.DOC_COMPL_USER_ID docComplStaffID,TO_CHAR(fltrpt.LM_DATE ,'ddMONYY HH24:MI') AS fltHdlgDataGenDate, TO_CHAR(evnt.LM_DATE, 'ddMMYY HH24:MI:SS') as lmDate,
		CASE WHEN evnt.DOC_ARR_DATE  is null THEN 'N' ELSE 'Y' END AS docrecvInd
		FROM FLT_OPR flt 		 
		JOIN FLT_OPR_EVENTS evnt ON 
			evnt.FLT_KEY = flt.FLT_KEY AND 
			evnt.SCH_DATE = flt.SCH_DATE AND 
			evnt.FLT_TYPE = 'A'		
		LEFT JOIN (SELECT count(1) as CARShp, FLT_KEY, TO_CHAR(FLT_DATE,'DDMONYY') FLT_DATE, 	
			   SUM(CASE WHEN NVL(FFM_FLG, 'N') = 'Y' and MANIFEST_PCS > 0 THEN 1 ELSE 0 END) AS ManfShp, 
			   SUM(CASE WHEN NVL(CAR_CREATED, 'N') = 'Y' THEN 1 ELSE 0 END) AS mtnCAR,	
			   SUM(CASE WHEN DOC_DISC IS NOT NULL  THEN 1 ELSE 0 END) AS DIRShp,
			   SUM(CASE WHEN DIR_PROC_USER IS NOT NULL  THEN 1 ELSE 0 END) AS mtnDIR,	
			   SUM(CASE WHEN CIR_PROC_USER is not null THEN 1 ELSE 0 END) AS CIR_Pcs 
			   FROM IMP_CAR_SHP GROUP BY FLT_KEY, FLT_DATE) shp 
		 ON flt.FLT_KEY = shp.FLT_KEY AND 
			flt.SCH_DATE = shp.FLT_DATE AND
			flt.FLT_TYPE = 'A'	
		LEFT JOIN IMP_FLT_HAND_SUMMARY fltrpt ON 
			fltrpt.FLT_KEY = flt.FLT_KEY AND 
			fltrpt.FLT_DATE = flt.SCH_DATE AND 
			fltrpt.Rep_Module = 'IDOC' 				
		WHERE   
			flt.SCH_DATE = TO_DATE(#sflightDate#, 'ddmonyy')		
			AND	flt.FLT_TYPE = 'A'
		<isNotEmpty property="sflightKey">
			AND	flt.CARR_CODE = #sflightKey#
		</isNotEmpty>
		<isNotEmpty property="sflightNo">
			AND	flt.FLT_NO = #sflightNo#
		</isNotEmpty>
		<isNotEmpty property="sflightNoKey">
			AND	flt.FLT_KEY = #sflightNoKey#
		</isNotEmpty>
			<isEmpty property="sflightNoKey">
			<isNotEmpty property="loginCarrier">
				AND	(flt.CARR_CODE = #loginCarrier#
				OR flt.CARR_CODE IN (SELECT CARR_CODE FROM MAST_CARR_GRP 
				WHERE GRP_CARR_CODE	= #loginCarrier#))							
			</isNotEmpty>
		</isEmpty>		
		ORDER BY flt.FLT_KEY ,flt.SCH_DATE 	, flt.ACT_TIME
	</select>
	
<select id="imp_rept_175_Hdr"  parameterClass="cargo.cms.imprt.report.bo.DIRSummaryRept_175BO"  resultClass="cargo.cms.imprt.report.bo.DIRSummaryRept_175BO">
		SELECT 
		shp.FLT_KEY flightNoKey, 
		shp.FLT_DATE flightDate, 
		pkg_common.get_flt_ata(flt.flt_key, flt.sch_date,'A','DD') AS ata,
		pkg_common.get_flt_ata(flt.flt_key, flt.sch_date,'A','DD') AS ataTime, 
		shp.FDAW fdaw, 
		shp.MSAW msaw,
		shp.FDAV fdav, 
		shp.MSAV msav,
		(select TO_CHAR(count(*),'0')   from Imp_CAR_SHP    where (Doc_Disc = 'FDAW' OR Doc_Disc = 'MSAW'  
                          OR Doc_Disc = 'MSCN'  OR Doc_Disc = 'FDCN') and DIR_PROC_USER is null  
                          and Flt_Key =shp.FLT_KEY  and Flt_Date =#sfltDate# ) AS dirProcUser
		FROM 
			(SELECT 
			FLT_KEY, 
			TO_CHAR(FLT_DATE,'DDMONYY') FLT_DATE, 
			SUM(CASE WHEN NVL(DOC_DISC, 'N') = 'FDAW' THEN 1 ELSE 0 END) as FDAW, 
			SUM(CASE WHEN NVL(DOC_DISC, 'N') = 'MSAW' THEN 1 ELSE 0 END) AS MSAW,
			SUM(CASE WHEN NVL(DOC_DISC, 'N') = 'FDCN' THEN 1 ELSE 0 END) as FDAV, 
			SUM(CASE WHEN NVL(DOC_DISC, 'N') = 'MSCN' THEN 1 ELSE 0 END) AS MSAV
			
			FROM IMP_CAR_SHP GROUP BY FLT_KEY, FLT_DATE) shp
		 JOIN FLT_OPR flt ON flt.FLT_KEY = shp.FLT_KEY AND 
			flt.SCH_DATE = shp.FLT_DATE AND FLT_TYPE = 'A' 
		           		
			<isNotEmpty property="carrCode">
				AND	flt.CARR_CODE = #carrCode#
			</isNotEmpty>		
			<isEmpty property="carrCode">
				<isNotEmpty property="loginCarrier">
					AND	(flt.CARR_CODE = #loginCarrier#
					OR flt.CARR_CODE IN (SELECT CARR_CODE FROM MAST_CARR_GRP 
					WHERE GRP_CARR_CODE	= #loginCarrier#))							
				</isNotEmpty>
			</isEmpty>  
		WHERE 
		  ( FDAW > 0 or MSAW > 0 OR FDAV  > 0 OR MSAV > 0 ) AND 
		    shp.FLT_DATE = #sfltDate# 
		    
		<isNotEmpty property="sfltNo">
			AND	shp.FLT_KEY = #sfltNo#
		</isNotEmpty>
</select>
<select id="imp_rept_175_Dtls"  parameterClass="cargo.cms.imprt.report.bo.DIRSummaryRept_175BO"  resultClass="cargo.cms.imprt.report.bo.DIRSummaryRept_175BO">

							<!--  SELECT 
										 row_number() over (order by  shp.AWB_No ) as serialNo, 
										SUBSTR(shp.AWB_NO,1,3)||'-'||SUBSTR(shp.AWB_NO,4) as awbNo , 
										car.AWB_DEST dest, 
										DOC_DISC disc, 
										mcd.CODE_DESC actionDesc, 
										DIR_ACTION_RMK remarks, 
										DIR_PROC_USER userID, 
										to_char(DIR_PROC_DATE, 'DDMONYY HH24:MI:SS') dirDate,
										shp.LM_USER_ID lmUserId,
										to_char(shp.LM_DATE, 'DDMONYY hh24:MI') lmDate			 
					FROM IMP_CAR_SHP shp LEFT JOIN MAST_CODE_DTL mcd on DIR_ACTION = mcd.CODE AND mcd.CODE_TYPE='ACTION_CODE'
									JOIN IMP_CAR_AWB car ON shp.AWB_No = car.AWB_No AND shp.AWB_Date = car.AWB_Date
					WHERE		shp.FLT_KEY = #sfltNo# 
								AND shp.FLT_DATE = #sfltDate# 
								AND DOC_DISC in ('FDAW', 'MSAW') 
										Order By shp.AWB_No
										
										 -->
										 
	SELECT 
			SUBSTR(shp.AWB_NO,1,3)  awbNoPrefix , 
			SUBSTR(shp.AWB_NO,4)  awbNoSuffix , 
			SUBSTR(shp.AWB_NO,1,3)||'-'||SUBSTR(shp.AWB_NO,4) as awbNoDisp , 
			shp.AWB_No awbNo, 
			TO_CHAR(shp.AWB_DATE, 'DDMONYY') awbDate, 
			car.AWB_DEST dest, 
			DOC_DISC docDisc, 
			mcd.CODE_DESC dirAction, 
			DIR_ACTION_RMK dirActionRemarks, 
			DIR_PROC_USER dirProcUser, 
			to_char(DIR_PROC_DATE, 'DDMONYY HH24:MI:SS') dirProcDate,
			shp.LM_USER_ID lmUserId,
			to_char(shp.LM_DATE, 'ddMMYY hh24:mi') lmDate,
			
			(SELECT COUNT(FAD_SEND) FROM IMP_FAD_AWB 
              WHERE flt_key = shp.FLT_KEY
              AND flt_date= shp.FLT_DATE
              AND AWB_NO = shp.AWB_No  AND FAD_SEND = 'N') AS sentfad
						 
		FROM IMP_CAR_SHP shp 
		LEFT JOIN MAST_CODE_DTL mcd on DIR_ACTION = mcd.CODE AND mcd.CODE_TYPE='ACTION_CODE'
		JOIN IMP_CAR_AWB car ON shp.AWB_No = car.AWB_No AND shp.AWB_Date = car.AWB_Date
		WHERE 
		shp.FLT_KEY = #sfltNo# AND 
		shp.FLT_DATE = #sfltDate# 
		 AND DOC_DISC in ('FDAW', 'MSAW','FDCN','MSCN') Order By shp.AWB_No
										 
										 
										 

</select>










<select id="imp_rept_604_Hdr"  parameterClass="cargo.cms.imprt.report.bo.ViewDIRSummaryRept_604BO"  resultClass="cargo.cms.imprt.report.bo.ViewDIRSummaryRept_604BO">





		SELECT 
		shp.FLT_KEY flightNoKey, 
		shp.FLT_DATE flightDate, 		
		decode(ltrim(SUBSTR(TRIM(TO_CHAR(flt.ACT_TIME,'0000')),0,2)|| ':'|| SUBSTR(TRIM(TO_CHAR(flt.ACT_TIME,'0000')),3,4), ':'),null,'',ltrim(SUBSTR(TRIM(TO_CHAR(flt.ACT_TIME,'0000')),0,2)|| ':'|| SUBSTR(TRIM(TO_CHAR(flt.ACT_TIME,'0000')),3,4), ':') )  AS ataTimeRept,
   		ltrim(SUBSTR(TRIM(TO_CHAR(flt.ACT_TIME,'0000')),0,2)|| ':'|| SUBSTR(TRIM(TO_CHAR(flt.ACT_TIME,'0000')),3,4), ':') as ata,
		ltrim(SUBSTR(TRIM(TO_CHAR(flt.ACT_TIME,'0000')),0,2)|| ':'|| SUBSTR(TRIM(TO_CHAR(flt.ACT_TIME,'0000')),3,4), ':') ataTime,	
		shp.FDAW fdaw, 
		shp.MSAW msaw,
		shp.FDAV fdav, 
		shp.MSAV msav,		
		(select count(*)   from Imp_CAR_SHP    where (Doc_Disc = 'FDAW' OR Doc_Disc = 'MSAW'  
                          OR Doc_Disc = 'MSCN'  OR Doc_Disc = 'FDCN') and DIR_PROC_USER is null  
                          and Flt_Key =#sfltNo#  and Flt_Date =#sfltDate# ) AS dirProcUser
		FROM 
			(SELECT 
			FLT_KEY, 
			TO_CHAR(FLT_DATE,'DDMONYY') FLT_DATE, 
			SUM(CASE WHEN NVL(DOC_DISC, 'N') = 'FDAW' THEN 1 ELSE 0 END) as FDAW, 
			SUM(CASE WHEN NVL(DOC_DISC, 'N') = 'MSAW' THEN 1 ELSE 0 END) AS MSAW,
			SUM(CASE WHEN NVL(DOC_DISC, 'N') = 'FDCN' THEN 1 ELSE 0 END) as FDAV, 
			SUM(CASE WHEN NVL(DOC_DISC, 'N') = 'MSCN' THEN 1 ELSE 0 END) AS MSAV
			
			FROM IMP_CAR_SHP GROUP BY FLT_KEY, FLT_DATE) shp
		 JOIN FLT_OPR flt ON flt.FLT_KEY = shp.FLT_KEY AND 
			flt.SCH_DATE = shp.FLT_DATE AND FLT_TYPE = 'A'           		
			
		WHERE 
		  ( FDAW > 0 or MSAW > 0 OR FDAV  > 0 OR MSAV > 0 ) AND 
		    shp.FLT_DATE = #sfltDate# 	
			AND	shp.FLT_KEY = #sfltNo#

	








</select>
<select id="imp_rept_604_Dtls"  parameterClass="cargo.cms.imprt.report.bo.ViewDIRSummaryRept_604BO"  resultClass="cargo.cms.imprt.report.bo.ViewDIRSummaryRept_604BO">

		SELECT 
			SUBSTR(shp.AWB_NO,1,3)  awbNoPrefix , 
			SUBSTR(shp.AWB_NO,4)  awbNoSuffix , 
			SUBSTR(shp.AWB_NO,1,3)||'-'||SUBSTR(shp.AWB_NO,4) as awbNoDisp , 
			shp.AWB_No awbNo, 
			TO_CHAR(shp.AWB_DATE, 'DDMONYY') awbDate, 
			car.AWB_DEST dest, 
			DOC_DISC docDisc, 
			mcd.CODE_DESC dirAction, 
			DIR_ACTION_RMK dirActionRemarks, 
			DIR_PROC_USER dirProcUser, 
			to_char(DIR_PROC_DATE, 'DDMONYY HH24:MI:SS') dirProcDate,
			shp.LM_USER_ID lmUserId,
			to_char(shp.LM_DATE, 'ddMMYY hh24:mi') lmDate,
			
			Decode(shp.send_fad_date,null,'N','Y') AS sentfad
						 
		FROM IMP_CAR_SHP shp 
		LEFT JOIN MAST_CODE_DTL mcd on DIR_ACTION = mcd.CODE AND mcd.CODE_TYPE='ACTION_CODE'
		JOIN IMP_CAR_AWB car ON shp.AWB_No = car.AWB_No AND shp.AWB_Date = car.AWB_Date
		WHERE 
		shp.FLT_KEY = #sfltNo# AND 
		shp.FLT_DATE = #sfltDate# 
		 AND DOC_DISC in ('FDAW', 'MSAW','FDCN','MSCN') Order By shp.AWB_No
</select>

	
	<select id="imprt_rept_505"  parameterClass="cargo.cms.imprt.report.bo.InboundDocArrivalBo"  resultClass="cargo.cms.imprt.report.bo.InboundDocArrivalBo">
		SELECT row_number() over (order by flt.FLT_KEY) sn,evnt.TR_NO fltEventTrNo,flt.FLT_KEY fltKey, TO_CHAR(flt.SCH_DATE,'DDMONYY') fltDate, 
		PKG_COMMON.get_flt_sta(flt.FLT_KEY, flt.SCH_DATE, 'A') as sta,
		PKG_COMMON.get_flt_ata(flt.FLT_KEY, flt.SCH_DATE, 'A','DD') AS ata ,
		TO_CHAR(evnt.DOC_ARR_DATE ,'ddMONYY HH24:MI') AS docArrTime, evnt.DOC_ARR_USER_ID AS docUserId,
		evnt.NO_OF_PACKS AS pouch,	evnt.DOC_COMPL_YN AS docComplYN ,
		TO_CHAR(evnt.LM_DATE, 'ddMMYY HH24:MI:SS') as lmDate
FROM    FLT_OPR flt	JOIN FLT_OPR_EVENTS evnt ON 
		evnt.FLT_KEY = flt.FLT_KEY AND 	evnt.SCH_DATE = flt.SCH_DATE 
		AND evnt.FLT_TYPE = 'A'		
WHERE to_date((to_char(flt.sch_date,'DDMONYY')||to_char(flt.SCH_TIME,'0000')),'DDMONYYHH24mi')  
            BETWEEN TO_DATE(#startTime#,'DDMONYYHH24mi') AND TO_DATE(#endTime#,'DDMONYYHH24mi')
        AND flt.FLT_TYPE = 'A' 
		<isNotEmpty property="sflightKey">
			AND	flt.CARR_CODE = #sflightKey#
		</isNotEmpty>
		<isNotEmpty property="sflightNo">
			AND	flt.FLT_NO = #sflightNo#
		</isNotEmpty>
			<isNotEmpty property="sfltKey">
			AND	flt.FLT_KEY = #sfltKey#
		</isNotEmpty> 
		ORDER BY flt.SCH_DATE,sta,flt.FLT_KEY 
		
			
	</select>
	
 <select id="imprt_rept_507_Allot"  parameterClass="cargo.cms.imprt.report.bo.CheckInULDTowReptBO"  resultClass="cargo.cms.imprt.report.bo.CheckInULDTowReptBO">
 select ALLOT_TYPE inbUldType,
		ALLOT_TYPE oldInbUld,
		QTY uldQty,
		QTY oldUldQty,
		EMPTY emptyInd,
      EMPTY oldEmptyInd 
		from IMP_CFM_ULD_TOWED_DTL where flt_key=#flightKey# and flt_date=#arrDate#
</select>

<select id="imprt_rept_507_Tow"  parameterClass="cargo.cms.imprt.report.bo.CheckInULDTowReptBO"  resultClass="cargo.cms.imprt.report.bo.CheckInULDTowReptBO">
   
    select #ctoArrvTime# ctoArrvTime,#ctoArrvTimeHr# ctoArrvTimeHr,#ctoArrvTimeMin# ctoArrvTimeMin,#towedStrtTime# towedStrtTime,
    #towedStrtTimeHr# towedStrtTimeHr,#towedStrtTimeMin# towedStrtTimeMin,#towedEndTime# towedEndTime,#towedEndTimeMin# towedEndTimeMin,#towedEndTimeHr# towedEndTimeHr,
   		 BATCH_NO batchNo, 
	   BATCH_NO oldbatchNo,
       ULD_TYPE towUldType,
       ULD_TYPE oldtowUldType,
       QTY towQty, 
       QTY oldTowQty,
       TO_NO towOrdrNo,
       TO_NO oldtowNo,
       TO_CHAR(CTO_ARR_TIME,'DDMONYY') ctoArrTime, 
       decode( TO_CHAR(CTO_ARR_TIME,'DDMONYY'),null,#ctoArrvTime#,TO_CHAR(CTO_ARR_TIME,'DDMONYY')) as ctoArrReptTime,
       TO_CHAR(CTO_ARR_TIME,'DDMONYY') oldctoTime,
       TO_CHAR(CTO_ARR_TIME,'HH24') ctoArrTimeHr,
        decode( TO_CHAR(CTO_ARR_TIME,'HH24'),null,#ctoArrvTimeHr#,TO_CHAR(CTO_ARR_TIME,'HH24')) ctoArrReptTimeHr,
       TO_CHAR(CTO_ARR_TIME,'HH24') oldctoTimeHr,
       TO_CHAR(CTO_ARR_TIME,'MI') ctoArrTimeMin,
        decode(TO_CHAR(CTO_ARR_TIME,'MI'),null,#ctoArrvTimeMin#,TO_CHAR(CTO_ARR_TIME,'MI')) ctoArrReptTimeMin,
       TO_CHAR(CTO_ARR_TIME,'MI') oldctoTimeMin,
       TO_CHAR(START_TIME,'DDMONYY') towStrtTime,
        decode(TO_CHAR(START_TIME,'DDMONYY'),null,#towedStrtTime#,TO_CHAR(START_TIME,'DDMONYY')) towStrtReptTime,
       TO_CHAR(START_TIME,'DDMONYY') oldStrtTime,
       TO_CHAR(START_TIME,'HH24') towStrtTimeHr,
        decode(TO_CHAR(START_TIME,'HH24'),null,#towedStrtTimeHr#,TO_CHAR(START_TIME,'HH24')) towStrtReptTimeHr,
       TO_CHAR(START_TIME,'HH24') oldStrtTimeHr,
       TO_CHAR(START_TIME,'MI') towStrtTimeMin,
        decode(TO_CHAR(START_TIME,'MI'),null,#towedStrtTimeMin#,TO_CHAR(START_TIME,'MI')) towStrtReptTimeMin, 
       TO_CHAR(START_TIME,'MI') oldStrtTimeMin,
       TO_CHAR(END_TIME,'DDMONYY') towEndTime,
        decode( TO_CHAR(END_TIME,'DDMONYY'),null,#towedEndTime#, TO_CHAR(END_TIME,'DDMONYY')) towEndReptTime, 
       TO_CHAR(END_TIME,'DDMONYY') oldEndTime,
       TO_CHAR(END_TIME,'MI') towEndTimeMin,
          decode(TO_CHAR(END_TIME,'MI'),null,#towedEndTimeMin#,TO_CHAR(END_TIME,'MI')) towEndReptTimeMin, 
       TO_CHAR(END_TIME,'MI') oldEndTimeMin,
       TO_CHAR(END_TIME,'HH24') towEndTimeHr,
         decode(TO_CHAR(END_TIME,'HH24'),null,#towedEndTimeHr#,TO_CHAR(END_TIME,'HH24')) towEndReptTimeHr, 
       TO_CHAR(END_TIME,'HH24') oldEndTimeHr
from imp_cfm_uld_towed_tow_info  where  FLT_KEY=#flightKey# AND FLT_DATE=#arrDate#
</select>

<select id="imprt_rept_021"  parameterClass="cargo.cms.imprt.report.bo.CheckListReptBO"  resultClass="cargo.cms.imprt.report.bo.CheckListReptBO">
  SELECT          
                hd.CARR_CODE  AS carrierCode,
                hd.FLT_NO  AS flightNo, 
                TO_CHAR(hd.FLT_DATE,'DDMONYY')  As flightDate, 
                dtl.ULD_KEY  AS uldNo, 
                Decode(dts.CHKIN_YN,NULL,'N',dts.CHKIN_YN) AS checkInInd,
                Decode(dtl.FFM_IND,NULL,'N',dtl.FFM_IND) ffmInd,
                Decode(dtl.CPM_IND,NULL,'N',dtl.CPM_IND) cpmInd,
                
                (SELECT
				    CASE
				      WHEN (SELECT COUNT(1)
				        FROM XT_IMP_CAR_SHP_DTL xt
				        WHERE xt.ULD_KEY    = dtl.ULD_KEY
				        AND xt.IMP_FLT_KEY  = hd.FLT_KEY
				        AND xt.IMP_FLT_DATE = hd.FLT_DATE ) > 0
				      THEN 'Y'
				      ELSE 'N'
				    END
				  FROM dual
				  ) AS xtInd,
  
                 (select TRF_TYPE
                  from v_ddt_dtl
                  where flt_key = hd.FLT_KEY
                  and flt_date = hd.FLT_DATE
                  and uld_key = dtl.ULD_KEY  and rownum=1
                  )  AS transferType,
                foe.RAMP_COMPL_YN as rampComplStatus,
                iul.IMX  AS imx, 
                iul.HANDLING_MODE AS handlingMode, 
                V_COMMA_SEP_IMP_FLT_ULD_SHC( hd.FLT_KEY,hd.FLT_DATE,dtl.ULD_KEY,NULL,NULL) AS shc,   
                UPPER(dtl.RMK) AS remark,               
                dtl.LOC_CODE AS locCode,
								(select TRIM(TO_CHAR(MAX(TO_NUMBER(i.TO_NO)),'00000000')) TO_NO FROM
                tow_order_in i, tow_order_in_dtl tdtl
                where i.to_no= tdtl.to_no
                and tdtl.uld_key = dtl.ULD_KEY
                and i.flt_key = #flightNoKey#
                and TO_CHAR(i.flt_date,'DDMONYY') = #flightDate#) as towOrderNo,
               (select cc.CODE_DESC from CUST_COMPANY cc where cc.code = f.rho_id) as rho,             
               (SELECT count(ULD_KEY) FROM IMP_RAMP_INB_CHK_DTL  WHERE flt_key = hd.flt_key AND FLT_DATE = hd.FLT_DATE)  as totalUld, 
                PKG_IMP.fun_get_ho_area(hd.FLT_KEY,hd.FLT_DATE,dtl.ULD_KEY) as  plannedHoArea,
   				PKG_IMP.fun_get_hdlg_area(hd.FLT_KEY,hd.FLT_DATE,dtl.ULD_KEY) as handlingZone,               
                pkg_common.get_flt_ata(hd.flt_key, hd.flt_date,'A','DD') AS ata
          FROM IMP_RAMP_CHK_HD hd
               join    FLT_OPR f                       ON  f.FLT_KEY = hd.FLT_KEY  AND  f.SCH_DATE = hd.FLT_DATE AND f.FLT_TYPE='A'
               join    FLT_OPR_EVENTS foe              ON  foe.FLT_KEY = hd.FLT_KEY  AND  foe.SCH_DATE = hd.FLT_DATE AND foe.FLT_TYPE='A'
               join    IMP_RAMP_INB_CHK_DTL dtl        ON  dtl.TR_NO = hd.TR_NO AND dtl.FLT_KEY = hd.FLT_KEY  AND  dtl.FLT_DATE = hd.FLT_DATE 
               left  join    IMP_ULD_LIST iul                ON  iul.FLT_KEY = dtl.FLT_KEY  AND  iul.FLT_DATE = dtl.FLT_date AND iul.ULD_KEY=dtl.ULD_KEY
               left  join    IMP_RAMP_CHK_DTL dts      ON  dts.TR_NO = hd.TR_NO AND dts.FLT_KEY = hd.FLT_KEY  AND  dts.FLT_DATE = hd.FLT_DATE AND dts.ULD_KEY=dtl.ULD_KEY
               
         WHERE            
               hd.flt_key = #flightNoKey# AND 
               hd.FLT_DATE = #flightDate#
           ORDER BY dtl.ULD_KEY

 </select>   
    <select id="imp_rept_605_Dtls"  parameterClass="cargo.cms.imprt.report.bo.SendFADRept_605BO"  resultClass="cargo.cms.imprt.report.bo.SendFADRept_605BO">
				SELECT SUBSTR(shp.AWB_NO,1,3)  awbNoPrefix , 
				SUBSTR(shp.AWB_NO,4)  awbNoSuffix , 
				SUBSTR(shp.AWB_NO,1,3)||'-'||SUBSTR(shp.AWB_NO,4) as awbNoDisp , 
				shp.AWB_No awbNo, 
				TO_CHAR(shp.AWB_DATE, 'DDMONYY') awbDate, 
				car.awb_Origin awbOrigin,
				car.AWB_DEST dest, 
				shp.MANIFEST_PCS manfPc,
				shp.MANIFEST_WT manfWt,
				car.AWB_PCS awbPc,
				car.AWB_WT awbWt,
				docDisc docDisc, 
				mcd.CODE_DESC dirAction, 
				DIR_ACTION_RMK dirActionRemarks, 
				DIR_PROC_USER dirProcUser, 
				to_char(DIR_PROC_DATE, 'DDMONYY') dirProcDate,
				fad.LM_USER_ID lmUserId,
				to_char(fad.LM_DATE, 'DDMONYY HH24:MI:SS') lmDate,
				fad.tr_No trNo,
				f.Orig fltOrigin,
				f.Dest fltDest
		FROM (Select DOC_DISC docDisc, s.* from IMP_CAR_SHP s) shp 
		left join (select max(TO_NUMBER(Tr_No)) Tr_No, AWB_NO, AWB_DATE, DISC_TYPE, FLT_KEY, FLT_DATE from Imp_FAD_AWB 
			where FAD_SEND = 'Y' group by AWB_NO, AWB_DATE, DISC_TYPE, FLT_KEY, FLT_DATE) tr 
			on tr.AWB_NO = shp.AWB_NO and tr.AWB_DATE = shp.AWB_DATE and tr.DISC_TYPE = shp.docDisc
			and tr.FLT_KEY = shp.FLT_KEY and tr.FLT_DATE = shp.FLT_DATE 
		left join Flt_Opr f on f.FLT_KEY = shp.FLT_KEY and f.Sch_DATE = shp.FLT_DATE and f.Flt_Type = 'A'
		left join Imp_FAD_AWB fad on fad.Tr_No = tr.Tr_No
		LEFT JOIN MAST_CODE_DTL mcd on shp.DIR_ACTION = mcd.CODE AND mcd.CODE_TYPE='ACTION_CODE'
		JOIN IMP_CAR_AWB car ON shp.AWB_No = car.AWB_No 
		AND to_char(shp.AWB_Date,'DDMMYYYY') = to_char(car.AWB_Date,'DDMMYYYY')		
		WHERE 
		shp.FLT_KEY = #flightNoKey# AND 
		shp.FLT_DATE = #flightDate#	AND 
		(NVL(shp.DOC_DISC, 'N') = 'FDAW' OR NVL(shp.DOC_DISC, 'N') = 'MSAW'
		OR NVL(shp.DOC_DISC, 'N') = 'FDCA' 
		OR NVL(shp.DOC_DISC, 'N') = 'MSCA' 
		OR NVL(shp.DOC_DISC, 'N') = 'FDCN'
		OR NVL(shp.DOC_DISC, 'N') = 'MSCN'
		OR NVL(shp.DOC_DISC, 'N') = 'FDMB'
		OR  NVL(shp.DOC_DISC, 'N') = 'MSMB')
		 UNION ALL
     	SELECT SUBSTR(shp.AWB_NO,1,3)  awbNoPrefix , 
				SUBSTR(shp.AWB_NO,4)  awbNoSuffix , 
				SUBSTR(shp.AWB_NO,1,3)||'-'||SUBSTR(shp.AWB_NO,4) as awbNoDisp , 
				shp.AWB_No awbNo, 
				TO_CHAR(shp.AWB_DATE, 'DDMONYY') awbDate, 
				car.awb_Origin awbOrigin,
				car.AWB_DEST dest, 
				shp.MANIFEST_PCS manfPc,
				shp.MANIFEST_WT manfWt,
				car.AWB_PCS awbPc,
				car.AWB_WT awbWt,
				docDisc docDisc, 
				mcd.CODE_DESC dirAction, 
				DIR_ACTION_RMK dirActionRemarks, 
				DIR_PROC_USER dirProcUser, 
				to_char(DIR_PROC_DATE, 'DDMONYY') dirProcDate,
				fad.LM_USER_ID lmUserId,
				to_char(fad.LM_DATE, 'DDMONYY HH24:MI:SS') lmDate,
				fad.tr_No trNo,
				f.Orig fltOrigin,
				f.Dest fltDest
		FROM (Select case when CIR_PCS_TYPE = 'SL' then 'MSCA' else 
			case when CIR_PCS_TYPE = 'SP' then 'FDCA' else DOC_DISC end end docDisc, s.* from IMP_CAR_SHP s) shp 
		left join (select max(TO_NUMBER(Tr_No)) Tr_No, AWB_NO, AWB_DATE, DISC_TYPE, FLT_KEY, FLT_DATE from Imp_FAD_AWB 
			where FAD_SEND = 'Y' group by AWB_NO, AWB_DATE, DISC_TYPE, FLT_KEY, FLT_DATE) tr 
			on tr.AWB_NO = shp.AWB_NO and tr.AWB_DATE = shp.AWB_DATE and tr.DISC_TYPE = shp.docDisc
			and tr.FLT_KEY = shp.FLT_KEY and tr.FLT_DATE = shp.FLT_DATE 
		left join Flt_Opr f on f.FLT_KEY = shp.FLT_KEY and f.Sch_DATE = shp.FLT_DATE and f.Flt_Type = 'A'
		left join Imp_FAD_AWB fad on fad.Tr_No = tr.Tr_No
		LEFT JOIN MAST_CODE_DTL mcd on shp.DIR_ACTION = mcd.CODE AND mcd.CODE_TYPE='ACTION_CODE'
		JOIN IMP_CAR_AWB car ON shp.AWB_No = car.AWB_No 
		AND to_char(shp.AWB_Date,'DDMMYYYY') = to_char(car.AWB_Date,'DDMMYYYY')		
		WHERE 
		shp.FLT_KEY = #flightNoKey# AND 
		shp.FLT_DATE = #flightDate#	AND shp.CIR_PROC_USER is not null
   		ORDER BY 4 	
          </select>    
          <!--  Added by Surendra Gollapalli on 19 Feb 2011 to fetch the Issue date and Time START -->
          
  <select id="imprt_rept_508_Issue_Date_Time"  parameterClass="cargo.cms.imprt.report.bo.EnqAckTowReptBo"  resultClass="cargo.cms.imprt.report.bo.EnqAckTowReptBo">  
    		select to_char(toi.cr_date,'DDMONYY HH24:MI') as issueTime,toi.CR_USER_ID as staffID,(PKG_COMMON.GET_FLT_ETA(#fltKeylist#, #fltDatelist#,'A')) as eta,
  fopr.ACFT_REG_NO as acregno
      	FROM tow_order_in toi
        left join flt_opr fopr on toi.FLT_KEY = fopr.FLT_KEY AND toi.FLT_DATE = fopr.SCH_DATE and fopr.flt_type = 'A'
        where toi.to_no= #towOrderlist#
        		</select>
		<!--  Added by Surendra Gollapalli on 19 Feb 2011 to fetch the Issue date and Time END -->

<select id="imprt_rept_508"  parameterClass="cargo.cms.imprt.report.bo.EnqAckTowReptBo"  resultClass="cargo.cms.imprt.report.bo.EnqAckTowReptBo">  
SELECT uldAwbNo,chkYN,hoArea,transferGrp,tfType,towOrderlist,cntgKey,std, pcs, shc1 ,loadType  FROM 
(select
       Decode(tdtl.ULD_KEY,null,(SUBSTR(tdtl.AWB_NO,1,3)||'-'||SUBSTR(tdtl.AWB_NO,4,11)),tdtl.ULD_KEY) uldAwbNo,
      Decode(chk.CHKIN_YN,NULL,'N',chk.CHKIN_YN) AS chkYN,
      tdtl.HO_AREA hoArea,     
       (select DECODE(ecd.LOAD_TYPE,null,' ',ecd.LOAD_TYPE) from EDI_CPM_DTL ecd where ecd.ULD_KEY = tdtl.ULD_KEY AND ecd.FLT_KEY=iul.FLT_KEY AND ecd.FLT_DATE=iul.FLT_DATE and rownum =1 )     	 as loadType,
      tdtl.TRNS_GRP as transferGrp,
      tdtl.trf_type tfType,
      toi.to_no towOrderlist,
      TRIM((tdtl.CNTG_FLT_KEY)||'/'||to_char(tdtl.CNTG_FLT_DATE,'DDMONYY')) cntgKey,	 
			PKG_COMMON.GET_FLT_STA(tdtl.CNTG_FLT_KEY,to_char(tdtl.CNTG_FLT_DATE,'DDMONYY'),'D','HH24:MI') std,  	       
      FFM.PCS || NVL2(FFM.PCS, '/', '') || DECODE(SUBSTR(FFM.WT, 0, 1), '.', '0' || FFM.WT, FFM.WT)  pcs,
      (select STRAGG(STRINGDELIM(CODE,',')) from mast_spl_hand_code A where A.code in (select column_value SHC  from   table(pkg_common.inlist(tdtl.SHCS))) and A.iata_yn = 'Y')  AS shc1
  FROM tow_order_in toi
  join tow_order_in_dtl tdtl ON toi.to_no = tdtl.to_no
  left join IMP_CAR_SHP car ON tdtl.AWB_NO = car.AWB_NO AND toi.FLT_KEY = car.FLT_KEY AND toi.FLT_DATE = car.FLT_DATE
  left join IMP_ULD_LIST iul ON iul.ULD_KEY = tdtl.ULD_KEY AND toi.FLT_KEY = iul.FLT_KEY AND toi.FLT_DATE = iul.FLT_DATE
  left join imp_ramp_chk_dtl chk ON chk.ULD_KEY = tdtl.ULD_KEY AND chk.FLT_KEY = toi.FLT_KEY AND toi.FLT_DATE = chk.FLT_DATE 
  LEFT OUTER JOIN
  (
   SELECT SUM(SHP.MAN_PCS) PCS, SUM(SHP.MAN_WT) WT, SHP.FLT_KEY, SHP.FLT_DATE, SHP.AWB_NO
   FROM EDI_FFM_MSG FFM
   JOIN EDI_FFM_ULD ULD
   ON FFM.TR_NO = ULD.TR_NO
   JOIN EDI_FFM_SHP SHP
   ON ULD.TR_NO = SHP.TR_NO AND ULD.DOC_LINE_NO = SHP.UDOC_LINE_NO
   WHERE
   FFM.FFM_STATUS = 'P' AND ULD.ULD_KEY IS NULL
   GROUP BY SHP.FLT_KEY, SHP.FLT_DATE, SHP.AWB_NO
  ) FFM
  ON CAR.AWB_NO = FFM.AWB_NO AND CAR.FLT_KEY = FFM.FLT_KEY AND CAR.FLT_DATE = FFM.FLT_DATE
     where toi.to_no =#towOrderlist#   and tdtl.ULD_KEY != 'null') DUAL
      <isEqual property="transFlag" compareValue="true"> 
     WHERE     
     UPPER(transferGrp) IN ( UPPER('dummyValue')
    		
    		<isEqual property="tramac" compareValue="Y" prepend=",">
				UPPER('TT') 
			</isEqual>
			<isEqual property="inteface" compareValue="Y" prepend=",">
				 UPPER('IF') 
			</isEqual>
			<isEqual property="otherCto" compareValue="Y" prepend=",">
				 UPPER('OTHER CTO') 
			</isEqual>
			<isEqual property="airSide" compareValue="Y" prepend=",">
				 UPPER('AS') 
			</isEqual>
			<isEqual property="strngRoom" compareValue="Y" prepend=",">
				UPPER('STRONG ROOM') 
			</isEqual>
			<isEqual property="cpct" compareValue="Y" prepend=",">
				 UPPER('CPCT') 
			</isEqual>
			)
      </isEqual>
		</select>
		
		<select id="imprt_rept_508_S2"  parameterClass="cargo.cms.imprt.report.bo.EnqAckTowReptBo"  resultClass="cargo.cms.imprt.report.bo.EnqAckTowReptBo">  
	SELECT towAwb,chkYN,hoArea,transferGrp,tfType,towOrderlist,cntgKey,std, pcs, shc1 ,loadType  FROM 
(select
      Decode(tdtl.ULD_KEY,null,(SUBSTR(tdtl.AWB_NO,1,3)||'-'||SUBSTR(tdtl.AWB_NO,4,11)),tdtl.ULD_KEY) towAwb,
      Decode(chk.CHKIN_YN,NULL,'N',chk.CHKIN_YN) AS chkYN,
      tdtl.HO_AREA hoArea,     
       (select DECODE(ecd.LOAD_TYPE,null,' ',ecd.LOAD_TYPE) from EDI_CPM_DTL ecd where ecd.ULD_KEY = tdtl.ULD_KEY AND ecd.FLT_KEY=iul.FLT_KEY AND ecd.FLT_DATE=iul.FLT_DATE and rownum =1 )     	 as loadType,
      tdtl.TRNS_GRP as transferGrp,
      tdtl.trf_type tfType,
      toi.to_no towOrderlist,
      TRIM((tdtl.CNTG_FLT_KEY)||'/'||to_char(tdtl.CNTG_FLT_DATE,'DDMONYY')) cntgKey,	 
			PKG_COMMON.GET_FLT_STA(tdtl.CNTG_FLT_KEY,to_char(tdtl.CNTG_FLT_DATE,'DDMONYY'),'D','HH24:MI') std,  	       
      FFM.PCS || NVL2(FFM.PCS, '/', '') || DECODE(SUBSTR(FFM.WT, 0, 1), '.', '0' || FFM.WT, FFM.WT)  pcs,
      (select STRAGG(STRINGDELIM(CODE,',')) from mast_spl_hand_code A where A.code in (select column_value SHC  from   table(pkg_common.inlist(tdtl.SHCS))) and A.iata_yn = 'Y')  AS shc1
			FROM tow_order_in toi
			join tow_order_in_dtl tdtl	ON toi.to_no = tdtl.to_no
      		left join IMP_CAR_SHP car ON	tdtl.AWB_NO = car.AWB_NO AND toi.FLT_KEY=car.FLT_KEY AND toi.FLT_DATE=car.FLT_DATE
      		left join IMP_ULD_LIST iul ON iul.ULD_KEY = tdtl.ULD_KEY AND toi.FLT_KEY=iul.FLT_KEY AND toi.FLT_DATE=iul.FLT_DATE
			left join imp_ramp_chk_dtl chk	ON chk.ULD_KEY = tdtl.ULD_KEY AND chk.FLT_KEY = toi.FLT_KEY AND toi.FLT_DATE=chk.FLT_DATE
      		left join EDI_CPM_DTL ecd ON ecd.ULD_KEY = tdtl.ULD_KEY AND ecd.FLT_KEY=iul.FLT_KEY AND ecd.FLT_DATE=iul.FLT_DATE
			LEFT OUTER JOIN
			(
				SELECT SUM(SHP.MAN_PCS) PCS, SUM(SHP.MAN_WT) WT, SHP.FLT_KEY, SHP.FLT_DATE, SHP.AWB_NO
				FROM EDI_FFM_MSG FFM
				JOIN EDI_FFM_ULD ULD
				ON FFM.TR_NO = ULD.TR_NO
				JOIN EDI_FFM_SHP SHP
				ON ULD.TR_NO = SHP.TR_NO AND ULD.DOC_LINE_NO = SHP.UDOC_LINE_NO
				WHERE
				FFM.FFM_STATUS = 'P' AND ULD.ULD_KEY IS NULL
				GROUP BY SHP.FLT_KEY, SHP.FLT_DATE, SHP.AWB_NO
			) FFM
			ON CAR.AWB_NO = FFM.AWB_NO AND CAR.FLT_KEY = FFM.FLT_KEY AND CAR.FLT_DATE = FFM.FLT_DATE      		
    		where toi.to_no= #towOrderlist# AND tdtl.AWB_NO != 'null' ) dual
      <isEqual property="transFlag" compareValue="true">
      WHERE 
    upper(transferGrp) IN ( upper('dummyValue')
    		
    		<isEqual property="tramac" compareValue="Y" prepend=",">
				UPPER('TT') 
			</isEqual>
			<isEqual property="inteface" compareValue="Y" prepend=",">
				 UPPER('IF') 
			</isEqual>
			<isEqual property="otherCto" compareValue="Y" prepend=",">
				 UPPER('OTHER CTO') 
			</isEqual>
			<isEqual property="airSide" compareValue="Y" prepend=",">
				 UPPER('AS') 
			</isEqual>
			<isEqual property="strngRoom" compareValue="Y" prepend=",">
				UPPER('STRONG ROOM') 
			</isEqual>
			<isEqual property="cpct" compareValue="Y" prepend=",">
				 UPPER('CPCT') 
			</isEqual>
			)
      </isEqual>
		</select>
		
			<select id="imprt_rept_510"  parameterClass="cargo.cms.imprt.report.bo.MaintainOBCMail510_ReptBO"  
		resultClass="cargo.cms.imprt.report.bo.MaintainOBCMail510_ReptBO">
		 SELECT 
		 	CATALOG as catalog,
		 	FLT_TYPE as fltType,
		 	FLT_KEY as fltKey,
		 	TO_CHAR(FLT_DATE,'DDMONYY') as fltDate,
			AWB_NO as awbNo, 
			AWB_DATE as awbDate, 
			TAG_NO as tagNo, 
			BD_ULD_KEY as bdULDKey,
			TARE_WT as tareWt,
			LSP_NO as lspNo, 				
			ORIG as orig, 
			DEST as dest, 
			ACT_PCS as actPcs, 
            ACT_WT as actWt,
            EST_PCS as estPcs,
            EST_WT as estWt,
			LOCN as locn, 
			ULD_KEY uldKey, 
			DAM_IND as damInd, 
			RMK as rmk, 
			RMK as rmkOld, 
			CR_USER_ID as crUserId, 
			CR_DATE as crDate, 
			LM_USER_ID as lmUserId,
			'update' as recordType,
			TO_CHAR(LM_DATE , 'DDMONYY HH24:MI:SS') AS lmDate		 				
		 FROM IMP_XPS_OBC_MAIL		
		 WHERE  
			FLT_KEY = #sfltKey# AND
			FLT_TYPE = 'I' AND
			CATALOG = 'IO' AND 
			<isNotEmpty property="sbdULDKey">
				BD_ULD_KEY = #sbdULDKey# AND
			</isNotEmpty>		
			TO_CHAR(FLT_DATE,'DDMONYY') = #schDate#
		ORDER BY
			TAG_NO
	</select>
	
	
	<select id="imprt_rept_650"  parameterClass="cargo.cms.imprt.report.bo.InbFltDiscrepancy650_ReptBO"  
		resultClass="cargo.cms.imprt.report.bo.InbFltDiscrepancy650_ReptBO">
		SELECT 
			TO_CHAR(A.AWB_DATE, 'DDMONYY') as awbDate,
			SUBSTR(TRIM(A.AWB_NO),1,3)||'-'||SUBSTR(TRIM(A.AWB_NO),4) as awbNo,
			TO_CHAR(A.FLT_DATE, 'DDMONYY') as fltDate,
			A.FLT_KEY as fltKey,
			PKG_COMMON.get_flt_ata(FLT.FLT_KEY,FLT.SCH_DATE,FLT.FLT_TYPE, 'DD') AS ata,
			B.AWB_DEST as dest, 
			B.CONTENT as cont, 
			B.CONSOLE_IND as consol,
			NVL(B.AWB_PCS,0) ||'/'||NVL(B.AWB_WT,0) as awbPcsWt, 
			NVL(A.MANIFEST_PCS,0) || '/' || NVL(A.MANIFEST_WT,0) as manfPcsWt, 
			NVL(A.RECD_PCS,0) || '/' || NVL(A.RECD_WT,0) as locnPcsWt, 
			decode (A.CIR_PCS, '', '', NULL, '', 0, '', (A.CIR_PCS ||'/'||A.CIR_PCS_TYPE)) as cirPcsType,
			decode (A.CIR_WT, '', '', NULL, '', 0, '', (A.CIR_WT ||'/'||A.CIR_WT_TYPE)) as cirWtType,
			B.ACCS_HANDLER as accsHandler,
			A.CIR_RMK as cirRmk,
			A.CIR_PROC_USER as userID,
			TO_CHAR(A.CIR_PROC_DATE, 'DDMONYY HH24:MI') as dateDisplay
		FROM  IMP_CAR_AWB B, IMP_CAR_SHP A 
			JOIN FLT_OPR FLT ON 
				FLT.FLT_KEY = A.FLT_KEY AND 
				FLT.SCH_DATE = A.FLT_DATE AND 
				FLT.FLT_TYPE = 'A'
		WHERE CATALOG NOT IN ('TA') AND
			A.CIR_PROC_USER is not null AND
			A.AWB_DATE = B.AWB_DATE AND
			A.AWB_NO   = B.AWB_NO   AND
			A.FLT_KEY = #sfltKey#   AND
			TO_CHAR(A.FLT_DATE, 'DDMONYY')  = #sfltDate#
		ORDER BY A.AWB_NO		
   	</select>
<select id="imprt_rept_651" parameterClass="cargo.cms.imprt.report.bo.InbConsignmentList651_ReptBO"
		resultClass="cargo.cms.imprt.report.bo.InbConsignmentList651_ReptBO">
		<![CDATA[ 
		SELECT
			TO_CHAR(A.FLT_DATE, 'DDMONYY') as fltDate,
			A.FLT_KEY as fltKey, 
			TO_CHAR(A.AWB_DATE, 'DDMONYY') as awbDate,
			A.AWB_NO as awbNo, 
			rtrim(B.AWB_ORIGIN || '/' || B.AWB_DEST, '/') as origDest, 
			UPPER(B.CONTENT) as content, 
			case WHEN (B.CONTENT like 'CONS%') THEN 'Y' ELSE 'N' end as consl,
			B.CONSOLE_IND as conslind,
			(SELECT sum(HAWB_PCS) FROM EDI_FHL_HAWB where TR_NO =  
			(select TR_NO From EDI_FHL where AWB_NO=A.AWB_NO and TO_CHAR(AWB_DATE,'DDMONYY') = TO_CHAR(A.AWB_DATE, 'DDMONYY')) ) as hawbPCS,			
			(decode(B.spl_code1,NULL,'',B.spl_code1)
      		|| decode(B.spl_code2,NULL,'',','||B.spl_code2)
   			|| decode(B.spl_code3,NULL,'',','||B.spl_code3)
      	    || decode(B.spl_code4,NULL,'',','||B.spl_code4)
      		|| decode(B.spl_code5,NULL,'',','||B.spl_code5)
      		|| decode(B.spl_code6,NULL,'',','||B.spl_code6)
      		|| decode(B.spl_code7,NULL,'',','||B.spl_code7)
      		|| decode(B.spl_code8,NULL,'',','||B.spl_code8)
      		|| decode(B.spl_code9,NULL,'',','||B.spl_code9)) as splCode1,
			(SELECT V.CC_CODE FROM V_CST_IMP_CC_CODE_AWB_ALL V
			WHERE V.FLT_KEY = A.FLT_KEY AND V.FLT_DATE = A.FLT_DATE AND V.AWB_NO = A.AWB_NO AND V.AWB_DATE = A.AWB_DATE
				  AND NVL(V.HAWB_NO, '000000000000000000') =  '000000000000000000' AND ROWNUM = 1) as ccCode,
			B.CATALOG as catalog,
			B.APPNTD_AGENT as appntdAgent,
			NVL(I.INV_PCS,0) || '/' || TRIM(TO_CHAR(NVL(I.INV_WT,0), '9999999990D9')) as invPcsWt,
			NVL(B.AWB_PCS,0) ||'/'|| TRIM(TO_CHAR(NVL(B.AWB_WT,0), '9999999990D9')) as awbPcsWt, 
			(NVL(A.MANIFEST_PCS,0) || '/' || TRIM(TO_CHAR(NVL(A.MANIFEST_WT,0), '9999999990D9'))) as manfPcsWt,
			NVL(A.RECD_PCS,0) ||'/'|| TRIM(TO_CHAR(NVL(A.RECD_WT,0), '9999999990D9'))  as bdPcsWt,
			A.BULK_PCS as manfBulkPcs,
			TRIM(TO_CHAR(NVL(A.BULK_WT,0), '9999999990D9')) as manfBulkWt,
			NVL(A.BUP_PCS,0) as manfBupPcs,
			NVL(A.BUP_WT,0)  as manfBupWt,
			CASE WHEN B.CATALOG = 'TA' THEN 0
				ELSE CASE WHEN A.CIR_WT_TYPE IS NULL THEN case when nvl(A.PPK_TYPE,'B') != 'P' then RECD_WT else 0 end 
			 		ELSE NVL(A.BULK_WT,0) + CASE WHEN A.CIR_WT_TYPE = 'SL' THEN -1 * NVL(A.CIR_BULK_WT,0) ELSE NVL(A.CIR_BULK_WT,0) END END END as bdBulkWt, 
			CASE WHEN B.CATALOG = 'TA' THEN 0
				 ELSE CASE WHEN  A.CIR_WT_TYPE IS NULL THEN case when nvl(A.PPK_TYPE,'B') = 'P' then RECD_WT else 0 end	  
						ELSE NVL(A.BUP_WT,0) + CASE WHEN A.CIR_WT_TYPE = 'SL' THEN -1 * NVL(A.CIR_BUP_WT,0) ELSE NVL(A.CIR_BUP_WT,0) END END END as bdBupWt,
			rtrim(AI.LOC_CODE, '/') || CASE WHEN INV_COUNT > 1 THEN '(+)' END  as whDestLocn,
			case when A.CIR_PROC_USER is not null then 'Y' else 'N' end as cir,
			case when A.DAM_PROC_USER is not null then 'Y' else 'N' end as dam,
			ltrim(NVL(S.PCS, TR.PCS) || '/' || NVL(S.WT, TR.WT), '/') as srfTrmPcsWt,
			NVL(A.CAR_CREATED,'N') as carYN,
		      (case when B.awb_pcs <> A.MANIFEST_PCS then 'Y'  else 'N' end ) partShpYN,
		      DECODE(A.DOC_DISC,null,null,SUBSTR(A.DOC_DISC,1,1)) docDisc,
		      ( Case when
		      (  SELECT count(1) FROM V_DDT_DTL WHERE FLT_KEY = A.FLT_KEY AND FLT_DATE = A.FLT_DATE AND AWB_NO= A.AWB_NO AND 
		      AWB_DATE = to_char(A.AWB_DATE,'DDMONYY') AND shp_trf_type='TT')>0 then 'TT'
		      when
		      (  SELECT count(1) FROM V_DDT_DTL WHERE FLT_KEY = A.FLT_KEY AND FLT_DATE = A.FLT_DATE AND AWB_NO= A.AWB_NO AND 
		      AWB_DATE = to_char(A.AWB_DATE,'DDMONYY') AND shp_trf_type='IF')>0 then 'IF'
		      when
		      (  SELECT count(1) FROM V_DDT_DTL WHERE FLT_KEY = A.FLT_KEY AND FLT_DATE = A.FLT_DATE AND AWB_NO= A.AWB_NO AND 
		      AWB_DATE = to_char(A.AWB_DATE,'DDMONYY')  AND shp_trf_type='QT')>0 then 'QT'
		      END) as trfType,
		     (CASE WHEN 
		      (select count(1) from cust_company where code=B.AGENT_CUST_NO AND NVL(virtual_cr_acc,'N') = 'Y')>0 then 'Y'
		      ELSE Case when
		      (SELECT count(1) FROM CUST_AGENT_AIRL_CREDIT WHERE CUST_NO=B.AGENT_CUST_NO 
		      AND instr( nvl(UPPER(CARR_CODE),'*'), nvl(UPPER(A.CARR_CODE),'**') ) > 0 AND nvl(upper(Status),'**') <> 'VOID'
	          AND ((B.CATALOG IN ('IG','IS') AND (CR_TYPE='Import_GEN' OR CR_TYPE='GEN'))
	          	OR (B.CATALOG ='IO' AND (CR_TYPE='Import_OBC' OR CR_TYPE='GEN'))) 
		      AND (TO_DATE(TO_CHAR(CR_EFF_DATE_FROM,'DDMONYY'),'DDMONYY') 
				<= TO_DATE(TO_CHAR(SYSDATE,'DDMONYY'),'DDMONYY') AND TO_DATE(TO_CHAR(CR_EFF_DATE_TO,'DDMONYY'),'DDMONYY') 
				>= TO_DATE(TO_CHAR(SYSDATE,'DDMONYY'),'DDMONYY') ) )>0 then 'Y'
	          ELSE CASE WHEN 
	          (SELECT count(1) FROM cust_agent_level_crd WHERE CUST_NO=B.AGENT_CUST_NO  
				AND (TO_DATE(TO_CHAR(CR_EFF_DATE_FROM,'DDMONYY'),'DDMONYY') 
				<= TO_DATE(TO_CHAR(SYSDATE,'DDMONYY'),'DDMONYY') AND TO_DATE(TO_CHAR(CR_EFF_DATE_TO,'DDMONYY'),'DDMONYY') 
				>= TO_DATE(TO_CHAR(SYSDATE,'DDMONYY'),'DDMONYY') ) AND nvl(upper(Status),'**') <> 'VOID' )>0 then 'Y'
	          ELSE 'N' 
		      END END END) as airlCrYN,
			  (CASE WHEN B.CATALOG LIKE 'T%' THEN
			  'T'
			  ELSE
			  'I'
			  END) awbType,
			  (CASE WHEN 'IMX' IN (B.SPL_CODE1,
			  B.SPL_CODE2 ,
			  B.SPL_CODE3,
			  B.SPL_CODE4 ,
			  B.SPL_CODE5,
			  B.SPL_CODE6,
			  B.SPL_CODE7,
			  B.SPL_CODE8 ,
			  B.SPL_CODE9) THEN
			  1
			  WHEN
			  'IMR' IN (B.SPL_CODE1,
			  B.SPL_CODE2 ,
			  B.SPL_CODE3,
			  B.SPL_CODE4 ,
			  B.SPL_CODE5,
			  B.SPL_CODE6,
			  B.SPL_CODE7,
			  B.SPL_CODE8 ,
			  B.SPL_CODE9) THEN
			  1
			  ELSE 
			  2 
			  END ) displayOrd,
			    (SELECT CASE WHEN (SELECT count(1) FROM XT_IMP_CAR_SHP_DTL xt where xt.awb_no = A.AWB_NO and xt.AWB_DATE = A.AWB_DATE and xt.IMP_FLT_KEY = A.flt_key and xt.IMP_FLT_DATE = A.flt_date ) > 0 then 'Y' else 'N' end  from dual) as xtShpFlg
		      ]]>
		FROM IMP_CAR_AWB B, IMP_CAR_SHP A
		LEFT JOIN 
		(SELECT AWB_NO, AWB_DATE, FLT_KEY, FLT_DATE, MIN(SEQ_NO) SEQ_NO, SUM(LOCN_PCS) INV_PCS, SUM(LOCN_WT) INV_WT, 
		 SUM(DECODE(LOC_CODE, NULL, 0, 1)) LOCN_COUNT, count(1) INV_COUNT
			FROM AWB_INVENTORY 
			GROUP BY AWB_NO, AWB_DATE, FLT_KEY, FLT_DATE
		) I 
		   ON A.AWB_NO = I.AWB_NO AND
			A.AWB_DATE = I.AWB_DATE AND
			A.FLT_KEY = I.FLT_KEY AND
			A.FLT_DATE = I.FLT_DATE
		LEFT JOIN AWB_INVENTORY AI ON AI.SEQ_NO = I.SEQ_NO
		LEFT JOIN 
		(SELECT SF.AWB_NO, SF.AWB_DATE, SF.FLT_KEY, SF.FLT_DATE, SUM(SR.SRF_PCS) PCS, SUM(SR.SRF_WT) WT			  
			FROM IMP_SRF SR 
			join IMP_SRF_FLT SF ON SR.SRF_NO = SF.SRF_NO
			WHERE ((SR.SRF_EXPY_DATE > sysdate and SR.STATUS ='ISSUED') or SR.STATUS ='POSTED' or
				   SR.SRF_NO IN (SELECT SRF_NO FROM IMP_CDIF WHERE VOID_DATE IS NULL))    
			GROUP BY SF.AWB_NO, SF.AWB_DATE, SF.FLT_KEY, SF.FLT_DATE
		) S ON A.AWB_NO = S.AWB_NO AND
			A.AWB_DATE = S.AWB_DATE AND
			A.FLT_KEY = S.FLT_KEY AND
			A.FLT_DATE = S.FLT_DATE
		LEFT JOIN 
		(SELECT D.AWB_NO, D.AWB_DATE, D.FLT_KEY, D.FLT_DATE, SUM(D.PCS) PCS, SUM(D.WT) WT		
			FROM IMP_TRM_DTL D
			JOIN IMP_TRM_HD H ON H.TRM_NO = D.TRM_NO
			WHERE H.VOID_DATE IS NULL
			GROUP BY D.AWB_NO, D.AWB_DATE, D.FLT_KEY, D.FLT_DATE
		) TR ON
			A.AWB_NO = TR.AWB_NO AND
			A.AWB_DATE = TR.AWB_DATE AND
			A.FLT_KEY = TR.FLT_KEY AND
			A.FLT_DATE = TR.FLT_DATE		
		WHERE 
			A.AWB_DATE = B.AWB_DATE AND
			A.AWB_NO   = B.AWB_NO AND
			A.FLT_KEY = #sfltKey# AND
			TO_CHAR(A.FLT_DATE, 'DDMONYY')  = #sfltDate#
			 <isEqual property="xtShpFlg" compareValue="Y">
     		<![CDATA[
	 			 AND  EXISTS (SELECT NULL FROM XT_IMP_CAR_SHP_DTL xt where xt.awb_no = A.AWB_NO and xt.AWB_DATE = A.AWB_DATE and xt.IMP_FLT_KEY = A.flt_key and xt.IMP_FLT_DATE = A.flt_date )
      		 	]]>
    		 </isEqual>  
		ORDER BY awbtype,displayOrd,awbNo
		</select>  
	
	<select id="imprt_rept_552_s1" parameterClass="cargo.cms.imprt.report.bo.PostFltChkList552_ReptBO" 	resultClass="cargo.cms.imprt.report.bo.PostFltChkList552_ReptBO">
   		SELECT 
   			TAG_NO as tagNo, ORIG as origin, DEST as whDest, 
   			ACT_PCS as actPcs, ACT_WT as actWt 
   		FROM IMP_XPS_OBC_MAIL 
   		WHERE 
   			FLT_KEY = #fltKey# and TO_CHAR(FLT_DATE, 'DDMONYY') = #fltDate# 
   			and AWB_NO IS NULL  and AWB_DATE IS NULL AND CATALOG='TM'
   	</select>

	<select id="imprt_rept_512"  parameterClass="cargo.cms.imprt.report.bo.InbConsFlightList512_ReptBO"  
		resultClass="cargo.cms.imprt.report.bo.InbConsFlightList512_ReptBO">
		 <![CDATA[
	   SELECT      SHP.FLT_KEY as fltKey ,
	     SHP.FLT_DATE as fltDate,     SHP.FLT_DATE_DISPLAY as fltDateDisplay,     
		 SUBSTR(TRIM(TO_CHAR(NVL(FLT.SCH_TIME,0),'0000')),0,2)|| ':'||  SUBSTR(TRIM(TO_CHAR(NVL(FLT.SCH_TIME,0),'0000')),3,4) AS sta,     
		 PKG_COMMON.get_flt_eta(FLT.FLT_KEY,FLT.SCH_DATE,'A')	AS eta,    
		 PKG_COMMON.get_flt_ata(FLT.FLT_KEY,FLT.SCH_DATE,'A','DD')AS ata,
		 pkg_common.flt_ports(FLT.FLT_KEY,FLT.SCH_DATE) AS route,     
		 FLT.ACFT_REG_NO as reg,     
		 FLT.ACFT_TYPE  as type,     
		 SHP.FFM as ffm,      
		 SHP.CAR as car,      
		 FLT.ORIG as orig,
		 FLT.DEST as dest
		 FROM     (SELECT FLT_KEY,CARR_CODE,TO_CHAR(FLT_DATE,'DDMONYY') FLT_DATE, TO_CHAR(FLT_DATE,'DDMONYY') FLT_DATE_DISPLAY,      
			 SUM(CASE WHEN NVL(FFM_FLG, 'N') ='Y' THEN 1 ELSE 0 END) AS FFM,       
			 SUM(CASE WHEN (NVL(CAR_CREATED, 'N') = 'Y' or RECD_PCS > 0) THEN 1 ELSE 0 END) AS CAR 
			 FROM IMP_CAR_SHP GROUP BY FLT_KEY, FLT_DATE,CARR_CODE     ) SHP     
		 JOIN FLT_OPR FLT ON       FLT.FLT_KEY = SHP.FLT_KEY AND       
		 FLT.SCH_DATE = SHP.FLT_DATE AND       FLT.FLT_TYPE = 'A' 
		 WHERE SHP.FLT_DATE = #sfltDate# 	 
		]]>
		<isEqual property="sfltKey" compareValue="%">					
			AND SHP.FLT_KEY LIKE #sfltKey#								
		</isEqual>			
		<isNotEmpty property="scarrCode">
			<isEmpty property="sfltNo">
				AND SHP.CARR_CODE = #scarrCode#
			</isEmpty>
		</isNotEmpty>		
		<isNotEmpty property="sfltNo">
			<isEmpty property="scarrCode">
				AND SHP.FLT_KEY like('%'|| #sfltNo#)
			</isEmpty>
		</isNotEmpty>
		<isNotEmpty property="sfltNo">
			<isNotEmpty property="scarrCode">
				AND SHP.FLT_KEY=#sfltKey#
			</isNotEmpty>
		</isNotEmpty>	
		<isEmpty property="scarrCode">
			<isNotEmpty property="loginCarrier">
				AND	(FLT.CARR_CODE = #loginCarrier#
				OR FLT.CARR_CODE IN (SELECT CARR_CODE FROM MAST_CARR_GRP 
				WHERE GRP_CARR_CODE	= #loginCarrier#))							
			</isNotEmpty>
		</isEmpty>
		ORDER BY sta
</select>
<select id="imprt_rept_652"  parameterClass="cargo.cms.imprt.report.bo.UpdateDamageULD652_ReptBO"  
		resultClass="cargo.cms.imprt.report.bo.UpdateDamageULD652_ReptBO">
		SELECT  A.FLT_KEY AS flightKey,
    A.FLT_NO AS flightNo , 
    A.CARR_CODE AS carrierCode ,
    TO_CHAR(A.FLT_DATE,'DDMONYY') AS flightDate,
    A.TR_NO AS trNo,
    B.ULD_KEY AS uldKey,     
    B.LOC_CODE AS wareHouseLoc,
    B.EIC_IND AS eic,
    B.EMPTY_IND AS empty,
    B.DAM_IND AS uldDamage,
    B.CARGO_DAM AS crgDamage,
    B.DAM_IND AS condition,
    B.DAM_RMK AS damageRemark,
    B.DOC_LINE_NO AS docLineNo,
    B.ULD_CARR AS uldCarr,B.ULD_TYPE AS uldType,
    C.ORIG AS ladingPoint,
    C.DEST AS unladingPoint, 
    C.ACFT_REG_NO AS regn,
    (SELECT MAST_CODE_DTL.CODE_DESC FROM FLT_OPR, MAST_CODE_DTL WHERE  MAST_CODE_DTL.CODE_TYPE =  'WTH_CONDN' AND
             MAST_CODE_DTL.CODE  = FLT_OPR.WTHR_COND AND FLT_OPR.SCH_DATE =  A.FLT_DATE AND FLT_OPR.FLT_KEY =  A.FLT_KEY AND FLT_OPR.FLT_TYPE = 'A') AS weatherCondition,
    A.CARR_CODE AS owner,
    PKG_COMMON.get_flt_ata(C.FLT_KEY,C.SCH_DATE,'A') AS ata
   FROM IMP_RAMP_CHK_HD A, IMP_RAMP_CHK_DTL B, FLT_OPR C, MAST_CARRIER  D
    WHERE A.FLT_NO = #sflightNo#
    AND A.CARR_CODE  = upper( #scarrierCode#)
	AND A.FLT_DATE   = TO_DATE(#sflightDate#,'DDMONYY')
	AND A.FLT_KEY    = C.FLT_KEY
	AND A.FLT_DATE   = C.SCH_DATE
	AND B.DAM_IND    ='Y'
	AND A.TR_NO      = B.TR_NO
	AND B.CHKIN_YN   = 'Y'
	AND C.CARR_CODE  = D.CODE
	AND C.FLT_TYPE   = 'A'
	ORDER BY B.ULD_KEY
   	</select>

	<select id="transactionID"  parameterClass="java.lang.String"  
		resultClass="java.lang.String">
		SELECT  ULD_IMAGE_NAME as fileName	FROM ULD_IMAGE WHERE ULD_KEY =#uldKey# and rownum = 1
   	</select>
    <select id="uld_images"  parameterClass="cargo.cms.imprt.report.bo.UpdateDamageULD652_ReptBO" resultClass="cargo.cms.imprt.report.bo.UpdateDamageULD652_ReptBO">
	  select (select rule_value from cmsrules where rule_code = 'ImageUploadRootPath') || img_path || img_name as  path from fw_image_store where img_session_id=#transID# and upper(img_name) like  '%JPG%' or upper(img_name) like  '%JPEG%'  
	<!-- select img_path || img_name as  path from fw_image_store where img_session_id=#transID#    -->
    </select> 

	<select id="imprt_rept_653"  parameterClass="cargo.cms.imprt.report.bo.PendingFollowupActionList653_ReptBO"  
		resultClass="cargo.cms.imprt.report.bo.PendingFollowupActionList653_ReptBO">
		select
			     cust.awb_no AS awbNo,
     			 cust.int_purpose AS purpose,
     			 cust.int_mode AS interactMode,
     			 (SELECT CODE_DESC FROM MAST_CODE_DTL WHERE CODE = cust.int_purpose AND CODE_TYPE = 'CUST_PURPOSE') AS purposeDesc,
     		 	 (SELECT CODE_DESC FROM MAST_CODE_DTL WHERE CODE = cust.int_mode AND CODE_TYPE = 'INTER_MODE') AS interactModeDesc,
     			 cust.contact_person AS contName,
     			 to_char(cust.cr_date,'DDMONYY HH24:MI') AS contDate,
     			 to_char(cust.follow_up_date,'DDMONYY HH24:MI') AS fallowUpDate,
     			 TO_CHAR(cust.LM_DATE, 'DDMONYY HH24:MI:SSSSS') as lmDate,
     			 cust.REMARKS AS remarks,
     			 cust.follow_up_action AS fallowUpAction
           		 FROM CUST_INTERACTION cust
           		 WHERE
           		 to_char(cust.FOLLOW_UP_DATE,'DDMONYY') =  to_Date(#sfallowUpDate#,'DDMONYY')
                           		 AND COMP_DATE IS NULL
      			 <isNotEmpty property="sfallowUpAction">
      			 		AND cust.FOLLOW_UP_ACTION = #sfallowUpAction#
      			 </isNotEmpty>
      			 <isNotEmpty property="spurpose">
      			 		AND cust.int_purpose = #spurpose#
      			 </isNotEmpty>
      			 ORDER BY fallowUpDate
   	</select>
   	 	<select id="imprt_rept_654"  parameterClass="cargo.cms.imprt.report.bo.CustomerInteraction654_ReptBO"  
		resultClass="cargo.cms.imprt.report.bo.CustomerInteraction654_ReptBO">
		select 
				 cust.awb_no AS awbNo, 
				
     			 cust.int_purpose AS purpose,
     			 cust.int_mode AS interactMode,
     			  (SELECT CODE_DESC FROM MAST_CODE_DTL WHERE CODE = cust.int_purpose AND CODE_TYPE = 'CUST_PURPOSE') AS purposeDesc,
     		 	 (SELECT CODE_DESC FROM MAST_CODE_DTL WHERE CODE = cust.int_mode AND CODE_TYPE = 'INTER_MODE') AS interactModeDesc,
     			 cust.contact_person AS contName,
     			 to_char(cust.INT_DATE,'DDMONYY HH24:MI') AS contDate,
     			 cust.follow_up_action AS actionReq,
    			 to_char(cust.follow_up_date,'DDMONYY HH24:MI') AS fallowUpDate,
    			 cust.CR_USER_ID AS createdBy,
    			 cust.comp_by AS complBy,
    			 TO_CHAR(cust.comp_date,'DDMONYY') AS complDate,
     			 cust.remarks AS remarks    
				 FROM CUST_INTERACTION cust 
      			 WHERE 
      			 cust.awb_no = #sawbNo# 
      			 <isNotEmpty property="spurpose">
      			 		AND cust.int_purpose = #spurpose#
      			 </isNotEmpty>
      			
      			 <isNotEmpty property="arrDate">
      			 		<isNotEmpty property="arrDateTo">
							AND cust.int_date between to_Date(#arrDateHm#,'DDMONYY HH24MI') and to_Date(#arrDateToHm#,'DDMONYY HH24MI')
						</isNotEmpty>
      			 </isNotEmpty>
      			 order by purposeDesc asc,interactModeDesc asc,contDate asc,fallowUpDate asc
   	</select>

	<select id="imprt_rept_553"  parameterClass="cargo.cms.imprt.report.bo.CrgDmgRept553_ReptBO" resultClass="cargo.cms.imprt.report.bo.CrgDmgRept553_ReptBO">
	SELECT 
			a.AWB_NO AS awbNumber,
			TO_CHAR(a.AWB_DATE, 'DDMONYY') AS awbDate,
			TO_CHAR(a.FLT_DATE, 'DDMONYY') AS flightDate,
			a.FLT_KEY AS flightKey, 
			pkg_common.get_flt_ata(a.flt_key, a.flt_date,'A') AS ata,  
			b.ACCS_HANDLER AS accsHandler,
			b.CONTENT AS content,
			a.DAM_RMK AS awbRemarks,
			b.CONSOLE_IND cnslInd,
			a.IMG_TRANS_ID as transactionId
		FROM IMP_CAR_SHP a, IMP_CAR_AWB b
		WHERE a.AWB_NO = #awb#
			AND to_date(a.AWB_DATE) = #awbDate#
			AND a.FLT_DATE = #fltDate#
			AND a.FLT_KEY = #fltKey#
			AND a.AWB_NO = b.AWB_NO 
			AND a.AWB_DATE = b.AWB_DATE
    </select> 
    <!--  added by Surendra Gollapalli on 11MAY2012 START -->
    
    
    <select id="image_collections"  parameterClass="cargo.cms.imprt.report.bo.CrgDmgRept553_ReptBO" resultClass="cargo.cms.imprt.report.bo.CrgDmgRept553_ReptBO">
	  select (select rule_value from cmsrules where rule_code = 'ImageUploadRootPath') || img_path || img_name as  path from fw_image_store where img_session_id=#transactionId# and upper(img_name) like  '%JPG%' or upper(img_name) like  '%JPEG%'  
	 <!--  select img_path || img_name as  path from fw_image_store where img_session_id='20120208165100695186197'
	 select img_path || img_name as  path from fw_image_store where img_session_id=#transactionId#    -->
    </select> 
    

    
    
    
   	
   	<select id="imprt_rept_553_s1"  parameterClass="cargo.cms.imprt.report.bo.CrgDmgRept553_ReptBO" resultClass="cargo.cms.imprt.report.bo.CrgDmgRept553_ReptBO">
	select awb.FLT_KEY as flightKey,
 	TO_CHAR(awb.FLT_DATE,'DDMONYY') as flightDate,
 	awb.AWB_NO as awb,
 	awb.LOC_CODE as location,
 	decode(awb.LSP_NO,null, awb.ULD_KEY, awb.LSP_NO) lspno,
 	awb.LOCN_PCS as storagepcs,
 	awb.LOCN_WT as storagewts,
 	awb.DAM_PCS as dampcs,
 	awb.DAM_WT as damwts
    FROM
    AWB_INVENTORY awb  
    where awb.AWB_NO= #awb# AND awb.AWB_DATE= #awbDate# and awb.DAM_IND = 'Y'
    </select> 
   	
   	<select id="imprt_rept_553_s2"  parameterClass="cargo.cms.imprt.report.bo.CrgDmgRept553_ReptBO" resultClass="cargo.cms.imprt.report.bo.CrgDmgRept553_ReptBO">
		SELECT
			a.DAM_PCS AS damagePc,
			b.CODE_DESC AS damageDescription
		FROM MAST_CODE_DTL b 
		LEFT JOIN IMP_AWB_STRG_DAM_COND a
			 ON a.DAM_COND = b.CODE 
				AND A.AWB_NO = #awb#
				AND A.AWB_DATE = #awbDate#
				AND A.FLT_KEY = #fltKey#
				AND A.FLT_DATE = #fltDate#
		WHERE b.CODE_TYPE = 'DAMAGE_CONDN'
		ORDER BY b.CODE_DESC
	</select>
	
	<select id="imprt_rept_553_s3"  parameterClass="cargo.cms.imprt.report.bo.CrgDmgRept553_ReptBO" resultClass="cargo.cms.imprt.report.bo.CrgDmgRept553_ReptBO">
		SELECT 
			a.HAWB_NO AS hawbNumber,
			a.HAWB_BRKDN_PCS AS hawbBreakdownPieces,
			a.HAWB_BRKDN_WT AS hawbBreakdownWeight,
			a.DAM_PCS AS damagePieces,
			a.DAM_WT AS damageWeight,
			a.DAM_RMK AS damageRemarks
		FROM IMP_HAWB_STRG_DTL a
		WHERE A.AWB_NO = #awb#
			AND A.AWB_DATE = #awbDate#
			AND A.FLT_KEY = #fltKey#
			AND A.FLT_DATE = #fltDate#
	</select>
	
	<!-- Enquire CDIF -->
	<select id="imprt_rept_554_enquireHd"  parameterClass="cargo.cms.imprt.report.bo.EnquireCDIF554_ReptBO" resultClass="cargo.cms.imprt.report.bo.EnquireCDIF554_ReptBO">
		select 
			AWB_NO awbNo,
			SUBSTR(AWB_NO,1,3)  awbNoPrefix , 
			SUBSTR(AWB_NO,4)  awbNoSuffix , 
			SUBSTR(AWB_NO,1,3)||'-'||SUBSTR(AWB_NO,4) as awbNoDisp ,
			TO_CHAR(AWB_DATE, 'DDMONYY') awbDate, 
			SRF_NO srfNo,
			SUBSTR(SRF_NO,1,6)  srfNoPrefix , 
			SUBSTR(SRF_NO,7)  srfNoSuffix , 
			SUBSTR(SRF_NO,1,8) as srfNoDisp ,
			CDIF_NO cdifNo,
			TO_CHAR(CDIF_PCS) cdifPcs,
			TO_CHAR(CDIF_WT) cdifWt,			
			SUBSTR(CDIF_NO,1,8)  cdifNoPrefix , 
			SUBSTR(CDIF_NO,9)  cdifNoSuffix , 
			SUBSTR(CDIF_NO,1,8)||'-'||SUBSTR(CDIF_NO,9) as cdifNoDisp,
			upper(UTL_RMK) utlRemark,
			UTL_EMAIL1 emailAddress1, 
			UTL_EMAIL2 emailAddress2, 
			UTL_EMAIL3 emailAddress3			 
		from IMP_CDIF  
		where 		
		CDIF_NO = #cdifNo# 
	</select>
	
	<select id="imprt_rept_554_awbInfo"  parameterClass="cargo.cms.imprt.report.bo.EnquireCDIF554_ReptBO" resultClass="cargo.cms.imprt.report.bo.EnquireCDIF554_ReptBO">
		SELECT
		A.AWB_NO awbNo,
		SUBSTR(A.AWB_NO,1,3)  awbNoPrefix , 
		SUBSTR(A.AWB_NO,4)  awbNoSuffix , 
		SUBSTR(A.AWB_NO,1,3)||'-'||SUBSTR(A.AWB_NO,4) as awbNoDisp ,
		TO_CHAR(A.AWB_DATE, 'DDMONYY') awbDate,
		A.SRF_NO srfNo,
		SUBSTR(A.SRF_NO,1,6)  srfNoPrefix , 
		SUBSTR(A.SRF_NO,7)  srfNoSuffix , 
		SUBSTR(A.SRF_NO,1,6)||'-'||SUBSTR(A.SRF_NO,7) as srfNoDisp , 
		TO_CHAR(B.FLT_DATE,'DDMONYY') fltDate, 
		B.FLT_KEY fltNoKey, 
		TO_CHAR(C.ACT_TIME) ata,
		PKG_COMMON.get_flt_ata(C.FLT_KEY, C.SCH_DATE, 'A') AS ataTime,
		TO_CHAR(A.SRF_PCS) delvPc, 
		TO_CHAR(A.SRF_WT) delvWt, 
		D.CONTENT content,
		D.CSGNE_NAME csgnDesc, 
		D.APPNTD_AGENT agentDesc,
		A.Truck_No truckNo,
		TO_CHAR(A.SRF_PCS - E.dlvPcSum) unDelvPcs,
    	TO_CHAR(A.SRF_WT - E.dlvWtSum) unDelvWt
		FROM imp_srf A, 
		(Select FLT_KEY, FLT_DATE from imp_srf_flt 
		where SRF_NO = #srfNo# and ROWNUM = 1
		order by FLT_DATE DESC) B
		left join flt_opr C on B.flt_key = C.flt_key
		   AND B.flt_date = C.sch_date AND C.FLT_TYPE = 'A',
		imp_car_awb D,
		(select sum(dlv_pcs) dlvPcSum,sum(dlv_Wt) dlvWtSum from imp_srf_flt where srf_no = #srfNo# group by srf_no) E
		WHERE A.awb_no = D.awb_no
   		AND A.awb_date = D.awb_date
        AND A.srf_no = #srfNo#
	</select>
	
	
	<select id="imprt_rept_554"  parameterClass="cargo.cms.imprt.report.bo.EnquireCDIF554_ReptBO" resultClass="cargo.cms.imprt.report.bo.EnquireCDIF554_ReptBO">
		select 
			AWB_NO awbNo,
			SUBSTR(AWB_NO,1,3)  awbNoPrefix , 
			SUBSTR(AWB_NO,4)  awbNoSuffix , 
			SUBSTR(AWB_NO,1,3)||'-'||SUBSTR(AWB_NO,4) as awbNoDisp ,
			TO_CHAR(AWB_DATE, 'DDMONYY') awbDate, 
			HAWB_NO hawbNo,
			CDIF_NO cdifNo,
			SUBSTR(CDIF_NO,1,8)  cdifNoPrefix , 
			SUBSTR(CDIF_NO,9)  cdifNoSuffix , 
			SUBSTR(CDIF_NO,1,8)||'-'||SUBSTR(CDIF_NO,9) as cdifNoDisp,
			TO_CHAR(DOC_LINE_NO) docLineNo, 
			decode(TO_CHAR(CDIF_DT_PCS), NULL,' ',TO_CHAR(CDIF_DT_PCS)) detainPc,
			decode(TO_CHAR(CDIF_DT_WT), NULL,' ',TO_CHAR(CDIF_DT_WT)) detainWt,
			decode(TO_CHAR(CDIF_PS_PCS), NULL,' ',TO_CHAR(CDIF_PS_PCS)) psPc,
			decode(TO_CHAR(CDIF_PS_WT), NULL,' ',TO_CHAR(CDIF_PS_WT)) psWt,
			decode(TO_CHAR(CDIF_UTL_PCS), NULL,' ',TO_CHAR(CDIF_UTL_PCS)) unlocPc,
			decode(TO_CHAR(CDIF_UTL_WT), NULL,' ',TO_CHAR(CDIF_UTL_WT)) unlocWt,
			decode(TO_CHAR(CDIF_FOLLOW_ON_PCS), NULL,' ',TO_CHAR(CDIF_FOLLOW_ON_PCS)) followonPc,
			decode(TO_CHAR(CDIF_FOLLOW_ON_Wt), NULL,' ',TO_CHAR(CDIF_FOLLOW_ON_Wt)) followonWt,
			TO_CHAR(LM_DATE, 'DDMONYY HH24:MI:SS') lmDate,
			upper(RMK) cdifRemark
		from IMP_CDIF_HAWB  
		where 		
		CDIF_NO = #cdifNo#
	</select>
	<!-- END OF Enquire CDIF -->
	
	<!-- Maintain CDIF -->	
	<select id="imprt_rept_556"  parameterClass="cargo.cms.imprt.report.bo.MaintainCDIF556_ReptBO" resultClass="cargo.cms.imprt.report.bo.MaintainCDIF556_ReptBO">
	SELECT
	A.COLL_NAME collName,
	A.COLL_HKID collHkid,
	(select cc_code from imp_srf_awb_inventory where awb_no = #awbNo# AND srf_no
	=#srfNo# and rownum = 1) ccCode,
	( SELECT SUM(ISRF.RELPCS) FROM IMP_CAR_SHP ICS
	LEFT JOIN (SELECT SF.AWB_NO, SF.AWB_DATE, SF.ORIG_FLT_KEY,
	SF.ORIG_FLT_DATE, SUM(SR.SRF_PCS) SRFPCS, SUM(SR.SRF_WT)
	SRFWT,SUM(SF.DLV_PCS) RELPCS,
	SUM(DLV_WT) RELWT
	FROM IMP_SRF SR
	join IMP_SRF_FLT SF ON SR.SRF_NO = SF.SRF_NO
	WHERE ((SR.STATUS ='ISSUED') or SR.STATUS ='POSTED' or
	SR.SRF_NO IN (SELECT SRF_NO FROM IMP_CDIF WHERE VOID_DATE IS NULL))
	GROUP BY SF.AWB_NO, SF.AWB_DATE, SF.ORIG_FLT_KEY, SF.ORIG_FLT_DATE
	) ISRF ON ICS.AWB_NO = ISRF.AWB_NO AND
	ICS.AWB_DATE = ISRF.AWB_DATE AND
	ICS.FLT_KEY = ISRF.ORIG_FLT_KEY AND
	ICS.FLT_DATE = ISRF.ORIG_FLT_DATE
	Where ICS.AWB_NO = #awbNo# AND
	ICS.AWB_DATE = to_date(#awbDate#,'DDMONYY'))dlvPcToDate
	FROM imp_srf A,
	imp_srf_flt B
	WHERE A.srf_no = B.srf_no
	AND A.awb_no = #awbNo#
	AND A.srf_no = #srfNo#
	GROUP BY B.srf_no,A.COLL_NAME,A.COLL_HKID
	</select>
				
	<select id="imprt_rept_556_1"  parameterClass="cargo.cms.imprt.report.bo.MaintainCDIF556_ReptBO" resultClass="cargo.cms.imprt.report.bo.MaintainCDIF556_ReptBO">
		SELECT
		A.SRF_NO srfNumber,
		TO_CHAR(A.SRF_PCS) srfPcs, 
		TO_CHAR(A.SRF_WT) srfWt, 
		E.dlvPcSum dlvPcs,
		E.dlvWtSum dlvWt,
		TO_CHAR(A.SRF_PCS - E.dlvPcSum) nonDelPcs,
    	TO_CHAR(A.SRF_WT - E.dlvWtSum) nonDelWt
		FROM imp_srf A join imp_car_awb D on A.awb_no = D.awb_no AND A.awb_date = D.awb_date,
			(Select FLT_KEY, FLT_DATE from imp_srf_flt where SRF_NO = #srfNo# and ROWNUM = 1 order by FLT_DATE DESC) B
			left join flt_opr C on B.flt_key = C.flt_key AND B.flt_date = C.sch_date AND C.FLT_TYPE = 'A',			
			(select sum(dlv_pcs) dlvPcSum,sum(dlv_Wt) dlvWtSum from imp_srf_flt where srf_no = #srfNo# group by srf_no) E
		WHERE A.srf_no = #srfNo#
	</select>
	
	<select id="imprt_rept_getHawbLocation"  parameterClass="cargo.cms.imprt.report.bo.MaintainCDIF556_ReptBO" resultClass="cargo.cms.imprt.report.bo.MaintainCDIF556_ReptBO">
		select row_number() over (order by  loc_code ) as serialNo,loc_code as location,cdif_pc as locPcs,cdif_wt locWt, decode(lsp_no,null,uld_key,lsp_no) as lsp from imp_srf_awb_inventory where srf_no = #srfNo# and cdif_pc > 0
	</select>
	<select id="imprt_rept_getHawbPcWt"  parameterClass="cargo.cms.imprt.report.bo.MaintainCDIF556_ReptBO" resultClass="java.lang.String">
		select hawb_pcs||'/'||hawb_wt as hawbPcWt from mast_hawb where awb_no=#awbNo# and awb_date=#awbDate# and hawb_no=#hawbNo#
	</select>
	<select id="imprt_rept_getAWBPcWt"  parameterClass="cargo.cms.imprt.report.bo.MaintainCDIF556_ReptBO" resultClass="java.lang.String">
		select pcs||'/'||wt as hawbPcWt from AWB where awb_no=#awbNo# and awb_date=#awbDate#
	</select>
	<!-- END OF Maintain CDIF -->
	
<select id="imp_list_trucker_manifest_138" parameterClass="cargo.cms.imprt.report.bo.ListTruckerMnfstRept_138BO" resultClass="cargo.cms.imprt.report.bo.ListTruckerMnfstRept_138BO">
		Select #iataCode# as iataCode,
			   CC.CODE_DESC as agentName,
			   CONCAT(CONCAT(CC.TEL_IMP1,' '),CC.TEL_IMP2) as telNo,
			   CONCAT(CONCAT(CC.FAX1,'  '),CC.FAX2) as fax,
			   CONCAT(CONCAT(CC.EMAIL1,' , '),CC.EMAIL2) as email,
			   DBMS_RANDOM.VALUE(50000,300000) as totalOSPayment,
			   SUBSTR(CS.AWB_NO,1,3) || '-' || SUBSTR(CS.AWB_NO,4) as awbNo2,
			   CS.AWB_NO as awbNo2,
			   CS.FLT_KEY as fltNo,
			   TO_CHAR(CS.FLT_DATE, 'DDMONYY') as fltDate,
			   NVL(CS.RECD_PCS,0) as invPc,
			   NVL(CS.RECD_WT,0) as invWt,			   
			   CA.CONTENT as cont,
			   CA.CC_CODE as cc,
			   DECODE(CS.DAM_PROC_DATE,NULL,'N','Y') as dam,
			   DBMS_RANDOM.VALUE(0,1000) as oscredit,
			   DBMS_RANDOM.VALUE(0,1000) as oscash,
			   ES.LM_DATE as ecansendDt
		FROM IMP_CAR_SHP CS
		LEFT JOIN IMP_CAR_AWB CA ON CA.AWB_NO = CS.AWB_NO AND CA.AWB_DATE = CS.AWB_DATE
		LEFT JOIN IMP_ECAN_SHP ES ON ES.AWB_DATE = CS.AWB_DATE AND ES.AWB_NO = CS.AWB_NO AND ES.FLT_DATE = CS.FLT_DATE AND ES.FLT_KEY = CS.FLT_KEY
		LEFT JOIN CUST_COMPANY CC ON CC.CODE = CA.APPNTD_AGENT
		WHERE CC.CODE_DESC LIKE '%A%'

</select>

<!-- Rahul Start Physical Clearance Action List  -->	
	<select id="phy_clearance_list_529"  parameterClass="cargo.cms.imprt.report.bo.PhyClearanceList529_ReptBO" resultClass="cargo.cms.imprt.report.bo.PhyClearanceList529_ReptBO">
		SELECT 
	  			A.AWB_NO as awbNo, SUBSTR(TRIM(A.AWB_NO),1,3)||'-'||SUBSTR(TRIM(A.AWB_NO),4) AS awbNoDisplay, TO_CHAR(A.AWB_DATE, 'DDMONYY') as awbDate, 
	  			A.FLT_KEY as fltNo, TO_CHAR(A.FLT_DATE, 'DDMONYY') as arrDate, V.HAWB_NO as hawbNo,FH.MANIFEST_DESC hawbContent, E.APPNTD_AGENT as agtName, A.MANIFEST_PCS as manfPcs, 
	  			A.MANIFEST_WT as manfWt, F.DOC_REQ as docReqYN, F.DOC_RCV as docRecvYN, D.CC_CATEGORY as ccCategory, V.CC_CODE as ccCode, 
	  			E.ALLOW_PACCO as paccoYN, F.RTRV_JO as rtrvJoYN, F.PHY_ACTION_STATUS as status, (A.FLT_KEY || '/' || 
	  			TO_CHAR(A.FLT_DATE, 'DDMONYY')) as fltNoDtDisplay, (SELECT SUM(LOCN_PCS) FROM AWB_INVENTORY WHERE AWB_NO=A.AWB_NO AND AWB_DATE=A.AWB_DATE 
	  			AND FLT_KEY=A.FLT_KEY AND FLT_DATE=A.FLT_DATE) as invPcs, (SELECT SUM(LOCN_WT) FROM AWB_INVENTORY WHERE AWB_NO=A.AWB_NO AND AWB_DATE=A.AWB_DATE 
	  			AND FLT_KEY=A.FLT_KEY AND FLT_DATE=A.FLT_DATE) as invWt, (SELECT B1.TRUCK_DOCK FROM IMP_TRUCK_SRF A1, TRUCK_TRIP B1 WHERE B1.TRIP_ID=A1.TRIP_ID AND 
	        	A1.SRF_NO=(SELECT SRF.SRF_NO FROM IMP_SRF SRF,IMP_SRF_FLT SFLT WHERE SRF.AWB_NO=A.AWB_NO AND SRF.AWB_DATE=A.AWB_DATE AND SRF.SRF_NO=SFLT.SRF_NO
	        	AND SFLT.FLT_KEY=A.FLT_KEY AND SFLT.FLT_DATE=A.FLT_DATE AND SRF.STATUS='ISSUED' AND SRF.SRF_EXPY_DATE>=SYSDATE)) AS truckDock ,
	        	(case when D.CC_CATEGORY IN ('Phy', 'Phy + Doc') and D.IMM_CHK_IND = 'Y' then 'CI' else
	         	 case when V.CC_CODE ='TB' then 'TB' else
	         	 case when J.AWB_NO IS NOT NULL then 'BKG' else
	         	 case when (E.ALLOW_PACCO='Y' AND D.constraint='Y') then 'PACCO' else 
	            case when D.constraint='Y' then 'OTHERS' end end end end end) condColumn
			FROM 
	  			IMP_CAR_SHP A
	        JOIN AWB AWB ON AWB.AWB_NO=A.AWB_NO AND AWB.AWB_DATE=A.AWB_DATE 
	        JOIN IMP_CAR_AWB E ON E.AWB_NO=A.AWB_NO AND E.AWB_DATE=A.AWB_DATE 
	        JOIN FLT_OPR C ON C.FLT_KEY=A.FLT_KEY AND C.SCH_DATE=A.FLT_DATE AND C.FLT_TYPE='A'
	        LEFT JOIN (SELECT SUM(LOCN_PCS) LOCN_PCS, AWB_NO,FLT_KEY,AWB_DATE,FLT_DATE FROM AWB_INVENTORY AW_INGROUP GROUP BY AWB_NO, FLT_KEY, 
	      			AWB_DATE, FLT_DATE) AWB_INV ON AWB_INV.AWB_NO=A.AWB_NO AND  AWB_INV.AWB_DATE=A.AWB_DATE AND AWB_INV.FLT_KEY=A.FLT_KEY AND  AWB_INV.FLT_DATE=A.FLT_DATE
	        LEFT JOIN V_CST_IMP_CC_CODE V ON V.AWB_NO = A.AWB_NO AND V.FLT_KEY=A.FLT_KEY AND V.FLT_DATE=A.FLT_DATE
	        LEFT JOIN (SELECT FHAWB.HAWB_PCS,FHAWB.HAWB_NET_WT,FHL.AWB_NO,FHL.AWB_DATE,FHAWB.HAWB_NO,FHAWB.MANIFEST_DESC
	        FROM EDI_FHL FHL,EDI_FHL_HAWB FHAWB WHERE FHL.TR_NO=FHAWB.TR_NO) FH ON FH.HAWB_NO = V.HAWB_NO AND FH.AWB_NO = A.AWB_NO AND FH.AWB_DATE = A.AWB_DATE
	        LEFT JOIN MAST_CONSTRAINT_CODE D ON D.CODE=V.CC_CODE  
	        LEFT JOIN IMP_CUST_CLR_LIST F ON F.AWB_NO=A.AWB_NO AND F.AWB_DATE=A.AWB_DATE AND F.FLT_KEY=A.FLT_KEY AND F.FLT_DATE=A.FLT_DATE AND F.HAWB_NO = V.HAWB_NO
	        LEFT JOIN (SELECT B2.AWB_NO, B2.AWB_DATE, B2.FLT_KEY, B2.FLT_DATE FROM IMP_BOOKING A2, IMP_BOOKING_DTL B2 
	            WHERE A2.BOOKING_NO=B2.BOOKING_NO AND TO_DATE((TO_CHAR(A2.BKG_SLOT_DATE, 'DDMONYY') 
					  || ' ' || TO_CHAR(A2.BKG_SLOT_TO, '0000')), 'DDMONYY HH24MI') > SYSDATE) J 
	            	  ON A.AWB_NO=J.AWB_NO AND A.AWB_DATE=J.AWB_DATE AND J.FLT_KEY=A.FLT_KEY AND J.FLT_DATE=A.FLT_DATE
	        	WHERE AWB.AWB_CLOSED_YN='N'   AND NOT(A.RECD_PCS>0 AND NVL(AWB_INV.LOCN_PCS,0)=0)
	          AND A.AWB_NO=#awbNo#
	          and V.HAWB_NO = #hawbNo#
    		<dynamic prepend="ORDER BY ">
  			<isNotEmpty property="sortOrder.sortField">
            	$sortOrder.sortField$
           	</isNotEmpty>
           	<isEmpty property="sortOrder.sortField">
            	awbNo 
           	</isEmpty>
           	</dynamic>
	</select>
	
	<!--  Added by Surendra Gollapalli on 29MAY12 Image print START -->
	<select id="getTransID_529"  parameterClass="cargo.cms.imprt.report.bo.PhyClearanceList529_ReptBO" resultClass="java.lang.String">
	 select AWB_IMAGE_NAME as transID from AWB_IMAGE where AWB_NO = #awbNo# and AWB_DATE = TO_DATE(#awbDate#, 'DDMONYY')  and HAWB_NO = #hawbNo# and rownum = 1
	</select>
	
	 <select id="awb_images"  parameterClass="cargo.cms.imprt.report.bo.PhyClearanceList529_ReptBO" resultClass="cargo.cms.imprt.report.bo.PhyClearanceList529_ReptBO">
	  select (select rule_value from cmsrules where rule_code = 'ImageUploadRootPath') || img_path || img_name as  path from fw_image_store where img_session_id=#transID# and upper(img_name) like  '%JPG%' or upper(img_name) like  '%JPEG%'    
	<!-- select img_path || img_name as  path from fw_image_store where img_session_id=#transID#  -->
    </select> 
	
	<!--  Added by Surendra Gollapalli on 29MAY12 Image print END -->
	
	<select id="findAwbInBooking_529" parameterClass="cargo.cms.imprt.report.bo.PhyClearanceList529_ReptBO" resultClass="java.lang.String">
		SELECT 
			TO_CHAR(A.BKG_SLOT_DATE, 'DDMONYY') || ' ' || SUBSTR(TRIM(TO_CHAR(A.BKG_SLOT_FROM,'0000')),0,2) || ':' ||  
			SUBSTR(TRIM(TO_CHAR(A.BKG_SLOT_FROM,'0000')),3,4) || '-' || SUBSTR(TRIM(TO_CHAR(A.BKG_SLOT_TO,'0000')),0,2) || ':' 
			|| SUBSTR(TRIM(TO_CHAR(A.BKG_SLOT_TO,'0000')),3,4) AS schTime 
		FROM 
			IMP_BOOKING A, IMP_BOOKING_DTL B 
		WHERE 
			A.BOOKING_NO=B.BOOKING_NO AND B.AWB_NO=#awbNo# AND B.AWB_DATE=TO_DATE(#awbDate#, 'DDMONYY') 
			AND B.FLT_KEY=#fltNo# AND B.FLT_DATE=TO_DATE(#arrDate#, 'DDMONYY') AND TO_DATE((TO_CHAR(A.BKG_SLOT_DATE, 'DDMONYY') 
			|| ' ' ||A.BKG_SLOT_TO), 'DDMONYY HH24MI') > SYSDATE
	</select>
	<select id="findAwbInSchColl_529" parameterClass="cargo.cms.imprt.report.bo.PhyClearanceList529_ReptBO" resultClass="java.lang.String">
		SELECT 
			TO_CHAR(A.SCH_COLL_DATE, 'DDMONYY') || ' ' || SUBSTR(TRIM(TO_CHAR(A.SCH_COLL_FROM,'0000')),0,2) || ':' || 
			SUBSTR(TRIM(TO_CHAR(A.SCH_COLL_FROM,'0000')),3,4) || '-' || SUBSTR(TRIM(TO_CHAR(A.SCH_COLL_TO,'0000')),0,2) 
			|| ':' || SUBSTR(TRIM(TO_CHAR(A.SCH_COLL_TO,'0000')),3,4) as schTime 
		FROM 
			TRUCK_MANIFEST A, TRUCK_MANIFEST_DTL B 
		WHERE 
			B.TRUCK_MANF_NO=A.TRUCK_MANF_NO AND B.AWB_NO=#awbNo# AND B.AWB_DATE=TO_DATE(#awbDate#, 'DDMONYY') 
			AND B.FLT_KEY=#fltNo# AND B.FLT_DATE=TO_DATE(#arrDate#, 'DDMONYY')
	</select>
	<select id="findAwbInShipment_529" parameterClass="cargo.cms.imprt.report.bo.PhyClearanceList529_ReptBO" resultClass="java.lang.String">
		SELECT 
			LTRIM(CNTG_FLT_CARR || CNTG_FLT_NO || '/' || TO_CHAR(CNTG_FLT_DATE, 'DDMONYY'), '/') || ' ' || LTRIM(SUBSTR(TRIM(TO_CHAR(CNTG_FLT_TIME,'0000')),0,2) 
			|| ':'|| SUBSTR(TRIM(TO_CHAR(CNTG_FLT_TIME,'0000')),3,4), ':') AS schTime 
		FROM 
			IMP_CAR_SHP 
		WHERE 
			AWB_NO=#awbNo# AND AWB_DATE=TO_DATE(#awbDate#, 'DDMONYY') AND FLT_KEY=#fltNo# AND FLT_DATE=TO_DATE(#arrDate#, 'DDMONYY')
	</select>
	<select id="findLatestCCCode_529" parameterClass="java.util.HashMap" resultClass="java.lang.String">
		SELECT 
			CC_CODE 
		FROM 
			V_CST_IMP_CC_CODE 
		WHERE 
			FLT_KEY=#fltNo# AND FLT_DATE=TO_DATE(#fltDate#, 'DDMONYY') AND AWB_NO=#awbNo# AND HAWB_NO=#hawbNo#
	</select>
<!-- Rahul End Physical Clearance Action List -->

	<!-- Rahul Start REPT 160 -->
	<select id="arrFltHndlgRampRept_160"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO">
			 
		 SELECT flt.FLT_NO as fltNo, flt.CARR_CODE as carrCode,      flt.FLT_KEY as fltKey,      
				TO_CHAR(flt.SCH_DATE,'DDMONYY') as fltDateDisplay,
				TO_CHAR(flt.SCH_DATE,'DDMONYY') as fltDate,           
				flt.TR_NO as trNo,       PKG_COMMON.get_flt_ata(flt.FLT_KEY, flt.SCH_DATE, 'A') as atime,      
				NVL(flt.ACT_TIME, '0000') as ataForInsert,      
				RTRIM(TO_CHAR(fltevents.RAMP_COMPL_DATE, 'DDMONYY')||' '||(SUBSTR(TRIM(TO_CHAR(fltevents.RAMP_COMPL_TIME, '0000')),0,2)|| ':'||  SUBSTR(TRIM(TO_CHAR(fltevents.RAMP_COMPL_TIME, '0000')),3,4)), ':') as bdComplDate,     
				flt.ACFT_TYPE as cargoAcftType,      PKG_COMMON.get_flt_eta(flt.FLT_KEY, flt.SCH_DATE, 'A') as etime,         
				DECODE(flt.SCH_TIME,NULL,'',SUBSTR(TRIM(TO_CHAR(flt.SCH_TIME, '0000')),0,2)|| ':'||  SUBSTR(TRIM(TO_CHAR(flt.SCH_TIME, '0000')),3,4)) as stime,      
				repthead.LM_USER_ID as fltHdlgDataGenStaffId,      
				TO_CHAR(repthead.LM_DATE,'DDMONYY HH24:MI:SS') as fltHdlgDataGenDate,      repthead.TR_NO as reptTrNo,      
				(SELECT CODE_DESC FROM MAST_CODE_DTL WHERE CODE = flt.WTHR_COND AND CODE_TYPE='WTH_CONDN') AS weatherCondition,    
				pkg_common.flt_route(flt.FLT_KEY, flt.SCH_DATE, 'A') portOfCall   
		FROM FLT_OPR flt LEFT JOIN IMP_FLT_HAND_SUMMARY repthead ON       repthead.REP_MODULE = 'IR' 
			AND    flt.FLT_KEY = repthead.FLT_KEY AND      flt.SCH_DATE = repthead.FLT_DATE,      
				   FLT_OPR_EVENTS fltevents   WHERE    flt.FLT_TYPE = 'A' AND    flt.TR_NO = fltevents.TR_NO 
			AND    TO_CHAR(flt.SCH_DATE,'DDMONYY') =#fltDate#                  
			AND    flt.FLT_KEY =#fltNo#
		 
	</select>
		
	<select id="arrFltHndlgRampRept_160_A"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO">
		
		SELECT    TR_NO as trNo,    REP_MODULE as repModule,    CARR_CODE as carrCode,    FLT_NO as fltNo,    
				  FLT_DATE as fltDate,    FLT_KEY as fltKey,    FLT_ATA as fltAta,    NO_OF_LOADED_ULDS as noOfLoadedUlds,   
				  NO_OF_BULK_CARGO as noOfBulkCargo,    NO_OF_EMPTY_ULD as noOfEmptyUld,    IRR_ULD as irrUld,    
				  IRR_ULD_RMK as irrUldRmk,    SVC_STD_RMK as svcStdRmk,    LM_USER_ID as modifiedUserId,    
				  TO_CHAR(LM_DATE, 'DDMONYY HH24:MI') as lmDate,    AWB_LOCAL as awbLocal,    AWB_TRAN as awbTran,    
				  AWB_MAIL as awbMail   
		FROM IMP_FLT_HAND_SUMMARY   WHERE     FLT_KEY =#fltNo# AND    TO_CHAR(FLT_DATE, 'DDMONYY') =#fltDate#  
				  AND    REP_MODULE = 'IR'
	</select>
		
	<select id="arrFltHndlgRampRept_160_S"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO">
		 <![CDATA[
			SELECT
		  	A.ITM_NAME as itemName,
		  	decode(a.STD_OPR, 'LE', '<=', 'LT', '<', 'GE', '>=', 'GT', '>', 'EQ', '=') || ' '|| NVL(MT.CODE_DESC, A.TIME_STAMP2) || ' + ' ||A.STD as std,
		  	B.SVC_TIME AS serviceTime,
		  	B.SVC_TIME as serviceTimeForDb,
		 	B.STD_MET_YN as stdMet,
		    (SELECT SUM(B.SVC_TIME-A.STD) FROM MAST_SVC_STD A, IMP_FLT_HAND_SVC_STD B 
		    WHERE B.STD_MET_YN = 'N' AND A.ITM_NAME= B.ITM_NAME AND F.FLT_KEY = #fltKey# AND F.SCH_DATE =B.FLT_DATE) AS exceed
		 	FROM MAST_SVC_STD A 
			LEFT JOIN MAST_FLT_TIME_STAMP MT ON MT.CODE = A.TIME_STAMP2
			LEFT JOIN IMP_FLT_HAND_SVC_STD B ON A.ITM_NAME = B.ITM_NAME  AND nvl(b.tr_no, '**') = nvl(#trNo#, '**') 
			JOIN FLT_OPR F ON F.FLT_TYPE = DECODE(A.FLT_TYPE, 'I', 'A', 'D') AND F.CARR_CODE = NVL(A.CARR_CODE, F.CARR_CODE) 
		 	AND F.CGO_ACFT_TYPE = NVL(A.ACFT_TYPE, F.CGO_ACFT_TYPE)
			LEFT JOIN (SELECT FLT_KEY, FLT_DATE, SUM(MANIFEST_WT) WT 
			FROM IMP_CAR_SHP GROUP BY FLT_KEY, FLT_DATE) S ON S.FLT_KEY = F.FLT_KEY AND S.FLT_DATE = F.SCH_DATE
			WHERE A.REP_MODULE = 'IR'
			AND F.FLT_KEY = #fltNo# AND F.SCH_DATE = #fltDate# AND F.FLT_TYPE = 'A' 
			AND NVL(A.TONN_RANGE_FROM, nvl(S.WT, 0)) <= nvl(S.WT, 0) AND NVL(A.TONN_RANGE_TO, nvl(S.WT, 0)) >= nvl(S.WT, 0)	]]>
	</select>
	
	 <select id="arrFltHndlgRampRept_160_LULDS"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO">
	
		SELECT STRAGG(STRINGDELIM(COUNT(ALLOTGROUP_2.ULD_ALLOT)  || ''  || ALLOTGROUP_2.ULD_ALLOT, ',')) AS noOfLoadedUlds
    	from IMP_RAMP_CHK_DTL RAMPCHK
    	JOIN MAST_ULD_TYPE MULD ON MULD.CODE = RAMPCHK.ULD_TYPE
   		LEFT JOIN ULD_GROUP_TYPE ULDGROUP_2 ON ULDGROUP_2.ULD_TYPE = RAMPCHK.ULD_TYPE
   		LEFT JOIN MAST_ULD_ALLOT_GROUP ALLOTGROUP_2 ON ALLOTGROUP_2.ULD_GROUP = ULDGROUP_2.ULD_GROUP
    	where to_char(RAMPCHK.FLT_DATE,'DDMONYY')= TO_DATE(#fltDate#,'DDMONYY')
    	AND RAMPCHK.FLT_KEY = #fltNo# AND RAMPCHK.EMPTY_IND = 'N'
    	AND MULD.H_CONT_IND != 'Y' AND	MULD.BT_IND != 'Y' GROUP BY ALLOTGROUP_2.ULD_ALLOT
	</select>
		
	<select id="arrFltHndlgRampRept_160_BULDS"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO">
	
		<![CDATA[
			SELECT
			DECODE(count(1),0,'',count(1)||'BULK') AS noOfBulkCargo
			from IMP_RAMP_CHK_DTL RAMPCHK
	     	JOIN MAST_ULD_TYPE MULD ON MULD.CODE = RAMPCHK.ULD_TYPE
	     	LEFT JOIN ULD_GROUP_TYPE ULDGROUP_2 ON ULDGROUP_2.ULD_TYPE = RAMPCHK.ULD_TYPE
	     	LEFT JOIN MAST_ULD_ALLOT_GROUP ALLOTGROUP_2 ON ALLOTGROUP_2.ULD_GROUP = ULDGROUP_2.ULD_GROUP
	     	where to_char(RAMPCHK.FLT_DATE,'DDMONYY')= TO_DATE(#fltDate#,'DDMONYY')
	     	AND RAMPCHK.FLT_KEY = #fltNo#  
	     	and (MULD.H_CONT_IND = 'Y' OR MULD.BT_IND = 'Y')
		]]>
	</select>
	<select id="arrFltHndlgRampRept_160_EULDS"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO">
		
		SELECT STRAGG(STRINGDELIM(COUNT(ALLOTGROUP_2.ULD_ALLOT)  || ''  || ALLOTGROUP_2.ULD_ALLOT, ',')) AS noOfEmptyUld
    	from IMP_RAMP_CHK_DTL RAMPCHK
    	JOIN MAST_ULD_TYPE MULD ON MULD.CODE = RAMPCHK.ULD_TYPE
   		LEFT JOIN ULD_GROUP_TYPE ULDGROUP_2 ON ULDGROUP_2.ULD_TYPE = RAMPCHK.ULD_TYPE
   		LEFT JOIN MAST_ULD_ALLOT_GROUP ALLOTGROUP_2 ON ALLOTGROUP_2.ULD_GROUP = ULDGROUP_2.ULD_GROUP
    	where to_char(RAMPCHK.FLT_DATE,'DDMONYY')= TO_DATE(#fltDate#,'DDMONYY')
    	AND RAMPCHK.FLT_KEY = #fltNo# AND RAMPCHK.EMPTY_IND = 'Y'
    	AND MULD.H_CONT_IND != 'Y' AND	MULD.BT_IND != 'Y' GROUP BY ALLOTGROUP_2.ULD_ALLOT
	</select>	
	<select id="arrFltHndlgRampRept_160_Itm"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO">
		select 
			A.CODE as itemCode, 
			A.Code_DESC as itemName, 
			UPPER(A.MODIFY_YN) as modifyYN,
			TO_CHAR(B.TSTAMP_DATE, 'DDMONYY HH24:MI:SS') as actionedTime,
			TO_CHAR(B.TSTAMP_DATE, 'DDMONYY') as actionedTimeDate,
			TO_CHAR(B.TSTAMP_DATE, 'HH24') as actionedTimeHour,
			TO_CHAR(B.TSTAMP_DATE, 'MI') as actionedTimeMinute,
			TO_CHAR(B.TSTAMP_DATE, 'SS') as actionedTimeSecond,
			TO_CHAR(B.TSTAMP_DATE, 'DDMONYY HH24:MI:SS') as oldActionedTime,
			TO_CHAR(B.TSTAMP_DATE, 'DDMONYY') as oldActionedTimeDate,
			TO_CHAR(B.TSTAMP_DATE, 'HH24') as oldActionedTimeHour,
			TO_CHAR(B.TSTAMP_DATE, 'MI') as oldActionedTimeMinute,	
			TO_CHAR(B.TSTAMP_DATE, 'SS') as oldActionedTimeSecond
		FROM MAST_FLT_TIME_STAMP A 
		LEFT JOIN IMP_FLT_HAND_TIME_STAMP B ON A.CODE =	B.TSTAMP_CODE AND B.TR_NO = #trNo#
		where (A.CODE_TYPE = 'TIME' AND A.REP_MODULE like '%'||'IR'||'%') and A.CODE not in ('CATA','CETA')
	  
	</select>
		
	<select id="arrFltHndlgRampRept_160_Dmg"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO">
		SELECT ULD_KEY AS damageUlds
		FROM IMP_RAMP_CHK_DTL    WHERE CHKIN_YN = 'Y' 
			AND TO_CHAR (FLT_DATE, 'DDMONYY') =#fltDate#  AND FLT_KEY =#fltNo# 
			AND DAM_IND = 'Y'
	</select>
	
	<select id="arrFltHndlgRampRept_160_P"	parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingRampRept_160BO">
		SELECT A.PERF_NAME as performanceName, 
			   A.PERF_DESC as description, 
			   A.INFO_REQD as infoRequired,
	 		   B.RMK as remarks  ,
			   B.RMK as oldRemarks  
		FROM MAST_PERFORMANCE_STD A 
		LEFT JOIN IMP_FLT_HAND_PERFORMANCE B ON A.PERF_NAME = B.PERF_NAME AND B.TR_NO = #trNo#
		WHERE A.REP_MODULE = 'IR'
	</select>

	<!-- Rahul End REPT 160 -->
	
<select id="imp_brkdwnWorkSheetRept_125"  parameterClass="cargo.cms.imprt.report.bo.ImpBreakdownWSheet_125ReptBO" resultClass="cargo.cms.imprt.report.bo.ImpBreakdownWSheet_125ReptBO">
	SELECT RD.ULD_KEY AS uldNo,
                TO_CHAR(nvl(RD.BRKDN_START_DATE, RD.BRKDN_COMPL_DATE),'DDMONYY HH24:MI') AS startBD,
                DECODE( RTRIM(TO_CHAR(RD.BRKDN_COMPL_DATE,'DDMONYY')||SUBSTR(TRIM(TO_CHAR(NVL(RD.BRKDN_COMPL_TIME,0),'0000')),0,2) || ':' ||  
                SUBSTR(TRIM(TO_CHAR(NVL(RD.BRKDN_COMPL_TIME,0),'0000')),3,4)||'/'||RD.BRKDN_COMPL_USER_ID, '/'),'00:00','',RTRIM(TO_CHAR(RD.BRKDN_COMPL_DATE,'DDMONYY')||SUBSTR(TRIM(TO_CHAR(NVL(RD.BRKDN_COMPL_TIME,0),'0000')),0,2) || ':' ||  
                SUBSTR(TRIM(TO_CHAR(NVL(RD.BRKDN_COMPL_TIME,0),'0000')),3,4)||'/'||RD.BRKDN_COMPL_USER_ID, '/')) AS completedBD, 
                A.AWB_NO AS awbNo,  
                rtrim(SUBSTR(A.AWB_NO,1,3)||'-'||SUBSTR(A.AWB_NO,4), '-') as awbNoDisp ,
                SUBSTR(A.AWB_NO,1,3)  awbNoPrefix , 
                SUBSTR(A.AWB_NO,4)  awbNoSuffix ,
                B.CONTENT AS content,
    pkg_common.get_awb_splcodes(A.AWB_NO, A.AWB_DATE, 'I') AS splcode,
    B.AWB_DEST AS dest, 
    A.LOC_CODE AS locn, 
                A.STRG_PCS AS pcs,
                A.STRG_WT AS wt,
                A.LSP_NO AS lspNo,
                A.ULD_KEY AS uld2,
                A.TAG_NO AS tagNo,
                RD.DAM_RMK AS damage,
                RD.DAM_IND AS damageIndicator,
                DECODE(RD.IMAGE,NULL,'N','Y') AS image,
            A.DAM_PC_DECL AS damagePc, 
            A.DAM_WT_DECL AS damageWt,
            A.DAM_COND AS damageType,  
            I.ULD_IMAGE_NAME AS transactionId
            FROM IMP_RAMP_CHK_DTL RD 
            LEFT JOIN IMP_AWB_STRG_DTL A 
            ON A.FLT_DATE = RD.FLT_DATE  AND
            A.FLT_KEY  = RD.FLT_KEY      AND
           A.CHKIN_ULD_KEY  = RD.ULD_KEY 
  LEFT JOIN (SELECT FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE, CHKIN_ULD_KEY, MIN(CR_DATE) START_DATE 
                                 FROM IMP_AWB_STRG_DTL GROUP BY FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE, CHKIN_ULD_KEY) M
                                 ON M.CHKIN_ULD_KEY = A.CHKIN_ULD_KEY AND M.FLT_KEY = A.FLT_KEY AND M.FLT_DATE = A.FLT_DATE AND M.AWB_NO = A.AWB_NO AND M.AWB_DATE = A.AWB_DATE
  LEFT JOIN IMP_CAR_AWB B ON A.AWB_NO = B.AWB_NO AND A.AWB_DATE = B.AWB_DATE  
   LEFT JOIN (SELECT ULD_IMAGE_NAME,ULD_KEY FROM ULD_IMAGE)I
  ON RD.ULD_KEY = I.ULD_KEY
  WHERE (RD.BRKDN_COMPL_DATE IS NOT NULL OR M.FLT_KEY IS NOT NULL OR A.TAG_NO IS NOT NULL)
    <isNotEmpty prepend="AND" property="fltDate">
		RD.FLT_DATE = #fltDate#
		</isNotEmpty>
	  	<isNotEmpty prepend="AND" property="fltNo">	
		RD.FLT_KEY = #fltNo#
		</isNotEmpty>	  
	  	<isNotEmpty prepend="AND" property="cargoCatalog">
		B.CATALOG = #cargoCatalog#
		</isNotEmpty>	
			<isNotEmpty  property="uldList">
 <iterate prepend="AND" property="uldList"
	open="(" close=")" conjunction="OR">
	RD.ULD_KEY = #uldList[]#
</iterate>
</isNotEmpty>
	ORDER BY RD.ULD_KEY, A.AWB_NO

</select> 
  

<select id="imprt_rept_514_uld"  parameterClass="cargo.cms.imprt.report.bo.InbULDList514_ReptBO"  
		resultClass="cargo.cms.imprt.report.bo.InbULDList514_ReptBO">
   	 	select distinct RAMPCHK.flt_key as flightKey,TO_CHAR(RAMPCHK.flt_date,'DDMONYY') as arrDate,
		DECODE(RAMPCHK.BRKDN_COMPL_DATE,NULL,DECODE(RAMPCHK.BRKDN_START_DATE,NULL,'','Started'),'Completed') as bdStatus,
    	RAMPCHK.uld_key as uldKey,impuld.manual_hdly_area as manualHdlgArea,impuld.manual_hdly_area as manualHdlgAreaOld,RAMPCHK.EIC_IND as eicInd, 
    	uld.LOC_CODE as locCode,ddtuld.TRF_TYPE as trfType,RAMPCHK.DAM_IND as serInd,decode(impuld.SPL_CODE1,NULL,' ',impuld.SPL_CODE1) as shc1,pkg_imp.fun_get_hdlg_area(RAMPCHK.flt_key,TO_CHAR(RAMPCHK.flt_date,'DDMONYY'),RAMPCHK.uld_key,null) systemHdlgArea,
    	decode(impuld.SPL_CODE2,NULL,' ',impuld.SPL_CODE2) as shc2, decode(impuld.SPL_CODE3,NULL,' ',impuld.SPL_CODE3) as shc3,impuld.wh_rmk as uldWhRmk,impuld.airl_rmk as uldAirlRmk,impuld.imx as imx,impuld.handling_mode as hdlgMode,
    	impuld.wh_rmk as uldWhRmkOld,impuld.airl_rmk as uldAirlRmkOld,
    	(select trim(to_char(sum(a.MAN_WT),'999999999999.9')) a from edi_ffm_shp a,edi_ffm_uld b,edi_ffm_msg c where a.tr_no=b.tr_no and a.udoc_line_no= b.doc_line_no 
		and  b.flt_key =#sflightKey# and b.flt_date=#sarrDate# and b.uld_key=RAMPCHK.uld_key and c.tr_no=a.tr_no and c.ffm_status='P') as wt1,
	(case
		      when (select count(*) from ULD_INVEntory where BASE_PLT = RAMPCHK.uld_key) >= 1
		       then 'Y'
		       else 'N'
		       end) as topPalletYN,
		(case
		      when (select count(*) from edi_ffm_shp a,edi_ffm_uld b where a.dest!='HKG' and a.tr_no=b.tr_no and a.udoc_line_no= b.doc_line_no 
		and b.flt_key =#sflightKey# and b.flt_date=#sarrDate# and b.uld_key=RAMPCHK.uld_key) >= 1
		       then 'T'
		       else 'I'
		       end) as uldFlow
    	from IMP_RAMP_CHK_DTL RAMPCHK
		LEFT JOIN IMP_ULD_LIST impuld ON impuld.FLT_KEY = RAMPCHK.FLT_KEY AND 
    	impuld.FLT_DATE = RAMPCHK.FLT_DATE AND RAMPCHK.uld_key = impuld.uld_key 
    	LEFT JOIN IMP_RAMP_INB_CHK_DTL imp ON imp.FLT_KEY = RAMPCHK.FLT_KEY AND imp.FLT_DATE = RAMPCHK.FLT_DATE
		AND imp.tr_no = RAMPCHK.tr_no 
    	LEFT Join ULD_INVEntory uld on RAMPCHK.uld_key = uld.uld_key
		Left JOIN DDT_MSG MSG on MSG.FLT_KEY = RAMPCHK.FLT_KEY AND MSG.FLT_DATE = RAMPCHK.FLT_DATE AND MSG.DDT_STATUS ='P' 
		LEFT JOIN DDT_ULD ddtuld ON ddtuld.TR_NO = MSG.TR_NO AND ddtuld.ULD_KEY = RAMPCHK.ULD_KEY
		where RAMPCHK.flt_date=#sarrDate# AND RAMPCHK.flt_key = #sflightKey#
    <isNotEmpty  property="inBdULDList">
		<iterate prepend="AND" property="inBdULDList"
	open="(" close=")" conjunction="OR">
    	RAMPCHK.ULD_KEY = #inBdULDList[]#
   	</iterate>
   	</isNotEmpty>
		UNION
    	select distinct imp.flt_key as flightKey,TO_CHAR(imp.flt_date,'DDMONYY') as arrDate,
	(select DECODE(RAMPCHK1.BRKDN_COMPL_DATE,NULL,DECODE(RAMPCHK1.BRKDN_START_DATE,NULL,'','Started'),'Completed') 
							from IMP_RAMP_CHK_DTL RAMPCHK1,IMP_ULD_LIST impuld1 
							where impuld1.FLT_KEY = RAMPCHK1.FLT_KEY AND impuld1.FLT_DATE = RAMPCHK1.FLT_DATE
    							AND RAMPCHK1.uld_key = impuld1.uld_key AND RAMPCHK1.uld_key = impuld.uld_key
    							AND RAMPCHK1.flt_date=#sarrDate# AND RAMPCHK1.flt_key =#sflightKey#) as bdStatus,
    	imp.uld_key as uldKey,impuld.manual_hdly_area as manualHdlgArea,impuld.manual_hdly_area as manualHdlgAreaOld,RAMPCHK.EIC_IND as eicInd,
    	uld.LOC_CODE as locCode,ddtuld.TRF_TYPE as trfType,imp.DAM_IND as serInd,decode(impuld.SPL_CODE1,NULL,' ',impuld.SPL_CODE1) as shc1,	pkg_imp.fun_get_hdlg_area(imp.flt_key,TO_CHAR(imp.flt_date,'DDMONYY'),imp.uld_key,null) systemHdlgArea,
    	decode(impuld.SPL_CODE2,NULL,' ',impuld.SPL_CODE2) as shc2, decode(impuld.SPL_CODE3,NULL,' ',impuld.SPL_CODE3) as shc3,impuld.wh_rmk as uldWhRmk,impuld.airl_rmk as uldAirlRmk,impuld.imx as imx,impuld.handling_mode as hdlgMode,
    	impuld.wh_rmk as uldWhRmkOld,impuld.airl_rmk as uldAirlRmkOld,
    	(select trim(to_char(sum(a.MAN_WT),'999999999999.9')) a from edi_ffm_shp a,edi_ffm_uld b,edi_ffm_msg c where a.tr_no=b.tr_no and a.udoc_line_no= b.doc_line_no 
		and  b.flt_key =#sflightKey# and b.flt_date=#sarrDate# and b.uld_key=imp.uld_key and c.tr_no=a.tr_no and c.ffm_status='P') as wt1,
	(case
		      when (select count(*) from ULD_INVEntory where BASE_PLT = imp.uld_key) >= 1
		       then 'Y'
		       else 'N'
		       end) as topPalletYN,
		       (case
		      when (select count(*) from edi_ffm_shp a,edi_ffm_uld b where a.dest!='HKG' and a.tr_no=b.tr_no and a.udoc_line_no= b.doc_line_no 
		and b.flt_key =#sflightKey# and b.flt_date=#sarrDate# and b.uld_key=imp.uld_key) >= 1
		       then 'T'
		       else 'I'
		       end) as uldFlow
    	from IMP_ULD_LIST impuld
		LEFT JOIN IMP_RAMP_CHK_DTL RAMPCHK ON impuld.FLT_KEY = RAMPCHK.FLT_KEY AND impuld.FLT_DATE = RAMPCHK.FLT_DATE
		LEFT JOIN IMP_RAMP_INB_CHK_DTL imp ON impuld.FLT_KEY = imp.FLT_KEY AND 
    	impuld.FLT_DATE = imp.FLT_DATE AND imp.uld_key = impuld.uld_key LEFT Join ULD_INVEntory uld on imp.uld_key = uld.uld_key
    	Left JOIN DDT_MSG MSG on MSG.FLT_KEY = impuld.FLT_KEY AND MSG.FLT_DATE = impuld.FLT_DATE AND MSG.DDT_STATUS ='P' 
		LEFT JOIN DDT_ULD ddtuld ON ddtuld.TR_NO = MSG.TR_NO AND ddtuld.ULD_KEY = impuld.ULD_KEY
		where imp.flt_date=#sarrDate# AND imp.flt_key = #sflightKey# AND impuld.uld_key not in (select 
    	RAMPCHK.uld_key as uldKey 
    	from IMP_RAMP_CHK_DTL RAMPCHK
    	LEFT JOIN IMP_ULD_LIST impuld ON impuld.FLT_KEY = RAMPCHK.FLT_KEY AND 
    	impuld.FLT_DATE = RAMPCHK.FLT_DATE AND RAMPCHK.uld_key = impuld.uld_key 
		LEFT JOIN IMP_RAMP_INB_CHK_DTL imp ON imp.FLT_KEY = RAMPCHK.FLT_KEY AND imp.FLT_DATE = RAMPCHK.FLT_DATE
		AND imp.tr_no = RAMPCHK.tr_no LEFT Join ULD_INVEntory uld on RAMPCHK.uld_key = uld.uld_key
		where RAMPCHK.flt_date=#sarrDate# AND RAMPCHK.flt_key = #sflightKey#)
       <isNotEmpty  property="inBdULDList">
		<iterate prepend="AND" property="inBdULDList"
	open="(" close=")" conjunction="OR">
    	 imp.uld_key = #inBdULDList[]#
    	 </iterate>
    	 </isNotEmpty>
</select>
		
<select id="imprt_rept_514_cpm"  parameterClass="cargo.cms.imprt.report.bo.InbULDList514_ReptBO"  
		resultClass="cargo.cms.imprt.report.bo.InbULDList514_ReptBO">
	select uld_key as uldKey,cpm_ind as cpmInd,ffm_ind as ffmInd,'Y' as uldChkStatus from IMP_RAMP_INB_CHK_DTL where uld_key in (
		select uld_key from IMP_RAMP_CHK_DTL where flt_date=#sarrDate# and flt_key=#sflightKey# 
		<isNotEmpty  property="inBdULDList">
		<iterate prepend="AND" property="inBdULDList"
	open="(" close=")" conjunction="OR">
	uld_key = #inBdULDList[]#
</iterate>
</isNotEmpty>)
		union
		select uld_key as uldKey,cpm_ind as cpmInd,ffm_ind as ffmInd,'N' as uldChkStatus from IMP_RAMP_INB_CHK_DTL where flt_date=#sarrDate# and flt_key=#sflightKey#
		AND uld_key not in (select uld_key from IMP_RAMP_INB_CHK_DTL where uld_key in (
		select uld_key from IMP_RAMP_CHK_DTL where flt_date=#sarrDate# and flt_key=#sflightKey#))
		<isNotEmpty  property="inBdULDList">
		<iterate prepend="AND" property="inBdULDList"
	open="(" close=")" conjunction="OR">
	uld_key = #inBdULDList[]#
</iterate>
</isNotEmpty>	   
		UNION 
		select uld_key as uldKey,'N' as cpmInd,'N' as ffmInd,chkin_yn as uldChkStatus from IMP_RAMP_CHK_DTL where flt_date=#sarrDate# and flt_key=#sflightKey#
		<isNotEmpty  property="inBdULDList">
		<iterate prepend="AND" property="inBdULDList"
	open="(" close=")" conjunction="OR">
	uld_key = #inBdULDList[]#
</iterate>
</isNotEmpty>	   
		and uld_key not in (
		select uld_key from (
		select uld_key from IMP_RAMP_INB_CHK_DTL where uld_key in (
		select uld_key from IMP_RAMP_CHK_DTL where flt_date=#sarrDate# and flt_key=#sflightKey#)
		union
		select uld_key from IMP_RAMP_INB_CHK_DTL where flt_date=#sarrDate# and flt_key=#sflightKey#))
</select>
<select id="imprt_rept_514_shipment"  parameterClass="cargo.cms.imprt.report.bo.InbULDList514_ReptBO"  
		resultClass="cargo.cms.imprt.report.bo.InbULDList514_ReptBO">
   		select distinct #sflightKey# as sflightKey,#sarrDate# as sarrDate,b.uld_key uldKey,a.awb_no as awbNo,rtrim(SUBSTR(A.AWB_NO,1,3)||'-'||SUBSTR(A.AWB_NO,4), '-') as awbNoDisp ,TO_CHAR(a.AWB_DATE, 'DDMONYY') as awbDate,c.MANIFEST_PCS as awbPcs,c.MANIFEST_WT as awbWt,a.content as content,
              decode(d.spl_code1,NULL,' ',d.spl_code1)|| decode(d.spl_code2,NULL,' ',','||d.spl_code2)
   		 ||decode(d.spl_code3,NULL,' ',','||d.spl_code3)||
       	decode(d.spl_code5,NULL,' ',','||d.spl_code5) ||decode(d.spl_code6,NULL,' ',','||d.spl_code6) ||decode(d.spl_code7,NULL,' ',','||d.spl_code7) ||
    decode(d.spl_code8,NULL,' ',','||d.spl_code8)||decode(d.spl_code9,NULL,' ',','||d.spl_code9) shc1,
            a.rmk,b.uld_key as uldKey,c.car_created as carCreated,c.imx_rqs as imxRqs, c.dlv_mode_rqs as dlvRqs, decode(d.spl_code4,NULL,' ',d.spl_code4) shc4,
            d.house_flg as houseFlag ,d.wh_Rmk as awbWhRmk,d.airln_rmk as awbAirlRmk,d.wh_Rmk as awbWhRmkOld,d.airln_rmk as awbAirlRmkOld,a.dest as dest,
            a.part_shmpt_yn as shpType,
            d.spl_code1 as oldShc1, d.spl_code2 oldShc2, d.spl_code3 as oldShc3,
            d.spl_code4 oldShc4, d.spl_code5 oldShc5, d.spl_code6 oldShc6, d.spl_code7 oldShc7, d.spl_code8 oldShc8, d.spl_code9 oldShc9,
            decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE1),0,'N','Y')  as shcVal1, 
            decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE2),0,'N','Y')  as shcVal2, 
            decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE3),0,'N','Y')  as shcVal3,
            decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE4),0,'N','Y')  as shcVal4,
            decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE5),0,'N','Y')  as shcVal5,
            decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE6),0,'N','Y')  as shcVal6,
            decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE7),0,'N','Y')  as shcVal7,
            decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE8),0,'N','Y')  as shcVal8,
            decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE9),0,'N','Y')  as shcVal9,
            (SELECT V.CC_CODE FROM V_CST_IMP_CC_CODE_AWB V
                             WHERE V.FLT_KEY = #sflightKey# AND V.FLT_DATE = #sarrDate# AND V.AWB_NO = A.AWB_NO 
                                AND NVL(V.HAWB_NO, '000000000000000000') =  '000000000000000000' AND ROWNUM = 1) as ccCode,           
            case when (
            select count(1) 
            from V_DDT_DTL 
            where awb_no=a.awb_no 
            and awb_date=a.awb_date
            and flt_key = b.flt_key
            and flt_date=b.flt_date
            and uld_key=b.uld_key
            and QT_BU = 'Y' ) > 0 then 'Y' else 'N' end  qtBuInd            
            from edi_ffm_shp a,edi_ffm_uld b, imp_car_shp c,imp_car_awb d 
            where a.tr_no=b.tr_no and a.udoc_line_no= b.doc_line_no 
            and b.flt_key =#sflightKey# and b.flt_date=#sarrDate# and a.awb_no=c.awb_no  and a.flt_key=c.flt_key and a.flt_date=c.flt_date
      and c.awb_no=d.awb_no and c.awb_date = d.awb_date
      <isNotEmpty  property="shipmentList">
            <iterate prepend="AND" property="shipmentList"
      open="(" close=")" conjunction="OR">
       a.awb_no = #shipmentList[]#
       </iterate>
       </isNotEmpty>
       <isNotEmpty  property="inBdULDList">
            <iterate prepend="AND" property="inBdULDList"
      open="(" close=")" conjunction="OR">
       b.uld_key = #inBdULDList[]#
       </iterate>
       </isNotEmpty>
</select>	

<select id="getReportTagList" parameterClass="cargo.cms.imprt.report.bo.InbULDList514_ReptBO" resultClass="cargo.cms.imprt.report.bo.InbULDList514_ReptBO">
	SELECT distinct rownum as tagDispNo,C.TAG_NO AS tagNo, C.TAG_WT AS tagWt
	FROM EDI_RESDIT_HD A,
	EDI_RESDIT_AWB_DTL B,
	EDI_RESDIT_TAG_DTL C,
	IMP_CAR_AWB D
	WHERE A.TR_NO = B.TR_NO
	AND B.TR_AWB_NO = C.TR_AWB_NO
	AND B.AWB_NO = D.AWB_NO
	AND TO_CHAR(B.AWB_DATE, 'DDMONYY') = TO_CHAR(D.AWB_DATE, 'DDMONYY')
	AND A.FLT_KEY = #sflightKey#
	AND TO_CHAR(A.FLT_DATE,'DDMONYY') = #sarrDate#
	and b.awb_no = #awbNo# AND B.AWB_DATE = #awbDate#
	<isNotEmpty  property="uldKey">
	and c.container_no is not null
	and c.container_no = #uldKey#
	</isNotEmpty>
	<isEmpty property="uldKey">
	and c.container_no is null
	</isEmpty>
	order by tagDispNo asc
</select>

	
<select id="imprt_rept_514_bulkshipment"  parameterClass="cargo.cms.imprt.report.bo.InbULDList514_ReptBO"  
		resultClass="cargo.cms.imprt.report.bo.InbULDList514_ReptBO">
   			select distinct #sflightKey# as sflightKey,#sarrDate# as sarrDate,a.awb_no as awbNo,rtrim(SUBSTR(A.AWB_NO,1,3)||'-'||SUBSTR(A.AWB_NO,4), '-') as awbNoDisp ,TO_CHAR(a.AWB_DATE, 'DDMONYY') as awbDate,decode(c.MANIFEST_PCS,a.man_pcs,c.MANIFEST_PCS,a.man_pcs) as awbPcs,decode(c.MANIFEST_WT,a.man_wt,c.MANIFEST_WT,a.man_wt) as awbWt,NVL(d.content,a.content) as content,
   	 decode(d.spl_code1,NULL,' ',d.spl_code1)|| decode(d.spl_code2,NULL,' ',','||d.spl_code2)
   		 ||decode(d.spl_code3,NULL,' ',','||d.spl_code3)||decode(d.spl_code4,NULL,' ',','||d.spl_code4)||
       	decode(d.spl_code5,NULL,' ',','||d.spl_code5) ||decode(d.spl_code6,NULL,' ',','||d.spl_code6) ||decode(d.spl_code7,NULL,' ',','||d.spl_code7) ||
    decode(d.spl_code8,NULL,' ',','||d.spl_code8)||decode(d.spl_code9,NULL,' ',','||d.spl_code9) shc1,
		a.rmk,b.uld_key as uldKey,c.car_created as carCreated,c.imx_rqs as imxRqs, c.dlv_mode_rqs as dlvRqs, decode(d.spl_code4,NULL,' ',d.spl_code4) shc4,
		d.house_flg as houseFlag ,d.wh_Rmk as awbWhRmk,d.airln_rmk as awbAirlRmk,d.wh_Rmk as awbWhRmkOld,d.airln_rmk as awbAirlRmkOld,a.dest as dest,
		a.part_shmpt_yn as shpType,
		d.spl_code1 as oldShc1, d.spl_code2 oldShc2, d.spl_code3 as oldShc3,
		d.spl_code4 oldShc4, d.spl_code5 oldShc5, d.spl_code6 oldShc6, d.spl_code7 oldShc7, d.spl_code8 oldShc8, d.spl_code9 oldShc9,
		decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE1),0,'N','Y')  as shcVal1, 
		decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE2),0,'N','Y')  as shcVal2, 
		decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE3),0,'N','Y')  as shcVal3,
		decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE4),0,'N','Y')  as shcVal4,
		decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE5),0,'N','Y')  as shcVal5,
		decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE6),0,'N','Y')  as shcVal6,
		decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE7),0,'N','Y')  as shcVal7,
		decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE8),0,'N','Y')  as shcVal8,
		decode((select count(*) from CUST_AIRL_SPL_CODE where spl_type='SPL_VAL' and spl_code=d.SPL_CODE9),0,'N','Y')  as shcVal9,
		(SELECT V.CC_CODE FROM V_CST_IMP_CC_CODE_AWB V
		 			WHERE V.FLT_KEY = #sflightKey# AND V.FLT_DATE = #sarrDate# AND V.AWB_NO = A.AWB_NO 
		 			  AND NVL(V.HAWB_NO, '000000000000000000') =  '000000000000000000' AND ROWNUM = 1) as ccCode,
		decode((select COUNT(1)
                  from v_ddt_dtl
                  where awb_no = a.awb_no
                  and awb_date = a.awb_date
                  and flt_key = c.flt_key
                  and flt_date = c.flt_date
                  and QT_BU = 'Y'),0,'N','Y') qtBu       
		from edi_ffm_shp a,edi_ffm_uld b,edi_ffm_msg m, imp_car_shp c,imp_car_awb d 
		where a.tr_no=b.tr_no and a.udoc_line_no= b.doc_line_no 
		and b.flt_key =#sflightKey# and b.flt_date=#sarrDate# and a.awb_no=c.awb_no  and a.flt_key=c.flt_key and a.flt_date=c.flt_date 
		and b.tr_no = m.tr_no and m.ffm_status = 'P'
    	and c.awb_no=d.awb_no and c.awb_date = d.awb_date and b.uld_key is null 
    	<isNotEmpty  property="inBdULDList">
		<iterate prepend="AND" property="inBdULDList"
	open="(" close=")" conjunction="OR">
         a.awb_no = #inBdULDList[]#
       </iterate>
       </isNotEmpty>
       union all
SELECT DISTINCT #sflightKey# as sflightKey,#sarrDate# as sarrDate,B.AWB_NO       AS awbNo,
			rtrim(SUBSTR(B.AWB_NO,1,3)
			||'-'
			||SUBSTR(B.AWB_NO,4), '-')     AS awbNoDisp,
			TO_CHAR(B.AWB_DATE, 'DDMONYY') AS awbDate,
			TAG.tagPcs            AS awbPcs,
			tag.tagWt            AS awbWt,
		  NVL(d.content,e.content) as content, 
    DECODE(e.spl_code1,NULL,' ',e.spl_code1)
  || DECODE(e.spl_code2,NULL,' ',','
  ||e.spl_code2)
  ||DECODE(e.spl_code3,NULL,' ',','
  ||e.spl_code3)
  ||DECODE(e.spl_code4,NULL,' ',','
  ||e.spl_code4)
  || DECODE(e.spl_code5,NULL,' ',','
  ||e.spl_code5)
  ||DECODE(e.spl_code6,NULL,' ',','
  ||e.spl_code6)
  ||DECODE(e.spl_code7,NULL,' ',','
  ||e.spl_code7)
  || DECODE(e.spl_code8,NULL,' ',','
  ||e.spl_code8)
  ||DECODE(e.spl_code9,NULL,' ',','
  ||e.spl_code9) shc1,
  D.AWB_RMK rmk,
			''                 AS uldKey,
      	F.car_created        	 AS carCreated,
        'N' imxRqs,
			  '' dlvRqs,
        DECODE(e.spl_code4,NULL,' ',e.spl_code4) shc4,
        d.house_flg     AS houseFlag ,
        d.wh_Rmk        AS awbWhRmk,
        d.airln_rmk     AS awbAirlRmk,
        d.wh_Rmk        AS awbWhRmkOld,
        d.airln_rmk     AS awbAirlRmkOld,
        d.AWB_DEST dest,
        'N' AS shpType,
        e.spl_code1 as oldShc1, e.spl_code2 oldShc2, e.spl_code3 as oldShc3,
		e.spl_code4 oldShc4, e.spl_code5 oldShc5, e.spl_code6 oldShc6, e.spl_code7 oldShc7, e.spl_code8 oldShc8, e.spl_code9 oldShc9,
    DECODE(
  (SELECT COUNT(*) FROM CUST_AIRL_SPL_CODE WHERE spl_type='SPL_VAL'
  AND spl_code                                           =e.SPL_CODE1
  ),0,'N','Y') AS shcVal1,
  DECODE(
  (SELECT COUNT(*) FROM CUST_AIRL_SPL_CODE WHERE spl_type='SPL_VAL'
  AND spl_code                                           =e.SPL_CODE2
  ),0,'N','Y') AS shcVal2,
  DECODE(
  (SELECT COUNT(*) FROM CUST_AIRL_SPL_CODE WHERE spl_type='SPL_VAL'
  AND spl_code                                           =e.SPL_CODE3
  ),0,'N','Y') AS shcVal3,
  DECODE(
  (SELECT COUNT(*) FROM CUST_AIRL_SPL_CODE WHERE spl_type='SPL_VAL'
  AND spl_code                                           =e.SPL_CODE4
  ),0,'N','Y') AS shcVal4,
  DECODE(
  (SELECT COUNT(*) FROM CUST_AIRL_SPL_CODE WHERE spl_type='SPL_VAL'
  AND spl_code                                           =e.SPL_CODE5
  ),0,'N','Y') AS shcVal5,
  DECODE(
  (SELECT COUNT(*) FROM CUST_AIRL_SPL_CODE WHERE spl_type='SPL_VAL'
  AND spl_code                                           =e.SPL_CODE6
  ),0,'N','Y') AS shcVal6,
  DECODE(
  (SELECT COUNT(*) FROM CUST_AIRL_SPL_CODE WHERE spl_type='SPL_VAL'
  AND spl_code                                           =e.SPL_CODE7
  ),0,'N','Y') AS shcVal7,
  DECODE(
  (SELECT COUNT(*) FROM CUST_AIRL_SPL_CODE WHERE spl_type='SPL_VAL'
  AND spl_code                                           =e.SPL_CODE8
  ),0,'N','Y') AS shcVal8,
  DECODE(
  (SELECT COUNT(*) FROM CUST_AIRL_SPL_CODE WHERE spl_type='SPL_VAL'
  AND spl_code                                           =e.SPL_CODE9
  ),0,'N','Y') AS shcVal9,
			D.CC_CODE ccCode,
    DECODE(
  (SELECT COUNT(1) FROM v_ddt_dtl WHERE awb_no = b.awb_no
  AND awb_date                                 = b.awb_date
  AND flt_key                                  = a.flt_key
  AND flt_date                                 = a.flt_date
  AND QT_BU                                    = 'Y'
  ),0,'N','Y') qtBu
		FROM EDI_RESDIT_HD A
    JOIN EDI_RESDIT_AWB_DTL B ON B.TR_NO = A.TR_NO
    JOIN IMP_CAR_AWB d ON D.AWB_NO = B.AWB_NO AND D.AWB_DATE = B.AWB_DATE
    JOIN AWB E ON E.AWB_NO = B.AWB_NO AND E.AWB_DATE = B.AWB_DATE
  	JOIN imp_car_shp F ON F.AWB_NO = B.AWB_NO AND F.AWB_DATE = B.AWB_DATE AND F.FLT_KEY=A.FLT_KEY AND F.FLT_DATE=A.FLT_DATE
    JOIN (SELECT TR_AWB_NO, SUM(tag_wt)   AS tagWt,      COUNT(tag_no) AS tagPcs
            FROM EDI_RESDIT_TAG_DTL where container_no is null GROUP BY TR_AWB_NO
            ) TAG ON TAG.TR_AWB_NO  = B.TR_AWB_NO
		WHERE A.FLT_KEY                      = #sflightKey#
		AND TO_CHAR(A.FLT_DATE,'DDMONYY')  = #sarrDate#
		<isNotEmpty  property="inBdULDList">
		<iterate prepend="AND" property="inBdULDList"
	    open="(" close=")" conjunction="OR">
         b.awb_no = #inBdULDList[]#
       </iterate>
       </isNotEmpty>
</select>	
<select id="getSystemHdlgArearept" parameterClass="cargo.cms.imprt.report.bo.InbULDList514_ReptBO" resultClass="cargo.cms.imprt.report.bo.InbULDList514_ReptBO">
	select flt_module1 from flt_opr where flt_key=#sflightKey# and sch_date=TO_DATE(#sarrDate#,'DDMONYY') and flt_type='A' and 
	(select rule_value from cmsrules where rule_code='WOSP_AVAILABLE') = 'N' and rownum=1
	</select>
	
	<!--  Commented by Surendra Gollapalli on 27 July 2011 START -->
	
	<!--  
<select id="exp_DepFltHndlgRept_204_A" parameterClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO" resultClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO">
	
	select  flt_key as fltKey,    to_char(sch_date,'DDMONYY') as fltDate,       
			substr(lpad(sch_time, 4, '0'), 1, 2)||':'||substr(sch_time, -2) as stdTime,    
			substr(lpad(est_time, 4, '0'), 1, 2)||':'||substr(est_time, -2) as etdTime,    
		    substr(lpad(act_time, 4, '0'), 1, 2)||':'||substr(act_time, -2) as atdTime,       
			cgo_acft_type as aircraftType, 
	        pkg_pman.flt_ports(#fltNo#, to_date(#fltDate#,'DDMONYY')) as portOfCall,       
			wthr_cond as weather   
	from   flt_opr   where     sch_date = to_date(#fltDate#, 'DDMONYY')    
  and flt_type = 'D'    and flt_key =#fltNo#	
</select>
	
<select id="exp_DepFltHndlgRept_204_A_TotAllot" parameterClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO" resultClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO">
	
	select unldg_pt AS unldgPt, allot_type AS attchment, qty AS totQty
	from   exp_flt_hand_wh_allot
	where  flt_key = #fltNo#
	and    flt_date =#fltDate#
   
</select>
	
<select id="exp_DepFltHndlgRept_204_A_Supplies" parameterClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO" resultClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO">
	
	select accessory_type AS sutypeA, qty AS noofQty
	from   exp_flt_hand_wh_accessory
	where  flt_key =#fltNo#
	and    flt_date =#fltDate#	 
</select>

<select id="exp_DepFltHndlgRept_204_B" parameterClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO" resultClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO">

	select uld_type , uld_key AS bauldNo, dest AS bdest, contour_code AS bcontour, 
	manifest_wt AS bactWt, net_wt AS bnetWt, gross_wt AS bgrossWt
	from   exp_flt_hand_wh_uld
	where  flt_key =#fltNo#
	and    flt_date =#fltDate#

</select>
<select id="exp_DepFltHndlgRept_204_D" parameterClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO" resultClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO">
	select to_char(trans_date,'DDMONYY') AS dispDate, ramp_user_id AS dispStaff, auld_detail AS dispAuldDtl
	from   exp_flt_hand_wh_dispatch
	where  flt_key = #fltNo#
	and    flt_date = #fltDate#

</select>
	
<select id="exp_DepFltHndlgRept_204_E" parameterClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO" resultClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO">

	select uld_awb_no AS awbNo, pcs AS pcs, wt AS wgt, bup_ind AS bupInd, 
	to_char(CE_date,'DDMONYY') AS cedate, aat_date AS aatDate, remarks AS cstAction
	from   exp_flt_hand_wh_inspect
	where  flt_key = #fltNo#
	and    flt_date =#fltDate#
	 
</select>
	
<select id="exp_DepFltHndlgRept_204_E1" parameterClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO" resultClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO">

	select INSPECT_CARGO_remarks AS crgRmks, POST_FLT_CHK_remarks AS fltRmks, ser_std_remarks AS stdRmks
	from   exp_flt_hand_wh
	where  flt_key =#fltNo#
	and    flt_date = #fltDate#	
</select>
	
<select id="exp_DepFltHndlgRept_204_G" parameterClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO" resultClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO">
	
	select awb_no AS gawbNo, loc_code AS location, pcs AS peices, checker AS checker
	from   exp_flt_hand_wh_post_flt
	where  flt_key = #fltNo#
	and    flt_date =#fltDate#	
</select>
<select id="exp_DepFltHndlgRept_204_F" parameterClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO" resultClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO">
	
	select distinct sno, item_name AS titem, trans_date AS ttarget, to_char(trans_date, 'HH24MI')AS tservTime, modify_yn AS ttargetMet
	from   exp_flt_hand_tstamp
	where  flt_key = #fltNo#
	and    flt_date =#fltDate#
	and    rpt_type = 'EW'		
</select>
		
<select id="exp_DepFltHndlgRept_204_F1" parameterClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO" resultClass="cargo.cms.imprt.report.bo.DepFltHandlgRept_204BO">
	
	select sno, item_name AS sitem, std AS starget, service_time AS sservTime, std_met AS stargetMet, remarks AS srem
	from   exp_flt_hand_ser_std
	where  flt_key = #fltNo#
	and    flt_date = #fltDate#
	and    rpt_type = 'EW'
</select>
-->

<!--  Commented by Surendra Gollapalli on 27 July 2011 END -->

<select id="arrFltHndlgWHouseRept_162"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO">
	

	SELECT  SUBSTR(TRIM(TO_CHAR(NVL(OPR.SCH_TIME,0),'0000')),0,2)|| ':'||  SUBSTR(TRIM(TO_CHAR(NVL(OPR.SCH_TIME,0),'0000')),3,4) stime,    
		PKG_COMMON.get_flt_eta(OPR.FLT_KEY, OPR.SCH_DATE, 'A')  etime,    
		PKG_COMMON.get_flt_ata(OPR.FLT_KEY, OPR.SCH_DATE, 'A')  atime,    
		OPR.ACFT_TYPE cargoAcftType,    
		(SELECT CODE_DESC FROM MAST_CODE_DTL WHERE CODE =OPR.WTHR_COND AND CODE_TYPE='WTH_CONDN') weatherCondition,    
		pkg_common.flt_ports(OPR.FLT_KEY, OPR.SCH_DATE, 'A') portOfCall,
		c.code_desc as codeDesc,
		nvl(f.BD_TONNAGE,0) as bdTonnage,
		TO_CHAR(f.CR_DATE,'DDMONYY HH24:MI') as bdComplDate
	FROM IMP_FLT_HAND_SUMMARY f
	join FLT_OPR OPR on f.flt_key = opr.flt_key and f.flt_date = opr.sch_date and opr.flt_type = 'A'
	join MAST_ACFT_TYPE c on OPR.ACFT_TYPE = c.code 
	WHERE OPR.FLT_TYPE = 'A'  
	AND  TO_CHAR(OPR.SCH_DATE,'DDMONYY') = UPPER(#fltDate#)  
	AND  OPR.FLT_KEY =#fltNo#
	AND   F.REP_MODULE = 'IW'

</select>
	
<select id="arrFltHndlgWHouseRept_162_Itm"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO">
 select     
	A.CODE as itemCode,     
	A.Code_DESC as itemName,     
	UPPER(A.MODIFY_YN) as modifyYN,TO_CHAR(B.TSTAMP_DATE, 'DDMONYY') as actionedTimeDate,
	SUBSTR(TRIM(TO_CHAR(B.TSTAMP_TIME,'0000')),0,2) as actionedTimeHour,    
	SUBSTR(TRIM(TO_CHAR(B.TSTAMP_TIME,'0000')),3,4) AS actionedTimeMinute   
 FROM 
	MAST_FLT_TIME_STAMP A    
	LEFT JOIN IMP_FLT_HAND_TIME_STAMP B 
		ON A.CODE = B.TSTAMP_CODE AND B.TR_NO =#trNo#   
 where 
	(A.CODE_TYPE = 'TIME' AND A.REP_MODULE like '%'||'IW'||'%') 
	and A.CODE not in ('CATA', 'CETA')
</select>
	
<select id="arrFltHndlgWHouseRept_162_Std"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO">
 	SELECT      A.ITM_NAME as sitemName,      A.STD as std,      B.SVC_TIME AS serviceTime,      
		B.SVC_TIME as serviceTimeForDb,      B.STD_MET_YN as stdMet   
	FROM MAST_SVC_STD A    LEFT JOIN IMP_FLT_HAND_SVC_STD B ON A.ITM_NAME = B.ITM_NAME AND B.TR_NO =#trNo# 
	WHERE A.REP_MODULE ='IW'
</select>	
<select id="arrFltHndlgWHouseRept_162_From"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO">
 	
	SELECT TR_NO as trNo,      
	       DOC_LINE_NO as docLineNo,      
	       TO_CHAR(INFO_DATE,'DDMONYY') as timeDate,      
		   INFO_TIME as fromTime,
		   substr(trim(to_char(INFO_TIME,'0000')), 0, 2) timeHour,
		   substr(trim(to_char(INFO_TIME,'0000')), 3, 4) timeMinute,      
		   INFO_CONTENT as fromContent,      
		   INFO_USER as fromStaff,      
		   INFO_ACT as fromResult      
	       FROM IMP_FLT_HAND_DOC_OFFINFO    
	       WHERE FLT_KEY =#fltNo#
		   AND FLT_DATE = TO_DATE(#fltDate#,'DDMONYY') 
		   AND  FROM_TO ='F' AND     TR_NO =#trNo#
</select>
	
<select id="arrFltHndlgWHouseRept_162_To"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO">
   SELECT TR_NO as trNo,      
          DOC_LINE_NO as docLineNo,      
          TO_CHAR(INFO_DATE,'DDMONYY') as timeDate,      
		  INFO_TIME as rtoTime,
		  substr(trim(to_char(INFO_TIME,'0000')), 0, 2) timeHour,
		  substr(trim(to_char(INFO_TIME,'0000')), 3, 4) timeMinute,      
		  INFO_CONTENT as rtoContent,      
		  INFO_USER as rtoStaff,      
		  INFO_ACT as rtoResult      
          FROM IMP_FLT_HAND_DOC_OFFINFO    
	      WHERE FLT_KEY =#fltNo# AND     
	      FLT_DATE = TO_DATE(#fltDate#,'DDMONYY') 
		  AND FROM_TO ='T' AND     TR_NO =#trNo#
</select>

<select id="arrFltHndlgWHouseRept_162_1"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO">
		
	SELECT    RECORD_TYPE as type,
				   CODE as nature1,
				   NO_OF_SHP as numShipmnt1,
				   DOC_LINE_NO as docLineNo
			FROM IMP_FLT_HAND_WH_SPL_INFO
			WHERE 	
				  FLT_KEY =#fltNo# AND
				  FLT_DATE = TO_DATE(#fltDate#,'DDMONYY') AND
				  RECORD_TYPE ='SPL' AND
				  TR_NO = #trNo#		
</select>
	<select id="arrFltHndlgWHouseRept_162_1a"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO">
		
	SELECT    RECORD_TYPE as type,
				   CODE as nature1,
				   NO_OF_SHP as numShipmnt1,
				   DOC_LINE_NO as docLineNo
			FROM IMP_FLT_HAND_WH_SPL_INFO
			WHERE 	
				  FLT_KEY =#fltNo# AND
				  FLT_DATE = TO_DATE(#fltDate#,'DDMONYY') AND
				  RECORD_TYPE ='WHDEST' AND
				  TR_NO = #trNo#		
</select>	
	<select id="arrFltHndlgWHouseRept_162_2"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO">
		
	SELECT    RECORD_TYPE as type,
				   CODE as nature2,
				   NO_OF_SHP as numShipmnt2,
				   DOC_LINE_NO as docLineNo
			FROM IMP_FLT_HAND_WH_SPL_INFO
			WHERE 	
				  FLT_KEY =#fltNo# AND
				  FLT_DATE = TO_DATE(#fltDate#,'DDMONYY') AND
				  RECORD_TYPE = 'DISC' AND
				  TR_NO = #trNo#		
</select>	
	<select id="arrFltHndlgWHouseRept_162_3"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO">
		
	SELECT    RECORD_TYPE as type,
				   CODE as nature3,
				   NO_OF_SHP as numShipmnt3,
				   DOC_LINE_NO as docLineNo
			FROM IMP_FLT_HAND_WH_SPL_INFO
			WHERE 	
				  FLT_KEY =#fltNo# AND
				  FLT_DATE = TO_DATE(#fltDate#,'DDMONYY') AND
				  RECORD_TYPE = 'CC' AND
				  TR_NO = #trNo#		
</select>	


	<select id="flight_report_getSpl_162" parameterClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO" 
		resultClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO" >
			SELECT 
				   RECORD_TYPE as type,
				   CODE as code,
				   NO_OF_SHP as noOfShp,
				   DOC_LINE_NO as docLineNo
			FROM IMP_FLT_HAND_WH_SPL_INFO
			WHERE 	
				  FLT_KEY = #fltNo# AND
				  FLT_DATE = TO_DATE(#fltDate#,'DDMONYY') AND
				  RECORD_TYPE = #recordType# AND
				  TR_NO = #trNo# 
				  Order by RECORD_TYPE , CODE
	</select>
	
		<select id="flight_report_getPerformanceListIMBFR_162"	parameterClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO"
			 resultClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO">
		SELECT A.PERF_NAME as performanceName, 
			   A.PERF_DESC as description, 
			   A.INFO_REQD as infoRequired,
	 		   B.RMK as remarks  ,
			   B.RMK as oldRemarks  
		FROM MAST_PERFORMANCE_STD A 
		LEFT JOIN IMP_FLT_HAND_PERFORMANCE B ON A.PERF_NAME = B.PERF_NAME AND B.TR_NO = #trNo#
		WHERE A.REP_MODULE = #reptType#
	</select>
	
	<select id="flight_report_getServiceStandardListIMBFR_162"	parameterClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO"
			 resultClass="cargo.cms.imprt.report.bo.ArrFltHndlgWHouseRept_162BO">
			 <![CDATA[
			SELECT
		  	A.ITM_NAME as itemName,
		  	decode(a.STD_OPR, 'LE', '<=', 'LT', '<', 'GE', '>=', 'GT', '>', 'EQ', '=') || ' '|| NVL(MT.CODE_DESC, A.TIME_STAMP2) || ' + ' ||A.STD as std,
		  	B.SVC_TIME AS serviceTime,
		  	B.SVC_TIME as serviceTimeForDb,
		 	B.STD_MET_YN as stdMet,
		    (SELECT SUM(B.SVC_TIME-A.STD) FROM MAST_SVC_STD A, IMP_FLT_HAND_SVC_STD B 
		    WHERE B.STD_MET_YN = 'N' AND A.ITM_NAME= B.ITM_NAME AND F.FLT_KEY = #fltNo# AND F.SCH_DATE =B.FLT_DATE) AS Exceed
		 	FROM MAST_SVC_STD A 
			LEFT JOIN MAST_FLT_TIME_STAMP MT ON MT.CODE = A.TIME_STAMP2
			LEFT JOIN IMP_FLT_HAND_SVC_STD B ON A.ITM_NAME = B.ITM_NAME  AND nvl(b.tr_no, '**') = nvl(#trNo#, '**') 
			JOIN FLT_OPR F ON F.FLT_TYPE = DECODE(A.FLT_TYPE, 'I', 'A', 'D') AND F.CARR_CODE = NVL(A.CARR_CODE, F.CARR_CODE) 
		 	AND F.CGO_ACFT_TYPE = NVL(A.ACFT_TYPE, F.CGO_ACFT_TYPE)
			LEFT JOIN (SELECT FLT_KEY, FLT_DATE, SUM(MANIFEST_WT) WT 
			FROM IMP_CAR_SHP GROUP BY FLT_KEY, FLT_DATE) S ON S.FLT_KEY = F.FLT_KEY AND S.FLT_DATE = F.SCH_DATE
			WHERE A.REP_MODULE = #reptType#
			AND F.FLT_KEY = #fltNo# AND F.SCH_DATE = #fltDate# AND F.FLT_TYPE = 'A' 
			AND NVL(A.TONN_RANGE_FROM, nvl(S.WT, 0)) <= nvl(S.WT, 0) AND NVL(A.TONN_RANGE_TO, nvl(S.WT, 0)) >= nvl(S.WT, 0)	]]>
	</select>


<!-- Added by Yugandhar for Report No 570 -->
<select id="imp_bkg_shipment_dtls_570" parameterClass="cargo.cms.imprt.report.bo.EnquireCollectionSlotRept_570BO" 
 		resultClass="cargo.cms.imprt.report.bo.EnquireCollectionSlotRept_570BO">
 			select  bkg.BOOKING_NO, SUBSTR(bkgDtl.AWB_NO,1,3)||SUBSTR(bkgDtl.AWB_NO,4)  awbNo, 	
				SUBSTR(bkgDtl.AWB_NO,1,3)||'-'||SUBSTR(bkgDtl.AWB_NO,4) as awbNoDisp ,  bkgDtl.awb_no awbNo, to_char(bkgDtl.awb_date,'DDMONYY') awbDate ,
				bkgDtl.flt_Key flightNoKey, to_char(bkgDtl.flt_date,'DDMONYY') flightDate, sta,
      				decode(WHSE_COMPL_DATE,null,'N','Y') bdcompl,
        		decode(WHSE_COMPL_DATE , null, TO_CHAR(TO_DATE(FUN_GET_EST_COLL_TIME(bkgDtl.flt_Key,bkgDtl.flt_date,'A','BOOKING_EST_COLL_TIME',bkgDtl.AWB_NO,bkgDtl.awb_date), 'DDMONYY HH24:MI'),'HH24:MI'), 'Available' ) estCollTime, 
        		decode(WHSE_COMPL_DATE , null, TO_CHAR(TO_DATE(FUN_GET_EST_COLL_TIME(bkgDtl.flt_Key,bkgDtl.flt_date,'A','BOOKING_EST_COLL_TIME',bkgDtl.AWB_NO,bkgDtl.awb_date), 'DDMONYY HH24:MI'),'HH24:MI'), TO_CHAR(sysdate,'HH24:MI') ) estCollTimeHide,
				FUN_GET_EST_COLL_TIME(bkgDtl.flt_Key,bkgDtl.flt_date,'A','BOOKING_EST_COLL_TIME',bkgDtl.AWB_NO,bkgDtl.awb_date) estCollTimeShow,
          		nvl(shp.Manifest_pcs,0) pcs, nvl(shp.Manifest_wt,0) wt, nvl(awbInv.invPcs,0) invPcs, nvl(awbInv.invWt,0) invWt,
				(select code_desc from cust_company where code = carAwb.agent_cust_no) agtName, carAwb.agent_cust_no agtCode, 
				carAwb.CSGNE_NAME csgnName, carAwb.CNS_CUST_NO csgnCode, 
				shp.DLV_MODE_RQS dlvModeRqs, shp.IMX_RQS imxRqs,
				AWB.content as content,
				carAwb.DOC_CHK_REQ docChkReq, DOC_CHK_COMP docChkCompl,
        		case when ( select count(*) from IMP_CUST_CLR_LIST t1, IMP_CCCL_DOC_LIST t2 
					where t2.NOT_AVAILABLE = 'Y' and t1.tr_no = t2.tr_no and t1.awb_no = bkgDtl.awb_no and  t1.awb_date = bkgDtl.awb_date 
					and t1.flt_key = bkgDtl.flt_key and t1.flt_DATE = bkgDtl.flt_date) > 0 then 'Y' else 'N' end   reqDocs,  
				shp.NOA_IND noaInd, carAwb.VAL_FOR_SCH_COLL validforSchColl, 
				decode(trkMnf.truck_manf_no,null, 'Y', 'N') schColl, 
				(SELECT V.CC_CODE FROM V_CST_IMP_CC_CODE_AWB V
					WHERE V.FLT_KEY = bkgDtl.FLT_KEY AND V.FLT_DATE = bkgDtl.FLT_DATE AND V.AWB_NO = bkgDtl.AWB_NO 
				  AND NVL(V.HAWB_NO, '000000000000000000') =  '000000000000000000' AND ROWNUM = 1)  cc, 
				nvl(carAwb.SPL_CODE1,'') ||' '|| nvl(carAwb.SPL_CODE2,'') ||' '|| nvl(carAwb.SPL_CODE3,'') ||' '|| nvl(carAwb.SPL_CODE4,'') 
				||' '|| nvl(carAwb.SPL_CODE5,'') ||' '|| nvl(carAwb.SPL_CODE6,'') ||' '|| nvl(carAwb.SPL_CODE7,'') ||' '|| nvl(carAwb.SPL_CODE8,'') 
				||' '|| nvl(carAwb.SPL_CODE9,'') shc  ,    
				osCharge chrgs, TO_CHAR(shp.LM_DATE, 'DDMONYY HH24:MI:SSSSS') as lmDate,carAwb.CONSOLE_IND consol,
		        (select BKG_YN from mast_spl_hand_code where code in (carAwb.SPL_CODE1, carAwb.SPL_CODE2, carAwb.SPL_CODE3, carAwb.SPL_CODE4,carAwb.SPL_CODE5, carAwb.SPL_CODE6, carAwb.SPL_CODE7, carAwb.SPL_CODE8,carAwb.SPL_CODE9) AND ROWNUM = 1 ) bkgAllow,
		        (select count(1) from cust_airl_spl_code where carr_code = AWB.carr_code and spl_type = 'SPL_VAL' and spl_code in (carAwb.SPL_CODE1, carAwb.SPL_CODE2, carAwb.SPL_CODE4, carAwb.SPL_CODE3,carAwb.SPL_CODE5, carAwb.SPL_CODE6, carAwb.SPL_CODE7, carAwb.SPL_CODE8,carAwb.SPL_CODE9) AND ROWNUM = 1) valCnt,
		        (select count(1) from cust_airl_spl_code where carr_code = AWB.carr_code and spl_type = 'SPL_ODD' and spl_code in (carAwb.SPL_CODE1, carAwb.SPL_CODE2, carAwb.SPL_CODE4, carAwb.SPL_CODE3,carAwb.SPL_CODE5, carAwb.SPL_CODE6, carAwb.SPL_CODE7, carAwb.SPL_CODE8,carAwb.SPL_CODE9) AND ROWNUM = 1) oddCnt,
            	shp.TRUCKER_CUST_NO asgnTruckerCode ,   shp.TRUCKER_ASSIGN_BY asgnLoginId,
                (select HKID from SEC_USER USR  where  CUST_NO = shp.TRUCKER_CUST_NO and code = shp.TRUCKER_ASSIGN_BY) asgTruckerHkid,
                bkgDtl.CHARGES charges
			from IMP_BOOKING bkg
      join IMP_BOOKING_DTL bkgDtl on bkg.BOOKING_NO = bkgDtl.BOOKING_NO      
      join (select  fltEvt.WHSE_COMPL_DATE , flt.FLT_TYPE, flt.sch_date, flt.flt_Key, 
          flt.CARR_CODE, flt.ACFT_TYPE, flt.SCH_TIME estCollTimesta, flt.ACT_TIME estCollTimeata,
          SUBSTR(TRIM(TO_CHAR(NVL(flt.SCH_TIME,0),'0000')),0,2)|| ':'||  SUBSTR(TRIM(TO_CHAR(NVL(flt.SCH_TIME,0),'0000')),3,4) AS sta, 
          PKG_COMMON.get_flt_ata(flt.FLT_KEY,FLT.SCH_DATE,'A')	AS ata 
          from flt_opr flt, flt_opr_events fltEvt
          where flt.flt_Key = fltEvt.flt_Key and  flt.sch_Date = fltEvt.sch_date and  flt.flt_type = fltEvt.flt_type) fltTimes  
          on  bkgDtl.flt_Key = fltTimes.flt_Key and  bkgDtl.flt_Date = fltTimes.sch_date and fltTimes.flt_type = 'A'
    join IMP_CAR_SHP shp  on shp.awb_no = bkgDtl.awb_no and  shp.awb_date = bkgDtl.awb_date and shp.flt_Key = bkgDtl.flt_Key 
          and  shp.flt_Date = bkgDtl.flt_date  
    join IMP_CAR_AWB carAwb on bkgDtl.awb_no = carAwb.awb_no and  bkgDtl.awb_date = carAwb.awb_date                  
    join AWB on bkgDtl.awb_no = AWB.awb_no and  bkgDtl.awb_date = AWB.awb_date                  
    left join (select sum(locn_pcs) invPcs, sum(locn_wt) invWt, awb_no, awb_date, flt_key, flt_date from AWB_INVENTORY 
          group by awb_no, awb_date, flt_key, flt_date) awbInv 
          on bkgDtl.awb_no = awbInv.awb_no and  bkgDtl.awb_date = awbInv.awb_date and awbInv.flt_Key = bkgDtl.flt_Key 
          and  awbInv.flt_Date = bkgDtl.flt_date 
    left join  (select trkDtl.truck_manf_no truck_manf_no, trkDtl.awb_no, trkDtl.awb_date, trkDtl.flt_key, trkDtl.flt_date, SCH_COLL_FROM, 
          decode(FINAL_TRUCK_MANF_NO, 'N', 'Y') trk_manf_flz
          from TRUCK_MANIFEST trk,  TRUCK_MANIFEST_DTL trkDtl 
          where trk.TRUCK_MANF_NO = trkDtl.TRUCK_MANF_NO 
          and to_date( to_char(SCH_COLL_DATE,'DDMONYY') ||' '||to_char(NVL(SCH_COLL_FROM,0),'0000') , 'DDMONYY HH24MI') > sysdate
          and FINAL_TRUCK_MANF_IND = 'N' ) trkMnf
          on bkgDtl.awb_no = trkMnf.awb_no and  bkgDtl.awb_date = trkMnf.awb_date and bkgDtl.flt_key = trkMnf.flt_key and bkgDtl.flt_DATE = trkMnf.flt_date
      left join CUST_UNDERTAKING cusUnd ON cusUnd.carr_code = awb.CARR_CODE and cusUnd.AGENT_CODE  = carAwb.agent_cust_no
			left JOIN (select AWB_NO, AWB_DATE, sum(AAT_OS + AIRL_OS) osCharge from GT_OS_CHARGES group by AWB_NO, AWB_DATE) GT  	ON GT.AWB_NO = bkgDtl.AWB_NO AND GT.AWB_DATE = bkgDtl.AWB_DATE	 
    Where bkg.BOOKING_NO = #bookingNo# 
 	</select>
 	
 	<select id="imp_dlv_spl_hdlg_code_570" parameterClass="cargo.cms.imprt.report.bo.EnquireCollectionSlotRept_570BO" resultClass="cargo.cms.imprt.report.bo.EnquireCollectionSlotRept_570BO">
 		SELECT 
 			CODE as shc 
 		FROM 
 			IMP_CAR_AWB A, MAST_SPL_HAND_CODE B 
		WHERE 
			(B.CODE = A.SPL_CODE1 OR B.CODE = A.SPL_CODE2 OR B.CODE = A.SPL_CODE3 OR 
			B.CODE = A.SPL_CODE4 OR B.CODE = A.SPL_CODE5 OR B.CODE = A.SPL_CODE6 OR 
			B.CODE = A.SPL_CODE7 OR B.CODE = A.SPL_CODE8 OR B.CODE = A.SPL_CODE9) 
			AND A.AWB_NO = #awbNo# AND A.AWB_DATE = #awbDate# 
		ORDER BY 
			PRIORITY
 	</select>
 	
 	<select id="imp_coll_slot_info_570" parameterClass="cargo.cms.imprt.report.bo.EnquireCollectionSlotRept_570BO" 
 		resultClass="cargo.cms.imprt.report.bo.EnquireCollectionSlotRept_570BO">
 		SELECT 
 			TRUCK1 || case when TRUCK2 is not null then ', ' || TRUCK2 else '' end || 
 			case when TRUCK3 is not null then ', ' || TRUCK3 else '' end || 
 			case when TRUCK4 is not null then ', ' || TRUCK4 else '' end || 
 			case when TRUCK5 is not null then ', ' || TRUCK5 else '' end || 
 			case when TRUCK6 is not null then ', ' || TRUCK6 else '' end as truckNo, 
 			COLL_PERSON_NAME as collBy, HK_ID as hkId, 
 			TO_CHAR(BKG_SLOT_DATE, 'DDMONYY') || ' ' || 
 			SUBSTR(TRIM(TO_CHAR(NVL(BKG_SLOT_FROM,0),'0000')),0,2)|| ':' || 
 			SUBSTR(TRIM(TO_CHAR(NVL(BKG_SLOT_FROM,0),'0000')),3,4)|| ' - ' || 
 			SUBSTR(TRIM(TO_CHAR(NVL(BKG_SLOT_TO,0),'0000')),0,2)|| ':'|| 
 			SUBSTR(TRIM(TO_CHAR(NVL(BKG_SLOT_TO,0),'0000')),3,4) as truckSlot, 
      		PHONE_NO as phoneNo 
 		FROM 
 			IMP_BOOKING 
    	WHERE 
      		BOOKING_NO = #bookingNo#
 	</select>
 	<!-- Undelivered Shipment List   -->
<select id="imp_dlv_UnDlvShpmnt_221" parameterClass="cargo.cms.imprt.report.bo.UndeliveredShipments_221BO" resultClass="cargo.cms.imprt.report.bo.UndeliveredShipments_221BO">
	SELECT * FROM
		 (
		 		SELECT
				  CASE
				    WHEN NVL(A.CAR_CREATED,'N') = 'N' THEN 'INVENTORY'  WHEN NVL(A.CAR_CREATED,'N') = 'Y' THEN 'CAR' END  AS tag,
				  TO_CHAR(A.FLT_DATE, 'DDMONYY') AS fltDate,
				  A.FLT_KEY                      AS fltKey,
				  TO_CHAR(A.AWB_DATE, 'DDMONYY') AS awbDate,
				  A.AWB_NO                       AS awbNo,
				  SUBSTR(A.AWB_NO,1,3) ||'-' ||SUBSTR(A.AWB_NO,4) AS awbNoDisp ,
				  SUBSTR(A.AWB_NO,1,3) awbNoPrefix ,
				  SUBSTR(A.AWB_NO,4) awbNoSuffix ,
				  (SELECT V.CC_CODE  FROM V_CST_IMP_CC_CODE_AWB V  WHERE V.FLT_KEY = A.FLT_KEY  AND V.FLT_DATE = A.FLT_DATE
				      AND V.AWB_NO = A.AWB_NO AND NVL(V.HAWB_NO, '000000000000000000') = '000000000000000000' AND ROWNUM = 1) AS ccCode,
				  B.APPNTD_AGENT                          AS agentName,
				  B.CSGNE_NAME                            AS consignee,
				  I.INV_PCS                               AS invPcs,
				  TRIM(TO_CHAR(I.INV_WT, '9999999990D9')) AS invWt,
				  A.CAR_CREATED car,
				  AI.LOC_CODE AS Locn,
				  (SELECT TO_CHAR(F.ACT_DATE, 'DDMONYY') FROM FLT_OPR F WHERE F.FLT_KEY = A.FLT_KEY  AND F.SCH_DATE  = A.FLT_DATE  AND F.FLT_TYPE  = 'A') AS actDate,
				  AWB.CARR_CODE carrCode,
				  A.SCH_COLL_YN AS schColl,
				  NVL( (SELECT NVL(CONSTRAINT,'N') FROM MAST_CONSTRAINT_CODE WHERE CODE = (SELECT V.CC_CODE FROM V_CST_IMP_CC_CODE_AWB V WHERE V.FLT_KEY = A.FLT_KEY
				    AND V.FLT_DATE = A.FLT_DATE AND V.AWB_NO = A.AWB_NO AND NVL(V.HAWB_NO, '000000000000000000') = '000000000000000000'  AND ROWNUM = 1 ) ), 'N') AS srfInd,
				  CASE WHEN A.CIR_PROC_USER IS NOT NULL
				    THEN 'Y' WHEN (A.RECD_PCS+ NVL( (SELECT NVL(SUM(actual_pcs),0) tt_pcs FROM v_ddt_dtl ddt WHERE (shp_trf_type = 'TT' OR trf_type = 'IF')
				                                      AND A.AWB_NO = ddt.AWB_NO AND A.AWB_DATE = ddt.AWB_DATE AND A.FLT_KEY = ddt.FLT_KEY AND A.FLT_DATE = ddt.FLT_DATE
				                                      ),0) ) > A.MANIFEST_PCS THEN 'Y' ELSE 'N' END AS brkDwn,
				  TO_CHAR(AI.STRG_DATE,'DDMONYY') AS storageDate
				FROM IMP_CAR_AWB B
				JOIN AWB ON AWB.AWB_NO = B.AWB_NO AND AWB.AWB_DATE = B.AWB_DATE AND AWB.AWB_TYPE = 'I'
				<isEmpty property="dayBefore">
		 			JOIN (select X.* from IMP_CAR_SHP X where (flt_key , flt_date) in (select flt_key, sch_date from flt_opr where to_date( TO_CHAR( DECODE(ACT_DATE,NULL,SCH_DATE,ACT_DATE), 'DDMONYY'), 'DDMONYY' ) 
				             BETWEEN to_date( #fromDate# , 'DDMONYY' ) AND  to_date(#toDate# , 'DDMONYY' ) and flt_type = 'A' )
				    ) A ON A.AWB_NO = B.AWB_NO AND A.AWB_DATE = B.AWB_DATE 
				</isEmpty>
				
				<isNotEmpty  property="dayBefore">
		 			JOIN IMP_CAR_SHP A ON A.AWB_NO    = B.AWB_NO AND A.AWB_DATE = B.AWB_DATE
				</isNotEmpty>	
				join AWB_INVENTORY AI ON A.AWB_NO = AI.AWB_NO AND A.AWB_DATE = AI.AWB_DATE AND A.FLT_KEY  = AI.FLT_KEY AND A.FLT_DATE = AI.FLT_DATE
				JOIN (SELECT AWB_NO, AWB_DATE, FLT_KEY, FLT_DATE, SUM(LOCN_PCS) INV_PCS,    SUM(LOCN_WT) INV_WT, MIN(SEQ_NO) SEQ_NO,    COUNT(1) INV_COUNT
                	FROM AWB_INVENTORY  GROUP BY AWB_NO, AWB_DATE, FLT_KEY, FLT_DATE  ) I ON AI.SEQ_NO = I.SEQ_NO    
				WHERE 1 =1
		 	<isEmpty property="carrierCode">
		 		<isNotEmpty property="loginCarrier">
					AND ( A.CARR_CODE = #loginCarrier# OR  A.CARR_CODE IN (SELECT CARR_CODE FROM MAST_CARR_GRP WHERE GRP_CARR_CODE  = #loginCarrier#))    
				</isNotEmpty>         
    		</isEmpty>
		 	<isNotEmpty property="carrierCode">
		 		AND A.CARR_CODE =#carrierCode#
			</isNotEmpty>
			<isNotEmpty property="agentName">
				AND B.APPNTD_AGENT=#agentName#
			</isNotEmpty>
			<isNotEmpty property="woAgent">
			<isEqual property="woAgent" compareValue="Y">			 
				AND B.APPNTD_AGENT is null
			</isEqual>
			<isEqual property="woAgent" compareValue="N">			 
				AND (B.APPNTD_AGENT is not null or B.APPNTD_AGENT is null)
			</isEqual>
			</isNotEmpty>
			<isNotEmpty property="agentCode">
				 AND EXISTS (SELECT NULL FROM CUST_COMPANY WHERE CODE_DESC= B.APPNTD_AGENT AND CODE= #agentCode#)
			</isNotEmpty>
		)	
		where tag = NVL(#status#, tag)
		<isNotEmpty  property="dayBefore">
		 AND (SYSDATE - TO_DATE(storageDate,'DDMONYY') > #dayBefore# )
		</isNotEmpty>
		<dynamic prepend="ORDER BY ">
           <isNotEmpty property="sortOrder.sortField">
             $sortOrder.sortField$
           </isNotEmpty>
           <isEmpty property="sortOrder.sortField">
             	awbNoDisp asc
           </isEmpty>
        </dynamic>			
</select>

 
 	
 	<select id="ArrFltHandlingReptDOC_161"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingReptDOC_161BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingReptDOC_161BO">
		 
SELECT    
		  TR_NO as reptTrNo,    
		  REP_MODULE as repModule,    
		  CARR_CODE as carrCode,    
		  FLT_NO as fltNo,    
		  FLT_DATE as fltDate,    
		  FLT_KEY as fltKey,    
		  FLT_ATA as fltAta,    
		  NO_OF_LOADED_ULDS as noOfLoadedUlds,    
		  NO_OF_BULK_CARGO as noOfBulkCargo,    
		  NO_OF_EMPTY_ULD as noOfEmptyUld,    
		  IRR_ULD as irrUld,    
		  IRR_ULD_RMK as irrUldRmk,    
		  SVC_STD_RMK as svcStdRmk,
		  LM_USER_ID as modifiedUserId,    
		  TO_CHAR(LM_DATE, 'DDMONYY HH24:MI') as lmDate,    
		  AWB_LOCAL as awbLocal,    
		  AWB_TRAN as awbTran,    
		  AWB_MAIL as awbMail   
FROM IMP_FLT_HAND_SUMMARY   
WHERE     FLT_KEY = #fltKey#
		  AND    TO_CHAR(FLT_DATE, 'DDMONYY') = #fltDate#
		  AND    REP_MODULE = 'ID'
			</select>


	<select id="truckSRFListRept_574" parameterClass="cargo.cms.imprt.report.bo.EnquireTruckRept_574BO" resultClass="cargo.cms.imprt.report.bo.EnquireTruckRept_574BO">
		SELECT S.SRF_NO AS srfNo,
		S.STATUS AS status,
		DECODE(UPPER(S.STATUS),'POSTED','Y','N') AS dlvCompl,
		S.AWB_NO AS awbNo,
		SA.FLT_KEY AS fltKey,
		to_char(SA.FLT_DATE,'DDMONYY') AS fltDate, 
		S.AGENT_ID AS agtName,
		S.SRF_PCS AS srfPc,
		S.SRF_WT AS srfWt,
		S.COLL_NAME AS collBy,
		S.COLL_HKID AS hkId,
		CAR_AWB.CONTENT AS content ,CAR_AWB.CC_CODE AS cc,
		CAR_AWB.SPL_CODE1 || DECODE(CAR_AWB.SPL_CODE2,NULL,'',','||CAR_AWB.SPL_CODE2) || DECODE(CAR_AWB.SPL_CODE3,NULL,'',','||CAR_AWB.SPL_CODE3)
		|| DECODE(CAR_AWB.SPL_CODE4,NULL,'',','||CAR_AWB.SPL_CODE4) || DECODE(CAR_AWB.SPL_CODE5,NULL,'',','||CAR_AWB.SPL_CODE5) || DECODE(CAR_AWB.SPL_CODE6,NULL,'',','||CAR_AWB.SPL_CODE6)
		|| DECODE(CAR_AWB.SPL_CODE7,NULL,'',','||CAR_AWB.SPL_CODE7) || DECODE(CAR_AWB.SPL_CODE8,NULL,'',','||CAR_AWB.SPL_CODE8) || DECODE(CAR_AWB.SPL_CODE9,NULL,'',','||CAR_AWB.SPL_CODE9) AS shc
		
		FROM IMP_SRF S
		JOIN IMP_SRF_AWB_INVENTORY SA ON S.AWB_NO=SA.AWB_NO AND S.AWB_DATE=SA.AWB_DATE AND S.SRF_NO=SA.SRF_NO
		JOIN IMP_CAR_AWB CAR_AWB ON SA.AWB_NO=CAR_AWB.AWB_NO AND SA.AWB_DATE=CAR_AWB.AWB_DATE
		WHERE S.TRUCK_NO=#truckNo#
	</select>
	<select id="truckULDListRept_574" parameterClass="cargo.cms.imprt.report.bo.EnquireTruckRept_574BO" resultClass="cargo.cms.imprt.report.bo.EnquireTruckRept_574BO">
		SELECT REL_DTL.ULD_KEY AS uldNo,REL_DTL.EIR_NO AS urfNo,
		SUM(INV.BULK_WT) AS uldWt
		FROM ULD_REL_HD REL_HD
		JOIN ULD_REL_DTL REL_DTL ON REL_HD.TR_NO=REL_DTL.TR_NO
		join AWB_INVENTORY INV ON INV.ULD_KEY=REL_DTL.ULD_KEY 
		WHERE REL_HD.TRUCK_NO=#truckNo# GROUP BY REL_DTL.ULD_KEY, REL_DTL.EIR_NO
	</select>
	<select id="truckSealListRept_574" parameterClass="cargo.cms.imprt.report.bo.EnquireTruckRept_574BO" resultClass="cargo.cms.imprt.report.bo.EnquireTruckRept_574BO">
		select seal_no as sealNo from truck_seal where truck_no = #truckNo#
	</select>



<select id="ArrFltHandlingReptDOC_161_summary"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingReptDOC_161BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingReptDOC_161BO">

SELECT		flt.FLT_NO as fltNo, 
		   flt.CARR_CODE as carrCode,
		   flt.FLT_KEY as fltKey,
		   TO_CHAR(flt.SCH_DATE,'DDMONYY') as fltDateDisplay,
		   TO_CHAR(flt.SCH_DATE,'DDMONYY') as fltDate,
		   flt.TR_NO as reptTrNo, 
		   PKG_COMMON.get_flt_ata(flt.FLT_KEY, flt.SCH_DATE, 'A') as ata,
		   NVL(flt.ACT_TIME, '0000') as ataForInsert,
		   TO_CHAR(fltevents.DOC_COMPL_DATE, 'DDMONYY HH24:MI') as bdComplDate,
		   flt.ACFT_TYPE as cargoAcftType,
		   PKG_COMMON.get_flt_eta(flt.FLT_KEY, flt.SCH_DATE, 'A') as eta,
	   	   DECODE(flt.SCH_TIME,NULL,'',SUBSTR(TRIM(TO_CHAR(flt.SCH_TIME, '0000')),0,2)|| ':'||  SUBSTR(TRIM(TO_CHAR(flt.SCH_TIME, '0000')),3,4)) as sta,
		   repthead.LM_USER_ID as fltHdlgDataGenStaffId,
		   TO_CHAR(repthead.LM_DATE,'DDMONYY HH24:MI') as fltHdlgDataGenDate,
		   repthead.TR_NO as reptTrNo,
		   (SELECT CODE_DESC FROM MAST_CODE_DTL WHERE  CODE  = flt.WTHR_COND AND CODE_TYPE='WTH_CONDN') AS weatherCondition,
			pkg_common.flt_ports(flt.FLT_KEY, flt.SCH_DATE, 'A') portOfCall,
			AWB_LOCAL as local, 
			AWB_TRAN as transhipment, 
			AWB_MAIL as mailCN
		FROM FLT_OPR flt 
		LEFT JOIN IMP_FLT_HAND_SUMMARY	repthead ON
		 		 repthead.REP_MODULE = 'ID' AND	 flt.FLT_KEY = repthead.FLT_KEY AND flt.SCH_DATE = repthead.FLT_DATE, 
		FLT_OPR_EVENTS fltevents
		WHERE
			flt.FLT_TYPE = 'A'	
			AND	flt.TR_NO = fltevents.TR_NO 
			AND TO_CHAR(flt.SCH_DATE,'DDMONYY') = #fltDate#               
		<dynamic>
			<isNotEmpty prepend="AND" property="carrCode">
				flt.CARR_CODE = #carrCode#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="fltNo">
				flt.FLT_NO = #fltNo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="fltKey">
				flt.FLT_KEY = #fltKey#
			</isNotEmpty>
			<isEmpty property="carrCode">
			<isNotEmpty property="loginCarrier">
				AND	(flt.CARR_CODE = #loginCarrier#
				OR flt.CARR_CODE IN (SELECT CARR_CODE FROM MAST_CARR_GRP 
				WHERE GRP_CARR_CODE	= #loginCarrier#))							
			</isNotEmpty>
		</isEmpty>			
		</dynamic>
</select>

<select id="ArrFltHandlingReptDOC_161_loadInfo"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingReptDOC_161BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingReptDOC_161BO">

		select 
			CARGO_TYPE AS type, 
			CARGO_TYPE_DESC AS typeCode, 
			nvl(NO_OF_SHP, 0) noOfShp, 
			nvl(PCS, 0) pcs, 
			nvl(WT, 0) wt, 
			nvl(BUP_WT, 0) bupWt, 
			nvl(BULK_WT, 0) bulkWt			
		FROM 
			IMP_FLT_HAND_LOAD_INFO 
		WHERE 
			TR_NO =  #reptTrNo#
		
</select>


<select id="ArrFltHandlingReptDOC_161_descrepancyTable"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingReptDOC_161BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingReptDOC_161BO">

		SELECT TR_NO AS trNo,
				DOC_LINE_NO AS docLineNo,
				AWB_NO AS awbNo,
				TO_CHAR(AWB_DATE,'DDMONYY') AS awbDate,
				DEST AS awbDest,
				DCP_CODE AS dcpCode,
				m.code_desc AS action,
				d.ACTION AS actionCode,
				ACTION_RMK AS remarks,
				ACTION_BY AS actionedBy
		FROM 
			IMP_FLT_HAND_DOC_DISC d
			left join Mast_code_dtl m on m.Code = d.ACTION and m.Code_Type = 'ACTION_CODE'
		WHERE 
			TR_NO =#reptTrNo#

</select>

<select id="ArrFltHandlingReptDOC_161_timeLog"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingReptDOC_161BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingReptDOC_161BO">

select 
			A.CODE as itemCode, 
			A.Code_DESC as itemName, 
			UPPER(A.MODIFY_YN) as modifyYN,
			TO_CHAR(B.TSTAMP_DATE, 'DDMONYY HH24:MI') as actionedTimeDate,
			SUBSTR(TRIM(TO_CHAR(B.TSTAMP_TIME,'0000')),0,2) as actionedTimeHour,
			SUBSTR(TRIM(TO_CHAR(B.TSTAMP_TIME,'0000')),3,4) AS actionedTimeMinute
		FROM MAST_FLT_TIME_STAMP A 
		LEFT JOIN IMP_FLT_HAND_TIME_STAMP B ON A.CODE =	B.TSTAMP_CODE AND B.TR_NO = #reptTrNo#
		where (A.CODE_TYPE = 'TIME' AND A.REP_MODULE like '%'||'ID'||'%') or A.CODE = 'CATA'

</select>

<select id="ArrFltHandlingReptDOC_161_performance"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingReptDOC_161BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingReptDOC_161BO">

<!--

 **NOT USED** Right Now, for Report
 **NOT USED** Right Now, for Report

-->
</select>


<select id="ArrFltHandlingReptDOC_161_tarmac"  parameterClass="cargo.cms.imprt.report.bo.ArrFltHandlingReptDOC_161BO" resultClass="cargo.cms.imprt.report.bo.ArrFltHandlingReptDOC_161BO">

		SELECT TR_NO AS trNo,
		   DOC_LINE_NO AS docLineNo,
		   AWB_NO AS awbNo,
		   TO_CHAR(AWB_DATE,'DDMONYY') AS awbDate,
		   DEST AS awbDest,
		   BKG_RECV_AT AS bookingAt ,
		   CNTG_FLT_KEY || '/' || to_char(CNTG_FLT_DATE,'DDMONYY') AS connectingFlt,
		   CNTG_FLT_KEY AS connectingFltKey,
		   to_char(CNTG_FLT_DATE,'DDMONYY') AS connectingFltDate,
		   TRM_NO AS trmNo
		FROM IMP_FLT_HAND_DOC_TRM
		WHERE TR_NO = #reptTrNo#

</select>

<!--REPT_525-->
<select id="get_details_cpsl_mhs_Rept525" parameterClass="cargo.cms.imprt.report.bo.RetrievalMonitoring_ReptBO"
		resultClass="cargo.cms.imprt.report.bo.RetrievalMonitoring_ReptBO">
		select 
		O.FUNC as function,
		O.REF_NO as refNo,
		O.AWB_NO as awbNo,
		case when O.LSP is not null then (select LOC_CODE from lsp_inventory where LSP_NO = O.LSP)
		else case when O.ULD is not null then (select LOC_CODE from uld_inventory where ULD_KEY = O.ULD) else null end end as currLocn,		
		O.LSP as csd,
		O.ULD as uld,
		O.PC as pcs,
		O.WT as wt,
		O.TARGET as target,
		O.STATUS as status,
                O.CURR_LOCN as source,
		O.HAWB_NO as hawb,
		O.AGENT_ID as agent,
		TO_CHAR(O.LM_DATE, 'DDMONYY HH24:MI') as lmDate,
		TO_CHAR(O.CR_DATE,'DDMONYY HH24:MI') as time,
		O.PRIORITY as priority,
		O.TYPE as type,
		O.CR_USER_ID AS handleUser,
		   		TO_CHAR(O.CR_DATE,'DDMONYY') as handleDate,
   		TO_CHAR(O.OB_FLT_DATE, 'DDMONYY') as obFltDate,
   		O.OB_FLT_KEY as obFltKey,
   		DECODE(O.STATUS,'REJECTED','Y',DECODE(O.STATUS,'CANCELLED','Y','N')) as action,
                AWB.AGENT_CODE as agentCode,
     	        AWB.AGENT_NAME as agentName
		from rtrv_move_order O
                LEFT JOIN AWB AWB ON AWB.AWB_NO=O.AWB_NO AND AWB.AWB_DATE=PKG_COMMON.GET_AWB_DATE(O.AWB_NO,'')
		<isNotEmpty property="obFltKey">
		join (select awb_no,awb_date from exp_pmanifest_awb where flt_date=TO_DATE(#obFltDate#,'DDMONYY') and flt_key=#obFltKey#) E
    	on O.awb_no = E.awb_no and O.AWB_DATE = E.AWB_DATE
		</isNotEmpty>
		<![CDATA[
		where TO_DATE(TO_CHAR(O.CR_DATE,'DDMONYY HH24:MI') ,'DDMONYY HH24:MI')  >=TO_DATE(#srmFromDate#,'DDMONYY HH24:MI') 
		and TO_DATE(TO_CHAR(O.CR_DATE,'DDMONYY HH24:MI'),'DDMONYY HH24:MI')   <= TO_DATE(#srmToDate#,'DDMONYY HH24:MI')
		]]>		
		<isNotEmpty property="jo">
		and TYPE	 = 'J'
		<isNotEmpty property="status">
		and STATUS = #status#
		</isNotEmpty>	
		<isEmpty property="status">
		 and (STATUS IS NULL or status ='STARTED' or status='COMPLETED')
		</isEmpty>	
		</isNotEmpty> 
		<isNotEmpty property="mhs">
		and TYPE	 = 'M'
		<isNotEmpty property="status">
			<isEqual compareValue="Blank" property="status">
			and status is NULL
			</isEqual>
			<isNotEqual property="status" compareValue="Blank">
		and STATUS = #status#
			</isNotEqual>
		</isNotEmpty>
		<isEmpty property="status">
		 and (STATUS IN ('E','A') or status ='STARTED'  or status is NULL)
		</isEmpty>
		</isNotEmpty> 
		<isNotEmpty property="whArea">
		and CURR_LOCN in (select code from mast_wh_loc where wh_group in (select wh_group from mast_wh_group where wh_area =#whArea#))
		</isNotEmpty> 
		<isNotEmpty property="whGroup">
		and CURR_LOCN in (select code from mast_wh_loc where wh_group =#whGroup#)
		</isNotEmpty>
    	<isNotEmpty property="whLocn">
		and CURR_LOCN	 = #whLocn#
		</isNotEmpty> 
                <isNotEmpty property="sourceLevel">
		and CURR_LOCN	 IN (SELECT CODE FROM MAST_WH_LOC WHERE LOC_LEVEL=#sourceLevel#)
		</isNotEmpty> 
		 
		<isNotEmpty property="trArea">
		and TARGET in (select code from mast_wh_loc where wh_group in (select wh_group from mast_wh_group where wh_area =#trArea#))
		</isNotEmpty> 
		<isNotEmpty property="trGroup">
		and TARGET in (select code from mast_wh_loc where wh_group =#trGroup#)
		</isNotEmpty>
   		<isNotEmpty property="trLocn">
		and TARGET	 = #trLocn#
		</isNotEmpty> 
                <isNotEmpty property="targetLevel">
		and TARGET	 IN (SELECT CODE FROM MAST_WH_LOC WHERE LOC_LEVEL=#targetLevel#)
		</isNotEmpty> 
		<isNotEmpty property="truckNo">
		and O.REF_NO IN (SELECT SRF_NO FROM IMP_SRF WHERE TRUCK_NO=#truckNo#)
		</isNotEmpty>
		<isNotEmpty property="awbNo">
		and AWB_NO	 = #awbNo#
		</isNotEmpty> 
		<isNotEmpty property="csd">
		and LSP	 = #csd#
		</isNotEmpty> 
		<isNotEmpty property="uld">
		and ULD	 = #uld#
		</isNotEmpty> 
		<isEqual property="priority" compareValue="Y">		
			and (PRIORITY IS NOT NULL AND PRIORITY != 'N')	
		</isEqual>
		<isEqual property="inv" compareValue="cpsl">		
			and INV_TYPE = 'CPSL'	
		</isEqual>
		<isEqual property="inv" compareValue="Agent">		
			and INV_TYPE = 'ASV'	
		</isEqual>
		<isNotEmpty property="trkFltKey">
		and TRUCK_FLT_NO=#trkFltKey# and TRUCK_FLT_DATE=TO_DATE(#trkFltDate#,'DDMONYY')
		</isNotEmpty>
		<isNotEmpty property="sfunction">
		and FUNC = #sfunction#
		</isNotEmpty>
	</select>
	

<select id="imp_awbList_526"  parameterClass="cargo.cms.imprt.report.bo.ReGenerateSRF526_ReptBO" resultClass="cargo.cms.imprt.report.bo.ReGenerateSRF526_ReptBO">
	SELECT A.AWB_NO awbNo,
			   SUBSTR(A.AWB_NO,1,3)  awbNoPrefix , 
			   SUBSTR(A.AWB_NO,4)  awbNoSuffix , 
			   SUBSTR(A.AWB_NO,1,3)||'-'||SUBSTR(A.AWB_NO,4) as awbNoDisp ,
			   TO_CHAR(A.AWB_DATE, 'DDMONYY') awbDate,
			   B.SRF_NO srfNo,
			   B.SRF_NO  srfNoPrefix ,  
			   B.SRF_NO as srfNoDisp ,
			   CATALOG catalog,
			   A.AWB_PCS awbPc, 
			   A.AWB_WT awbWt, 
			   A.CONTENT contents,
			   decode(A.SPL_CODE1,NULL,' ',A.SPL_CODE1) splCode1, 
			   decode(A.SPL_CODE2,NULL,' ',A.SPL_CODE2) splCode2, 
			   decode(A.SPL_CODE3,NULL,' ',A.SPL_CODE3) splCode3, 
			   decode(A.SPL_CODE4,NULL,' ',A.SPL_CODE4) splCode4, 
			   decode(A.SPL_CODE5,NULL,' ',A.SPL_CODE5) splCode5, 
			   decode(A.SPL_CODE6,NULL,' ',A.SPL_CODE6) splCode6, 
			   decode(A.SPL_CODE7,NULL,' ',A.SPL_CODE7) splCode7, 
			   decode(A.SPL_CODE8,NULL,' ',A.SPL_CODE8) splCode8,
			   decode(A.SPL_CODE9,NULL,' ',A.SPL_CODE9) splCode9,
			   CSGNE_NAME consignee, 
			   APPNTD_AGENT apptdAgt,  
			   B.CHARGE_STATUS as chrgStatus,
			   (SELECT CO_IATA_CODE FROM CUST_COMPANY WHERE CODE = A.AGENT_CUST_NO) iataCode,
			   A.BANK_ENDOS bankEndorsmentYN, 
			   A.BANK_TYPE bank,  
			   A.AWB_RMK awbRemarks, 			  
			   TO_CHAR(B.SRF_EXPY_DATE,'DDMONYY HH24:MI') srfExpiryDate, 
			   B.REPEAT_YN repeatYN, 
			   B.TRUCK_CO truckerCo, 	
			   B.AUTH_REP_NAME authName, 					
			   B.AUTH_REP_ID authID, 					
			   B.TRUCK_NO truckNo,
			   B.COLL_HKID hkId, 
			   B.COLL_NAME collectedBy,
			   B.COLL_CENTER collCenter,
			   B.SRF_PCS delvPcToDate,
			   To_Char(OFF_ARR_DATE,'DDMONYY HH24:MI')	cargoArrDate,
			   To_Char(B.SRF_PRNT_DATE,'DDMONYY HH24:MI') srfPrintDate,
			   To_Char(FIRST_CG_ARR_DATE,'DDMONYY HH24:MI') firstCargoArrDate, 
			   (select to_char(DLV_DATE,'DDMONYY HH24:MI') from imp_srf_awb_inventory where DLV_DATE is not null and srf_no = #sc_srfNo# and ROWNUM =1 ) deliComplDate,  
			   To_Char(POST_DATE,'DDMONYY HH24:MI') postDate,
			   A.CR_USER_ID crUserID,
			   pkg_common.get_srf_cc(b.srf_no) as strCC,
			   B.TD_NO truckDockNo,
			   SRF_RMK srfRmk,
			   B.AGENT_ID apptdAgtCode,
			   B.CHARGE_STATUS chargeStatus,B.COLL_CENTER collCenter ,
			   NVL((SELECT sum(CR_BAL) 
			   FROM CUST_AGENT_AIRL_CREDIT
			   WHERE CR_EFF_DATE_FROM &lt; SYSDATE AND CR_EFF_DATE_TO &gt;= SYSDATE AND nvl(upper(Status),'**') &lt;&gt; 'VOID' 
			   AND UPPER(CR_TYPE) = UPPER(DECODE(A.CATALOG, 'IG', 'Import_GEN', DECODE(A.CATALOG, 'IO', 'Import_OBC', '*')))
			   AND CUST_NO = A.AGENT_CUST_NO AND nvl(upper(Status),'**') &lt;&gt; 'VOID' ), 0)  airlCrdAvail,
	    	   NVL((SELECT sum(CR_BAL) 
			   FROM CUST_AGENT_CREDIT
			   WHERE CR_EFF_DATE_FROM &lt; SYSDATE AND NVL(CR_EFF_DATE_TO, SYSDATE) &gt;= SYSDATE 
			   and nvl(upper(Status),'**') &lt;&gt; 'VOID' AND instr( nvl(UPPER(CARR_CODE),'*'), nvl(UPPER(B.CARR_CODE),'**') ) &gt; 0 
			   AND CUST_NO = A.AGENT_CUST_NO AND upper(CR_TYPE) = 'IMPORT_GEN'), 0)  aatCrdAvail,
			   NVL((SELECT 'Y' C
			   FROM CUST_UNDERTAKING 
			   WHERE EFF_FROM &lt; SYSDATE AND NVL(EFF_TO, SYSDATE) &gt;= SYSDATE AND ROWNUM = 1
			   AND CARR_CODE = B.CARR_CODE AND AGENT_CODE = A.AGENT_CUST_NO AND A.CONSOLE_IND = 'Y'), 'N') undertakingYN 
			   FROM IMP_SRF B , IMP_CAR_AWB A
			   WHERE  
			   B.AWB_NO = A.AWB_NO AND
			   B.AWB_DATE = A.AWB_DATE AND
			   B.SRF_NO = #sc_srfNo#
</select>

<select id="imp_pendList_526"  parameterClass="cargo.cms.imprt.report.bo.ReGenerateSRF526_ReptBO" resultClass="cargo.cms.imprt.report.bo.ReGenerateSRF526_ReptBO">
SELECT 
			a.FLT_KEY flightNoKey, 
			to_Char(a.FLT_DATE,'DDMONYY') flightDate, 
			b.ACT_TIME AS ata, 
			PKG_COMMON.get_flt_ata(B.FLT_KEY, B.SCH_DATE, 'A')  as ataTime,	
			decode(INV_PCS,NULL,' ',INV_PCS) invPc, 
			decode(INV_WT,NULL,' ',INV_WT) invWt, 
			decode(MANIFEST_PCS,NULL,' ',MANIFEST_PCS) manfPc, 
			decode(MANIFEST_WT,NULL,' ',MANIFEST_WT) manfWt,
			CIR_TYPE cirType, 
			decode(CIR_PCS,NULL,' ',CIR_PCS) cirPc, 
			decode(CIR_WT,NULL,' ',CIR_WT) cirWt, 
			CC_CODE strCC, 
			DC_IND strDC, 
			STRG_CHRG strChrg,
			a.RMK remarks
			FROM IMP_SRF_FLT a 
			LEFT JOIN FLT_OPR b ON a.FLT_DATE = b.SCH_DATE AND a.FLT_KEY = b.FLT_KEY and b.flt_type = 'A'
			WHERE SRF_NO = #sc_srfNo# 
</select>

<select id="validate_locn_for_area_rept" parameterClass="map" resultClass="java.lang.Integer">
		select count(1) from mast_wh_area where wh_area = #locn#
	</select>
	<select id="validate_locn_for_group_rept" parameterClass="map" resultClass="java.lang.Integer">
		select count(1) from mast_wh_group where wh_group =#locn#
	</select>
	
<select id="airline_charge"  parameterClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO" resultClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO">
select to_char(sum(CHRG_AMT),'999999,999,999.99')as airLineCharge,sum(PAID_AMT_CASH) cashPayment,sum(PAID_AMT_CREDIT) creditPayment
from bill_charge_dtl where srf_no = #sc_srfNo# and rev_ind = 'A'
group by bill_charge_dtl.srf_no
</select>

<select id="storage_charge"  parameterClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO" resultClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO">
select to_char(sum(CHRG_AMT),'999999,999,999.99') as storageCharge,sum(PAID_AMT_CASH) cashPayment,sum(PAID_AMT_CREDIT) creditPayment
from bill_charge_dtl where itm_code like 'SC%' and srf_no = #sc_srfNo#
group by bill_charge_dtl.srf_no
</select>

<select id="bond_charge"  parameterClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO" resultClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO">
select to_char(sum(CHRG_AMT),'999999,999,999.99') as bondCharge,sum(PAID_AMT_CASH) cashPayment,sum(PAID_AMT_CREDIT) creditPayment
from bill_charge_dtl where itm_code like 'LCBOND%' and srf_no = #sc_srfNo#
group by bill_charge_dtl.srf_no
</select>

<select id="storage_charge_rertutn_cargo"  parameterClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO" resultClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO">
 	SELECT TO_CHAR(SUM(CHRG_AMT),'999999,999,999.99') AS storageCharge,
  	SUM(PAID_AMT_CASH) cashPayment,
  	SUM(PAID_AMT_CREDIT) creditPayment
	FROM bill_charge_dtl c
	join exp_rtn_hd r on instr(r.chrg_tr_no, c.tr_no) > 0
	WHERE itm_code LIKE 'SC%'
	and r.rtn_no = #sc_srfNo#
</select>

<select id="imp_EnquireSRFRept_110SRFD"  parameterClass="cargo.cms.imprt.report.bo.EnquireSRFRept_110SRFDBO"  resultClass="cargo.cms.imprt.report.bo.EnquireSRFRept_110SRFDBO">
SELECT
			To_Char(SRF_DATE,'DDMONYY HH24:MI')  srfDate,
			SRF_NO srfNo,
			SRF_NO  srfNoPrefix , 
			SUBSTR(SRF_NO,1,8) as srfNoDisp ,
			pkg_common.get_srf_cc(SRF_NO) as strCC,
			A.AWB_NO awbNo,
			SUBSTR(A.AWB_NO,1,3)  awbNoPrefix , 
			SUBSTR(A.AWB_NO,4)  awbNoSuffix , 
			SUBSTR(A.AWB_NO,1,3)||'-'||SUBSTR(A.AWB_NO,4) as awbNoDisp ,
			TO_CHAR(A.AWB_DATE, 'DDMONYY') awbDate,
			SRF_PCS srfPc , 
			SRF_WT srfWt,
			(select B.TRUCK_DOCK from IMp_truck_srf CC join TRUCK_TRIP b on CC.TRIP_ID= b.TRIP_ID where CC.srf_No =A.SRF_NO and b.CLOSED='N' and rownum=1)  truckDoc,
			<!-- (select CC_CODE from IMP_SRF_FLT isf   where isf.srf_no = A.SRF_NO  and isf.awb_no = A.AWB_NO and to_char(isf.AWB_DATE,'DDMONYY')= to_char(A.AWB_DATE,'DDMONYY')) ccCode,-->
			To_Char(SRF_EXPY_DATE,'DDMONYY HH24:MI') srfExpiryDate,
			To_Char(OFF_ARR_DATE,'DDMONYY HH24:MI')	cargoArrDate,
			To_Char(SRF_PRNT_DATE,'DDMONYY HH24:MI') srfPrintDate,
			<!-- CASE is added to resolve the bug 'Delivery Completed should show value if all the locations for the SRF are delivered' -->
			case when (select count(1) from imp_srf_awb_inventory where   DLV_IND='N' and srf_no=A.SRF_NO) > 0 then '' else (select to_char(DLV_DATE,'DDMONYY HH24:MI') from imp_srf_awb_inventory where DLV_DATE is not null and srf_no = A.SRF_NO and ROWNUM =1 )end deliComplDate,  
			decode((To_Char(POST_DATE,'DDMONYY')||' '|| substr(POST_TIME,0,2)||':'||substr(POST_TIME,3,4)),':','',(To_Char(POST_DATE,'DDMONYY')||' '|| substr(POST_TIME,0,2)||':'||substr(POST_TIME,3,4))) postDate, 
			A.CR_USER_ID userID,
			DECODE(POST_DATE,NULL, 'N','Y') srfPostedYN,  
			case when (SELECT COUNT(1) FROM BILL_CHARGE_DTL WHERE upper(status)='PENDING' and srf_no=A.SRF_NO)>0 then 'OUTSTANDING' else 'PAID' end as chrgStatus,
			B.BYPASS_REL byPass,
			A.CONSTRAINED_ON_POST ccOnPostYN,
			statusCDIF,
			statusExit,
			statusVoid
			FROM (Select s.*, case when 
					(Select count(1) from Imp_CDIF where SRF_No = s.SRF_No and VOID_USER is null) > 0 then 'Y' else 'N' end statusCDIF,  
					   DECODE(POST_DATE,NULL, 'N','Y') statusExit,    
					   DECODE(VOID_DATE,NULL, 'N','Y') statusVoid from IMP_SRF s) A, IMP_CAR_AWB B   
		WHERE A.AWB_NO 	= B.AWB_NO AND
		A.AWB_DATE  = B.AWB_DATE 
		AND SRF_DATE BETWEEN      
			TO_DATE(TO_CHAR(#srfDateFrom#||' '||#srfTimeFromHH#||' '||#srfTimeFromMM#),'DDMONYY HH24:MI') AND      			
			TO_DATE(TO_CHAR(#srfDateTo#||' '||#srfTimeToHH#||' '||#srfTimeToMM#),'DDMONYY HH24:MI') + 1/1440
		AND B.BYPASS_REL=#srfByPass#
	
		<isNotEmpty property="status">
			<isEqual property="status" compareValue="VOID">
			   	 AND statusVoid = 'Y'
			</isEqual>
			<isEqual property="status" compareValue="EXIT">
			   	 AND statusExit = 'Y'
			</isEqual>
			<isEqual property="status" compareValue="NOT_EXIT">
			   	 AND statusExit = 'N' AND statusVoid = 'N'
			</isEqual>
			<isEqual property="status" compareValue="CDIF">
			   	 AND statusCDIF = 'Y'
			</isEqual>
			<isEqual property="status" compareValue="EXPIRED">
			   	 AND A.SRF_EXPY_DATE &lt; sysdate
				 AND A.STATUS = 'ISSUED'
			</isEqual>
		</isNotEmpty>
	
		<isNotEmpty property="crUserId">
			AND   UPPER(A.CR_USER_ID)  = UPPER(#crUserId#) 	   
		</isNotEmpty>
	
		<isNotEmpty property="srfNo">
			AND A.SRF_NO like  ('%'||#srfNo#||'%')	
		</isNotEmpty>
		
		<isNotEmpty property="srfAgent">
			AND A.AGENT_ID = 	#srfAgent#	
		</isNotEmpty>

		<isNotEmpty property="srfHkid">
			AND A.COLL_HKID = 	#srfHkid#	
		</isNotEmpty>
		
		<isNotEmpty property="srfTD">
		<isEqual property="srfTD" compareValue="Y">
			AND (select B.TRUCK_DOCK from IMp_truck_srf CC join TRUCK_TRIP b on CC.TRIP_ID= b.TRIP_ID where CC.srf_No =A.SRF_NO and b.CLOSED = 'N' and rownum=1) is null
		</isEqual>
		</isNotEmpty>
		
		<isNotEmpty property="srfPostYN">
		<isEqual property="srfPostYN" compareValue="Y">
			AND A.POST_DATE is null
		</isEqual>
		</isNotEmpty>
		
		<isNotEmpty property="constrYN">
		<isEqual property="constrYN" compareValue="Y">
		<![CDATA[
		AND (select count(1) from IMP_SRF_FLT isf  join MAST_CONSTRAINT_CODE mcc  on isf.CC_CODE = mcc.CODE    where isf.srf_no = A.SRF_NO
                        and isf.awb_no = A.AWB_NO and to_char(isf.AWB_DATE,'DDMONYY')= to_char(A.AWB_DATE,'DDMONYY') and mcc.CONSTRAINT='Y')>0
                        ]]>
		</isEqual>
		</isNotEmpty>
		
		<isNotEmpty property="printDateFrom">
		<isNotEmpty property="prntTimeFromHH">
		<isNotEmpty property="prntTimeFromMM">
		<isNotEmpty property="prntDateTo">
		<isNotEmpty property="prntTimeToHH">
		<isNotEmpty property="prntTimeToMM">
		<![CDATA[
			AND SRF_PRNT_DATE BETWEEN      
			TO_DATE(TO_CHAR(#printDateFrom#||' '||#prntTimeFromHH#||' '||#prntTimeFromMM#),'DDMONYY HH24:MI') AND      			
			TO_DATE(TO_CHAR(#prntDateTo#||' '||#prntTimeToHH#||' '||#prntTimeToMM#),'DDMONYY HH24:MI') + 1/1440
		]]>
		</isNotEmpty>
		</isNotEmpty>
		</isNotEmpty>
		</isNotEmpty>
		</isNotEmpty>
		</isNotEmpty>
		Order BY SRF_DATE DESC
</select>

<select id="imprt_534_awb"  parameterClass="cargo.cms.imprt.report.bo.ImpClearanceList534_ReptBO"  resultClass="cargo.cms.imprt.report.bo.ImpClearanceList534_ReptBO">
	SELECT A.AWB_NO as awbNo, SUBSTR(TRIM(A.AWB_NO),1,3)||'-'||SUBSTR(TRIM(A.AWB_NO),4) awbNoDisplay, A.FLT_KEY as fltNo, 
			TO_CHAR(A.FLT_DATE, 'DDMONYY') as arrDate, 
			E.MANIFEST_PCS as manfPcs, E.MANIFEST_WT as manfWt,  G.CC_CODE as ccCode, 
			SUBSTR(TRIM(TO_CHAR(C.SCH_TIME,'0000')),0,2)|| ':'||  SUBSTR(TRIM(TO_CHAR(C.SCH_TIME,'0000')),3,4) as schTimeFm, 
			TO_CHAR(A.AWB_DATE, 'DDMONYY') as awbDate, 
			H.CC_CATEGORY as ccCategory, (SELECT SUM(LOCN_PCS) FROM AWB_INVENTORY WHERE AWB_NO=A.AWB_NO AND 
			AWB_DATE=A.AWB_DATE AND FLT_KEY=A.FLT_KEY AND FLT_DATE=A.FLT_DATE) AS invPcs, 
      (SELECT SUM(LOCN_WT) FROM AWB_INVENTORY 
			WHERE AWB_NO=A.AWB_NO AND AWB_DATE=A.AWB_DATE AND FLT_KEY=A.FLT_KEY AND FLT_DATE=A.FLT_DATE) AS invWt,
      (select print_ind from imp_srf srf where  srf.awb_no = A.awb_no and rownum = 1)as printInd,
      (select d.CNTG_FLT_KEY from ddt_shp s left join ddt_shp_trf_dtl d on s.doc_line_no = d.sdoc_line_no  left join DDT_MSG MSG on s.tr_no=MSG.tr_no and MSG.DDT_STATUS = 'P' where  s.awb_no = A.awb_no and rownum = 1) as conFlt,
      (select d.CNTG_FLT_DATE from ddt_shp s left join ddt_shp_trf_dtl d on s.doc_line_no = d.sdoc_line_no  left join DDT_MSG MSG on s.tr_no=MSG.tr_no and MSG.DDT_STATUS = 'P' where  s.awb_no = A.awb_no  and rownum = 1) as conDate,
     (SELECT STRAGG(STRINGDELIM(t.TRUCK_DOCK,' , ')) FROM imp_srf imp left join imp_truck_srf truck_srf on imp.srf_no = truck_srf.srf_no
     left join truck_trip t on truck_srf.trip_id = t.trip_id WHERE imp.awb_no = A.awb_no)  as truckDock,
          decode(C.flt_key,NULL,' ',C.flt_key) as flightKey,decode(to_char(C.sch_date,'DDMONYY'),NULL,' ',to_char(C.sch_date,'DDMONYY')) as flightDate,
      G.REF_NO as referenceNo,to_char(sysdate,'DDMONYY HH24:MI') printTime
		FROM 
			AWB_INVENTORY A LEFT JOIN HAWB_INVENTORY B ON A.SEQ_NO=B.SEQ_NO, FLT_OPR C, 
			IMP_CAR_AWB D, V_CST_IMP_CC_CODE G LEFT JOIN MAST_CONSTRAINT_CODE H ON G.CC_CODE=H.CODE, 
      		IMP_CAR_SHP E
		WHERE 
			G.AWB_NO=A.AWB_NO AND G.FLT_KEY=A.FLT_KEY AND G.FLT_DATE=A.FLT_DATE AND G.HAWB_NO=NVL(B.HAWB_NO, '000000000000000000') AND 
			E.AWB_NO=A.AWB_NO AND E.AWB_DATE=A.AWB_DATE AND 
			E.FLT_KEY=A.FLT_KEY AND E.FLT_DATE=A.FLT_DATE AND D.AWB_NO=A.AWB_NO AND D.AWB_DATE=A.AWB_DATE AND 
			A.FLT_KEY=C.FLT_KEY AND A.FLT_DATE=C.SCH_DATE AND C.FLT_TYPE='A' AND 
			A.AWB_NO NOT IN (SELECT AWB_NO FROM IMP_CUST_CLR_LIST WHERE AWB_DATE=A.AWB_DATE AND FLT_DATE=A.FLT_DATE AND FLT_KEY=A.FLT_KEY 
			AND HAWB_NO=NVL(B.HAWB_NO, '000000000000000000')) AND G.CC_CODE IS NOT NULL AND H.CONSTRAINT='Y' 
			AND A.AWB_NO=#awbNo# AND A.FLT_KEY = #fltNo# AND A.FLT_DATE = TO_DATE(#arrDate#,'DDMONYY')
			
		UNION
		SELECT 
			A.AWB_NO as awbNo, SUBSTR(TRIM(A.AWB_NO),1,3)||'-'||SUBSTR(TRIM(A.AWB_NO),4) awbNoDisplay, A.FLT_KEY as fltNo, 
			TO_CHAR(A.FLT_DATE, 'DDMONYY') as arrDate, E.MANIFEST_PCS as manfPcs, 
			E.MANIFEST_WT as manfWt,G.CC_CODE as ccCode, SUBSTR(TRIM(TO_CHAR(B.SCH_TIME,'0000')),0,2) 
			|| ':'||  SUBSTR(TRIM(TO_CHAR(B.SCH_TIME,'0000')),3,4) as schTimeFm,
			TO_CHAR(A.AWB_DATE, 'DDMONYY') as awbDate, H.CC_CATEGORY as ccCategory, 
      		(SELECT SUM(LOCN_PCS) FROM AWB_INVENTORY WHERE AWB_NO=A.AWB_NO AND AWB_DATE=A.AWB_DATE AND FLT_KEY=A.FLT_KEY AND FLT_DATE=A.FLT_DATE) AS invPcs, 
      		(SELECT SUM(LOCN_WT) FROM AWB_INVENTORY WHERE AWB_NO=A.AWB_NO AND AWB_DATE=A.AWB_DATE AND FLT_KEY=A.FLT_KEY AND FLT_DATE=A.FLT_DATE) AS invWt,
          (select print_ind from imp_srf srf where  srf.awb_no = A.awb_no and rownum = 1)as printInd,
          (select d.CNTG_FLT_KEY from ddt_shp s left join ddt_shp_trf_dtl d on s.doc_line_no = d.sdoc_line_no left join DDT_MSG MSG on s.tr_no=MSG.tr_no and MSG.DDT_STATUS = 'P' where  s.awb_no = A.awb_no and rownum = 1) as conFlt,
      (select d.CNTG_FLT_DATE from ddt_shp s left join ddt_shp_trf_dtl d on s.doc_line_no = d.sdoc_line_no left join DDT_MSG MSG on s.tr_no=MSG.tr_no and MSG.DDT_STATUS = 'P' where  s.awb_no = A.awb_no and rownum = 1) as conDate,
   (SELECT STRAGG(STRINGDELIM(t.TRUCK_DOCK,' , ')) FROM imp_srf imp left join imp_truck_srf truck_srf on imp.srf_no = truck_srf.srf_no
     left join truck_trip t on truck_srf.trip_id = t.trip_id WHERE imp.awb_no = A.awb_no)  as truckDock,
      decode(B.flt_key,NULL,' ',B.flt_key) as flightKey,decode(to_char(B.sch_date,'DDMONYY'),NULL,' ',to_char(B.sch_date,'DDMONYY')) as flightDate,
       G.REF_NO as referenceNo,to_char(sysdate,'DDMONYY HH24:MI') printTime
  	FROM 
			IMP_CUST_CLR_LIST A, FLT_OPR B, V_CST_IMP_CC_CODE G LEFT JOIN MAST_CONSTRAINT_CODE H ON G.CC_CODE=H.CODE,
			IMP_CAR_AWB D, IMP_CAR_SHP E
		WHERE 
      		G.AWB_NO=A.AWB_NO AND G.FLT_KEY=A.FLT_KEY AND G.FLT_DATE=A.FLT_DATE AND E.AWB_NO=A.AWB_NO AND E.AWB_DATE=A.AWB_DATE AND G.HAWB_NO=A.HAWB_NO AND
      		E.FLT_KEY=A.FLT_KEY AND E.FLT_DATE=A.FLT_DATE AND D.AWB_NO=A.AWB_NO AND D.AWB_DATE=A.AWB_DATE AND A.FLT_KEY=B.FLT_KEY AND A.FLT_DATE=B.SCH_DATE 
			AND B.FLT_TYPE='A' AND G.CC_CODE IS NOT NULL AND (A.CCCL_STATUS IS NULL OR A.CCCL_STATUS!='Complete') AND H.CONSTRAINT='Y' 
			AND A.AWB_NO=#awbNo# AND A.FLT_KEY = #fltNo# AND A.FLT_DATE = TO_DATE(#arrDate#,'DDMONYY')

</select>

<select id="imprt_534_hawb"  parameterClass="cargo.cms.imprt.report.bo.ImpClearanceList534_ReptBO"  resultClass="cargo.cms.imprt.report.bo.ImpClearanceList534_ReptBO">
      SELECT 
			DISTINCT A.AWB_NO as awbNo, NVL(B.HAWB_NO, '000000000000000000') as hawbNo,
			 G.CC_CODE as ccCode, B.STRG_PCS hawbPcs,B.STRG_WT hawbWt
     		FROM 
			AWB_INVENTORY A LEFT JOIN HAWB_INVENTORY B ON A.SEQ_NO=B.SEQ_NO,  
			 V_CST_IMP_CC_CODE G LEFT JOIN MAST_CONSTRAINT_CODE H ON G.CC_CODE=H.CODE 
      		
		WHERE 
			G.AWB_NO=A.AWB_NO AND G.FLT_KEY=A.FLT_KEY AND G.FLT_DATE=A.FLT_DATE AND G.HAWB_NO=NVL(B.HAWB_NO, '000000000000000000') AND 
			A.AWB_NO NOT IN (SELECT AWB_NO FROM IMP_CUST_CLR_LIST WHERE AWB_DATE=A.AWB_DATE AND FLT_DATE=A.FLT_DATE AND FLT_KEY=A.FLT_KEY 
			AND HAWB_NO=NVL(B.HAWB_NO, '000000000000000000')) AND G.CC_CODE IS NOT NULL AND H.CONSTRAINT='Y' 
			AND A.AWB_NO=#awbNo#
			<isNotEmpty  property="hawbList">
 			<iterate prepend="AND" property="hawbList"
				open="(" close=")" conjunction="OR">
				B.HAWB_NO = #hawbList[]#
			</iterate>
			</isNotEmpty>
			
		UNION
		SELECT 
			A.AWB_NO as awbNo,  A.HAWB_NO as hawbNo, 
			G.CC_CODE as ccCode,  0 as hawbPcs,0 as hawbWt
      FROM 
			IMP_CUST_CLR_LIST A,  V_CST_IMP_CC_CODE G LEFT JOIN MAST_CONSTRAINT_CODE H ON G.CC_CODE=H.CODE
	   WHERE 
      		G.AWB_NO=A.AWB_NO AND G.FLT_KEY=A.FLT_KEY AND G.FLT_DATE=A.FLT_DATE AND G.HAWB_NO=A.HAWB_NO AND
      	G.CC_CODE IS NOT NULL AND (A.CCCL_STATUS IS NULL OR A.CCCL_STATUS!='Complete') AND H.CONSTRAINT='Y' 
			AND A.AWB_NO=#awbNo#
			<isNotEmpty  property="hawbList">
			 <iterate prepend="AND" property="hawbList"
				open="(" close=")" conjunction="OR">
				A.HAWB_NO = #hawbList[]#
			</iterate>
		</isNotEmpty>
</select>

<select id="imprt_534_location"  parameterClass="cargo.cms.imprt.report.bo.ImpClearanceList534_ReptBO"  resultClass="cargo.cms.imprt.report.bo.ImpClearanceList534_ReptBO">
		select a.loc_code as location,
		(case when a.uld_key is not null then
		    u.target
		    else ''
		    end) as uldtarget,
		(case when a.lsp_no is not null then
		    l.target
		    else ''
		    end) as lsptarget
		from awb_inventory a
		left join uld_inventory u on a.uld_key=u.uld_key
		left join lsp_inventory l on a.lsp_no=l.lsp_no
		where a.awb_no = #awbNo#
</select>
<!-- Query starts for Print SRF,ISsue SRF and Regenerate SRF  -->
<select id="header_print"  parameterClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO" resultClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO">
 SELECT DECODE(SRF.AWB_NO,NULL,'',SUBSTR(SRF.AWB_NO,1,3)||'-'||SUBSTR(SRF.AWB_NO,4,8)) as awbNo,
  decode(SRF.SRF_NO,NULL,' ',SRF.SRF_NO)       as srfNo,
  decode(SRF.CR_USER_ID,NULL,' ',SRF.CR_USER_ID)   as userId,
  decode(SRF.COLL_CENTER,NULL,' ',SRF.COLL_CENTER)  as collCenter,
  decode(to_char(SRF.SRF_EXPY_DATE,'DDMONYY HH24:MI'),NULL,' ',to_char(SRF.SRF_EXPY_DATE,'DDMONYY HH24:MI')) as expiryDay,
  decode(SRF.PRINT_USER,NULL,' ',SRF.PRINT_USER)   as printUser,
  TO_CHAR(SRF.VERIFIED_TIME, 'DDMONYY HH24:MI') as verifiedTime,
  decode(SRF.VERIFIED_BY,NULL,' ',SRF.VERIFIED_BY) as verifiedBy,
  decode(SRF.AUTH_REP_NAME,NULL,' ',SRF.AUTH_REP_NAME)    as collName,
  decode(SRF.AUTH_REP_ID,NULL,' ',SRF.AUTH_REP_ID)    as collHKID,
  decode(SRF.SRF_PRNT_DATE,NULL,to_char(sysdate,'DDMONYY HH24:MI'),to_char(SRF.SRF_PRNT_DATE,'DDMONYY HH24:MI')) as printDate,
  decode(AWB.APPNTD_AGENT,NULL,' ',AWB.APPNTD_AGENT) as agentName,
  decode(AWB.AGENT_CUST_NO,NULL,' ',AWB.AGENT_CUST_NO) as agentNo,
  decode(BILL.CHRG_AMT,NULL,' ',to_char(BILL.CHRG_AMT,'999999,999,999.99'))    as chargeAmt,
  decode(AWB.SPL_CODE1,NULL,' ',AWB.SPL_CODE1)    as shc1,
  decode(AWB.SPL_CODE2,NULL,' ',AWB.SPL_CODE2)    as shc2,
  decode(AWB.SPL_CODE3,NULL,' ',AWB.SPL_CODE3)    as shc3,
  decode(AWB.SPL_CODE4,NULL,' ',AWB.SPL_CODE4)    as shc4,
  decode(AWB.SPL_CODE5,NULL,' ',AWB.SPL_CODE5)    as shc5,
  decode(AWB.SPL_CODE6,NULL,' ',AWB.SPL_CODE6)    as shc6,
  decode(AWB.SPL_CODE7,NULL,' ',AWB.SPL_CODE7)    as shc7,
  decode(AWB.SPL_CODE8,NULL,' ',AWB.SPL_CODE8)    as shc8,
  decode(AWB.SPL_CODE9,NULL,' ',AWB.SPL_CODE9)    as shc9,
   (select decode(FLT_KEY,null,'',FLT_KEY)||'/'||decode(FLT_DATE,null,'',TO_CHAR(FLT_DATE, 'DDMONYY')) from IMP_SRF_FLT where srf_no=#sc_srfNo# and rownum = 1) finalFltDt,
  decode(TRIP.TRUCK_DOCK,NULL,' ',TRIP.TRUCK_DOCK)     as tripId,
  decode(TRIP.TRUCK_NO,NULL,' ',TRIP.TRUCK_NO)    as truckNo,
   (select REF_NO from (select REF_NO from V_CST_IMP_CC_CODE 
   where awb_no IN (SELECT AWB_NO FROM IMP_SRF WHERE SRF_NO = #sc_srfNo#) order by hawb_no) where rownum = 1) referenceNo,
   SRF.SRF_RMK remarks,   
   SRF.Collect_Person_Recvd collNameRec,
    TO_CHAR(SRF.Cargo_Collected, 'DDMONYY HH24:MI') as cargoColDate
   FROM IMP_CAR_AWB AWB
INNER JOIN IMP_SRF SRF
     ON AWB.AWB_NO = SRF.AWB_NO
AND AWB.AWB_DATE   = SRF.AWB_DATE
INNER JOIN IMP_SRF_FLT SRF_FLT
ON SRF.SRF_NO = SRF_FLT.SRF_NO
LEFT JOIN IMP_TRUCK_SRF TRUCK_SRF
ON SRF.SRF_NO = TRUCK_SRF.SRF_NO
LEFT JOIN TRUCK_TRIP TRIP
ON TRUCK_SRF.TRIP_ID = TRIP.TRIP_ID AND CLOSED ='N'
LEFT JOIN
  (SELECT SRF_NO,
    SUM(CHRG_AMT)CHRG_AMT
     FROM BILL_CHARGE_DTL
    WHERE STATUS='PAID'
 GROUP BY SRF_NO
  )BILL
     ON BILL.SRF_NO = SRF.SRF_NO
  WHERE SRF.SRF_NO  =#sc_srfNo#
</select>

<select id="header_print_return_cargo"  parameterClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO" resultClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO">
 SELECT DECODE(SRF.AWB_NO,NULL,'',SUBSTR(SRF.AWB_NO,1,3)||'-'||SUBSTR(SRF.AWB_NO,4,8)) as awbNo,
  decode(SRF.SRF_NO,NULL,' ',SRF.SRF_NO)       as srfNo,
  decode(SRF.CR_USER_ID,NULL,' ',SRF.CR_USER_ID)   as userId,
  decode(SRF.COLL_CENTER,NULL,' ',SRF.COLL_CENTER)  as collCenter,
 decode(to_char(SRF.SRF_EXPY_DATE,'DDMONYY HH24:MI'),NULL,' ',to_char(SRF.SRF_EXPY_DATE,'DDMONYY HH24:MI')) as expiryDay,
  decode(SRF.PRINT_USER,NULL,' ',SRF.PRINT_USER)   as printUser,
  TO_CHAR(SRF.VERIFIED_TIME, 'HH24:MI') as verifiedTime,
  decode(SRF.VERIFIED_BY,NULL,' ',SRF.VERIFIED_BY) as verifiedBy,
  decode(SRF.COLL_NAME,NULL,' ',SRF.COLL_NAME)    as collName,
  decode(SRF.COLL_HKID,NULL,' ',SRF.COLL_HKID)    as collHKID,
  decode(SRF.SRF_PRNT_DATE,NULL,to_char(sysdate,'DDMONYY HH24:MI'),to_char(SRF.SRF_PRNT_DATE,'DDMONYY HH24:MI')) as printDate,
  NVL((select AGENT_NAME FROM EXP_RTN_HD WHERE SRF_NO = #sc_srfNo#),' ') as agentName,
  NVL((select AGENT_CUST_NO FROM EXP_RTN_HD WHERE SRF_NO = #sc_srfNo#), ' ') as agentNo,
  decode(BILL.CHRG_AMT,NULL,' ',to_char(BILL.CHRG_AMT,'999999,999,999.99'))    as chargeAmt,
  decode(AWB.SPL_CODE1,NULL,' ',AWB.SPL_CODE1)    as shc1,
  decode(AWB.SPL_CODE2,NULL,' ',AWB.SPL_CODE2)    as shc2,
  decode(AWB.SPL_CODE3,NULL,' ',AWB.SPL_CODE3)    as shc3,
  decode(AWB.SPL_CODE4,NULL,' ',AWB.SPL_CODE4)    as shc4,
  decode(AWB.SPL_CODE5,NULL,' ',AWB.SPL_CODE5)    as shc5,
  decode(AWB.SPL_CODE6,NULL,' ',AWB.SPL_CODE6)    as shc6,
  decode(AWB.SPL_CODE7,NULL,' ',AWB.SPL_CODE7)    as shc7,
  decode(AWB.SPL_CODE8,NULL,' ',AWB.SPL_CODE8)    as shc8,
  decode(AWB.SPL_CODE9,NULL,' ',AWB.SPL_CODE9)    as shc9,
   (select decode(FLT_KEY,null,'',FLT_KEY)||'/'||decode(FLT_DATE,null,'',TO_CHAR(FLT_DATE, 'DDMONYY')) from IMP_SRF_FLT where srf_no=#sc_srfNo# and rownum = 1) finalFltDt,
  decode(TRIP.TRUCK_DOCK,NULL,' ',TRIP.TRUCK_DOCK)     as tripId,
  decode(TRIP.TRUCK_NO,NULL,' ',TRIP.TRUCK_NO)    as truckNo,
  (SELECT REF_NO
     FROM V_CST_IMP_CC_CODE
    WHERE AWB_NO IN
    (SELECT AWB_NO FROM IMP_SRF WHERE SRF_NO=#sc_srfNo#
    )and rownum = 1
  )referenceNo
   FROM AWB AWB
INNER JOIN IMP_SRF SRF
     ON AWB.AWB_NO = SRF.AWB_NO
AND AWB.AWB_DATE   = SRF.AWB_DATE
INNER JOIN IMP_SRF_FLT SRF_FLT
     ON SRF.SRF_NO = SRF_FLT.SRF_NO
LEFT JOIN IMP_TRUCK_SRF TRUCK_SRF
     ON SRF.SRF_NO = TRUCK_SRF.SRF_NO
LEFT JOIN TRUCK_TRIP TRIP
     ON TRUCK_SRF.TRIP_ID = TRIP.TRIP_ID
AND CLOSED                ='N'
LEFT JOIN
  (SELECT SRF_NO,
    SUM(CHRG_AMT)CHRG_AMT
     FROM BILL_CHARGE_DTL
    WHERE STATUS='PAID'
 GROUP BY SRF_NO
  )BILL
     ON BILL.SRF_NO = SRF.SRF_NO
  WHERE SRF.SRF_NO  =#sc_srfNo#
</select>

<select id="header_print_return_cargo_uld"  parameterClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO" resultClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO">
  SELECT 'EXPORT RETURN CARGO (PPK)' awbNo,
  #sc_srfNo#       as srfNo,
  decode(ERH.LM_USER_ID,NULL,' ',ERH.LM_USER_ID)   as userId,
  ' '  as collCenter,
  ' ' as expiryDay,
  decode(ERH.LM_USER_ID,NULL,' ',ERH.LM_USER_ID)   as printUser,
  ' ' as verifiedTime,
  ' ' as verifiedBy,
  decode(ERH.COLL_NAME,NULL,' ',ERH.COLL_NAME)    as collName,
  decode(ERH.COLL_HKID,NULL,' ',ERH.COLL_HKID)    as collHKID,
  ' ' as printDate,
  decode(ERH.AGENT_NAME,NULL,' ',ERH.AGENT_NAME) as agentName,
  decode((select code from cust_company where code_desc = ERH.AGENT_NAME),null,' ',(select code from cust_company where code_desc = ERH.AGENT_NAME)) as agentNo,
  decode(ERH.STRG_AMT,NULL,' ',to_char(ERH.STRG_AMT,'999999,999,999.99'))    as chargeAmt,
  ' '  as shc1,
  ' '    as shc2,
  ' '    as shc3,
  ' '    as shc4,
  ' '    as shc5,
  ' '  as shc6,
  ' '   as shc7,
  ' '    as shc8,
  ' '   as shc9,
  #sc_srfNo# ||'/'||to_Char(CR_DATE,'DDMONYY')  finalFltDt,
  ' '    as tripId,
  decode(ERH.TRUCK_NO,NULL,' ',ERH.TRUCK_NO)    as truckNo
  FROM EXP_RTN_HD ERH
  WHERE ERH.RTN_NO = #sc_srfNo#
  </select>

<select id="details_print"  parameterClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO" resultClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO">
  select pcs, wt, locCode, ppkInd, lspNo, lockInd, ccCode
  from (SELECT SRF_NO, decode(INV.LOCN_PCS,NULL,' ',INV.LOCN_PCS) AS pcs,
  decode(INV.LOCN_WT,NULL,' ',trim(to_char(INV.LOCN_WT,'9999999990D9'))) as wt,   
  decode(INV.LOC_CODE,NULL,' ',INV.LOC_CODE)         as locCode,
  (select 'PPK' ppkInd FROM ULD_INVENTORY a WHERE a.uld_key=INV.ULD_KEY and a.HANDLING_MODE in ('PPK','NBK')) ppkInd,
  decode(INV.LSP_NO,NULL,INV.ULD_KEY,INV.LSP_NO) as lspNo, 
  decode(INV.ULD_KEY,null,decode((select c.LOCKED from LSP_INVENTORY c WHERE c.lsp_no=INV.LSP_NO),null,'N','N','N','Y','Y') ,decode((select b.LOCKED from ULD_INVENTORY b WHERE b.uld_key=INV.ULD_KEY),null,'N','N','N','Y','Y'))  as lockInd,
  (SELECT AWB_CC_CODE FROM IMP_SRF ISF WHERE ISF.SRF_NO = INV.SRF_NO) as ccCode 
  FROM IMP_SRF_AWB_INVENTORY inv) INV
  left join mast_constraint_code M ON inv.cccode = M.CODE
  WHERE SRF_NO = #sc_srfNo#
  ORDER BY PRIORITY DESC
</select>

<select id="details_print_return_cargo"  parameterClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO" resultClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO">
SELECT 'N.A' pcs,
   	    decode(INV.LOCN_WT,NULL,' ',trim(to_char(INV.LOCN_WT,'999999999.9'))) as wt,   
 		decode(INV.LOC_CODE,NULL,' ',INV.LOC_CODE) as locCode,
  		(select 'PPK' ppkInd FROM ULD_INVENTORY a WHERE a.uld_key=INV.ULD_KEY and a.HANDLING_MODE in ('PPK','NBK')) ppkInd,
  		decode(INV.LSP_NO,NULL,'*'||INV.ULD_KEY,INV.LSP_NO) as lspNo, 
  		decode((select b.LOCKED from ULD_INVENTORY b WHERE b.uld_key=INV.ULD_KEY),null,'N','N','N','Y','Y')  as lockInd
 		FROM AWB_INVENTORY INV
  		WHERE ULD_KEY  =#uldKey#
</select>

	<select id="awbInfo"  parameterClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO" resultClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO">
		select srf_no sc_srfNo,awb_no awbNo,flt_key fltKey,to_char(flt_date,'DDMONYY') fltDate from imp_srf_awb_inventory where srf_no = #sc_srfNo# and rownum = 1
	</select>

	<select id="awbInfoInSrfFlt"  parameterClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO" resultClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO">
		select srf_no sc_srfNo,awb_no awbNo,flt_key fltKey,to_char(flt_date,'DDMONYY') fltDate from imp_srf_flt where srf_no = #sc_srfNo# and rownum = 1
	</select>


<select id="checkCodeConstrintInd"  parameterClass="java.lang.String" resultClass="java.lang.String">
		select NVL(CONSTRAINT,'N') from MAST_CONSTRAINT_CODE where code = #dispccCode#
</select>
	
<select id="details_print1"  parameterClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO" resultClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO">
 SELECT distinct (SElect CONSTRAINT from MAST_CONSTRAINT_CODE where code=anv.cc_code) constrInd,
 INV.SRF_RMK
           as remarks
   FROM IMP_SRF INV,imp_srf_awb_inventory anv
   WHERE anv.SRF_NO=INV.SRF_NO
   and anv.SRF_NO=#sc_srfNo#
</select>
<update id="updatePrintInd" parameterClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO">
			update imp_srf SET print_ind = 'Y',PRINT_USER =#loguserId#,
  SRF_PRNT_DATE = sysdate,LM_USER_ID = #loguserId#,LM_DATE = sysdate,tr_type='PRSRF' where srf_no = #sc_srfNo#
	</update>
	<select id="get_credit_charges"  parameterClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO"  resultClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO">
	  select charge_status chargeStatus,print_ind printInd from Imp_srf where srf_no = #sc_srfNo#
	</select>
	<select id="get_srfshipment_detailsformilestone"  parameterClass="java.lang.String"  resultClass="cargo.cms.imprt.report.bo.ImpShipmentReleaseReptBO">
	SELECT B.AWB_NO awbNo,TO_CHAR(B.AWB_DATE,'DDMONYY') awbDate,B.FLT_KEY fltKey,TO_CHAR(B.FLT_DATE,'DDMONYY') fltDate FROM IMP_SRF A,IMP_SRF_FLT B WHERE B.SRF_NO = A.SRF_NO AND A.SRF_NO=#PARAM#
	</select>
<!-- Query ends for Print SRF,ISsue SRF and Regenerate SRF  -->
<select id="UTL_rept_238"  parameterClass="java.lang.String"  resultClass="cargo.cms.imprt.report.bo.UTLReport_238BO">

	select 
		   a.awb_no awbNo,  
		   (select flt_key||'/'||to_char(flt_date, 'DDMONYY') 
				   from imp_srf_flt 
				   where srf_no = c.srf_no and rownum = 1) fltNo, 
		  a.content content,
		  s.srf_pcs noPieces, 
		  u.cdif_ul_pcs noMissing, 
		  '' hawb , 
		  cdif_locn as missingLocation, 
		  u.cdif_ul_wt wtMissing, 
		  a.appntd_agent nameAgent, 
		  u.rmk remarks, 
		  u.cr_user_id preparedStaff, 
		  to_char(u.cr_date, 'DDMONYY') preparedDate, 
		  to_char(u.cr_date, 'hh24:mi') preparedTime
	from imp_cdif_utl_locn u
	join imp_cdif c on c.cdif_no = u.cdif_no
	join imp_srf s on s.srf_no = c.srf_no
	join imp_car_awb a on a.awb_no = c.awb_no
	where u.cdif_no = #cdifNo#
</select>

<select id="getSRFDetailsRept_577"  parameterClass="cargo.cms.imprt.report.bo.AssignCheckerRept577_BO" resultClass="cargo.cms.imprt.report.bo.AssignCheckerRept577_BO">
		SELECT 
		ISF.AWB_NO AS awbNo,
		to_char(ISF.AWB_DATE,'DDMONYY')AS awbDate,
		T.TRUCK_NO AS truckNo,
		T.trip_id AS tripId,
		ISF.SRF_NO AS srfNo,
		ISF.SRF_PCS AS srfPcs,
		ISF.SRF_WT AS srfWt,
		ISF.COLL_NAME AS collName,
		ISF.COLL_HKID AS collHkid 
		FROM IMP_SRF ISF 
		LEFT JOIN IMP_TRUCK_SRF ITS on ITS.SRF_NO = ISF.SRF_NO
		LEFT JOIN TRUCK_TRIP T ON T.TRIP_ID = ITS.TRIP_ID and CLOSED = 'N'
		WHERE
		ISF.SRF_NO = NVL(#ssrfNo#, ISF.SRF_NO)
		and NVL(T.TRUCK_NO, '*') = NVL(#struckNo#, NVL(T.TRUCK_NO, '*'))
		and (ISF.AUTH_REP_ID = (SELECT HKID FROM SEC_USER WHERE CODE = #loginUser#)
			OR 
			exists (SELECT null FROM CUST_AGENT_AUTH_REP 
					WHERE CUST_NO = ISF.AGENT_ID AND AUTH_REP_ID =(SELECT HKID FROM SEC_USER WHERE CODE = #loginUser#)))	
</select>

 <select id="imprt_amendrept_508_Issue_Date_Time"  parameterClass="cargo.cms.imprt.bo.MaintainTowOrderBO"  resultClass="cargo.cms.imprt.bo.MaintainTowOrderBO">  
    		select to_char(toi.cr_date,'DDMONYY HH24:MI') as issueTime,toi.CR_USER_ID as staffID,(PKG_COMMON.GET_FLT_ETA(#fltKey#, #fltDate#,'A')) as eta,
  			fopr.ACFT_REG_NO as acregno
      	FROM tow_order_in toi
        left join flt_opr fopr on toi.FLT_KEY = fopr.FLT_KEY AND toi.FLT_DATE = fopr.SCH_DATE and fopr.flt_type = 'A'
        where toi.to_no= #towOrderlist#
        		</select>
	

<select id="imprt_amendrept_508"  parameterClass="cargo.cms.imprt.bo.MaintainTowOrderBO"  resultClass="cargo.cms.imprt.bo.MaintainTowOrderBO">
	SELECT
	towUld,uldAwbNo,chkYN,hoArea,towAwb,transferGrp,tfType,towOrderlist,cntgKey,std,
	pcs, shc1 ,loadType FROM
	(select
	tdtl.ULD_KEY towUld,
	tdtl.ULD_KEY uldAwbNo,
	Decode(chk.CHKIN_YN,NULL,'N',chk.CHKIN_YN) AS chkYN,
	tdtl.HO_AREA hoArea,
	DECODE( tdtl.awb_no,NULL,'',SUBSTR( tdtl.awb_no,1,3)||'-'||SUBSTR(
	tdtl.awb_no,4,8)) towAwb,
	(select DECODE(ecd.LOAD_TYPE,null,' ',ecd.LOAD_TYPE) from EDI_CPM_DTL ecd
	where ecd.ULD_KEY = tdtl.ULD_KEY AND ecd.FLT_KEY=iul.FLT_KEY AND
	ecd.FLT_DATE=iul.FLT_DATE and rownum =1 ) as loadType,
	tdtl.TRNS_GRP as transferGrp,
	tdtl.trf_type tfType,
	toi.to_no towOrderlist,
	TRIM((tdtl.CNTG_FLT_KEY)||'/'||to_char(tdtl.CNTG_FLT_DATE,'DDMONYY'))
	cntgKey,
	PKG_COMMON.GET_FLT_STA(tdtl.CNTG_FLT_KEY,to_char(tdtl.CNTG_FLT_DATE,'DDMONYY'),'D','HH24:MI')
	std,
	FFM.PCS || NVL2(FFM.PCS, '/', '') || DECODE(SUBSTR(FFM.WT, 0, 1), '.', '0' ||
	FFM.WT, FFM.WT) pcs,
	tdtl.shcs as shc1
	FROM tow_order_in toi
	join tow_order_in_dtl tdtl ON toi.to_no = tdtl.to_no
	left join IMP_CAR_SHP car ON tdtl.AWB_NO = car.AWB_NO AND toi.FLT_KEY =
	car.FLT_KEY AND toi.FLT_DATE = car.FLT_DATE
	left join IMP_ULD_LIST iul ON iul.ULD_KEY = tdtl.ULD_KEY AND toi.FLT_KEY =
	iul.FLT_KEY AND toi.FLT_DATE = iul.FLT_DATE
	left join imp_ramp_chk_dtl chk ON chk.ULD_KEY = tdtl.ULD_KEY AND
	chk.FLT_KEY = toi.FLT_KEY AND toi.FLT_DATE = chk.FLT_DATE
	LEFT OUTER JOIN
	(
	SELECT SUM(SHP.MAN_PCS) PCS, SUM(SHP.MAN_WT) WT, SHP.FLT_KEY, SHP.FLT_DATE,
	SHP.AWB_NO
	FROM EDI_FFM_MSG FFM
	JOIN EDI_FFM_ULD ULD
	ON FFM.TR_NO = ULD.TR_NO
	JOIN EDI_FFM_SHP SHP
	ON ULD.TR_NO = SHP.TR_NO AND ULD.DOC_LINE_NO = SHP.UDOC_LINE_NO
	WHERE
	FFM.FFM_STATUS = 'P' AND ULD.ULD_KEY IS NULL
	GROUP BY SHP.FLT_KEY, SHP.FLT_DATE, SHP.AWB_NO
	) FFM
	ON CAR.AWB_NO = FFM.AWB_NO AND CAR.FLT_KEY = FFM.FLT_KEY AND CAR.FLT_DATE
	= FFM.FLT_DATE
	where toi.to_no =#towOrderlist# AND tdtl.ULD_KEY != 'null') DUAL
   	</select>
		
		<select id="imprt_amendrept_508_S2"  parameterClass="cargo.cms.imprt.bo.MaintainTowOrderBO"  resultClass="cargo.cms.imprt.bo.MaintainTowOrderBO">  
			
	SELECT
	towUld,uldAwbNo,chkYN,hoArea,towAwb,transferGrp,tfType,towOrderlist,cntgKey,std,
	pcs, shc1 ,loadType FROM
	(select
	tdtl.ULD_KEY towUld,
	tdtl.ULD_KEY uldAwbNo,
	Decode(chk.CHKIN_YN,NULL,'N',chk.CHKIN_YN) AS chkYN,
	tdtl.HO_AREA hoArea,
	DECODE( tdtl.awb_no,NULL,'',SUBSTR( tdtl.awb_no,1,3)||'-'||SUBSTR(
	tdtl.awb_no,4,8)) towAwb,
	(select DECODE(ecd.LOAD_TYPE,null,' ',ecd.LOAD_TYPE) from EDI_CPM_DTL ecd
	where ecd.ULD_KEY = tdtl.ULD_KEY AND ecd.FLT_KEY=iul.FLT_KEY AND
	ecd.FLT_DATE=iul.FLT_DATE and rownum =1 ) as loadType,
	tdtl.TRNS_GRP as transferGrp,
	tdtl.trf_type tfType,
	toi.to_no towOrderlist,
	TRIM((tdtl.CNTG_FLT_KEY)||'/'||to_char(tdtl.CNTG_FLT_DATE,'DDMONYY'))
	cntgKey,
	PKG_COMMON.GET_FLT_STA(tdtl.CNTG_FLT_KEY,to_char(tdtl.CNTG_FLT_DATE,'DDMONYY'),'D','HH24:MI')
	std,
	FFM.PCS || NVL2(FFM.PCS, '/', '') || DECODE(SUBSTR(FFM.WT, 0, 1), '.', '0' ||
	FFM.WT, FFM.WT) pcs,
	tdtl.shcs as shc1
	FROM tow_order_in toi
	join tow_order_in_dtl tdtl ON toi.to_no = tdtl.to_no
	left join IMP_CAR_SHP car ON tdtl.AWB_NO = car.AWB_NO AND toi.FLT_KEY =
	car.FLT_KEY AND toi.FLT_DATE = car.FLT_DATE
	left join IMP_ULD_LIST iul ON iul.ULD_KEY = tdtl.ULD_KEY AND toi.FLT_KEY =
	iul.FLT_KEY AND toi.FLT_DATE = iul.FLT_DATE
	left join imp_ramp_chk_dtl chk ON chk.ULD_KEY = tdtl.ULD_KEY AND
	chk.FLT_KEY = toi.FLT_KEY AND toi.FLT_DATE = chk.FLT_DATE
	LEFT OUTER JOIN
	(
	SELECT SUM(SHP.MAN_PCS) PCS, SUM(SHP.MAN_WT) WT, SHP.FLT_KEY, SHP.FLT_DATE,
	SHP.AWB_NO
	FROM EDI_FFM_MSG FFM
	JOIN EDI_FFM_ULD ULD
	ON FFM.TR_NO = ULD.TR_NO
	JOIN EDI_FFM_SHP SHP
	ON ULD.TR_NO = SHP.TR_NO AND ULD.DOC_LINE_NO = SHP.UDOC_LINE_NO
	WHERE
	FFM.FFM_STATUS = 'P' AND ULD.ULD_KEY IS NULL
	GROUP BY SHP.FLT_KEY, SHP.FLT_DATE, SHP.AWB_NO
	) FFM
	ON CAR.AWB_NO = FFM.AWB_NO AND CAR.FLT_KEY = FFM.FLT_KEY AND CAR.FLT_DATE
	= FFM.FLT_DATE
	where toi.to_no =#towOrderlist#) DUAL
    		
		</select>
		
<select id="sqlStaTow"  parameterClass="cargo.cms.imprt.bo.MaintainTowOrderBO"  resultClass="cargo.cms.imprt.bo.MaintainTowOrderBO">
				select distinct 
                a.to_no towOrderlist,
                a.flt_key fltKeylist,
                SUBSTR(TRIM(TO_CHAR(NVL(c.sch_time,0),'0000')),0,2)|| ':'|| SUBSTR(TRIM(TO_CHAR(NVL(c.sch_time,0),'0000')),3,4) sta,
                <![CDATA[
                TO_CHAR(DECODE(TO_CHAR(C.EST_TIME),NULL,
                                TO_CHAR(TO_DATE(SUBSTR(TRIM(TO_CHAR(NVL(c.SCH_TIME,0),'0000')),0,2)|| ':'|| SUBSTR(TRIM(TO_CHAR(NVL(c.SCH_TIME,0),'0000')),3,4),'HH24:MI')+ (
                                                                (SELECT TO_NUMBER(s.rule_value)
                                                                FROM CMSRULES s
                                                                WHERE RULE_CODE='TOW_CUT_OFF_TIME'
                                                                ) / (24 * 60)),'HH24:MI'),
                                                TO_CHAR(TO_DATE(SUBSTR(TRIM(TO_CHAR(NVL(C.est_time,0),'0000')),0,2)|| ':'|| SUBSTR(TRIM(TO_CHAR(NVL(C.est_time,0),'0000')),3,4), 'HH24:MI') + (
                                                                (SELECT TO_NUMBER(s.rule_value)
                                                                FROM CMSRULES s
                                                                WHERE rule_code='TOW_CUT_OFF_TIME'
                                                                ) / (24 * 60)), 'HH24:MI'))) estTime,

                ]]>
                c.ACFT_PRK_BAY bay
                from tow_order_in a left join tow_order_in_dtl
                b
                on a.to_no= b.to_no
                Left outer join flt_opr c on c.flt_key=a.flt_key
                and c.SCH_DATE=a.FLT_DATE AND C.FLT_TYPE='A'
                join flt_opr_events e on c.flt_key=e.flt_key
                and c.SCH_DATE=e.SCH_DATE AND e.FLT_TYPE='A'
                <![CDATA[
                where (e.RAMP_COMPL_YN is null or e.RAMP_COMPL_YN <>'Y')
                ]]>
				<isNotEmpty property="towOrderlist">
				                                AND a.to_no = #towOrderlist#
				</isNotEmpty>

</select>

<select id="imp_DepCrgSumRept_140"	parameterClass="cargo.cms.imprt.report.bo.DepartedCrgRept140_BO"
			 resultClass="cargo.cms.imprt.report.bo.DepartedCrgRept140_BO">		
		select  t2.carr_code as carrCode, 
			t1.awb_no as awbNo, 
			t2.dest as dest, 
			NVL(t2.pcs,0) || '/' || TRIM(TO_CHAR(NVL(t2.wt,0), '99999999D99')) as awbPcsWt,
			NVL(t1.pman_pcs,0) || '/' || TRIM(TO_CHAR(NVL(t1.pman_wt,0), '99999999D99')) as departedPcsWt,
			decode(t6.ACT_DATE,null,decode(t6.EST_DATE,null,
	      	(to_char(t6.SCH_DATE, 'DDMONYY ') || (SUBSTR(TRIM(TO_CHAR(t6.SCH_TIME, '0000')),0,2)|| ':'||  SUBSTR(TRIM(TO_CHAR(t6.SCH_TIME, '0000')),3,4))),
	      	(to_char(t6.EST_DATE, 'DDMONYY ') || (SUBSTR(TRIM(TO_CHAR(t6.EST_TIME, '0000')),0,2)|| ':'||  SUBSTR(TRIM(TO_CHAR(t6.EST_TIME, '0000')),3,4)))),
	      	(to_char(t6.ACT_DATE, 'DDMONYY ') || (SUBSTR(TRIM(TO_CHAR(t6.ACT_TIME, '0000')),0,2)|| ':'||  SUBSTR(TRIM(TO_CHAR(t6.ACT_TIME, '0000')),3,4))))
	      	as fltDate,
			t1.flt_key as fltKey
		from   exp_pmanifest_awb t1, exp_car t2, flt_opr_events t5 , flt_opr t6
		where  t1.awb_no = t2.awb_no
		and    t1.awb_date = t2.awb_date
		and    t1.flt_key = t5.flt_key
		and    t1.flt_date = t5.sch_date
		and    t5.flt_type = 'D'
		and    t5.ctm_out_date is not null
		and    t1.flt_key = t6.flt_key
		and    t1.flt_date = t6.sch_date
		and    t5.flt_type = t6.flt_type
		and    t2.carr_code = nvl(#scarrier#, t2.carr_code)
		and    t1.flt_date between #sfromDate# and #sdateTo#
		<isNotEmpty property="loginCarrier">
			and	t2.carr_code = #loginCarrier#
		</isNotEmpty>	
		<isEmpty property="loginCarrier">
			and (t2.agent_name = #agentName#
			or t2.shpr_name = #agentName# )
		</isEmpty>	
		order by t1.flt_date
</select>
<select id="imp_DepCrgSumRept_140A"	parameterClass="cargo.cms.imprt.report.bo.DepartedCrgRept140_BO"
    	 resultClass="cargo.cms.imprt.report.bo.DepartedCrgRept140_BO">
		select t2.carr_code as carrCode, count(distinct t1.awb_no) as awbCount, 
		sum(t1.pman_pcs) as departedPcs, 
		TRIM(TO_CHAR(NVL(sum(t1.pman_wt),0), '99999999D99')) as departedWt
		from   exp_pmanifest_awb t1, exp_car t2, flt_opr_events t5
	    where  t1.awb_no = t2.awb_no
		and    t1.awb_date = t2.awb_date
		and    t1.flt_key = t5.flt_key
		and    t1.flt_date = t5.sch_date
		and    t5.flt_type = 'D'
		and    t5.ctm_out_date is not null
		and    t2.carr_code = nvl(#scarrier#, t2.carr_code)
		and    t1.flt_date between #sfromDate# and #sdateTo#
		<isNotEmpty property="loginCarrier">
			and	t2.carr_code = #loginCarrier#
		</isNotEmpty>	
		<isEmpty property="loginCarrier">
			and (t2.agent_name = #agentName#
			or t2.shpr_name = #agentName# )
		</isEmpty>	
		group by t2.carr_code
</select>
<select id="getLocationDetails_575" parameterClass="cargo.cms.imprt.report.bo.FinalizeTruckManifestRept_575BO" resultClass="cargo.cms.imprt.report.bo.FinalizeTruckManifestRept_575BO">
		SELECT LOC_CODE as locDetails FROM AWB_INVENTORY WHERE AWB_NO = #awbNo#
</select>
<!-- CROSS TERMINAL HO FORM :: CROSS TERMINAL TRANSFER :: START -->
<select id="getCrossTerminalHODetails" parameterClass="cargo.cms.imprt.bo.TrmBO" resultClass="cargo.cms.imprt.bo.TrmBO">
  	  select tab1.TRM_NO trmNo,
         tab1.RECD_CARR recevCarrier, 
         (SELECT  code_desc  FROM CUST_COMPANY 
              WHERE code = (SELECT  RHO_ID FROM flt_opr FO where FO.flt_key = tab2.flt_key  and FO.sch_date =  tab2.flt_date and tab2.FLT_TYPE = decode(FO.FLT_TYPE, 'A', 'I', 'E')) ) rhoName,
         tab1.ULD_KEY uldKey, 
         SUBSTR(tab2.AWB_NO,1,3)||'-'||SUBSTR(tab2.AWB_NO,4) as awbNoDisp , 
         nvl(tab2.PCS,0)||'/'||nvl(tab2.WT,0) transferPcs, 
         tab1.RECD_CARR_HANDR recevCarrierHandler,
         (SELECT V.CC_CODE FROM V_CST_CC_CODE_AWB V WHERE V.AWB_NO = tab2.AWB_NO AND NVL(V.HAWB_NO, '000000000000000000') =  '000000000000000000' 
         		AND ROWNUM = 1)  ccCode,
         case when (select count(1) FROM  CST_DC_DTL where awb_no = tab2.AWB_NO and awb_date = tab2.AWB_DATE) > 0 then 'Y'
         else 'N' end as dcDetailsExistYN
      from IMP_trm_hd tab1, IMP_trm_DTL tab2  
      where tab1.TRM_NO = tab2.TRM_NO 
      and tab1.HO_NO = #hoNo# 
</select>

<select id="get_enquire_trm_list_trmno_report_ct_002" parameterClass="cargo.cms.imprt.bo.TrmBO" resultClass="cargo.cms.imprt.bo.TrmBO" >
	SELECT
		A.ULD_KEY AS uldKey,
		B.AWB_NO AS awbNo,
		B.AWB_DATE AS awbDate,
		B.PCS as pcs,
		B.WT as wt,
		A.RMK remark,
		SUBSTR(TRIM(B.AWB_NO),1,3)||'-'||SUBSTR(TRIM(B.AWB_NO),4) awbNoDisp,
		A.TRM_NO AS trmNo,
		TO_CHAR(A.TRM_DATE,'DDMONYY HH24:MI') AS trmDate,
		'' AS trmHour,
		'' AS trmMin,
		A.TRANSF_CARR AS transferCarrier,
		A.RECD_CARR AS recevCarrier,
		A.RECD_CARR_HANDR AS recevCarrierHandler,
		DECODE(A.ULD_KEY,NULL,'N','Y') AS uldExists,
		A.STATUS AS status,
		TO_CHAR(A.POST_DATE,'DDMONYY HH24:MI') AS postDate,
		'' AS postTrmHour,
		'' AS postTrmMin,
		TO_CHAR(A.VOID_DATE,'DDMONYY HH24:MI') AS voidDate ,
		DECODE(A.RETRV_DATE,NULL,'N','Y') AS retrvInd ,
		A.Source source,
		to_char(A.LAST_PRNT_DATE,'DDMONYY HH24:MI') lastPrntDate,
		(select orig||'/'||dest from awb  where awb_no=b.awb_no	and awb_date=b.awb_Date) dest,
		to_char(B.FLT_DATE,'DDMONYY') fltDate,
		B.flt_key fltKey,
		(select content from awb where awb_no  = b.awb_no and awb_date = b.awb_date) remark1
		FROM IMP_TRM_HD A,
		IMP_TRM_DTL B    
		WHERE A.TRM_NO = #trmNo#
		and A.TRM_NO=B.TRM_NO
	    and A.TRM_TYPE=B.TRM_TYPE
		<isNotEmpty prepend="AND" property="loginCarrier">
			 A.TRANSF_CARR = #loginCarrier# 
		</isNotEmpty>
	Order by  A.TRM_NO
	</select>
	

<select id="getCrossTerminalHOUlds" parameterClass="cargo.cms.imprt.bo.TrmBO" resultClass="cargo.cms.imprt.bo.TrmBO">
	select distinct uld_key uldKey from awb_inventory where trm_no in ( select distinct trm_no from IMP_TRM_HD where HO_NO = #hoNo#) and uld_key is not null
</select>
<select id="getCrossTerminalInfo" parameterClass="cargo.cms.imprt.bo.TrmBO" resultClass="cargo.cms.imprt.bo.TrmBO">
select recd_carr_handr recevCarrierHandler, to_char(est_pick_date_time,'DDMONYY HH24:MI') estPickDateTime from CT_HO where HO_NO = #hoNo#  
</select>

 <select id="getAWBInvInfoListforCrossTerminalPrint" parameterClass="cargo.cms.imprt.bo.TrmBO" resultClass="cargo.cms.imprt.bo.TrmAwbRelocationBO" >
	select awb.TRM_NO trmNo, 
       awb.AWB_NO awbNo, 
       SUBSTR(awb.AWB_NO,1,3)||'-'||SUBSTR(awb.AWB_NO,4) as awbNoDisp , 
       to_char(awb.AWB_DATE,'DDMONYY') awbDate, 
       awb.loc_code warehouseLocation, 
       awb.lsp_no lspNo, 
       awb.ULD_KEY uldKey, 
       awb.locn_pcs locPieces, 
       awb.locn_wt locWeight ,
       awb.locn_pcs oldLocPieces, 
       awb.locn_wt oldLocWeight , 
       awb.SEQ_NO seqNo, 
       awb.CARR_CODE carrCode,
       #rtrvInd# selFlag,
       nvl(trm.PCs,0)||'/'||nvl(trm.WT,0) transferPcs
    from awb_inventory  awb  
    left join  IMP_trm_DTL trm on awb.trm_no = trm.trm_no and awb.awb_no = trm.awb_no and awb.awb_date = trm.awb_date
    where awb.AWB_NO = #awbNo# and awb.AWB_DATE = to_date(#awbDate#,'DDMONYY')  
    <isNotEmpty property="uldKey">
            and  awb.ULD_KEY = #uldKey#
     </isNotEmpty>
     <isNotEmpty property="lspNo">
            and  awb.lsp_no = #lspNo#
     </isNotEmpty>
  </select>  
  
 <update id="updateTrmLastPrintDate" parameterClass="cargo.cms.imprt.bo.TrmBO">
 update IMP_TRM_HD
 set LAST_PRNT_DATE  = to_date(#lastPrntDate#,'DDMONYY HH24:MI')
 where trm_no=#trmNo#
</update>
 <select id="getrept722fltList" parameterClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO" resultClass="java.lang.String">
 select stragg(STRINGDELIM((CNTG_FLT_KEY || '/' ||CNTG_FLT_DATE),',')) from(
 
 select 
    ddt.CNTG_FLT_KEY ,ddt.CNTG_FLT_DATE
from
(select  
FFMSHP.AWB_NO AWB_NO, FFMSHP.AWB_DATE AWB_DATE, FFMSHP.ORG ORG, FFMSHP.DEST DEST, NVL(FFMSHP.MAN_PCS,0) PCS,
NVL(FFMSHP.MAN_WT,0) WT, FFMMSG.FLT_KEY FLT_KEY , FFMMSG.FLT_DATE FLT_DATE, FFMULD.ULD_KEY ULD_KEY, FFMMSG.TR_NO TR_NO,

ffmULD.CNTG_FLT_CARR1 ||ffmULD.CNTG_FLT_NO1 CNTG_FLT_KEY,ffmULD.CNTG_FLT_DATE1 CNTG_FLT_DATE
    from EDI_FFM_MSG ffmMSG, EDI_FFM_ULD ffmULD , edi_ffm_shp ffmshp 
    where FFMMSG.FFM_STATUS = 'P' and FFMSHP.DEST != 'HKG' 
    and ffmMSG.TR_NO = ffmULD.TR_NO and ffmMSG.TR_NO = ffmshp.TR_NO and ffmULD.Doc_line_no = ffmshp.uDoc_line_no 
    ) ffm 
join  (select ddtView.awb_no awb_no, to_char(ddtView.awb_DATE,'DDMONYY') awb_DATE, ddtView.flt_key flt_key , 
                      to_char(ddtView.flt_Date,'DDMONYY') flt_Date, 
                	ddtView.TR_NO TR_NO, ddtView.sdoc_line_no Sdoc_line_no, ddtView.uDOC_LINE_NO UDOC_LINE_NO, ddtView.DOC_LINE_NO DOC_LINE_NO,
                	ddtView.ULD_KEY ULD_KEY , ddtView.SHP_CNTG_FLT_KEY CNTG_FLT_KEY, to_char(ddtView.SHP_CNTG_FLT_DATE,'DDMONYY') CNTG_FLT_DATE, 
                  	ddtView.TRF_TYPE TRF_TYPE,  ddtView.BRK_BULK BRK_BULK, to_char(ddtView.BASELINE_ETA,'DDMONYY') BASELINE_ETA,
                  	NVL( (TO_CHAR(TO_DATE(to_char(ddtView.BASELINE_ETA,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
                   			TO_DATE(TO_CHAR(FLT.SCH_DATE,'DDMONYY')|| ' ' || 
                   			TO_CHAR(NVL(FLT.EST_TIME,  FLT.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24  , 0 ) as etaChangedHrs,
                        NVL( (TO_CHAR(TO_DATE(to_char(ddtView.BASELINE_ETA,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
                   			TO_DATE(TO_CHAR(FLT.SCH_DATE,'DDMONYY')|| ' ' || 
                   			TO_CHAR(NVL(FLT.EST_TIME,  FLT.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24 * 60 , 0 ) as etaChangedMin,
                    ddtView.Acton_code_1 Acton_code_1, ddtView.Acton_code_2 Acton_code_2, ddtView.UNLDG_PT , ddtView.SHP_UNLDG_PT,
                    ddtView.SHP_TRF_PC , ddtView.SHP_TRF_WT
                  from V_UNFIN_DDT_DTL ddtView
              		join FLT_OPR FLT on FLT.FLT_KEY = ddtView.FLT_KEY and FLT.SCH_DATE = ddtView.FLT_DATE and FLT_type = 'A') ddt 
  				on DDT.FLT_KEY = FFM.FLT_KEY and  DDT.FLT_DATE =  FFM.FLT_DATE and nvl(DDT.ULD_KEY, '*') =  nvl(FFM.ULD_KEY, '*') and DDT.AWB_NO = FFM.AWB_NO
 where 
   ((ffm.flt_key = #fltKey# and ffm.flt_Date = #fltDate# ) 
 		OR (ddt.flt_key = #fltKey# and ddt.flt_Date = #fltDate# ))
 		<isNotEmpty property="expFltKey">
		 	<isNotEmpty property="expFltDate">
		  			and  ddt.CNTG_FLT_KEY = #expFltKey# and ddt.CNTG_FLT_DATE = #expFltDate#
			</isNotEmpty>
		</isNotEmpty>
 		group by ddt.CNTG_FLT_KEY , ddt.CNTG_FLT_DATE )
    
      
  </select>
 <select id="fetchInBUldList" parameterClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO" resultClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO" >
<![CDATA[ 
select a.* from (
select nvl(ffm.awb_no,ddt.awb_no) awbNo,
SUBSTR(TRIM(nvl(ffm.awb_no,ddt.awb_no)),1,3)||'-'||SUBSTR(TRIM(nvl(ffm.awb_no,ddt.awb_no)),4) awbNoDisp,
TO_CHAR(nvl(ffm.awb_Date,ddt.awb_Date),'DDMONYY') awbDate, 
nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK')  uldKey,
NVL(NVL(FFM.ULD_KEY,DDT.ULD_KEY),'BULK') ||'-'|| NVL(FFM.AWB_NO,DDT.AWB_NO)  uldKeyAwbNo,
ULDFFM.PCS ttlUldPcs,
ULDFFM.WT ttlUldWt,
case when NVL(FFM.ULD_KEY,DDT.ULD_KEY) is not null then  (select LOC_CODE from ULD_INVENTORY where ULD_KEY = NVL(FFM.ULD_KEY,DDT.ULD_KEY))
             else null end as locn,
(select WH_RMK from IMP_ULD_LIST where FLT_KEY = NVL(FFM.FLT_KEY,DDT.FLT_KEY)  and FLT_DATE = NVL(FFM.FLT_DATE,DDT.FLT_DATE) 
              and ULD_KEY = NVL(FFM.ULD_KEY,DDT.ULD_KEY) ) as uldWhRmk,   
(select AIRL_RMK from IMP_ULD_LIST where FLT_KEY = NVL(FFM.FLT_KEY,DDT.FLT_KEY)  and FLT_DATE = NVL(FFM.FLT_DATE,DDT.FLT_DATE) 
              and ULD_KEY = NVL(FFM.ULD_KEY,DDT.ULD_KEY)) as uldAirlRmk,     
(SELECT STRAGG(STRINGDELIM(SHC, ',')) 
	    	FROM (SELECT DISTINCT SHC, ULD_KEY, FLT_KEY,FLT_DATE, AWB_NO, AWB_DATE,PRIORITY FROM V_IMP_FLT_ULD_SHC ORDER BY PRIORITY DESC
	      	) WHERE AWB_NO = NVL(ffm.awb_No,ddt.awb_No) AND AWB_DATE = NVL(ffm.awb_date,ddt.awb_date)
	      	AND FLT_KEY = nvl(ffm.flt_key,ddt.flt_key) AND FLT_DATE = nvl(ffm.flt_Date,ddt.flt_Date)
	      	and nvl(ULD_KEY,'BULK') = nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK')
                )  shc,
decode(ffm.tr_No,null,'N','Y') ffmInd, DECODE(DDT.TR_NO,null,'N','Y') ddtInd,
NVL(AWB.ORIG,'') org, AWB.DEST dest, NVL(AWB.PCS,0) awbPcs,NVL(AWB.WT,0) awbWt, NVL(FFM.PCS,0) PCS,NVL(FFM.WT,0) WT,ffm.shmpt_code shpmCode,
(SELECT SUM(RECD_PCS)||'/'|| SUM(RECD_WT) FROM  IMP_CAR_SHP CAR
        WHERE  CAR.AWB_NO = DDT.AWB_NO AND CAR.AWB_DATE = TO_DATE(DDT.AWB_DATE,'DDMONYY')
         and car.flt_key = ffm.flt_key and  car.flt_Date =  ffm.flt_Date ) as bdPcWt, 

(SELECT SUM(DAM_PCS)||'/'|| SUM(DAM_WT) FROM  IMP_CAR_SHP car
        WHERE  CAR.AWB_NO = DDT.AWB_NO AND CAR.AWB_DATE = TO_DATE(DDT.AWB_DATE,'DDMONYY')
          and car.flt_key = ffm.flt_key and  car.flt_Date =  ffm.flt_Date ) AS damPcWt,      
(case when ( nvl((select sum(shp_trf_pc) from v_ddt_dtl 
                    where AWB_NO = nvl(ffm.awb_no,ddt.awb_no) and AWB_DATE = nvl(ffm.awb_Date,to_date(ddt.awb_Date,'DDMONYY'))
                        and (SHP_TRF_TYPE = 'QT' OR (SHP_TRF_TYPE = 'IF' and CNTG_FLT_KEY is null))),0) 
                        != nvl((select sum(PMAN_PCS) from EXP_PMANIFEST_AWB where  AWB_NO = nvl(ffm.awb_no,ddt.awb_no) 
                        					and AWB_DATE = nvl(ffm.awb_Date,to_date(ddt.awb_Date,'DDMONYY'))),0))  
              then 'Y' else 'N' end) as manPman,
 nvl(ffm.flt_key,ddt.flt_key) fltKey , TO_CHAR(nvl(ffm.flt_Date,ddt.flt_Date),'DDMONYY')  fltDate,
  ddt.TR_NO ddtTrNo, ddt.SDOC_LINE_NO ddtSdocLineNo, ddt.UDOC_LINE_NO ddtUdocLineNo, ddt.DOC_LINE_NO ddtDocLineNo,
  ddt.CNTG_FLT_KEY cntgFltKey, ddt.CNTG_FLT_DATE cntgFltDate,
  decode(ddt.CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.CNTG_FLT_KEY)) cntgFltCarr,
  REPLACE(ddt.CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.CNTG_FLT_KEY), '') cntgFltNo,
  decode(ddt.CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.CNTG_FLT_KEY)) oldCntgFltCarr, 
  REPLACE(ddt.CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.CNTG_FLT_KEY), '') oldCntgFltNo,
 (select decode(FLTOPR.EST_TIME ,null,SUBSTR(TRIM(TO_CHAR(lpad(FLTOPR.SCH_TIME,4,0))),0,2)|| ':'|| SUBSTR(TRIM(TO_CHAR(lpad(FLTOPR.SCH_TIME,4,0))),3,4),SUBSTR(TRIM(TO_CHAR(lpad(FLTOPR.EST_TIME,4,0))),0,2)|| ':'|| SUBSTR(TRIM(TO_CHAR(lpad(FLTOPR.EST_TIME,4,0))),3,4)) 
   as etd from FLT_OPR FLTOPR WHERE FLTOPR.FLT_KEY = ddt.CNTG_FLT_KEY and FLTOPR.SCH_DATE = ddt.CNTG_FLT_DATE  and FLTOPR.flt_type ='D')as etd,
   FUN_GET_FLT_TDIFF_TRFYPE(ddt.CNTG_FLT_KEY, ddt.CNTG_FLT_DATE,#fltKey#,#fltDate#,'TIME_DIFF' ) timeDiifferance,
   FUN_GET_FLT_TDIFF_TRFYPE_HH_MI(ddt.CNTG_FLT_KEY, ddt.CNTG_FLT_DATE,#fltKey#,#fltDate#,'TIME_DIFF' ) timeDiifferanceHhMi,
  ddt.CNTG_FLT_KEY oldCntgFltKey, 
ddt.CNTG_FLT_DATE oldCntgFltDate,  
ddt.TRF_TYPE trfType, ddt.TRF_TYPE oldTrfType,   ddt.BRK_BULK brkBulk,ddt.BRK_BULK oldBrkBulk,
ddt.UNLDG_PT  uldUnldgPt, ddt.UNLDG_PT  oldUldUnldgPt, 
ddt.SHP_UNLDG_PT shpUnldgPt, ddt.SHP_UNLDG_PT oldShpUnldgPt, 
  (select eic_UNLDG_PT from ULD_INVENTORY where ULD_KEY = ffm.ULD_KEY) unldgPt,
       case when (select count(1) from imp_uld_list where FLT_KEY = ffm.flt_key and ffm.flt_Date = FLT_DATE
              and ULD_KEY = ffm.ULD_KEY and HANDLING_MODE in ('NBK','PPK')) > 0 then 'Y' 
               else null end as noBreak, 
              DDT.ACTON_CODE_1 actionOne, DDT.ACTON_CODE_2 actionTwo , 'Y' splitChkNotReqd,
               ddt.SHP_TRF_PC trfPcs, ddt.SHP_TRF_WT trfWt,
               
             (select bulkPcs ||'/'||  bulkWt from 
               	  (select FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE, sum(bulkPcs) bulkPcs,  sum(bulkWt) bulkWt from 
                   (select FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE, NVL(SUM(MIX_PCS)+SUM(PPK_PCS)+SUM(ASSIGNED_BULK_PCS),0) bulkPcs, NVL(SUM(MIX_WT)+SUM(PPK_WT)+SUM(ASSIGNED_BULK_WT),0) bulkWt
                      from EXP_PMANIFEST_AWB 
                            where MIX_PCS <> 0 OR PPK_PCS <> 0 OR ASSIGNED_BULK_PCS <> 0 OR  MIX_WT <> 0 OR PPK_WT <> 0 OR ASSIGNED_BULK_WT <> 0
                            group by FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE
                    union
                    select FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE,  NVL(SUM(BULK_PCS)+SUM(PPK_PCS),0) bulkPcs,  NVL(SUM(BULK_WT)+SUM(PPK_WT),0) bulkWt
                      from EXP_PMAN_TARMAC_AWB 
                            where BULK_PCS <> 0 OR PPK_PCS <> 0 OR  BULK_WT <> 0 OR PPK_WT <> 0 
                              group by FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE
                  ) a  group by FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE ) buPcWt
                where FLT_KEY = ddt.SHP_CNTG_FLT_KEY  and FLT_DATE = ddt.SHP_CNTG_FLT_DATE 
                and AWB_NO = NVL(FFM.AWB_NO,DDT.AWB_NO) and AWB_DATE = NVL(FFM.AWB_DATE,TO_DATE(DDT.AWB_DATE,'DDMONYY'))
                ) BUPCWT,
                ddt.qt_bu qtBu,
        (select bu_inst from EXP_BU_JO hd, EXP_BU_JO_DTL dtl 
		where hd.jo_no = dtl.jo_no and hd.flt_key =  ddt.shp_cntg_flt_key and hd.flt_date = ddt.shp_cntg_flt_date 
		and dtl.awb_NO = NVL(ffm.awb_No,ddt.awb_No) and dtl.awb_Date = NVL(ffm.awb_Date,ddt.awb_Date) and rownum = 1 ) as buildInstr,
DECODE((select count(1) from awb where awb_no = nvl(ffm.awb_no,ddt.awb_no) and awb_date=nvl(ffm.awb_date,ddt.awb_date) and rownum=1),0,(select rmk from awb_rmk where awb_no=nvl(ffm.awb_no,ddt.awb_no) and awb_date=nvl(ffm.awb_date,ddt.awb_date)  and rownum=1),(select AIRLN_RMK from awb where awb_no = nvl(ffm.awb_no,ddt.awb_no) and awb_date=nvl(ffm.awb_date,ddt.awb_date)  and rownum=1)) AS awbAirlRmk,  
DECODE((select count(1) from imp_car_awb where awb_no = nvl(ffm.awb_no,ddt.awb_no) and awb_date=nvl(ffm.awb_date,ddt.awb_date)  and rownum=1),0,(select awb_rmk from awb where awb_no=nvl(ffm.awb_no,ddt.awb_no) and awb_date=nvl(ffm.awb_date,ddt.awb_date)  and rownum=1),(select WH_RMK from imp_car_awb where awb_no = nvl(ffm.awb_no,ddt.awb_no) and awb_date=nvl(ffm.awb_date,ddt.awb_date)  and rownum=1)) AS awbWhRmk,
case when (SELECT t1.cc_code FROM V_CST_IMP_CC_CODE_AWB t1,mast_constraint_code t2 WHERE t1.cc_code = t2.code AND awb_no = ffm.awb_no AND NVL(hawb_no, '000000000000000000') = '000000000000000000' and rownum = 1) is null
then (select CONST_CODE from CST_RECV WHERE AWB_NO =  ffm.awb_no and LM_DATE = (SELECT MAX(LM_DATE) FROM CST_RECV WHERE AWB_NO= ffm.awb_no) AND rownum=1)
else (SELECT t1.cc_code FROM V_CST_IMP_CC_CODE_AWB t1,mast_constraint_code t2 WHERE t1.cc_code = t2.code AND awb_no =  ffm.awb_no AND NVL(hawb_no, '000000000000000000') = '000000000000000000' and rownum = 1) end as ccode
from

(select  
ffmshp.awb_no awb_no, ffmshp.awb_Date awb_Date, ffmshp.ORG ORG, ffmshp.DEST DEST, nvl(ffmshp.MAN_PCS,0) PCS,
nvl(ffmshp.MAN_WT,0) WT, ffmMSG.flt_key flt_key , ffmMSG.flt_Date flt_Date, ffmULD.ULD_KEY ULD_KEY, ffmMSG.TR_No tr_NO ,shmpt_code shmpt_code
    from EDI_FFM_MSG ffmMSG, EDI_FFM_ULD ffmULD , edi_ffm_shp ffmshp 
    where ffmMSG.FFM_STATUS = 'P' 
    and ffmMSG.TR_NO = ffmULD.TR_NO and ffmMSG.TR_NO = ffmshp.TR_NO and ffmULD.Doc_line_no = ffmshp.uDoc_line_no 
    ) ffm 
]]> 
FULL OUTER join  (select ddtView.awb_no awb_no, to_char(ddtView.awb_DATE,'DDMONYY') awb_DATE, ddtView.flt_key flt_key , 
                      to_char(ddtView.flt_Date,'DDMONYY') flt_Date, 
                	ddtView.TR_NO TR_NO, ddtView.sdoc_line_no Sdoc_line_no, ddtView.uDOC_LINE_NO UDOC_LINE_NO, ddtView.DOC_LINE_NO DOC_LINE_NO,
                	ddtView.ULD_KEY ULD_KEY , ddtView.SHP_CNTG_FLT_KEY CNTG_FLT_KEY, to_char(ddtView.SHP_CNTG_FLT_DATE,'DDMONYY') CNTG_FLT_DATE, 
                	ddtView.SHP_CNTG_FLT_KEY SHP_CNTG_FLT_KEY, to_char(ddtView.SHP_CNTG_FLT_DATE,'DDMONYY') SHP_CNTG_FLT_DATE,ddtView.qt_BU,
                  	ddtView.SHP_TRF_TYPE TRF_TYPE,  ddtView.BRK_BULK BRK_BULK, to_char(ddtView.BASELINE_ETA,'DDMONYY') BASELINE_ETA,
                  	NVL( (TO_CHAR(TO_DATE(to_char(ddtView.BASELINE_ETA,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
                   			TO_DATE(TO_CHAR(FLT.SCH_DATE,'DDMONYY')|| ' ' || 
                   			TO_CHAR(NVL(FLT.EST_TIME,  FLT.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24  , 0 ) as etaChangedHrs,
                        NVL( (TO_CHAR(TO_DATE(to_char(ddtView.BASELINE_ETA,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
                   			TO_DATE(TO_CHAR(FLT.SCH_DATE,'DDMONYY')|| ' ' || 
                   			TO_CHAR(NVL(FLT.EST_TIME,  FLT.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24 * 60 , 0 ) as etaChangedMin,
                    ddtView.Acton_code_1 Acton_code_1, ddtView.Acton_code_2 Acton_code_2, ddtView.UNLDG_PT , ddtView.SHP_UNLDG_PT,
                    ddtView.SHP_TRF_PC , ddtView.SHP_TRF_WT
                  from V_UNFIN_DDT_DTL ddtView
              		join FLT_OPR FLT on FLT.FLT_KEY = ddtView.FLT_KEY and FLT.SCH_DATE = ddtView.FLT_DATE and FLT_type = 'A' 
              		where 
              		(uld_key is not null or (uld_key is null and SHP_TRF_TYPE = 'QT'))
              		 and ddtView.SHP_CNTG_FLT_KEY = nvl(#expFltKey#,ddtView.SHP_CNTG_FLT_KEY) and nvl( ddtView.SHP_CNTG_FLT_DATE,'31AUG2000') = NVL(#expFltDate#,nvl( ddtView.SHP_CNTG_FLT_DATE,'31AUG2000'))) ddt 
  				on ddt.flt_key = ffm.flt_key and  ddt.flt_Date =  ffm.flt_Date and nvl(ddt.ULD_KEY, '*') =  nvl(ffm.ULD_KEY, '*') AND DDT.AWB_NO = FFM.AWB_NO
 left join AWB on AWB.AWB_NO = NVL(FFM.AWB_NO,DDT.AWB_NO) and AWB.AWB_DATE = NVL(FFM.AWB_DATE,DDT.AWB_DATE)
 left join (select BU_INST, AIRL_RMK, WH_RMK, EXP_BU_JO.FLT_KEY, EXP_BU_JO.FLT_DATE, EXP_BU_JO_DTL.AWB_NO ,EXP_BU_JO_DTL.AWB_DATE 
            from      EXP_BU_JO ,  EXP_BU_JO_DTL where EXP_BU_JO.JO_NO =  EXP_BU_JO_DTL.JO_NO ) JO 
            ON JO.FLT_KEY = DDT.CNTG_FLT_KEY  and JO.FLT_DATE = DDT.CNTG_FLT_DATE
              and JO.AWB_NO = NVL(FFM.AWB_NO,DDT.AWB_NO)  and JO.AWB_DATE = nvl(ffm.awb_Date,to_date(ddt.awb_Date,'DDMONYY'))
 left join (select sum(NVL(ffmshp.MAN_PCS,0)) PCS,sum(nvl(ffmshp.MAN_WT,0)) WT, ffmMSG.flt_key flt_key , ffmMSG.flt_Date flt_Date, ffmULD.ULD_KEY ULD_KEY
 		    from EDI_FFM_MSG ffmMSG, EDI_FFM_ULD ffmULD , edi_ffm_shp ffmshp 
    		where ffmMSG.FFM_STATUS = 'P'
    		and ffmMSG.TR_NO = ffmULD.TR_NO and ffmMSG.TR_NO = ffmshp.TR_NO and ffmULD.Doc_line_no = ffmshp.uDoc_line_no group by ffmMSG.flt_key, ffmMSG.flt_Date, ffmULD.ULD_KEY)  uldFfm 
    		on ffm.FLT_KEY = uldFfm.FLT_KEY and ffm.FLT_DATE = uldFfm.FLT_DATE and ffm.ULD_KEY = uldFFm.ULD_KEY             
  where ((ffm.flt_key = #fltKey# and ffm.flt_Date = #fltDate# ) 
  OR (ddt.flt_key = #fltKey# and ddt.flt_Date = #fltDate# ))
    and exists (select null from V_UNFIN_DDT_DTL where SHP_TRF_TYPE = 'QT' and flt_key = ffm.flt_key and flt_date = ffm.flt_date and nvl(ULD_KEY, '*') =  nvl(ffm.ULD_KEY, '*') 
                and (uld_key is not null or (uld_key is null and SHP_TRF_TYPE = 'QT' and awb_no = ffm.awb_no)))
      ) a       where 1 = 1 
       <isNotEmpty property="bulkIndYN">
	       <isEqual property="bulkIndYN" compareValue="N">
	       		and uldKey &lt;&gt; 'BULK'
	       			<isNotEmpty property="expFltKey">
					 	<isNotEmpty property="expFltDate">
					  			and  cntgFltKey = #expFltKey# and cntgFltDate = #expFltDate#
						</isNotEmpty>
					</isNotEmpty>
	       	</isEqual>
	       <isEqual property="bulkIndYN" compareValue="Y">
	       		and uldKey = 'BULK'
	       	</isEqual>
       	</isNotEmpty>
   order by  to_number(nvl(timeDiifferanceHhMi,0)) , uldKey
</select>
<select id="getreptBuildUpList" parameterClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO" resultClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO">
select distinct FLT_KEY, FLT_DATE, ULD_KEY uldKey, LOC_CODE locn
		from IMP_RAMP_CHK_DTL r
		join mast_wh_loc l on l.code = r.loc_code
		join mast_wh_group g on l.wh_group = g.wh_group and g.wh_type = 'QT'
		join mast_uld_type t on t.code = r.uld_type and (t.h_cont_ind = 'Y' or t.bt_ind = 'Y')
where r.flt_key = #fltKey# and r.flt_Date = #fltDate#  and NVL(r.chkin_yn,'N')='Y'
</select>
<select id="getExpTransitUldFltList" parameterClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO" resultClass="java.lang.String">
select stragg(STRINGDELIM((flt_key || '/' ||fltDate),',')) from(
select
ddt.flt_key,to_char(ddt.flt_Date ,'DDMONYY') fltDate
from V_UNFIN_DDT_DTL ddt
join (select V_UNFIN_DDT_DTL.SHP_CNTG_FLT_KEY , V_UNFIN_DDT_DTL.SHP_CNTG_FLT_DATE,  V_UNFIN_DDT_DTL.TR_NO , V_UNFIN_DDT_DTL.SDOC_LINE_NO , V_UNFIN_DDT_DTL.UDOC_LINE_NO , V_UNFIN_DDT_DTL.DOC_LINE_NO ,
          NVL( (TO_CHAR(TO_DATE(TO_CHAR(V_UNFIN_DDT_DTL.BASELINE_ETD,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
                      TO_DATE(TO_CHAR(FLT_OPR.SCH_DATE,'DDMONYY')|| ' ' || 
                      TO_CHAR(NVL(FLT_OPR.EST_TIME,  FLT_OPR.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24  , 0 ) as etdChangedHrs,
		NVL( (TO_CHAR(TO_DATE(TO_CHAR(V_UNFIN_DDT_DTL.BASELINE_ETD,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
                      TO_DATE(TO_CHAR(FLT_OPR.SCH_DATE,'DDMONYY')|| ' ' || 
                      TO_CHAR(NVL(FLT_OPR.EST_TIME,  FLT_OPR.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24 * 60 , 0 ) as etdChangedMin
      from V_UNFIN_DDT_DTL , FLT_OPR  where V_UNFIN_DDT_DTL.SHP_TRF_TYPE = 'QT' and V_UNFIN_DDT_DTL.SHP_CNTG_FLT_KEY = FLT_OPR.FLT_KEY and FLT_OPR.SCH_DATE = V_UNFIN_DDT_DTL.SHP_CNTG_FLT_DATE and FLT_OPR.FLT_TYPE ='D') ddtEtd
      on ddt.SHP_CNTG_FLT_KEY = ddtEtd.SHP_CNTG_FLT_KEY and ddt.SHP_CNTG_FLT_DATE = ddtEtd.SHP_CNTG_FLT_DATE 
          and  ddtEtd.TR_NO = ddt.TR_NO and ddtEtd.SDOC_LINE_NO = ddt.SDOC_LINE_NO
          and ddtEtd.UDOC_LINE_NO = ddt.UDOC_LINE_NO and ddtEtd.DOC_LINE_NO = ddt.DOC_LINE_NO
join FLT_OPR FLT on ddt.SHP_CNTG_FLT_KEY = FLT.FLT_KEY and FLT.SCH_DATE = ddt.SHP_CNTG_FLT_DATE and FLT.FLT_TYPE ='D'
left join (select nvl(sum(shp_trf_Pc),0) qt_trf_Pcs  , nvl(sum(shp_trf_Wt),0) qt_trf_Wt  ,V_UNFIN_DDT_DTL.SHP_CNTG_FLT_KEY ,  V_UNFIN_DDT_DTL.SHP_CNTG_FLT_DATE,  V_UNFIN_DDT_DTL.TR_NO ,
          V_UNFIN_DDT_DTL.SDOC_LINE_NO , V_UNFIN_DDT_DTL.UDOC_LINE_NO , V_UNFIN_DDT_DTL.DOC_LINE_NO 
      from V_UNFIN_DDT_DTL , FLT_OPR  where V_UNFIN_DDT_DTL.SHP_TRF_TYPE = 'QT' and V_UNFIN_DDT_DTL.SHP_CNTG_FLT_KEY = FLT_OPR.FLT_KEY and FLT_OPR.SCH_DATE = V_UNFIN_DDT_DTL.SHP_CNTG_FLT_DATE and FLT_OPR.FLT_TYPE ='D'
      group by V_UNFIN_DDT_DTL.SHP_CNTG_FLT_KEY,  V_UNFIN_DDT_DTL.SHP_CNTG_FLT_DATE,  V_UNFIN_DDT_DTL.TR_NO, V_UNFIN_DDT_DTL.SDOC_LINE_NO, V_UNFIN_DDT_DTL.UDOC_LINE_NO, V_UNFIN_DDT_DTL.DOC_LINE_NO 
      ) ddtQt
      on ddt.SHP_CNTG_FLT_KEY = ddtQt.SHP_CNTG_FLT_KEY and ddt.SHP_CNTG_FLT_DATE = ddtQt.SHP_CNTG_FLT_DATE 
          and  ddtQt.TR_NO = ddt.TR_NO and ddtQt.SDOC_LINE_NO = ddt.SDOC_LINE_NO
          and ddtQt.UDOC_LINE_NO = ddt.UDOC_LINE_NO and ddtQt.DOC_LINE_NO = ddt.DOC_LINE_NO
left join awb on awb.awb_NO = ddt.awb_No and awb.awb_Date = ddt.awb_Date
left join (select ffmshp.awb_no awb_no, ffmshp.awb_Date awb_Date, ffmshp.ORG ORG, ffmshp.DEST DEST, nvl(ffmshp.MAN_PCS,0) PCS,
    nvl(ffmshp.MAN_WT,0) WT, ffmMSG.flt_key flt_key , ffmMSG.flt_Date flt_Date, ffmULD.ULD_KEY ULD_KEY, ffmMSG.TR_No tr_NO 
    from EDI_FFM_MSG ffmMSG, EDI_FFM_ULD ffmULD , edi_ffm_shp ffmshp 
    where ffmMSG.FFM_STATUS = 'P' and ffmshp.dest != 'HKG' 
    and ffmMSG.TR_NO = ffmULD.TR_NO and ffmMSG.TR_NO = ffmshp.TR_NO and ffmULD.Doc_line_no = ffmshp.uDoc_line_no 
    ) ffm on ddt.SHP_CNTG_FLT_KEY = ffm.flt_key and ffm.flt_DATE = ddt.SHP_CNTG_FLT_DATE and ffm.awb_NO = ddt.awb_No and ffm.awb_Date = ddt.awb_Date
left join (select BU_INST, AIRL_RMK, WH_RMK, EXP_BU_JO.FLT_KEY, EXP_BU_JO.FLT_DATE, EXP_BU_JO_DTL.AWB_NO ,EXP_BU_JO_DTL.AWB_DATE 
            from      EXP_BU_JO ,  EXP_BU_JO_DTL where EXP_BU_JO.JO_NO =  EXP_BU_JO_DTL.JO_NO ) JO 
            ON JO.FLT_KEY = DDT.SHP_CNTG_FLT_KEY  and JO.FLT_DATE = DDT.SHP_CNTG_FLT_DATE
              and JO.AWB_NO =DDT.AWB_NO  and JO.AWB_DATE = ddt.awb_Date
where ddt.SHP_CNTG_FLT_KEY = #expFltKey# and ddt.SHP_CNTG_FLT_DATE = #expFltDate#  
and ddt.SHP_TRF_TYPE = 'QT' 
   <isNotEmpty property="unldgPt" >	 
	  	and ddt.SHP_UNLDG_PT = #unldgPt#
	</isNotEmpty>
	 <isNotEmpty property="impFltKey" >	 
	  	<isNotEmpty property="impFltDate" >	 
	  		and ddt.flt_key = #impFltKey# and ddt.flt_Date = #impFltDate#  
	  	</isNotEmpty>
	</isNotEmpty>
  
group By ddt.flt_key , ddt.flt_Date)
</select>
<select id="getExpTransitUldList" parameterClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO" resultClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO">
<![CDATA[ 
select
nvl(ddt.ULD_KEY,'BULK')  uldKey, nvl(ddt.ULD_KEY,'BULK') ||'-'|| ddt.awb_no  uldKeyAwbNo, 
ddt.awb_no awbNo, SUBSTR(TRIM(ddt.awb_no),1,3)||'-'||SUBSTR(TRIM(ddt.awb_no),4) awbNoDisp,  to_char(ddt.awb_Date,'DDMONYY') awbDate, 
nvl(awb.ORIG,'') org, awb.DEST dest, ddt.UNLDG_PT unldgPt,ddt.UNLDG_PT uldUnldgPt, ddt.SHP_UNLDG_PT shpUnldgPt, 
ddt.UNLDG_PT oldUldUnldgPt, ddt.SHP_UNLDG_PT oldShpUnldgPt, 
ddt.flt_key fltKey , to_char(ddt.flt_Date,'DDMONYY')  fltDate,
PKG_COMMON.get_flt_eta(ddt.flt_key, ddt.flt_Date, 'A', 'DD') eta,
NVL(AWB.PCS,0) awbPcs,NVL(AWB.WT,0) awbWt, 
NVL(FFM.PCS,0) ffmPcs,NVL(FFM.WT,0) ffmWt, FFM.shmpt_code shpmCode,
ddt.qt_bu as qtBuInd,
(select NVL(SUM(MIX_PCS)+SUM(PPK_PCS)+SUM(ASSIGNED_BULK_PCS),0)||'/'|| NVL(SUM(MIX_WT)+SUM(PPK_WT)+SUM(ASSIGNED_BULK_WT),0) 
        from EXP_PMANIFEST_AWB 
        where FLT_KEY = ddt.SHP_CNTG_FLT_KEY  and FLT_DATE = ddt.SHP_CNTG_FLT_Date
        and AWB_NO = DDT.AWB_NO and AWB_DATE = DDT.AWB_DATE) buPcWt,
        
(select NVL(SUM(PMAN_PCS),0)||'/'|| NVL(SUM(PMAN_WT),0)  from EXP_PMANIFEST_AWB 
        where FLT_KEY = DDT.SHP_CNTG_FLT_KEY  and FLT_DATE = DDT.SHP_CNTG_FLT_DATE
        and AWB_NO = DDT.AWB_NO and AWB_DATE = DDT.AWB_DATE) pmanPcWt,       
        
(select sum(SHP.RECD_PCS)||'/'|| sum(SHP.RECD_WT) from  IMP_CAR_SHP SHP
          where SHP.AWB_NO = DDT.AWB_NO and SHP.AWB_DATE = DDT.AWB_DATE
          and  SHP.FLT_KEY = DDT.FLT_KEY and SHP.FLT_DATE = DDT.FLT_DATE group by SHP.AWB_NO,SHP.AWB_DATE,SHP.FLT_KEY,SHP.FLT_DATE) as bdPcWt, 
(select loc_code from  ULD_INVENTORY uldInv where ddt.uld_key = uldInv.uld_key and rownum = 1) locn, 
NVL(JODTL.PC,0) joPcs, NVL(JODTL.WT,0) joWt,          
NVL(ddt.SHP_TRF_PC,0) trfPcs, NVL(ddt.SHP_TRF_WT,0) trfWt,
nvl(ddt.LOADED_PCS,0) pcs,nvl(ddt.LOADED_WT,0) wt, ddt.SHP_TRF_PC trfPcs , ddt.SHP_TRF_WT  trfWt, ddt.BRK_BULK brkBulk,
round(ddtEtd.etdChangedHrs) etdChangedHrs, 
       round(ddtEtd.etdChangedMin) etdChangedMin,
   FUN_GET_FLT_TDIFF_TRFYPE(ddt.shp_CNTG_FLT_KEY, ddt.shp_CNTG_FLT_Date,ddt.FLT_KEY, ddt.FLT_DATE,'TIME_DIFF' ) etdChangedHrsMin,
   FUN_GET_FLT_TDIFF_TRFYPE(ddt.shp_CNTG_FLT_KEY, ddt.shp_CNTG_FLT_Date,ddt.FLT_KEY, ddt.FLT_DATE,'TIME_DIFF' ) etaChangedHrsMin,
   ddt.shp_TRF_TYPE trfType, 
   ddt.TR_NO ddtTrNo, ddt.SDOC_LINE_NO ddtSdocLineNo, ddt.UDOC_LINE_NO ddtUdocLineNo, ddt.DOC_LINE_NO ddtDocLineNo,
   ddt.SHP_CNTG_FLT_KEY cntgFltKey, to_char(ddt.SHP_CNTG_FLT_DATE,'DDMONYY') cntgFltDate,  
   ddt.SHP_CNTG_FLT_KEY oldCntgFltKey, to_char(ddt.SHP_CNTG_FLT_DATE,'DDMONYY') oldCntgFltDate,  
   decode(ddt.SHP_CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY)) cntgFltCarr, REPLACE(ddt.SHP_CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY), '') cntgFltNo,
   decode(ddt.SHP_CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY)) oldCntgFltCarr, REPLACE(ddt.SHP_CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY), '') oldCntgFltNo,
   ddt.TRF_TYPE trfType, ddt.TRF_TYPE oldTrfType,   ddt.BRK_BULK brkBulk,ddt.BRK_BULK oldBrkBulk,   
   (SELECT STRAGG(STRINGDELIM(SHC, ',')) 
	    	FROM (SELECT DISTINCT SHC, ULD_KEY, FLT_KEY,FLT_DATE, AWB_NO, AWB_DATE,PRIORITY FROM V_IMP_FLT_ULD_SHC ORDER BY PRIORITY DESC
	      	) WHERE AWB_NO = ddt.awb_No AND AWB_DATE = ddt.awb_date
	      	AND FLT_KEY = ddt.flt_key AND FLT_DATE = ddt.flt_Date
	      	and nvl(ULD_KEY,'BULK') = nvl(ddt.ULD_KEY,'BULK') 
                ) shc,
        (SELECT V.CC_CODE FROM V_CST_CC_CODE_AWB V
                WHERE V.AWB_NO = ddt.awb_no
          AND NVL(V.HAWB_NO, '000000000000000000') =  '000000000000000000' AND ROWNUM = 1)  ccode,
           JO.BU_INST buildInstr, ddt.QT_BU qtBu,
FUN_GET_FLT_TDIFF_TRFYPE(ddt.shp_CNTG_FLT_KEY, ddt.shp_CNTG_FLT_Date,ddt.FLT_KEY, ddt.FLT_DATE,'TIME_DIFF' ) timeDiifferance,
FUN_GET_FLT_TDIFF_TRFYPE(ddt.shp_CNTG_FLT_KEY, ddt.shp_CNTG_FLT_Date,ddt.FLT_KEY, ddt.FLT_DATE,'TR_TYPE' ) proposeTrfType   
from V_UNFIN_DDT_DTL ddt
join (select V_UNFIN_DDT_DTL.SHP_CNTG_FLT_KEY , V_UNFIN_DDT_DTL.SHP_CNTG_FLT_DATE,  V_UNFIN_DDT_DTL.TR_NO , V_UNFIN_DDT_DTL.SDOC_LINE_NO , V_UNFIN_DDT_DTL.UDOC_LINE_NO , V_UNFIN_DDT_DTL.DOC_LINE_NO ,
          NVL( (TO_CHAR(TO_DATE(TO_CHAR(V_UNFIN_DDT_DTL.BASELINE_ETD,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
                      TO_DATE(TO_CHAR(FLT_OPR.SCH_DATE,'DDMONYY')|| ' ' || 
                      TO_CHAR(NVL(FLT_OPR.EST_TIME,  FLT_OPR.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24  , 0 ) as etdChangedHrs,
		NVL( (TO_CHAR(TO_DATE(TO_CHAR(V_UNFIN_DDT_DTL.BASELINE_ETD,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
                      TO_DATE(TO_CHAR(FLT_OPR.SCH_DATE,'DDMONYY')|| ' ' || 
                      TO_CHAR(NVL(FLT_OPR.EST_TIME,  FLT_OPR.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24 * 60 , 0 ) as etdChangedMin
      from V_UNFIN_DDT_DTL  , FLT_OPR  where V_UNFIN_DDT_DTL.SHP_TRF_TYPE = 'QT' and V_UNFIN_DDT_DTL.SHP_CNTG_FLT_KEY = FLT_OPR.FLT_KEY and FLT_OPR.SCH_DATE = V_UNFIN_DDT_DTL.SHP_CNTG_FLT_DATE and FLT_OPR.FLT_TYPE ='D') ddtEtd
      on ddt.SHP_CNTG_FLT_KEY = ddtEtd.SHP_CNTG_FLT_KEY and ddt.SHP_CNTG_FLT_DATE = ddtEtd.SHP_CNTG_FLT_DATE 
          and  ddtEtd.TR_NO = ddt.TR_NO and ddtEtd.SDOC_LINE_NO = ddt.SDOC_LINE_NO
          and ddtEtd.UDOC_LINE_NO = ddt.UDOC_LINE_NO and ddtEtd.DOC_LINE_NO = ddt.DOC_LINE_NO
join FLT_OPR FLT on ddt.SHP_CNTG_FLT_KEY = FLT.FLT_KEY and FLT.SCH_DATE = ddt.SHP_CNTG_FLT_DATE and FLT.FLT_TYPE ='D'
left join awb on awb.awb_NO = ddt.awb_No and awb.awb_Date = ddt.awb_Date
LEFT JOIN   (SELECT SUM(JO_DTL.AWB_JO_PC) PC ,SUM(JO_DTL.AWB_JO_WT) WT,JO_HD.FLT_KEY FLT_KEY, JO_HD.FLT_DATE FLT_DATE ,JO_DTL.AWB_NO AWB_NO ,JO_DTL.AWB_DATE AWB_DATE 
FROM EXP_BU_JO JO_HD 
JOIN EXP_BU_JO_DTL JO_DTL 
ON JO_HD.JO_NO = JO_DTL.JO_NO
WHERE CONFIRMED_YN='Y' 
group by JO_HD.FLT_KEY, JO_HD.FLT_DATE, JO_DTL.AWB_NO, JO_DTL.AWB_DATE) JODTL
ON JODTL.FLT_KEY = DDT.SHP_CNTG_FLT_KEY  AND JODTL.FLT_DATE = DDT.SHP_CNTG_FLT_DATE
AND JODTL.AWB_NO = DDT.AWB_NO  AND JODTL.AWB_DATE =  DDT.AWB_DATE
left join (select ffmshp.awb_no awb_no, ffmshp.awb_Date awb_Date, sum(nvl(ffmshp.MAN_PCS,0)) PCS, MIN(shmpt_code) shmpt_code,
    SUM(nvl(ffmshp.MAN_WT,0)) WT, ffmMSG.flt_key flt_key , ffmMSG.flt_Date flt_Date,ffmULD.ULD_KEY
    from EDI_FFM_MSG ffmMSG, EDI_FFM_ULD ffmULD , edi_ffm_shp ffmshp 
    where ffmMSG.FFM_STATUS = 'P' and ffmshp.dest != 'HKG' 
    and ffmMSG.TR_NO = ffmULD.TR_NO and ffmMSG.TR_NO = ffmshp.TR_NO and ffmULD.Doc_line_no = ffmshp.uDoc_line_no group by ffmshp.awb_no, ffmshp.awb_Date, ffmMSG.flt_key, ffmMSG.flt_Date,ffmULD.ULD_KEY 
    ) ffm on ddt.FLT_KEY = ffm.flt_key and ffm.flt_DATE = ddt.FLT_DATE and ffm.awb_NO = ddt.awb_No and ffm.awb_Date = ddt.awb_Date and ffm.ULD_KEY=ddt.uld_key
left join (select BU_INST, AIRL_RMK, WH_RMK, EXP_BU_JO.FLT_KEY, EXP_BU_JO.FLT_DATE, EXP_BU_JO_DTL.AWB_NO ,EXP_BU_JO_DTL.AWB_DATE 
            from      EXP_BU_JO ,  EXP_BU_JO_DTL where EXP_BU_JO.JO_NO =  EXP_BU_JO_DTL.JO_NO ) JO 
            ON JO.FLT_KEY = DDT.SHP_CNTG_FLT_KEY  and JO.FLT_DATE = DDT.SHP_CNTG_FLT_DATE
              and JO.AWB_NO =DDT.AWB_NO  and JO.AWB_DATE = ddt.awb_Date
where ddt.SHP_CNTG_FLT_KEY = #expFltKey# and ddt.SHP_CNTG_FLT_DATE = #expFltDate#  
and ddt.SHP_TRF_TYPE = 'QT' 
  ]]>
  <isNotEmpty property="unldgPt" >	 
	  	and ddt.SHP_UNLDG_PT = #unldgPt#
	</isNotEmpty>
	 <isNotEmpty property="impFltKey" >	 
	  	<isNotEmpty property="impFltDate" >	 
	  		and ddt.flt_key = #impFltKey# and ddt.flt_Date = #impFltDate#  
	  	</isNotEmpty>
	</isNotEmpty>
	ORDER BY  ddt.awb_no
	</select>
<select id="fetchIndBoundTsnstCntrlAWBList_DtlRept" parameterClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO" resultClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO" >
<![CDATA[ 
select a.* from (  
select nvl(ffm.awb_no,ddt.awb_no) awbNo,
SUBSTR(TRIM(nvl(ffm.awb_no,ddt.awb_no)),1,3)||'-'||SUBSTR(TRIM(nvl(ffm.awb_no,ddt.awb_no)),4) awbNoDisp,
TO_CHAR(nvl(ffm.awb_Date,ddt.awb_Date),'DDMONYY') awbDate, 
nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK')  uldKey,
nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK')  uldKeyShow,
nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK') ||'-'|| nvl(ffm.awb_no,ddt.awb_no)  uldKeyAwbNo,
decode(ffm.tr_No,null,'N','Y') ffmInd,
decode(ddt.tr_No,null,'N','Y') ddtInd,
nvl(awb.ORIG,'') org, awb.DEST dest, nvl(ffm.PCS,0) pcs,nvl(ffm.WT,0) wt, ffm.shmpt_code shpmCode, NVL(AWB.PCS,0) awbPcs,NVL(AWB.WT,0) awbWt,
(case when ( nvl((select sum(shp_trf_pc) from v_ddt_dtl 
                    where AWB_NO = nvl(ffm.awb_no,ddt.awb_no) and AWB_DATE = nvl(ffm.awb_Date,to_date(ddt.awb_Date,'DDMONYY'))
                        and (SHP_TRF_TYPE = 'QT' OR (SHP_TRF_TYPE = 'IF' and ddt.ULD_KEY is null))),0) 
                        != nvl((select sum(PMAN_PCS) from EXP_PMANIFEST_AWB where  AWB_NO = nvl(ffm.awb_no,ddt.awb_no) 
                        					and AWB_DATE = nvl(ffm.awb_Date,to_date(ddt.awb_Date,'DDMONYY'))),0))  
              then 'Y' else 'N' end) as manPman,
 nvl(ffm.flt_key,ddt.flt_key) fltKey , TO_CHAR(nvl(ffm.flt_Date,ddt.flt_Date),'DDMONYY')  fltDate,
  ddt.TR_NO ddtTrNo, ddt.SDOC_LINE_NO ddtSdocLineNo, ddt.UDOC_LINE_NO ddtUdocLineNo, ddt.DOC_LINE_NO ddtDocLineNo,
   (SELECT V.CC_CODE FROM V_CST_IMP_CC_CODE_AWB V
				WHERE nvl(V.FLT_KEY,'*') = NVL(nvl(ffm.flt_key,ddt.flt_key),'*') AND nvl( V.FLT_DATE,'31AUG2000') = NVL(nvl(ffm.flt_date,ddt.flt_date),'31AUG2000')
				AND V.AWB_NO =  nvl(ffm.awb_no,ddt.awb_no)  AND NVL(V.HAWB_NO, '000000000000000000') =  '000000000000000000' AND ROWNUM = 1)  AS ccode,
(SELECT STRAGG(STRINGDELIM(SHC, ',')) 
	    	FROM (SELECT DISTINCT SHC, ULD_KEY, FLT_KEY,FLT_DATE, AWB_NO, AWB_DATE,PRIORITY FROM V_IMP_FLT_ULD_SHC ORDER BY PRIORITY DESC
	      	) WHERE AWB_NO = NVL(ffm.awb_No,ddt.awb_No) AND AWB_DATE = NVL(ffm.awb_date,ddt.awb_date)
	      	AND FLT_KEY = nvl(ffm.flt_key,ddt.flt_key) AND FLT_DATE = nvl(ffm.flt_Date,ddt.flt_Date)
	      	and nvl(ULD_KEY,'BULK') = nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK')
                ) shc,  				
 ddt.SHP_CNTG_FLT_KEY cntgFltKey, ddt.SHP_CNTG_FLT_DATE cntgFltDate,
	ddt.SHP_CNTG_FLT_KEY oldCntgFltKey, ddt.SHP_CNTG_FLT_DATE oldCntgFltDate,
  decode(ddt.SHP_CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY)) cntgFltCarr, REPLACE(ddt.SHP_CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY), '') cntgFltNo,
  decode(ddt.SHP_CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY)) oldCntgFltCarr, REPLACE(ddt.SHP_CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY), '') oldCntgFltNo,
 ddt.SHP_TRF_TYPE trfType, ddt.SHP_BRK_BULK brkBulk, ddt.SHP_UNLDG_PT shpUnldgPt, 
  ddt.SHP_TRF_TYPE oldTrfType, ddt.SHP_BRK_BULK oldBrkBulk, ddt.SHP_UNLDG_PT oldShpUnldgPt, 
  ddt.SHP_TRF_PC trfPcs, ddt.SHP_TRF_WT trfWt,
	ddt.SHP_TRF_PC oldTrfPcs, ddt.SHP_TRF_WT oldTrfWt,
  (select eic_UNLDG_PT from ULD_INVENTORY where ULD_KEY = ffm.ULD_KEY) unldgPt,
      case when (select count(1) from imp_uld_list where FLT_KEY = ffm.flt_key and ffm.flt_Date = FLT_DATE
              and ULD_KEY = ffm.ULD_KEY and HANDLING_MODE in ('NBK','PPK')) > 0 then 'Y' 
               else '' end as noBreak, 
              ddt.Acton_code_1 actionOne, ddt.Acton_code_2 actionTwo , 'Y' spiltChkNotReqd,
FUN_GET_FLT_TDIFF_TRFYPE(ddt.SHP_CNTG_FLT_KEY, ddt.SHP_CNTG_FLT_DATE,#fltKey#,#fltDate#,'TIME_DIFF' ) timeDiifferance,
FUN_GET_FLT_TDIFF_TRFYPE(ddt.SHP_CNTG_FLT_KEY, ddt.SHP_CNTG_FLT_DATE,#fltKey#,#fltDate#,'TR_TYPE' ) proposeTrfType,
nvl((select AIRLN_RMK from awb where awb_no = nvl(ffm.awb_no,ddt.awb_no) and awb_date=nvl(ffm.awb_date,ddt.awb_date)  and rownum=1),(select AIRLN_RMK from imp_car_awb where awb_no = nvl(ffm.awb_no,ddt.awb_no) and awb_date=nvl(ffm.awb_date,ddt.awb_date)  and rownum=1)) AS awbAirlRmk,  
nvl((select awb_rmk from awb where awb_no=nvl(ffm.awb_no,ddt.awb_no) and awb_date=nvl(ffm.awb_date,ddt.awb_date)  and rownum=1),(select WH_RMK from imp_car_awb where awb_no = nvl(ffm.awb_no,ddt.awb_no) and awb_date=nvl(ffm.awb_date,ddt.awb_date)  and rownum=1)) AS awbWhRmk,
d.AIRL_RMK uldAirlRmk, d.WH_RMK uldWhRmk,
DECODE(shp.RECD_PCS,'0','',shp.RECD_PCS) ||DECODE(shp.RECD_PCS,'0','','/')||DECODE(shp.RECD_WT,null,'',DECODE(trim(TO_CHAR(NVL(shp.RECD_WT,0),'99999990.0')),'0.0','',trim(TO_CHAR(NVL(shp.RECD_WT,0),'99999990.0')))) AS bdPcWt,
DECODE(shp.DAM_PCS,'0','',shp.DAM_PCS) ||DECODE(shp.DAM_PCS,'0','','/')|| DECODE(shp.DAM_WT,null,'',DECODE(trim(TO_CHAR(NVL(shp.DAM_WT,0),'99999990.0')),'0.0','',trim(TO_CHAR(NVL(shp.DAM_WT,0),'99999990.0')))) AS damPcWt     
from
(select  
ffmshp.awb_no awb_no, ffmshp.awb_Date awb_Date, ffmshp.ORG ORG, ffmshp.DEST DEST, nvl(ffmshp.MAN_PCS,0) PCS,
nvl(ffmshp.MAN_WT,0) WT, shmpt_code shmpt_code, ffmMSG.flt_key flt_key , ffmMSG.flt_Date flt_Date, ffmULD.ULD_KEY ULD_KEY, ffmMSG.TR_No tr_NO 
    from EDI_FFM_MSG ffmMSG, EDI_FFM_ULD ffmULD , edi_ffm_shp ffmshp 
    where ffmMSG.FFM_STATUS = 'P' 
    and ffmMSG.TR_NO = ffmULD.TR_NO and ffmMSG.TR_NO = ffmshp.TR_NO and ffmULD.Doc_line_no = ffmshp.uDoc_line_no 
    ) ffm 
FULL OUTER join  (select ddtView.awb_no awb_no, to_char(ddtView.awb_DATE,'DDMONYY') awb_DATE, ddtView.flt_key flt_key , 
                      to_char(ddtView.flt_Date,'DDMONYY') flt_Date, 
                	ddtView.TR_NO TR_NO, ddtView.sdoc_line_no Sdoc_line_no, ddtView.uDOC_LINE_NO UDOC_LINE_NO, ddtView.DOC_LINE_NO DOC_LINE_NO,
                	ddtView.ULD_KEY ULD_KEY , ddtView.SHP_CNTG_FLT_KEY SHP_CNTG_FLT_KEY, to_char(ddtView.SHP_CNTG_FLT_DATE,'DDMONYY') SHP_CNTG_FLT_DATE, 
                  	ddtView.SHP_TRF_TYPE SHP_TRF_TYPE,  ddtView.SHP_BRK_BULK SHP_BRK_BULK, to_char(ddtView.BASELINE_ETA,'DDMONYY') BASELINE_ETA,
                  	NVL( (TO_CHAR(TO_DATE(to_char(ddtView.BASELINE_ETA,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
                   			TO_DATE(TO_CHAR(FLT.SCH_DATE,'DDMONYY')|| ' ' || 
                   			TO_CHAR(NVL(FLT.EST_TIME,  FLT.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24  , 0 ) as etaChangedHrs,
                    ddtView.Acton_code_1 Acton_code_1, ddtView.Acton_code_2 Acton_code_2, ddtView.UNLDG_PT , ddtView.SHP_UNLDG_PT,
                    ddtView.SHP_TRF_PC , ddtView.SHP_TRF_WT
                  from V_UNFIN_DDT_DTL ddtView
              		join FLT_OPR FLT on FLT.FLT_KEY = ddtView.FLT_KEY and FLT.SCH_DATE = ddtView.FLT_DATE and FLT_type = 'A') ddt 
  				on ddt.flt_key = ffm.flt_key and  ddt.flt_Date =  ffm.flt_Date and nvl(ddt.ULD_KEY, '*') =  nvl(ffm.ULD_KEY, '*') AND DDT.AWB_NO = FFM.AWB_NO
 left join awb on awb.awb_NO = NVL(ffm.awb_No,ddt.awb_No) and awb.awb_Date = NVL(ffm.awb_Date,ddt.awb_Date)
 left join IMP_CAR_SHP shp on shp.awb_NO = NVL(ffm.awb_No,ddt.awb_No) and shp.awb_Date = NVL(ffm.awb_Date,ddt.awb_Date) and shp.flt_key = NVL(ffm.flt_key,ddt.flt_key) and shp.flt_Date = NVL(ffm.flt_Date,ddt.flt_Date)
 left join IMP_ULD_LIST D
     ON nvl(D.ULD_KEY,'BULK') = nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK')  and d.flt_key = NVL(ffm.flt_key,ddt.flt_key) and d.flt_date = NVL(ffm.flt_Date,ddt.flt_Date) 
  where ((ffm.flt_key = #fltKey# and ffm.flt_Date = #fltDate# ) 
  		OR (ddt.flt_key = #fltKey# and ddt.flt_Date = #fltDate# ))
  		and nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK') = #uldKey#  
   ]]>
   <isNotEmpty property="trfType">
		and ddt.SHP_TRF_TYPE = nvl(#trfType#,ddt.SHP_TRF_TYPE)
	</isNotEmpty>
  ) a ORDER BY  timeDiifferance, awbNo , awbDate
</select>
<select id="fetchIndBoundTsnstCntrlAWB_CNTG_FLT_ListRept" parameterClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO" resultClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO" >
<![CDATA[ 
select a.* from (
select nvl(ffm.awb_no,ddt.awb_no) awbNo,
SUBSTR(TRIM(nvl(ffm.awb_no,ddt.awb_no)),1,3)||'-'||SUBSTR(TRIM(nvl(ffm.awb_no,ddt.awb_no)),4) awbNoDisp,
TO_CHAR(nvl(ffm.awb_Date,ddt.awb_Date),'DDMONYY') awbDate, 
nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK')  uldKey,
nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK')  uldKeyShow,
nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK') ||'-'|| nvl(ffm.awb_no,ddt.awb_no)  uldKeyAwbNo,
decode(ffm.tr_No,null,'N','Y') ffmInd,
decode(ddt.tr_No,null,'N','Y') ddtInd,
nvl(awb.ORIG,'') org, awb.DEST dest, nvl(ffm.PCS,0) pcs,nvl(ffm.WT,0) wt,NVL(AWB.PCS,0) awbPcs,NVL(AWB.WT,0) awbWt,
(case when ( nvl((select sum(shp_trf_pc) from v_ddt_dtl 
                    where AWB_NO = nvl(ffm.awb_no,ddt.awb_no) and AWB_DATE = nvl(ffm.awb_Date,to_date(ddt.awb_Date,'DDMONYY'))
                        and (SHP_TRF_TYPE = 'QT' OR (SHP_TRF_TYPE = 'IF' and ddt.ULD_KEY is null))),0) 
                        != nvl((select sum(PMAN_PCS) from EXP_PMANIFEST_AWB where  AWB_NO = nvl(ffm.awb_no,ddt.awb_no) 
                        					and AWB_DATE = nvl(ffm.awb_Date,to_date(ddt.awb_Date,'DDMONYY'))),0))  
              then 'Y' else 'N' end) as manPman,
 nvl(ffm.flt_key,ddt.flt_key) fltKey , TO_CHAR(nvl(ffm.flt_Date,ddt.flt_Date),'DDMONYY')  fltDate,
  ddt.TR_NO ddtTrNo, ddt.SDOC_LINE_NO ddtSdocLineNo, ddt.UDOC_LINE_NO ddtUdocLineNo, ddt.DOC_LINE_NO ddtDocLineNo,
 ddt.SHP_CNTG_FLT_KEY cntgFltKey, ddt.SHP_CNTG_FLT_DATE cntgFltDate,
	ddt.SHP_CNTG_FLT_KEY oldCntgFltKey, ddt.SHP_CNTG_FLT_DATE oldCntgFltDate,
  decode(ddt.SHP_CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY)) cntgFltCarr, REPLACE(ddt.SHP_CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY), '') cntgFltNo,
  decode(ddt.SHP_CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY)) oldCntgFltCarr, REPLACE(ddt.SHP_CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY), '') oldCntgFltNo,
 ddt.SHP_TRF_TYPE trfType, ddt.SHP_BRK_BULK brkBulk, ddt.SHP_UNLDG_PT shpUnldgPt, 
  ddt.SHP_TRF_TYPE oldTrfType, ddt.SHP_BRK_BULK oldBrkBulk, ddt.SHP_UNLDG_PT oldShpUnldgPt, 
  ddt.SHP_TRF_PC trfPcs, ddt.SHP_TRF_WT trfWt,
	ddt.SHP_TRF_PC oldTrfPcs, ddt.SHP_TRF_WT oldTrfWt, 
  (select eic_UNLDG_PT from ULD_INVENTORY where ULD_KEY = ffm.ULD_KEY) unldgPt,
  '' as proposeTrfType, '' etaChangedHrs, 
      case when (select count(1) from imp_uld_list where FLT_KEY = ffm.flt_key and ffm.flt_Date = FLT_DATE
              and ULD_KEY = ffm.ULD_KEY and HANDLING_MODE in ('NBK','PPK')) > 0 then 'Y' 
               else '' end as noBreak, 
              ddt.Acton_code_1 actionOne, ddt.Acton_code_2 actionTwo , 'Y' spiltChkNotReqd,
               (select bulkPcs ||'/'||  bulkWt from 
               	  (select FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE, sum(bulkPcs) bulkPcs,  sum(bulkWt) bulkWt from 
                   (select FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE, NVL(SUM(MIX_PCS)+SUM(PPK_PCS)+SUM(ASSIGNED_BULK_PCS),0) bulkPcs, NVL(SUM(MIX_WT)+SUM(PPK_WT)+SUM(ASSIGNED_BULK_WT),0) bulkWt
                      from EXP_PMANIFEST_AWB 
                            where MIX_PCS <> 0 OR PPK_PCS <> 0 OR ASSIGNED_BULK_PCS <> 0 OR  MIX_WT <> 0 OR PPK_WT <> 0 OR ASSIGNED_BULK_WT <> 0
                            group by FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE
                    union
                    select FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE,  NVL(SUM(BULK_PCS)+SUM(PPK_PCS),0) bulkPcs,  NVL(SUM(BULK_WT)+SUM(PPK_WT),0) bulkWt
                      from EXP_PMAN_TARMAC_AWB 
                            where BULK_PCS <> 0 OR PPK_PCS <> 0 OR  BULK_WT <> 0 OR PPK_WT <> 0 
                              group by FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE
                  ) a  group by FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE ) buPcWt
                where FLT_KEY = ddt.SHP_CNTG_FLT_KEY  and FLT_DATE = ddt.SHP_CNTG_FLT_DATE 
                and AWB_NO = NVL(FFM.AWB_NO,DDT.AWB_NO) and AWB_DATE = NVL(FFM.AWB_DATE,TO_DATE(DDT.AWB_DATE,'DDMONYY'))
                ) buPcWt,
PKG_COMMON.get_flt_eta(ddt.SHP_CNTG_FLT_KEY, ddt.SHP_CNTG_FLT_DATE, 'D', 'DD')  as etd, 
                        PKG_COMMON.get_flt_sta(ddt.SHP_CNTG_FLT_KEY, ddt.SHP_CNTG_FLT_DATE, 'D', 'DD')  as std,
FUN_GET_FLT_TDIFF_TRFYPE(ddt.SHP_CNTG_FLT_KEY,ddt.SHP_CNTG_FLT_DATE,nvl(ffm.flt_key,ddt.flt_key),nvl(ffm.flt_date,ddt.flt_date),'TIME_DIFF' ) timeDiifferance,
ddt.qt_bu qtBu,
(select bu_inst from EXP_BU_JO hd, EXP_BU_JO_DTL dtl 
		where hd.jo_no = dtl.jo_no and hd.flt_key =  ddt.shp_cntg_flt_key and hd.flt_date = ddt.shp_cntg_flt_date 
		and dtl.awb_NO = NVL(ffm.awb_No,ddt.awb_No) and dtl.awb_Date = NVL(ffm.awb_Date,ddt.awb_Date) and rownum = 1 ) as buildInstr               
from
(select  
ffmshp.awb_no awb_no, ffmshp.awb_Date awb_Date, ffmshp.ORG ORG, ffmshp.DEST DEST, nvl(ffmshp.MAN_PCS,0) PCS,
nvl(ffmshp.MAN_WT,0) WT, ffmMSG.flt_key flt_key , ffmMSG.flt_Date flt_Date, ffmULD.ULD_KEY ULD_KEY, ffmMSG.TR_No tr_NO 
    from EDI_FFM_MSG ffmMSG, EDI_FFM_ULD ffmULD , edi_ffm_shp ffmshp 
    where ffmMSG.FFM_STATUS = 'P' and ffmshp.dest != 'HKG' 
    and ffmMSG.TR_NO = ffmULD.TR_NO and ffmMSG.TR_NO = ffmshp.TR_NO and ffmULD.Doc_line_no = ffmshp.uDoc_line_no 
    ) ffm 
FULL OUTER join  (select ddtView.awb_no awb_no, to_char(ddtView.awb_DATE,'DDMONYY') awb_DATE, ddtView.flt_key flt_key , 
                      to_char(ddtView.flt_Date,'DDMONYY') flt_Date, 
                	ddtView.TR_NO TR_NO, ddtView.sdoc_line_no Sdoc_line_no, ddtView.uDOC_LINE_NO UDOC_LINE_NO, ddtView.DOC_LINE_NO DOC_LINE_NO,
                	ddtView.ULD_KEY ULD_KEY , ddtView.SHP_CNTG_FLT_KEY SHP_CNTG_FLT_KEY, to_char(ddtView.SHP_CNTG_FLT_DATE,'DDMONYY') SHP_CNTG_FLT_DATE, 
                  	ddtView.SHP_TRF_TYPE SHP_TRF_TYPE,  ddtView.SHP_BRK_BULK SHP_BRK_BULK, to_char(ddtView.BASELINE_ETA,'DDMONYY') BASELINE_ETA,
                  	NVL( (TO_CHAR(TO_DATE(to_char(ddtView.BASELINE_ETA,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
                   			TO_DATE(TO_CHAR(FLT.SCH_DATE,'DDMONYY')|| ' ' || 
                   			TO_CHAR(NVL(FLT.EST_TIME,  FLT.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24  , 0 ) as etaChangedHrs,
                    ddtView.Acton_code_1 Acton_code_1, ddtView.Acton_code_2 Acton_code_2, ddtView.UNLDG_PT , ddtView.SHP_UNLDG_PT,
                    ddtView.SHP_TRF_PC , ddtView.SHP_TRF_WT, ddtView.qt_BU
                  from V_UNFIN_DDT_DTL ddtView
              		join FLT_OPR FLT on FLT.FLT_KEY = ddtView.FLT_KEY and FLT.SCH_DATE = ddtView.FLT_DATE and FLT_type = 'A') ddt 
  				on ddt.flt_key = ffm.flt_key and  ddt.flt_Date =  ffm.flt_Date and nvl(ddt.ULD_KEY, '*') =  nvl(ffm.ULD_KEY, '*') AND DDT.AWB_NO = FFM.AWB_NO
 left join awb on awb.awb_NO = NVL(ffm.awb_No,ddt.awb_No) and awb.awb_Date = NVL(ffm.awb_Date,ddt.awb_Date)
  where ((ffm.flt_key = #fltKey# and ffm.flt_Date = #fltDate# ) 
  		OR (ddt.flt_key = #fltKey# and ddt.flt_Date = #fltDate# ))
  		and nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK') = #uldKey#  
  		and nvl(ffm.awb_no,ddt.awb_no) = #awbNo# and nvl(ffm.awb_Date,ddt.awb_Date) = #awbDate#
   ]]>
   ) a where 1=1 
    	<isNotEmpty property="expFltKey">
       	 	<isNotEmpty property="expFltDate">
       	  		and cntgFltKey = #expFltKey# and cntgFltDate = #expFltDate#
    	  	</isNotEmpty>
     	 </isNotEmpty>
   ORDER BY  timeDiifferance,  awbNo , awbDate
</select>
<select id="viewTruckManfWorkSheet" parameterClass="cargo.cms.imprt.report.bo.TruckManfFinalReptBo725"
    	 resultClass="cargo.cms.imprt.report.bo.TruckManfFinalReptBo725">
    	 SELECT 
			B.CODE_DESC as agent, B.CODE as agentCode, (TO_CHAR(A.SCH_COLL_DATE, 'DDMONYY') || ' ' || 
			SUBSTR(LPAD(A.SCH_COLL_FROM, 4, 0), 1, 2) || ':' || SUBSTR(LPAD(A.SCH_COLL_FROM, 4, 0), 3, 4) || '-' || SUBSTR(LPAD(A.SCH_COLL_TO, 4, 0), 1, 2) 
			|| ':' || SUBSTR(LPAD(A.SCH_COLL_TO, 4, 0), 3, 4)) as timeSlot, A.TRUCK_MANF_NO as truckManifestNo 
		FROM 
			TRUCK_MANIFEST A, CUST_COMPANY B 
		WHERE 
			B.CODE=A.AGENT_CODE  AND A.FINAL_TRUCK_MANF_IND='N' AND A.FINAL_TRUCK_MANF_NO IS NULL 
				and exists (select dtl.TRUCK_MANF_NO from TRUCK_MANIFEST_DTL dtl, TRUCK_MANIFEST_INVENTORY_INFO inv 
                              where  dtl.TRUCK_MANF_NO = inv.TRUCK_MANF_NO and  dtl.doc_line_no = inv.doc_line_no and dtl.TRUCK_MANF_NO = A.TRUCK_MANF_NO
			and B.CODE in (select regexp_substr(#agentLst#,'[^,]+', 1, level) from dual connect by regexp_substr(#agentLst#, '[^,]+', 1, level) is not null) 
             <isNotEmpty property="location">
				AND LOCN_TYPE = #location#
			</isNotEmpty>) 
			<isNotEmpty property="agent">
				AND B.CODE_DESC=#agent# 
			</isNotEmpty>
			<isNotEmpty property="agentCode">
				AND A.AGENT_CODE=#agentCode# 
			</isNotEmpty>
			<isNotEmpty property="schCollDate">
				<isNotEmpty property="schCollFrmHrs">
					<isNotEmpty property="schCollFrmMin">
						<isNotEmpty property="schCollToHrs">
							<isNotEmpty property="schCollToMin">
					and (to_date(to_char(A.SCH_COLL_DATE,'DDMONYY') ||' ' || to_char(A.SCH_COLL_FROM, '0000'), 'DDMONYY HH24MI')
          				between to_date(#schCollDate#  ||' ' || #schCollFrmHrs#||#schCollFrmMin#, 'DDMONYY HH24MI') 
          						and to_date(#schCollDate# ||' ' || #schCollToHrs#||#schCollToMin#, 'DDMONYY HH24MI')
     				OR      
    				to_date(to_char(A.SCH_COLL_DATE,'DDMONYY') ||' ' || to_char(A.SCH_COLL_TO, '0000'), 'DDMONYY HH24MI')
          				between to_date(#schCollDate# ||' ' || #schCollFrmHrs#||#schCollFrmMin#, 'DDMONYY HH24MI') 
          						and to_date(#schCollDate# ||' ' || #schCollToHrs#||#schCollToMin#, 'DDMONYY HH24MI')) 
							</isNotEmpty>
						</isNotEmpty>
					</isNotEmpty>
				</isNotEmpty>
			</isNotEmpty>
			<isNotEmpty property="trkMnfstFromDate">
				<isNotEmpty property="trkMnfstFromHrs">
					<isNotEmpty property="trkMnfstFromMin">
						<isNotEmpty property="trkMnfstToDate">
							<isNotEmpty property="trkMnfstToHrs">
								<isNotEmpty property="trkMnfstToMin">
					and A.CR_DATE between 
							to_date(#trkMnfstFromDate#||' '||#trkMnfstFromHrs#||#trkMnfstFromMin#, 'DDMONYY HH24MI') 
							and to_date(#trkMnfstToDate#||' '||#trkMnfstToHrs#||#trkMnfstToMin#, 'DDMONYY HH24MI')
								</isNotEmpty>
							</isNotEmpty>
						</isNotEmpty>
					</isNotEmpty>
				</isNotEmpty>
			</isNotEmpty>
			<isNotEmpty property="truckManifestNo">
				AND A.TRUCK_MANF_NO=#truckManifestNo# 
			</isNotEmpty>
			<isNotEmpty property="awbNo">
				AND A.TRUCK_MANF_NO IN (SELECT TRUCK_MANF_NO FROM TRUCK_MANIFEST_DTL WHERE AWB_NO=#awbNo#) 
			</isNotEmpty>
			AND  to_date(to_char(A.SCH_COLL_DATE,'DDMONYY')||' '||LPAD(A.SCH_COLL_TO, 4, 0),'DDMONYY HH24MI') > sysdate
</select>
<select id="viewTruckManfWorkSheet1" parameterClass="cargo.cms.imprt.report.bo.TruckManfFinalReptBo725"
    	 resultClass="cargo.cms.imprt.report.bo.TruckManfFinalReptBo725">
       SELECT 
			A.TRUCK_MANF_NO as truckManifestNo, A.AWB_NO as awbNo, TO_CHAR(A.AWB_DATE, 'DDMONYY') as awbDate, C.CC_CODE as cc,  
			TO_CHAR(A.CR_DATE, 'DDMONYY HH24:MI') as crDate,A.doc_line_no docLineNo,(SELECT CODE FROM 
 			IMP_CAR_AWB e, MAST_SPL_HAND_CODE f 
		WHERE 
			(f.CODE=e.SPL_CODE1 OR f.CODE=e.SPL_CODE2 OR f.CODE=e.SPL_CODE3 OR f.CODE=e.SPL_CODE4 OR f.CODE=e.SPL_CODE5 OR f.CODE=e.SPL_CODE6 OR 
			f.CODE=e.SPL_CODE7 OR f.CODE=e.SPL_CODE8 OR f.CODE=e.SPL_CODE9) AND e.AWB_NO=A.AWB_NO AND e.AWB_DATE=TO_char(A.AWB_DATE, 'DDMONYY') and rownum=1 ) shc
		FROM 
			TRUCK_MANIFEST_DTL A LEFT JOIN V_CST_IMP_CC_CODE_AWB C ON C.FLT_KEY=A.FLT_KEY AND C.FLT_DATE=A.FLT_DATE AND C.AWB_NO=A.AWB_NO 
		WHERE 
			A.TRUCK_MANF_NO=#truckManifestNo#
			and A.doc_line_no in (select regexp_substr(#docLineNo#,'[^,]+', 1, level) from dual connect by regexp_substr(#docLineNo#, '[^,]+', 1, level) is not null)
			and exists (select inv.TRUCK_MANF_NO from TRUCK_MANIFEST_INVENTORY_INFO inv 
	                         where  A.TRUCK_MANF_NO = inv.TRUCK_MANF_NO and  A.doc_line_no = inv.doc_line_no 
				             <isNotEmpty property="location">
								AND inv.LOCN_TYPE = #location#
							</isNotEmpty>)	 
</select>
<select id="viewTruckManfWorkSheet2" parameterClass="cargo.cms.imprt.report.bo.TruckManfFinalReptBo725"
    	 resultClass="cargo.cms.imprt.report.bo.TruckManfFinalReptBo725">
    	   SELECT 
  			A.TRUCK_MANF_NO as truckManifestNo,
        A.doc_line_no docLineNo,
        NVL(A.LOC_CODE,nvl(l.loc_code,u.loc_code)) as location,
        NVL(A.LSP_NO, A.ULD_KEY) as device, 
        decode(A.PCS,null,'',(A.PCS||'/'|| A.WT)) as pcWt, 
        decode(A.FLT_KEY,null,TO_CHAR(A.FLT_DATE, 'DDMONYY'),A.FLT_KEY||'/'||(TO_CHAR(A.FLT_DATE, 'DDMONYY'))) as flightNoDate,
        A.TRUCK_DOCK truckDock
		FROM 
  			TRUCK_MANIFEST_INVENTORY_INFO  A
  			left join lsp_inventory l on  l.lsp_no = a.lsp_no
  			left join uld_inventory u on  u.uld_key = a.uld_key  
	WHERE 
  			A.TRUCK_MANF_NO=#truckManifestNo# 
  			AND A.doc_line_no = #docLineNo# 
			<isNotEmpty property="location">
				AND A.LOCN_TYPE = #location#
			</isNotEmpty>
</select>
<select id="viewTruckManfTruckManfNoList" parameterClass="cargo.cms.imprt.report.bo.TruckManfFinalReptBo725"
    	 resultClass="cargo.cms.imprt.report.bo.TruckManfFinalReptBo725">
    	 SELECT 
			B.CODE_DESC as agent, B.CODE as agentCode, (TO_CHAR(A.SCH_COLL_DATE, 'DDMONYY') || ' ' || 
			SUBSTR(LPAD(A.SCH_COLL_FROM, 4, 0), 1, 2) || ':' || SUBSTR(LPAD(A.SCH_COLL_FROM, 4, 0), 3, 4) || '-' || SUBSTR(LPAD(A.SCH_COLL_TO, 4, 0), 1, 2) 
			|| ':' || SUBSTR(LPAD(A.SCH_COLL_TO, 4, 0), 3, 4)) as timeSlot,A.FINAL_TRUCK_MANF_NO as truckManifestNo 
		FROM 
			TRUCK_MANIFEST A, CUST_COMPANY B 
		WHERE 
			B.CODE=A.AGENT_CODE AND A.FINAL_TRUCK_MANF_IND='N' AND A.FINAL_TRUCK_MANF_NO IS NOT NULL 
				and exists (select dtl.TRUCK_MANF_NO from TRUCK_MANIFEST_DTL dtl, TRUCK_MANIFEST_INVENTORY_INFO inv 
                              where  dtl.TRUCK_MANF_NO = inv.TRUCK_MANF_NO and  dtl.doc_line_no = inv.doc_line_no and dtl.TRUCK_MANF_NO = A.TRUCK_MANF_NO 
             <isNotEmpty property="location">
				AND LOCN_TYPE = #location#
			</isNotEmpty>) 
			<isNotEmpty property="agent">
				AND B.CODE_DESC=#agent# 
			</isNotEmpty>
			<isNotEmpty property="agentCode">
				AND A.AGENT_CODE=#agentCode# 
			</isNotEmpty>
			<isNotEmpty property="schCollDate">
				<isNotEmpty property="schCollFrmHrs">
					<isNotEmpty property="schCollFrmMin">
						<isNotEmpty property="schCollToHrs">
							<isNotEmpty property="schCollToMin">
					and (to_date(to_char(A.SCH_COLL_DATE,'DDMONYY') ||' ' || to_char(A.SCH_COLL_FROM, '0000'), 'DDMONYY HH24MI')
          				between to_date(#schCollDate#  ||' ' || #schCollFrmHrs#||#schCollFrmMin#, 'DDMONYY HH24MI') 
          						and to_date(#schCollDate# ||' ' || #schCollToHrs#||#schCollToMin#, 'DDMONYY HH24MI')
     				OR      
    				to_date(to_char(A.SCH_COLL_DATE,'DDMONYY') ||' ' || to_char(A.SCH_COLL_TO, '0000'), 'DDMONYY HH24MI')
          				between to_date(#schCollDate# ||' ' || #schCollFrmHrs#||#schCollFrmMin#, 'DDMONYY HH24MI') 
          						and to_date(#schCollDate# ||' ' || #schCollToHrs#||#schCollToMin#, 'DDMONYY HH24MI')) 
							</isNotEmpty>
						</isNotEmpty>
					</isNotEmpty>
				</isNotEmpty>
			</isNotEmpty>
			<isNotEmpty property="trkMnfstFromDate">
				<isNotEmpty property="trkMnfstFromHrs">
					<isNotEmpty property="trkMnfstFromMin">
						<isNotEmpty property="trkMnfstToDate">
							<isNotEmpty property="trkMnfstToHrs">
								<isNotEmpty property="trkMnfstToMin">
					and A.CR_DATE between 
							to_date(#trkMnfstFromDate#||' '||#trkMnfstFromHrs#||#trkMnfstFromMin#, 'DDMONYY HH24MI') 
							and to_date(#trkMnfstToDate#||' '||#trkMnfstToHrs#||#trkMnfstToMin#, 'DDMONYY HH24MI')
								</isNotEmpty>
							</isNotEmpty>
						</isNotEmpty>
					</isNotEmpty>
				</isNotEmpty>
			</isNotEmpty>
			<isNotEmpty property="truckManifestNo">
				AND A.TRUCK_MANF_NO=#truckManifestNo# 
			</isNotEmpty>
			<isNotEmpty property="awbNo">
				AND A.TRUCK_MANF_NO IN (SELECT TRUCK_MANF_NO FROM TRUCK_MANIFEST_DTL WHERE AWB_NO=#awbNo#) 
			</isNotEmpty>
			AND  to_date(to_char(A.SCH_COLL_DATE,'DDMONYY')||' '||LPAD(A.SCH_COLL_TO, 4, 0),'DDMONYY HH24MI') > sysdate
</select>
<select id="viewTruckManfFinalSample" parameterClass="cargo.cms.imprt.report.bo.TruckManfFinalReptBo725"
    	 resultClass="cargo.cms.imprt.report.bo.TruckManfFinalReptBo725">
    	      SELECT 
  			A.TRUCK_MANF_NO as truckManifestNo, B.doc_line_no docLineNo,  TO_CHAR(B.CR_DATE, 'DDMONYY HH24:MI') as crDate, B.AWB_NO as awbNo, TO_CHAR(B.AWB_DATE, 'DDMONYY') as awbDate, e.CC_CODE as cc, 
  			SUBSTR(TRIM(B.AWB_NO),1,3)||'-'||SUBSTR(TRIM(B.AWB_NO),4) as awbNoDisplay, (SELECT CODE FROM IMP_CAR_AWB c, MAST_SPL_HAND_CODE d WHERE 
			(d.CODE=c.SPL_CODE1 OR d.CODE=c.SPL_CODE2 OR d.CODE=c.SPL_CODE3 OR d.CODE=c.SPL_CODE4 OR d.CODE=c.SPL_CODE5 OR d.CODE=c.SPL_CODE6 OR 
			d.CODE=c.SPL_CODE7 OR d.CODE=c.SPL_CODE8 OR d.CODE=c.SPL_CODE9) AND c.AWB_NO= B.AWB_NO AND c.AWB_DATE=TO_CHAR(B.AWB_DATE, 'DDMONYY') and rownum=1) shc
		FROM 
  			TRUCK_MANIFEST A, TRUCK_MANIFEST_DTL B LEFT JOIN V_CST_IMP_CC_CODE_AWB e ON e.FLT_KEY=B.FLT_KEY AND e.FLT_DATE=B.FLT_DATE AND e.AWB_NO=B.AWB_NO 
		WHERE 
  			B.TRUCK_MANF_NO=A.TRUCK_MANF_NO AND A.TRUCK_MANF_NO=#truckManifestNo# 
  			and not exists ( SELECT hd.TRUCK_MANF_NO FROM TRUCK_MANIFEST hd,
							TRUCK_MANIFEST_DTL dtl WHERE
							dtl.TRUCK_MANF_NO=hd.TRUCK_MANF_NO AND hd.TRUCK_MANF_NO= A.FINAL_TRUCK_MANF_NO
							and dtl.AWB_NO = b.AWB_NO and dtl.AWB_date = b.AWB_date )
</select>
<select id="viewTruckManfFinalSample2" parameterClass="cargo.cms.imprt.report.bo.TruckManfFinalReptBo725"
    	 resultClass="cargo.cms.imprt.report.bo.TruckManfFinalReptBo725">
 SELECT 
			LOC_CODE as location, NVL(LSP_NO, ULD_KEY) as device, 
			decode(PCS,null,'',PCS||'/'||WT) as pcWt, nvl(PCS,0) as pcs, nvl(WT,0) as wt,
			decode(FLT_KEY,null,TO_CHAR(FLT_DATE, 'DDMONYY'),FLT_KEY||'/'||(TO_CHAR(FLT_DATE, 'DDMONYY'))) as flightNoDate 
		FROM 
			TRUCK_MANIFEST_INVENTORY_INFO 
		WHERE truck_manf_no = #truckManifestNo# and doc_line_no=#docLineNo#
			<!-- AWB_NO=#awbNo# AND AWB_DATE=TO_DATE(#awbDate#, 'DDMONYY') -->

</select>
<select id="viewCustomClearance727" parameterClass="cargo.cms.imprt.report.bo.CustomClearanceReptBo727" resultClass="cargo.cms.imprt.report.bo.CustomClearanceReptBo727">
	SELECT * FROM 
		( SELECT 
  			A.AWB_NO as awbNo, SUBSTR(TRIM(A.AWB_NO),1,3)||'-'||SUBSTR(TRIM(A.AWB_NO),4) AS awbNoDisplay, TO_CHAR(A.AWB_DATE, 'DDMONYY') as awbDate, 
  			A.FLT_KEY as fltNo, TO_CHAR(A.FLT_DATE, 'DDMONYY') as arrDate, V.HAWB_NO as hawbNo,FH.MANIFEST_DESC hawbContent, E.APPNTD_AGENT as agtName, A.MANIFEST_PCS as manfPcs, 
  			A.MANIFEST_WT as manfWt, F.DOC_REQ as docReqYN, F.DOC_RCV as docRecvYN, D.CC_CATEGORY as ccCategory, V.CC_CODE as ccCode, 
  			E.ALLOW_PACCO as paccoYN, F.RTRV_JO as rtrvJoYN, F.PHY_ACTION_STATUS as status, (A.FLT_KEY || '/' || 
  			TO_CHAR(A.FLT_DATE, 'DDMONYY')) as fltNoDtDisplay, (SELECT SUM(LOCN_PCS) FROM AWB_INVENTORY WHERE AWB_NO=A.AWB_NO AND AWB_DATE=A.AWB_DATE 
  			AND FLT_KEY=A.FLT_KEY AND FLT_DATE=A.FLT_DATE) as invPcs, (SELECT SUM(LOCN_WT) FROM AWB_INVENTORY WHERE AWB_NO=A.AWB_NO AND AWB_DATE=A.AWB_DATE 
  			AND FLT_KEY=A.FLT_KEY AND FLT_DATE=A.FLT_DATE) as invWt, (SELECT B1.TRUCK_DOCK FROM IMP_TRUCK_SRF A1, TRUCK_TRIP B1 WHERE B1.TRIP_ID=A1.TRIP_ID AND 
        A1.SRF_NO=(SELECT SRF.SRF_NO FROM IMP_SRF SRF,IMP_SRF_FLT SFLT WHERE SRF.AWB_NO=A.AWB_NO AND SRF.AWB_DATE=A.AWB_DATE AND SRF.SRF_NO=SFLT.SRF_NO
        AND SFLT.FLT_KEY=A.FLT_KEY AND SFLT.FLT_DATE=A.FLT_DATE AND SRF.STATUS='ISSUED' AND SRF.SRF_EXPY_DATE>=SYSDATE)) AS truckDock ,
        (case when D.CC_CATEGORY IN ('Phy', 'Phy + Doc') and D.IMM_CHK_IND = 'Y' then 'CI' else
         	 case when V.CC_CODE ='TB' then 'TB' else
         	 case when J.AWB_NO IS NOT NULL then 'BKG' else
         	 case when (E.ALLOW_PACCO='Y' AND D.constraint='Y') then 'PACCO' else 
           case when D.constraint='Y' then 'OTHERS' end end end end end) condColumn
		FROM 
  			IMP_CAR_SHP A
        JOIN AWB AWB ON AWB.AWB_NO=A.AWB_NO AND AWB.AWB_DATE=A.AWB_DATE 
        JOIN IMP_CAR_AWB E ON E.AWB_NO=A.AWB_NO AND E.AWB_DATE=A.AWB_DATE 
        JOIN FLT_OPR C ON C.FLT_KEY=A.FLT_KEY AND C.SCH_DATE=A.FLT_DATE AND C.FLT_TYPE='A'
        LEFT JOIN (SELECT SUM(LOCN_PCS) LOCN_PCS, AWB_NO,FLT_KEY,AWB_DATE,FLT_DATE FROM AWB_INVENTORY AW_INGROUP GROUP BY AWB_NO, FLT_KEY, 
      			AWB_DATE, FLT_DATE) AWB_INV ON AWB_INV.AWB_NO=A.AWB_NO AND  AWB_INV.AWB_DATE=A.AWB_DATE AND AWB_INV.FLT_KEY=A.FLT_KEY AND  AWB_INV.FLT_DATE=A.FLT_DATE
        LEFT JOIN V_CST_IMP_CC_CODE V ON V.AWB_NO = A.AWB_NO AND V.FLT_KEY=A.FLT_KEY AND V.FLT_DATE=A.FLT_DATE
        LEFT JOIN (SELECT FHAWB.HAWB_PCS,FHAWB.HAWB_NET_WT,FHL.AWB_NO,FHL.AWB_DATE,FHAWB.HAWB_NO,FHAWB.MANIFEST_DESC
        FROM EDI_FHL FHL,EDI_FHL_HAWB FHAWB WHERE FHL.TR_NO=FHAWB.TR_NO) FH ON FH.HAWB_NO = V.HAWB_NO AND FH.AWB_NO = A.AWB_NO AND FH.AWB_DATE = A.AWB_DATE
        LEFT JOIN MAST_CONSTRAINT_CODE D ON D.CODE=V.CC_CODE  
        LEFT JOIN IMP_CUST_CLR_LIST F ON F.AWB_NO=A.AWB_NO AND F.AWB_DATE=A.AWB_DATE AND F.FLT_KEY=A.FLT_KEY AND F.FLT_DATE=A.FLT_DATE AND F.HAWB_NO = V.HAWB_NO
        LEFT JOIN (SELECT B2.AWB_NO, B2.AWB_DATE, B2.FLT_KEY, B2.FLT_DATE FROM IMP_BOOKING A2, IMP_BOOKING_DTL B2 
            WHERE A2.BOOKING_NO=B2.BOOKING_NO AND TO_DATE((TO_CHAR(A2.BKG_SLOT_DATE, 'DDMONYY') 
				  || ' ' || TO_CHAR(A2.BKG_SLOT_TO, '0000')), 'DDMONYY HH24MI') > SYSDATE) J 
            	  ON A.AWB_NO=J.AWB_NO AND A.AWB_DATE=J.AWB_DATE AND J.FLT_KEY=A.FLT_KEY AND J.FLT_DATE=A.FLT_DATE
        	WHERE AWB.AWB_CLOSED_YN='N'   AND NOT(A.RECD_PCS>0 AND AWB_INV.LOCN_PCS=0)
  			<isNotEmpty property="carrCode">
  				<isNotEmpty prepend="AND" property="fltNo">
  				A.FLT_KEY=#carrCode# || #fltNo#
  				</isNotEmpty>
  			</isNotEmpty>
  			<isNotEmpty prepend="AND" property="searchAgtName">
  				E.APPNTD_AGENT=#searchAgtName# 
  			</isNotEmpty>
  			<isNotEmpty prepend="AND" property="searchAgtCode">
  				E.AGENT_CUST_NO=#searchAgtCode# 
  			</isNotEmpty>
  			<isNotEmpty prepend="AND" property="arrDate">
  				A.FLT_DATE=TO_DATE(#arrDate#, 'DDMONYY')
  			</isNotEmpty>
  			<isNotEmpty property="awbPrefix">
  				<isNotEmpty prepend="AND" property="awbSuffix">
  				A.AWB_NO=#awbPrefix# || #awbSuffix#
  				</isNotEmpty>
  			</isNotEmpty>
  			<isNotEmpty prepend="AND" property="ataFromHr">
				<isNotEmpty property="ataFromMin">
					<isNotEmpty property="ataToHr">
						<isNotEmpty property="ataToMin">
							C.SCH_TIME BETWEEN #ataFromHr# || #ataFromMin# AND #ataToHr# || #ataToMin#
						</isNotEmpty>
					</isNotEmpty>
				</isNotEmpty>
			</isNotEmpty>
			) WHERE condColumn IS NOT NULL 
			<isNotEmpty prepend="AND" property="srvcType">
					condColumn = #srvcType#
			</isNotEmpty>
			
  			<dynamic prepend="ORDER BY ">
  			<isNotEmpty property="sortOrder.sortField">
            	$sortOrder.sortField$
           	</isNotEmpty>
           	<isEmpty property="sortOrder.sortField">
            	awbNo 
           	</isEmpty>
           	</dynamic>
	</select>
<!-- CROSS TERMINAL HO FORM :: CROSS TERMINAL TRANSFER :: END -->

<!-- Added by yugandhar for IF ULD shipment.. -->
<select id="IFULDShipment_ConnFlt_723I" parameterClass="cargo.cms.imprt.report.bo.IFUldShpmReptBO" resultClass="java.lang.String">
		 select stragg(STRINGDELIM((CNTG_FLT_KEY || '/' ||CNTG_FLT_DATE),',')) from(
		 select 
		    ddt.CNTG_FLT_KEY ,ddt.CNTG_FLT_DATE
		from
		(select  
		FFMSHP.AWB_NO AWB_NO, FFMSHP.AWB_DATE AWB_DATE, FFMSHP.ORG ORG, FFMSHP.DEST DEST, NVL(FFMSHP.MAN_PCS,0) PCS,
		NVL(FFMSHP.MAN_WT,0) WT, FFMMSG.FLT_KEY FLT_KEY , FFMMSG.FLT_DATE FLT_DATE, FFMULD.ULD_KEY ULD_KEY, FFMMSG.TR_NO TR_NO,
		
		ffmULD.CNTG_FLT_CARR1 ||ffmULD.CNTG_FLT_NO1 CNTG_FLT_KEY,ffmULD.CNTG_FLT_DATE1 CNTG_FLT_DATE
		    from EDI_FFM_MSG ffmMSG, EDI_FFM_ULD ffmULD , edi_ffm_shp ffmshp 
		    where FFMMSG.FFM_STATUS = 'P' and FFMSHP.DEST != 'HKG' 
		    and ffmMSG.TR_NO = ffmULD.TR_NO and ffmMSG.TR_NO = ffmshp.TR_NO and ffmULD.Doc_line_no = ffmshp.uDoc_line_no 
		    ) ffm 
		join  (select ddtView.awb_no awb_no, to_char(ddtView.awb_DATE,'DDMONYY') awb_DATE, ddtView.flt_key flt_key , 
		                      to_char(ddtView.flt_Date,'DDMONYY') flt_Date, 
		                	ddtView.TR_NO TR_NO, ddtView.sdoc_line_no Sdoc_line_no, ddtView.uDOC_LINE_NO UDOC_LINE_NO, ddtView.DOC_LINE_NO DOC_LINE_NO,
		                	ddtView.ULD_KEY ULD_KEY , ddtView.SHP_CNTG_FLT_KEY CNTG_FLT_KEY, to_char(ddtView.SHP_CNTG_FLT_DATE,'DDMONYY') CNTG_FLT_DATE, 
		                  	ddtView.TRF_TYPE TRF_TYPE,  ddtView.BRK_BULK BRK_BULK, to_char(ddtView.BASELINE_ETA,'DDMONYY') BASELINE_ETA,
		                  	NVL( (TO_CHAR(TO_DATE(to_char(ddtView.BASELINE_ETA,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
		                   			TO_DATE(TO_CHAR(FLT.SCH_DATE,'DDMONYY')|| ' ' || 
		                   			TO_CHAR(NVL(FLT.EST_TIME,  FLT.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24  , 0 ) as etaChangedHrs,
		                        NVL( (TO_CHAR(TO_DATE(to_char(ddtView.BASELINE_ETA,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
		                   			TO_DATE(TO_CHAR(FLT.SCH_DATE,'DDMONYY')|| ' ' || 
		                   			TO_CHAR(NVL(FLT.EST_TIME,  FLT.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24 * 60 , 0 ) as etaChangedMin,
		                    ddtView.Acton_code_1 Acton_code_1, ddtView.Acton_code_2 Acton_code_2, ddtView.UNLDG_PT , ddtView.SHP_UNLDG_PT,
		                    ddtView.SHP_TRF_PC , ddtView.SHP_TRF_WT
		                  from V_UNFIN_DDT_DTL ddtView
		              		join FLT_OPR FLT on FLT.FLT_KEY = ddtView.FLT_KEY and FLT.SCH_DATE = ddtView.FLT_DATE and FLT_type = 'A') ddt 
		  				on DDT.FLT_KEY = FFM.FLT_KEY and  DDT.FLT_DATE =  FFM.FLT_DATE and nvl(DDT.ULD_KEY, '*') =  nvl(FFM.ULD_KEY, '*') and DDT.AWB_NO = FFM.AWB_NO
		 where 
		   ((ffm.flt_key = #fltKey# and ffm.flt_Date = #fltDate# ) 
		 		OR (ddt.flt_key = #fltKey# and ddt.flt_Date = #fltDate# ))
		 		<isNotEmpty property="expFltKey">
				 	<isNotEmpty property="expFltDate">
				  			and  ddt.CNTG_FLT_KEY = #expFltKey# and ddt.CNTG_FLT_DATE = #expFltDate#
					</isNotEmpty>
				</isNotEmpty>
		 		group by ddt.CNTG_FLT_KEY , ddt.CNTG_FLT_DATE )
 </select>
 
 <select id="fetchInBUldList_723I" parameterClass="cargo.cms.imprt.report.bo.IFUldShpmReptBO" resultClass="cargo.cms.imprt.report.bo.IFUldShpmReptBO" >
		<![CDATA[ 
		select a.* from (
		select ddt.awb_no awbNo,
		SUBSTR(TRIM(ddt.awb_no),1,3)||'-'||SUBSTR(TRIM(ddt.awb_no),4) awbNoDisp,
		ddt.awb_Date awbDate, 
		nvl(ddt.ULD_KEY,'BULK')  uldKey,
		NVL(DDT.ULD_KEY,'BULK') ||'-'|| DDT.AWB_NO  uldKeyAwbNo,
		ULDFFM.PCS ttlUldPcs,
		ULDFFM.WT ttlUldWt,
		case when DDT.ULD_KEY is not null then (select LOC_CODE from ULD_INVENTORY where ULD_KEY = DDT.ULD_KEY) else null end as locn,
    	case when (select count(1) from imp_uld_list where FLT_KEY = ffm.flt_key and ffm.flt_Date = FLT_DATE
            and ULD_KEY = ffm.ULD_KEY and HANDLING_MODE in ('NBK','PPK')) > 0 then 'Y' 
             else null end as noBreak, 
		(select WH_RMK from IMP_ULD_LIST where FLT_KEY = DDT.FLT_KEY  and FLT_DATE =DDT.FLT_DATE and ULD_KEY = DDT.ULD_KEY) as uldWhRmk,   
		(select AIRL_RMK from IMP_ULD_LIST where FLT_KEY = DDT.FLT_KEY  and FLT_DATE = DDT.FLT_DATE and ULD_KEY = DDT.ULD_KEY) as uldAirlRmk,     
		(SELECT STRAGG(STRINGDELIM(SHC, ',')) 
			    	FROM (SELECT DISTINCT SHC, ULD_KEY, FLT_KEY,FLT_DATE, AWB_NO, AWB_DATE,PRIORITY FROM V_IMP_FLT_ULD_SHC ORDER BY PRIORITY DESC
			      	) WHERE AWB_NO = NVL(ffm.awb_No,ddt.awb_No) AND AWB_DATE = NVL(ffm.awb_date,ddt.awb_date)
			      	AND FLT_KEY = nvl(ffm.flt_key,ddt.flt_key) AND FLT_DATE = nvl(ffm.flt_Date,ddt.flt_Date)
			      	and nvl(ULD_KEY,'BULK') = nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK')
		                )  shc,
		NVL(AWB.ORIG,'') org, AWB.DEST dest, NVL(AWB.PCS,0) awbPcs,NVL(AWB.WT,0) awbWt, NVL(FFM.PCS,0) PCS,NVL(FFM.WT,0) WT,ffm.shmpt_code shpmCode,
		(select sum(STRG_PCS)||'/'|| sum(STRG_WT) from  IMP_AWB_STRG_DTL 
        where  AWB_NO = DDT.AWB_NO and AWB_DATE = TO_DATE(DDT.AWB_DATE,'DDMONYY')
          and  chkin_ULD_KEY = DDT.ULD_KEY group by AWB_NO,AWB_DATE,chkin_uld_key ) as bdPcWt, 
		(select sum(DAM_PC_DECL)||'/'|| sum(DAM_WT_DECL) from  IMP_AWB_STRG_DTL 
        where  AWB_NO = DDT.AWB_NO and AWB_DATE = TO_DATE(DDT.AWB_DATE,'DDMONYY')
          and chkin_uld_key = ddt.ULD_KEY group by AWB_NO,AWB_DATE,chkin_uld_key ) as damPcWt,   
    	(SELECT V.CC_CODE FROM V_CST_IMP_CC_CODE_AWB V
        WHERE V.FLT_KEY =  DDT.FLT_KEY AND V.FLT_DATE = DDT.FLT_DATE  AND V.AWB_NO = ddt.awb_no
        AND NVL(V.HAWB_NO, '000000000000000000') =  '000000000000000000' AND ROWNUM = 1)  ccode,    
		ddt.flt_key fltKey , ddt.flt_Date  fltDate,
    	DECODE((select count(1) from awb where awb_no = ddt.awb_no and awb_date=ddt.awb_date and rownum=1),0,(select rmk from awb_rmk where awb_no=ddt.awb_no and awb_date=ddt.awb_date  and rownum=1),(select AIRLN_RMK from awb where awb_no = ddt.awb_no and awb_date=ddt.awb_date  and rownum=1)) AS awbAirlRmk,  
		DECODE((select count(1) from imp_car_awb where awb_no =ddt.awb_no and awb_date=ddt.awb_date  and rownum=1),0,(select awb_rmk from awb where awb_no=ddt.awb_no and awb_date=ddt.awb_date  and rownum=1),(select WH_RMK from imp_car_awb where awb_no = ddt.awb_no and awb_date=ddt.awb_date and rownum=1)) AS awbWhRmk,
	    ddt.CNTG_FLT_KEY cntgFltKey, ddt.SHP_CNTG_FLT_DATE cntgFltDate,
		decode(ddt.SHP_CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY)) cntgFltCarr,
		REPLACE(ddt.SHP_CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY), '') cntgFltNo,
		(select decode(FLTOPR.EST_TIME ,null,SUBSTR(TRIM(TO_CHAR(lpad(FLTOPR.SCH_TIME,4,0))),0,2)|| ':'|| SUBSTR(TRIM(TO_CHAR(lpad(FLTOPR.SCH_TIME,4,0))),3,4),SUBSTR(TRIM(TO_CHAR(lpad(FLTOPR.EST_TIME,4,0))),0,2)|| ':'|| SUBSTR(TRIM(TO_CHAR(lpad(FLTOPR.EST_TIME,4,0))),3,4)) 
		   as etd from FLT_OPR FLTOPR WHERE FLTOPR.FLT_KEY = ddt.SHP_CNTG_FLT_KEY and FLTOPR.SCH_DATE = ddt.SHP_CNTG_FLT_DATE  and FLTOPR.flt_type ='D')as etd,
		FUN_GET_FLT_TDIFF_TRFYPE(ddt.SHP_CNTG_FLT_KEY, ddt.SHP_CNTG_FLT_DATE,#fltKey#,#fltDate#,'TIME_DIFF' ) timeDiifferance,
		FUN_GET_FLT_TDIFF_TRFYPE_HH_MI(ddt.SHP_CNTG_FLT_KEY, ddt.SHP_CNTG_FLT_DATE,#fltKey#,#fltDate#,'TIME_DIFF' ) timeDiifferanceHhMi,
      	ddt.SHP_TRF_TYPE trfType, ddt.BRK_BULK brkBulk,
		ddt.UNLDG_PT  uldUnldgPt,
		ddt.SHP_UNLDG_PT shpUnldgPt,
    	ddt.SHP_TRF_PC trfPcs, ddt.SHP_TRF_WT trfWt,
    	(select bulkPcs ||'/'||  bulkWt from 
             	  (select FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE, sum(bulkPcs) bulkPcs,  sum(bulkWt) bulkWt from 
                 (select FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE, NVL(SUM(MIX_PCS)+SUM(PPK_PCS)+SUM(ASSIGNED_BULK_PCS),0) bulkPcs, NVL(SUM(MIX_WT)+SUM(PPK_WT)+SUM(ASSIGNED_BULK_WT),0) bulkWt
                    from EXP_PMANIFEST_AWB 
                          where MIX_PCS <> 0 OR PPK_PCS <> 0 OR ASSIGNED_BULK_PCS <> 0 OR  MIX_WT <> 0 OR PPK_WT <> 0 OR ASSIGNED_BULK_WT <> 0
                          group by FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE
                  union
                  select FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE,  NVL(SUM(BULK_PCS)+SUM(PPK_PCS),0) bulkPcs,  NVL(SUM(BULK_WT)+SUM(PPK_WT),0) bulkWt
                    from EXP_PMAN_TARMAC_AWB 
                          where BULK_PCS <> 0 OR PPK_PCS <> 0 OR  BULK_WT <> 0 OR PPK_WT <> 0 
                            group by FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE
                ) a  group by FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE ) buPcWt
              where FLT_KEY = ddt.SHP_CNTG_FLT_KEY  and FLT_DATE = ddt.SHP_CNTG_FLT_DATE 
              and AWB_NO = NVL(FFM.AWB_NO,DDT.AWB_NO) and AWB_DATE = NVL(FFM.AWB_DATE,TO_DATE(DDT.AWB_DATE,'DDMONYY'))
              ) buPcWt,
    	JO.BU_INST buildInstr
  	from
		(select  
		ffmshp.awb_no awb_no, ffmshp.awb_Date awb_Date, ffmshp.ORG ORG, ffmshp.DEST DEST, nvl(ffmshp.MAN_PCS,0) PCS,
		nvl(ffmshp.MAN_WT,0) WT, ffmMSG.flt_key flt_key , ffmMSG.flt_Date flt_Date, ffmULD.ULD_KEY ULD_KEY, ffmMSG.TR_No tr_NO,shmpt_code shmpt_code 
		    from EDI_FFM_MSG ffmMSG, EDI_FFM_ULD ffmULD , edi_ffm_shp ffmshp 
		    where ffmMSG.FFM_STATUS = 'P' and ffmshp.dest != 'HKG' 
		    and ffmMSG.TR_NO = ffmULD.TR_NO and ffmMSG.TR_NO = ffmshp.TR_NO and ffmULD.Doc_line_no = ffmshp.uDoc_line_no 
		    ) ffm 
		]]> 
		FULL OUTER join  (select ddtView.awb_no awb_no, to_char(ddtView.awb_DATE,'DDMONYY') awb_DATE, ddtView.flt_key flt_key , 
	               to_char(ddtView.flt_Date,'DDMONYY') flt_Date, 
	         	ddtView.TR_NO TR_NO, ddtView.sdoc_line_no Sdoc_line_no, ddtView.uDOC_LINE_NO UDOC_LINE_NO, ddtView.DOC_LINE_NO DOC_LINE_NO,
	         	ddtView.ULD_KEY ULD_KEY , ddtView.SHP_CNTG_FLT_KEY CNTG_FLT_KEY, to_char(ddtView.SHP_CNTG_FLT_DATE,'DDMONYY') CNTG_FLT_DATE,
	             ddtView.SHP_CNTG_FLT_KEY SHP_CNTG_FLT_KEY, to_char(ddtView.SHP_CNTG_FLT_DATE,'DDMONYY') SHP_CNTG_FLT_DATE, 
	             ddtView.SHP_TRF_TYPE SHP_TRF_TYPE,  ddtView.SHP_BRK_BULK SHP_BRK_BULK,
	           	ddtView.SHP_TRF_TYPE TRF_TYPE,  ddtView.BRK_BULK BRK_BULK, to_char(ddtView.BASELINE_ETA,'DDMONYY') BASELINE_ETA,
	           	NVL( (TO_CHAR(TO_DATE(to_char(ddtView.BASELINE_ETA,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
	            			TO_DATE(TO_CHAR(FLT.SCH_DATE,'DDMONYY')|| ' ' || 
	            			TO_CHAR(NVL(FLT.EST_TIME,  FLT.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24  , 0 ) as etaChangedHrs,
	                 NVL( (TO_CHAR(TO_DATE(to_char(ddtView.BASELINE_ETA,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
	            			TO_DATE(TO_CHAR(FLT.SCH_DATE,'DDMONYY')|| ' ' || 
	            			TO_CHAR(NVL(FLT.EST_TIME,  FLT.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24 * 60 , 0 ) as etaChangedMin,
	             ddtView.Acton_code_1 Acton_code_1, ddtView.Acton_code_2 Acton_code_2, ddtView.UNLDG_PT , ddtView.SHP_UNLDG_PT,
	             ddtView.SHP_TRF_PC , ddtView.SHP_TRF_WT
	           from V_UNFIN_DDT_DTL ddtView
	       		join FLT_OPR FLT on FLT.FLT_KEY = ddtView.FLT_KEY and FLT.SCH_DATE = ddtView.FLT_DATE and FLT_type = 'A' 
	       		where 
	     		(uld_key is not null or (uld_key is null and SHP_TRF_TYPE = 'IF'))
	     		 and ddtView.SHP_CNTG_FLT_KEY = nvl(#expFltKey#,ddtView.SHP_CNTG_FLT_KEY) and nvl( ddtView.SHP_CNTG_FLT_DATE,'31AUG2000') = NVL(#expFltDate#,nvl( ddtView.SHP_CNTG_FLT_DATE,'31AUG2000'))) ddt 
 		on ddt.flt_key = ffm.flt_key and  ddt.flt_Date =  ffm.flt_Date and nvl(ddt.ULD_KEY, '*') =  nvl(ffm.ULD_KEY, '*') AND DDT.AWB_NO = FFM.AWB_NO
		 left join AWB on AWB.AWB_NO = NVL(FFM.AWB_NO,DDT.AWB_NO) and AWB.AWB_DATE = NVL(FFM.AWB_DATE,DDT.AWB_DATE)
		 left join (select BU_INST, AIRL_RMK, WH_RMK, EXP_BU_JO.FLT_KEY, EXP_BU_JO.FLT_DATE, EXP_BU_JO_DTL.AWB_NO ,EXP_BU_JO_DTL.AWB_DATE 
		            from      EXP_BU_JO ,  EXP_BU_JO_DTL where EXP_BU_JO.JO_NO =  EXP_BU_JO_DTL.JO_NO ) JO 
		            ON JO.FLT_KEY = DDT.CNTG_FLT_KEY  and JO.FLT_DATE = DDT.CNTG_FLT_DATE
		              and JO.AWB_NO = NVL(FFM.AWB_NO,DDT.AWB_NO)  and JO.AWB_DATE = nvl(ffm.awb_Date,to_date(ddt.awb_Date,'DDMONYY'))
		 left join (select sum(NVL(ffmshp.MAN_PCS,0)) PCS,sum(nvl(ffmshp.MAN_WT,0)) WT, ffmMSG.flt_key flt_key , ffmMSG.flt_Date flt_Date, ffmULD.ULD_KEY ULD_KEY
		 		    from EDI_FFM_MSG ffmMSG, EDI_FFM_ULD ffmULD , edi_ffm_shp ffmshp 
		    		where ffmMSG.FFM_STATUS = 'P' and ffmshp.dest != 'HKG' 
		    		and ffmMSG.TR_NO = ffmULD.TR_NO and ffmMSG.TR_NO = ffmshp.TR_NO and ffmULD.Doc_line_no = ffmshp.uDoc_line_no group by ffmMSG.flt_key, ffmMSG.flt_Date, ffmULD.ULD_KEY)  uldFfm 
		    		on ffm.FLT_KEY = uldFfm.FLT_KEY and ffm.FLT_DATE = uldFfm.FLT_DATE and ffm.ULD_KEY = uldFFm.ULD_KEY             
		  where ((ffm.flt_key = #fltKey# and ffm.flt_Date = #fltDate# ) 
		  OR (ddt.flt_key = #fltKey# and ddt.flt_Date = #fltDate# ))
		    and exists (select null from V_UNFIN_DDT_DTL where SHP_TRF_TYPE = 'IF' and flt_key = ffm.flt_key and flt_date = ffm.flt_date and nvl(ULD_KEY, '*') =  nvl(ffm.ULD_KEY, '*') 
		                and (uld_key is not null or (uld_key is null and SHP_TRF_TYPE = 'IF' and awb_no = ffm.awb_no)))
		      ) a       where 1 = 1 
       <isNotEmpty property="bulkIndYN">
	       <isEqual property="bulkIndYN" compareValue="N">
	       		and uldKey &lt;&gt; 'BULK'
	       			<isNotEmpty property="expFltKey">
					 	<isNotEmpty property="expFltDate">
					  			and  cntgFltKey = #expFltKey# and cntgFltDate = #expFltDate#
						</isNotEmpty>
					</isNotEmpty>
	       	</isEqual>
	       <isEqual property="bulkIndYN" compareValue="Y">
	       		and uldKey = 'BULK'
	       	</isEqual>
       	</isNotEmpty>
   order by  to_number(nvl(timeDiifferanceHhMi,0)) , uldKey, awbno
</select>

<select id="fetchIndBoundIDULDAWBList_DtlRept_723I" parameterClass="cargo.cms.imprt.report.bo.IFUldShpmReptBO" resultClass="cargo.cms.imprt.report.bo.IFUldShpmReptBO" >
		<![CDATA[ 
		select a.* from (  
		select nvl(ffm.awb_no,ddt.awb_no) awbNo,
		SUBSTR(TRIM(nvl(ffm.awb_no,ddt.awb_no)),1,3)||'-'||SUBSTR(TRIM(nvl(ffm.awb_no,ddt.awb_no)),4) awbNoDisp,
		TO_CHAR(nvl(ffm.awb_Date,ddt.awb_Date),'DDMONYY') awbDate, 
		nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK')  uldKey,
		nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK')  uldKeyShow,
		nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK') ||'-'|| nvl(ffm.awb_no,ddt.awb_no)  uldKeyAwbNo,
		decode(ffm.tr_No,null,'N','Y') ffmInd,
		decode(ddt.tr_No,null,'N','Y') ddtInd,
		nvl(awb.ORIG,'') org, awb.DEST dest, nvl(ffm.PCS,0) pcs,nvl(ffm.WT,0) wt, ffm.shmpt_code shpmCode, NVL(AWB.PCS,0) awbPcs,NVL(AWB.WT,0) awbWt,
		(case when ( nvl((select sum(shp_trf_pc) from v_ddt_dtl 
		                    where AWB_NO = nvl(ffm.awb_no,ddt.awb_no) and AWB_DATE = nvl(ffm.awb_Date,to_date(ddt.awb_Date,'DDMONYY'))
		                        and (SHP_TRF_TYPE = 'IF' OR (SHP_TRF_TYPE = 'IF' and ddt.ULD_KEY is null))),0) 
		                        != nvl((select sum(PMAN_PCS) from EXP_PMANIFEST_AWB where  AWB_NO = nvl(ffm.awb_no,ddt.awb_no) 
		                        					and AWB_DATE = nvl(ffm.awb_Date,to_date(ddt.awb_Date,'DDMONYY'))),0))  
		              then 'Y' else 'N' end) as manPman,
		 nvl(ffm.flt_key,ddt.flt_key) fltKey , TO_CHAR(nvl(ffm.flt_Date,ddt.flt_Date),'DDMONYY')  fltDate,
		  ddt.TR_NO ddtTrNo, ddt.SDOC_LINE_NO ddtSdocLineNo, ddt.UDOC_LINE_NO ddtUdocLineNo, ddt.DOC_LINE_NO ddtDocLineNo,
		   (SELECT V.CC_CODE FROM V_CST_IMP_CC_CODE_AWB V
						WHERE nvl(V.FLT_KEY,'*') = NVL(nvl(ffm.flt_key,ddt.flt_key),'*') AND nvl( V.FLT_DATE,'31AUG2000') = NVL(nvl(ffm.flt_date,ddt.flt_date),'31AUG2000')
						AND V.AWB_NO =  nvl(ffm.awb_no,ddt.awb_no)  AND NVL(V.HAWB_NO, '000000000000000000') =  '000000000000000000' AND ROWNUM = 1)  AS ccode,
		(SELECT STRAGG(STRINGDELIM(SHC, ',')) 
			    	FROM (SELECT DISTINCT SHC, ULD_KEY, FLT_KEY,FLT_DATE, AWB_NO, AWB_DATE,PRIORITY FROM V_IMP_FLT_ULD_SHC ORDER BY PRIORITY DESC
			      	) WHERE AWB_NO = NVL(ffm.awb_No,ddt.awb_No) AND AWB_DATE = NVL(ffm.awb_date,ddt.awb_date)
			      	AND FLT_KEY = nvl(ffm.flt_key,ddt.flt_key) AND FLT_DATE = nvl(ffm.flt_Date,ddt.flt_Date)
			      	and nvl(ULD_KEY,'BULK') = nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK')
		                ) shc,  				
		 ddt.SHP_CNTG_FLT_KEY cntgFltKey, ddt.SHP_CNTG_FLT_DATE cntgFltDate,
			ddt.SHP_CNTG_FLT_KEY oldCntgFltKey, ddt.SHP_CNTG_FLT_DATE oldCntgFltDate,
		  decode(ddt.SHP_CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY)) cntgFltCarr, REPLACE(ddt.SHP_CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY), '') cntgFltNo,
		  decode(ddt.SHP_CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY)) oldCntgFltCarr, REPLACE(ddt.SHP_CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY), '') oldCntgFltNo,
		 ddt.SHP_TRF_TYPE trfType, ddt.SHP_BRK_BULK brkBulk, ddt.SHP_UNLDG_PT shpUnldgPt, 
		  ddt.SHP_TRF_TYPE oldTrfType, ddt.SHP_BRK_BULK oldBrkBulk, ddt.SHP_UNLDG_PT oldShpUnldgPt, 
		  ddt.SHP_TRF_PC trfPcs, ddt.SHP_TRF_WT trfWt,
			ddt.SHP_TRF_PC oldTrfPcs, ddt.SHP_TRF_WT oldTrfWt,
		  (select eic_UNLDG_PT from ULD_INVENTORY where ULD_KEY = ffm.ULD_KEY) unldgPt,
		      case when (select count(1) from imp_uld_list where FLT_KEY = ffm.flt_key and ffm.flt_Date = FLT_DATE
		              and ULD_KEY = ffm.ULD_KEY and HANDLING_MODE in ('NBK','PPK')) > 0 then 'Y' 
		               else '' end as noBreak, 
		              ddt.Acton_code_1 actionOne, ddt.Acton_code_2 actionTwo , 'Y' spiltChkNotReqd,
		FUN_GET_FLT_TDIFF_TRFYPE(ddt.SHP_CNTG_FLT_KEY, ddt.SHP_CNTG_FLT_DATE,#fltKey#,#fltDate#,'TIME_DIFF' ) timeDiifferance,
		FUN_GET_FLT_TDIFF_TRFYPE(ddt.SHP_CNTG_FLT_KEY, ddt.SHP_CNTG_FLT_DATE,#fltKey#,#fltDate#,'TR_TYPE' ) proposeTrfType,
		nvl((select AIRLN_RMK from awb where awb_no = nvl(ffm.awb_no,ddt.awb_no) and awb_date=nvl(ffm.awb_date,ddt.awb_date)  and rownum=1),(select AIRLN_RMK from imp_car_awb where awb_no = nvl(ffm.awb_no,ddt.awb_no) and awb_date=nvl(ffm.awb_date,ddt.awb_date)  and rownum=1)) AS awbAirlRmk,  
		nvl((select awb_rmk from awb where awb_no=nvl(ffm.awb_no,ddt.awb_no) and awb_date=nvl(ffm.awb_date,ddt.awb_date)  and rownum=1),(select WH_RMK from imp_car_awb where awb_no = nvl(ffm.awb_no,ddt.awb_no) and awb_date=nvl(ffm.awb_date,ddt.awb_date)  and rownum=1)) AS awbWhRmk,
		d.AIRL_RMK uldAirlRmk, d.WH_RMK uldWhRmk,
		DECODE(shp.RECD_PCS,'0','',shp.RECD_PCS) ||DECODE(shp.RECD_PCS,'0','','/')||DECODE(shp.RECD_WT,null,'',DECODE(trim(TO_CHAR(NVL(shp.RECD_WT,0),'99999990.0')),'0.0','',trim(TO_CHAR(NVL(shp.RECD_WT,0),'99999990.0')))) AS bdPcWt,
		DECODE(shp.DAM_PCS,'0','',shp.DAM_PCS) ||DECODE(shp.DAM_PCS,'0','','/')|| DECODE(shp.DAM_WT,null,'',DECODE(trim(TO_CHAR(NVL(shp.DAM_WT,0),'99999990.0')),'0.0','',trim(TO_CHAR(NVL(shp.DAM_WT,0),'99999990.0')))) AS damPcWt     
		from
		(select  
		ffmshp.awb_no awb_no, ffmshp.awb_Date awb_Date, ffmshp.ORG ORG, ffmshp.DEST DEST, nvl(ffmshp.MAN_PCS,0) PCS,
		nvl(ffmshp.MAN_WT,0) WT, shmpt_code shmpt_code, ffmMSG.flt_key flt_key , ffmMSG.flt_Date flt_Date, ffmULD.ULD_KEY ULD_KEY, ffmMSG.TR_No tr_NO 
		    from EDI_FFM_MSG ffmMSG, EDI_FFM_ULD ffmULD , edi_ffm_shp ffmshp 
		    where ffmMSG.FFM_STATUS = 'P' 
		    and ffmMSG.TR_NO = ffmULD.TR_NO and ffmMSG.TR_NO = ffmshp.TR_NO and ffmULD.Doc_line_no = ffmshp.uDoc_line_no 
		    ) ffm 
		FULL OUTER join  (select ddtView.awb_no awb_no, to_char(ddtView.awb_DATE,'DDMONYY') awb_DATE, ddtView.flt_key flt_key , 
		                      to_char(ddtView.flt_Date,'DDMONYY') flt_Date, 
		                	ddtView.TR_NO TR_NO, ddtView.sdoc_line_no Sdoc_line_no, ddtView.uDOC_LINE_NO UDOC_LINE_NO, ddtView.DOC_LINE_NO DOC_LINE_NO,
		                	ddtView.ULD_KEY ULD_KEY , ddtView.SHP_CNTG_FLT_KEY SHP_CNTG_FLT_KEY, to_char(ddtView.SHP_CNTG_FLT_DATE,'DDMONYY') SHP_CNTG_FLT_DATE, 
		                  	ddtView.SHP_TRF_TYPE SHP_TRF_TYPE,  ddtView.SHP_BRK_BULK SHP_BRK_BULK, to_char(ddtView.BASELINE_ETA,'DDMONYY') BASELINE_ETA,
		                  	NVL( (TO_CHAR(TO_DATE(to_char(ddtView.BASELINE_ETA,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
		                   			TO_DATE(TO_CHAR(FLT.SCH_DATE,'DDMONYY')|| ' ' || 
		                   			TO_CHAR(NVL(FLT.EST_TIME,  FLT.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24  , 0 ) as etaChangedHrs,
		                    ddtView.Acton_code_1 Acton_code_1, ddtView.Acton_code_2 Acton_code_2, ddtView.UNLDG_PT , ddtView.SHP_UNLDG_PT,
		                    ddtView.SHP_TRF_PC , ddtView.SHP_TRF_WT
		                  from V_UNFIN_DDT_DTL ddtView
		              		join FLT_OPR FLT on FLT.FLT_KEY = ddtView.FLT_KEY and FLT.SCH_DATE = ddtView.FLT_DATE and FLT_type = 'A') ddt 
		  				on ddt.flt_key = ffm.flt_key and  ddt.flt_Date =  ffm.flt_Date and nvl(ddt.ULD_KEY, '*') =  nvl(ffm.ULD_KEY, '*') AND DDT.AWB_NO = FFM.AWB_NO
		 left join awb on awb.awb_NO = NVL(ffm.awb_No,ddt.awb_No) and awb.awb_Date = NVL(ffm.awb_Date,ddt.awb_Date)
		 left join IMP_CAR_SHP shp on shp.awb_NO = NVL(ffm.awb_No,ddt.awb_No) and shp.awb_Date = NVL(ffm.awb_Date,ddt.awb_Date) and shp.flt_key = NVL(ffm.flt_key,ddt.flt_key) and shp.flt_Date = NVL(ffm.flt_Date,ddt.flt_Date)
		 left join IMP_ULD_LIST D
		     ON nvl(D.ULD_KEY,'BULK') = nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK')  and d.flt_key = NVL(ffm.flt_key,ddt.flt_key) and d.flt_date = NVL(ffm.flt_Date,ddt.flt_Date) 
		  where ((ffm.flt_key = #fltKey# and ffm.flt_Date = #fltDate# ) 
		  		OR (ddt.flt_key = #fltKey# and ddt.flt_Date = #fltDate# ))
		  		and nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK') = #uldKey#  
		   ]]>
		   <isNotEmpty property="trfType">
				and ddt.SHP_TRF_TYPE = nvl(#trfType#,ddt.SHP_TRF_TYPE)
			</isNotEmpty>
		  ) a ORDER BY  timeDiifferance, awbNo , awbDate
</select>
<select id="fetchIndBoundIFULDAWB_CNTG_FLT_ListRept_723I" parameterClass="cargo.cms.imprt.report.bo.IFUldShpmReptBO" resultClass="cargo.cms.imprt.report.bo.IFUldShpmReptBO" >
		<![CDATA[ 
		select a.* from (
		select nvl(ffm.awb_no,ddt.awb_no) awbNo,
		SUBSTR(TRIM(nvl(ffm.awb_no,ddt.awb_no)),1,3)||'-'||SUBSTR(TRIM(nvl(ffm.awb_no,ddt.awb_no)),4) awbNoDisp,
		TO_CHAR(nvl(ffm.awb_Date,ddt.awb_Date),'DDMONYY') awbDate, 
		nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK')  uldKey,
		nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK')  uldKeyShow,
		nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK') ||'-'|| nvl(ffm.awb_no,ddt.awb_no)  uldKeyAwbNo,
		decode(ffm.tr_No,null,'N','Y') ffmInd,
		decode(ddt.tr_No,null,'N','Y') ddtInd,
		nvl(awb.ORIG,'') org, awb.DEST dest, nvl(ffm.PCS,0) pcs,nvl(ffm.WT,0) wt,NVL(AWB.PCS,0) awbPcs,NVL(AWB.WT,0) awbWt,
		(case when ( nvl((select sum(shp_trf_pc) from v_ddt_dtl 
		                    where AWB_NO = nvl(ffm.awb_no,ddt.awb_no) and AWB_DATE = nvl(ffm.awb_Date,to_date(ddt.awb_Date,'DDMONYY'))
		                        and (SHP_TRF_TYPE = 'IF' OR (SHP_TRF_TYPE = 'IF' and ddt.ULD_KEY is null))),0) 
		                        != nvl((select sum(PMAN_PCS) from EXP_PMANIFEST_AWB where  AWB_NO = nvl(ffm.awb_no,ddt.awb_no) 
		                        					and AWB_DATE = nvl(ffm.awb_Date,to_date(ddt.awb_Date,'DDMONYY'))),0))  
		              then 'Y' else 'N' end) as manPman,
		 nvl(ffm.flt_key,ddt.flt_key) fltKey , TO_CHAR(nvl(ffm.flt_Date,ddt.flt_Date),'DDMONYY')  fltDate,
		  ddt.TR_NO ddtTrNo, ddt.SDOC_LINE_NO ddtSdocLineNo, ddt.UDOC_LINE_NO ddtUdocLineNo, ddt.DOC_LINE_NO ddtDocLineNo,
		 ddt.SHP_CNTG_FLT_KEY cntgFltKey, ddt.SHP_CNTG_FLT_DATE cntgFltDate,
			ddt.SHP_CNTG_FLT_KEY oldCntgFltKey, ddt.SHP_CNTG_FLT_DATE oldCntgFltDate,
		  decode(ddt.SHP_CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY)) cntgFltCarr, REPLACE(ddt.SHP_CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY), '') cntgFltNo,
		  decode(ddt.SHP_CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY)) oldCntgFltCarr, REPLACE(ddt.SHP_CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY), '') oldCntgFltNo,
		 ddt.SHP_TRF_TYPE trfType, ddt.SHP_BRK_BULK brkBulk, ddt.SHP_UNLDG_PT shpUnldgPt, 
		  ddt.SHP_TRF_TYPE oldTrfType, ddt.SHP_BRK_BULK oldBrkBulk, ddt.SHP_UNLDG_PT oldShpUnldgPt, 
		  ddt.SHP_TRF_PC trfPcs, ddt.SHP_TRF_WT trfWt,
			ddt.SHP_TRF_PC oldTrfPcs, ddt.SHP_TRF_WT oldTrfWt, 
		  (select eic_UNLDG_PT from ULD_INVENTORY where ULD_KEY = ffm.ULD_KEY) unldgPt,
		  '' as proposeTrfType, '' etaChangedHrs, 
		      case when (select count(1) from imp_uld_list where FLT_KEY = ffm.flt_key and ffm.flt_Date = FLT_DATE
		              and ULD_KEY = ffm.ULD_KEY and HANDLING_MODE in ('NBK','PPK')) > 0 then 'Y' 
		               else '' end as noBreak, 
		              ddt.Acton_code_1 actionOne, ddt.Acton_code_2 actionTwo , 'Y' spiltChkNotReqd,
		               (select bulkPcs ||'/'||  bulkWt from 
		               	  (select FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE, sum(bulkPcs) bulkPcs,  sum(bulkWt) bulkWt from 
		                   (select FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE, NVL(SUM(MIX_PCS)+SUM(PPK_PCS)+SUM(ASSIGNED_BULK_PCS),0) bulkPcs, NVL(SUM(MIX_WT)+SUM(PPK_WT)+SUM(ASSIGNED_BULK_WT),0) bulkWt
		                      from EXP_PMANIFEST_AWB 
		                            where MIX_PCS <> 0 OR PPK_PCS <> 0 OR ASSIGNED_BULK_PCS <> 0 OR  MIX_WT <> 0 OR PPK_WT <> 0 OR ASSIGNED_BULK_WT <> 0
		                            group by FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE
		                    union
		                    select FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE,  NVL(SUM(BULK_PCS)+SUM(PPK_PCS),0) bulkPcs,  NVL(SUM(BULK_WT)+SUM(PPK_WT),0) bulkWt
		                      from EXP_PMAN_TARMAC_AWB 
		                            where BULK_PCS <> 0 OR PPK_PCS <> 0 OR  BULK_WT <> 0 OR PPK_WT <> 0 
		                              group by FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE
		                  ) a  group by FLT_KEY, FLT_DATE, AWB_NO, AWB_DATE ) buPcWt
		                where FLT_KEY = ddt.SHP_CNTG_FLT_KEY  and FLT_DATE = ddt.SHP_CNTG_FLT_DATE 
		                and AWB_NO = NVL(FFM.AWB_NO,DDT.AWB_NO) and AWB_DATE = NVL(FFM.AWB_DATE,TO_DATE(DDT.AWB_DATE,'DDMONYY'))
		                ) buPcWt,
		PKG_COMMON.get_flt_eta(ddt.SHP_CNTG_FLT_KEY, ddt.SHP_CNTG_FLT_DATE, 'D', 'DD')  as etd, 
		                        PKG_COMMON.get_flt_sta(ddt.SHP_CNTG_FLT_KEY, ddt.SHP_CNTG_FLT_DATE, 'D', 'DD')  as std,
		FUN_GET_FLT_TDIFF_TRFYPE(ddt.SHP_CNTG_FLT_KEY,ddt.SHP_CNTG_FLT_DATE,nvl(ffm.flt_key,ddt.flt_key),nvl(ffm.flt_date,ddt.flt_date),'TIME_DIFF' ) timeDiifferance,
		ddt.qt_bu qtBu,
		(select bu_inst from EXP_BU_JO hd, EXP_BU_JO_DTL dtl 
				where hd.jo_no = dtl.jo_no and hd.flt_key =  ddt.shp_cntg_flt_key and hd.flt_date = ddt.shp_cntg_flt_date 
				and dtl.awb_NO = NVL(ffm.awb_No,ddt.awb_No) and dtl.awb_Date = NVL(ffm.awb_Date,ddt.awb_Date) and rownum = 1 ) as buildInstr               
		from
		(select  
		ffmshp.awb_no awb_no, ffmshp.awb_Date awb_Date, ffmshp.ORG ORG, ffmshp.DEST DEST, nvl(ffmshp.MAN_PCS,0) PCS,
		nvl(ffmshp.MAN_WT,0) WT, ffmMSG.flt_key flt_key , ffmMSG.flt_Date flt_Date, ffmULD.ULD_KEY ULD_KEY, ffmMSG.TR_No tr_NO 
		    from EDI_FFM_MSG ffmMSG, EDI_FFM_ULD ffmULD , edi_ffm_shp ffmshp 
		    where ffmMSG.FFM_STATUS = 'P' and ffmshp.dest != 'HKG' 
		    and ffmMSG.TR_NO = ffmULD.TR_NO and ffmMSG.TR_NO = ffmshp.TR_NO and ffmULD.Doc_line_no = ffmshp.uDoc_line_no 
		    ) ffm 
		FULL OUTER join  (select ddtView.awb_no awb_no, to_char(ddtView.awb_DATE,'DDMONYY') awb_DATE, ddtView.flt_key flt_key , 
		                      to_char(ddtView.flt_Date,'DDMONYY') flt_Date, 
		                	ddtView.TR_NO TR_NO, ddtView.sdoc_line_no Sdoc_line_no, ddtView.uDOC_LINE_NO UDOC_LINE_NO, ddtView.DOC_LINE_NO DOC_LINE_NO,
		                	ddtView.ULD_KEY ULD_KEY , ddtView.SHP_CNTG_FLT_KEY SHP_CNTG_FLT_KEY, to_char(ddtView.SHP_CNTG_FLT_DATE,'DDMONYY') SHP_CNTG_FLT_DATE, 
		                  	ddtView.SHP_TRF_TYPE SHP_TRF_TYPE,  ddtView.SHP_BRK_BULK SHP_BRK_BULK, to_char(ddtView.BASELINE_ETA,'DDMONYY') BASELINE_ETA,
		                  	NVL( (TO_CHAR(TO_DATE(to_char(ddtView.BASELINE_ETA,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
		                   			TO_DATE(TO_CHAR(FLT.SCH_DATE,'DDMONYY')|| ' ' || 
		                   			TO_CHAR(NVL(FLT.EST_TIME,  FLT.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24  , 0 ) as etaChangedHrs,
		                    ddtView.Acton_code_1 Acton_code_1, ddtView.Acton_code_2 Acton_code_2, ddtView.UNLDG_PT , ddtView.SHP_UNLDG_PT,
		                    ddtView.SHP_TRF_PC , ddtView.SHP_TRF_WT, ddtView.qt_BU
		                  from V_UNFIN_DDT_DTL ddtView
		              		join FLT_OPR FLT on FLT.FLT_KEY = ddtView.FLT_KEY and FLT.SCH_DATE = ddtView.FLT_DATE and FLT_type = 'A') ddt 
		  				on ddt.flt_key = ffm.flt_key and  ddt.flt_Date =  ffm.flt_Date and nvl(ddt.ULD_KEY, '*') =  nvl(ffm.ULD_KEY, '*') AND DDT.AWB_NO = FFM.AWB_NO
		 left join awb on awb.awb_NO = NVL(ffm.awb_No,ddt.awb_No) and awb.awb_Date = NVL(ffm.awb_Date,ddt.awb_Date)
		  where ((ffm.flt_key = #fltKey# and ffm.flt_Date = #fltDate# ) 
		  		OR (ddt.flt_key = #fltKey# and ddt.flt_Date = #fltDate# ))
		  		and nvl(nvl(ffm.ULD_KEY,ddt.ULD_KEY),'BULK') = #uldKey#  
		  		and nvl(ffm.awb_no,ddt.awb_no) = #awbNo# and nvl(ffm.awb_Date,ddt.awb_Date) = #awbDate#
		   ]]>
		   ) a where 1=1 
		    	<isNotEmpty property="expFltKey">
		       	 	<isNotEmpty property="expFltDate">
		       	  		and cntgFltKey = #expFltKey# and cntgFltDate = #expFltDate#
		    	  	</isNotEmpty>
		     	 </isNotEmpty>
		   ORDER BY  timeDiifferance,  awbNo , awbDate
</select>
<select id="getIFUldFltList_723E" parameterClass="cargo.cms.imprt.report.bo.IFUldShpmReptBO" resultClass="java.lang.String">
		select stragg(STRINGDELIM((flt_key || '/' ||fltDate),',')) from(
		select
		ddt.flt_key,to_char(ddt.flt_Date ,'DDMONYY') fltDate
		from V_UNFIN_DDT_DTL ddt
		join (select V_UNFIN_DDT_DTL.SHP_CNTG_FLT_KEY , V_UNFIN_DDT_DTL.SHP_CNTG_FLT_DATE,  V_UNFIN_DDT_DTL.TR_NO , V_UNFIN_DDT_DTL.SDOC_LINE_NO , V_UNFIN_DDT_DTL.UDOC_LINE_NO , V_UNFIN_DDT_DTL.DOC_LINE_NO ,
		          NVL( (TO_CHAR(TO_DATE(TO_CHAR(V_UNFIN_DDT_DTL.BASELINE_ETD,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
		                      TO_DATE(TO_CHAR(FLT_OPR.SCH_DATE,'DDMONYY')|| ' ' || 
		                      TO_CHAR(NVL(FLT_OPR.EST_TIME,  FLT_OPR.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24  , 0 ) as etdChangedHrs,
				NVL( (TO_CHAR(TO_DATE(TO_CHAR(V_UNFIN_DDT_DTL.BASELINE_ETD,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
		                      TO_DATE(TO_CHAR(FLT_OPR.SCH_DATE,'DDMONYY')|| ' ' || 
		                      TO_CHAR(NVL(FLT_OPR.EST_TIME,  FLT_OPR.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24 * 60 , 0 ) as etdChangedMin
		      from V_UNFIN_DDT_DTL , FLT_OPR  where V_UNFIN_DDT_DTL.SHP_TRF_TYPE = 'IF' and V_UNFIN_DDT_DTL.SHP_CNTG_FLT_KEY = FLT_OPR.FLT_KEY and FLT_OPR.SCH_DATE = V_UNFIN_DDT_DTL.SHP_CNTG_FLT_DATE and FLT_OPR.FLT_TYPE ='D') ddtEtd
		      on ddt.SHP_CNTG_FLT_KEY = ddtEtd.SHP_CNTG_FLT_KEY and ddt.SHP_CNTG_FLT_DATE = ddtEtd.SHP_CNTG_FLT_DATE 
		          and  ddtEtd.TR_NO = ddt.TR_NO and ddtEtd.SDOC_LINE_NO = ddt.SDOC_LINE_NO
		          and ddtEtd.UDOC_LINE_NO = ddt.UDOC_LINE_NO and ddtEtd.DOC_LINE_NO = ddt.DOC_LINE_NO
		join FLT_OPR FLT on ddt.SHP_CNTG_FLT_KEY = FLT.FLT_KEY and FLT.SCH_DATE = ddt.SHP_CNTG_FLT_DATE and FLT.FLT_TYPE ='D'
		left join (select nvl(sum(shp_trf_Pc),0) qt_trf_Pcs  , nvl(sum(shp_trf_Wt),0) qt_trf_Wt  ,V_UNFIN_DDT_DTL.SHP_CNTG_FLT_KEY ,  V_UNFIN_DDT_DTL.SHP_CNTG_FLT_DATE,  V_UNFIN_DDT_DTL.TR_NO ,
		          V_UNFIN_DDT_DTL.SDOC_LINE_NO , V_UNFIN_DDT_DTL.UDOC_LINE_NO , V_UNFIN_DDT_DTL.DOC_LINE_NO 
		      from V_UNFIN_DDT_DTL , FLT_OPR  where V_UNFIN_DDT_DTL.SHP_TRF_TYPE = 'IF' and V_UNFIN_DDT_DTL.SHP_CNTG_FLT_KEY = FLT_OPR.FLT_KEY and FLT_OPR.SCH_DATE = V_UNFIN_DDT_DTL.SHP_CNTG_FLT_DATE and FLT_OPR.FLT_TYPE ='D'
		      group by V_UNFIN_DDT_DTL.SHP_CNTG_FLT_KEY,  V_UNFIN_DDT_DTL.SHP_CNTG_FLT_DATE,  V_UNFIN_DDT_DTL.TR_NO, V_UNFIN_DDT_DTL.SDOC_LINE_NO, V_UNFIN_DDT_DTL.UDOC_LINE_NO, V_UNFIN_DDT_DTL.DOC_LINE_NO 
		      ) ddtQt
		      on ddt.SHP_CNTG_FLT_KEY = ddtQt.SHP_CNTG_FLT_KEY and ddt.SHP_CNTG_FLT_DATE = ddtQt.SHP_CNTG_FLT_DATE 
		          and  ddtQt.TR_NO = ddt.TR_NO and ddtQt.SDOC_LINE_NO = ddt.SDOC_LINE_NO
		          and ddtQt.UDOC_LINE_NO = ddt.UDOC_LINE_NO and ddtQt.DOC_LINE_NO = ddt.DOC_LINE_NO
		left join awb on awb.awb_NO = ddt.awb_No and awb.awb_Date = ddt.awb_Date
		left join (select ffmshp.awb_no awb_no, ffmshp.awb_Date awb_Date, ffmshp.ORG ORG, ffmshp.DEST DEST, nvl(ffmshp.MAN_PCS,0) PCS,
		    nvl(ffmshp.MAN_WT,0) WT, ffmMSG.flt_key flt_key , ffmMSG.flt_Date flt_Date, ffmULD.ULD_KEY ULD_KEY, ffmMSG.TR_No tr_NO 
		    from EDI_FFM_MSG ffmMSG, EDI_FFM_ULD ffmULD , edi_ffm_shp ffmshp 
		    where ffmMSG.FFM_STATUS = 'P' and ffmshp.dest != 'HKG' 
		    and ffmMSG.TR_NO = ffmULD.TR_NO and ffmMSG.TR_NO = ffmshp.TR_NO and ffmULD.Doc_line_no = ffmshp.uDoc_line_no 
		    ) ffm on ddt.SHP_CNTG_FLT_KEY = ffm.flt_key and ffm.flt_DATE = ddt.SHP_CNTG_FLT_DATE and ffm.awb_NO = ddt.awb_No and ffm.awb_Date = ddt.awb_Date
		left join (select BU_INST, AIRL_RMK, WH_RMK, EXP_BU_JO.FLT_KEY, EXP_BU_JO.FLT_DATE, EXP_BU_JO_DTL.AWB_NO ,EXP_BU_JO_DTL.AWB_DATE 
		            from      EXP_BU_JO ,  EXP_BU_JO_DTL where EXP_BU_JO.JO_NO =  EXP_BU_JO_DTL.JO_NO ) JO 
		            ON JO.FLT_KEY = DDT.SHP_CNTG_FLT_KEY  and JO.FLT_DATE = DDT.SHP_CNTG_FLT_DATE
		              and JO.AWB_NO =DDT.AWB_NO  and JO.AWB_DATE = ddt.awb_Date
		where ddt.SHP_CNTG_FLT_KEY = #expFltKey# and ddt.SHP_CNTG_FLT_DATE = #expFltDate#  
		and ddt.SHP_TRF_TYPE = 'IF' 
		   <isNotEmpty property="unldgPt" >	 
			  	and ddt.SHP_UNLDG_PT = #unldgPt#
			</isNotEmpty>
			 <isNotEmpty property="impFltKey" >	 
			  	<isNotEmpty property="impFltDate" >	 
			  		and ddt.flt_key = #impFltKey# and ddt.flt_Date = #impFltDate#  
			  	</isNotEmpty>
			</isNotEmpty>
		  
		group By ddt.flt_key , ddt.flt_Date)
</select>
<select id="getIFUldList_723E" parameterClass="cargo.cms.imprt.report.bo.IFUldShpmReptBO" resultClass="cargo.cms.imprt.report.bo.IFUldShpmReptBO">
		<![CDATA[ 
		select
		nvl(ddt.ULD_KEY,'BULK')  uldKey, nvl(ddt.ULD_KEY,'BULK') ||'-'|| ddt.awb_no  uldKeyAwbNo, 
		ddt.awb_no awbNo, SUBSTR(TRIM(ddt.awb_no),1,3)||'-'||SUBSTR(TRIM(ddt.awb_no),4) awbNoDisp,  to_char(ddt.awb_Date,'DDMONYY') awbDate, 
		nvl(awb.ORIG,'') org, awb.DEST dest, ddt.UNLDG_PT unldgPt,ddt.UNLDG_PT uldUnldgPt, ddt.SHP_UNLDG_PT shpUnldgPt, 
		ddt.UNLDG_PT oldUldUnldgPt, ddt.SHP_UNLDG_PT oldShpUnldgPt, 
		ddt.flt_key fltKey , to_char(ddt.flt_Date,'DDMONYY')  fltDate,
		PKG_COMMON.get_flt_eta(ddt.flt_key, ddt.flt_Date, 'A', 'DD') eta,
		NVL(AWB.PCS,0) awbPcs,NVL(AWB.WT,0) awbWt, 
		NVL(FFM.PCS,0) ffmPcs,NVL(FFM.WT,0) ffmWt, FFM.shmpt_code shpmCode,
		ddt.qt_bu as qtBuInd,
		
		(select nvl(sum(bup_pc),'0') ||'/'|| nvl(sum(bup_wt),'0') buPcWt
	    FROM ( select flt_key, flt_date, awb_no, awb_date,
	    sum( nvl(PPK_PCS,0)+nvl(MIX_PCS,0)+nvl(ASSIGNED_BULK_PCS,0)) bup_pc,
	    sum( nvl(PPK_WT,0)+nvl(MIX_WT,0)+nvl(ASSIGNED_BULK_WT,0) )bup_wt 
	   from exp_pmanifest_awb 
	   GROUP BY flt_key, flt_date, awb_no, awb_date
	   UNION 
	   select flt_key flt_key, flt_date flt_date, awb_no awb_no,awb_date awb_date,
	   sum(nvl(bulk_pcs,0)+nvl(ppk_pcs,0)) bup_pc,
	   sum(nvl(bulk_wt,0)+nvl(ppk_wt,0)) bup_wt 
	   from EXP_PMAN_TARMAC_AWB
	   group by flt_key,awb_no,awb_date,flt_date) where FLT_KEY = ddt.SHP_CNTG_FLT_KEY
	    AND FLT_DATE  = ddt.SHP_CNTG_FLT_Date
	    AND AWB_NO    = DDT.AWB_NO
	    AND AWB_DATE  = DDT.AWB_DATE) as buPcWt,
	   
	   (select nvl(sum(manf_pc),'0') ||'/'|| nvl(sum(manf_wt),'0') as pmanPcWt
	    FROM ( select flt_key, flt_date, awb_no, awb_date,sum(nvl(pman_pcs,0)) manf_pc, sum(nvl(pman_wt,0)) manf_wt
	   from exp_pmanifest_awb 
	   GROUP BY flt_key, flt_date, awb_no, awb_date
	   UNION 
	   select flt_key flt_key, flt_date flt_date, awb_no awb_no,awb_date awb_date, sum(nvl(bulk_pcs,0)+nvl(ppk_pcs,0)) manf_pc, sum(nvl(bulk_wt,0)+nvl(ppk_wt,0)) manf_wt
	   from EXP_PMAN_TARMAC_AWB
	   group by flt_key,awb_no,awb_date,flt_date) 
	    WHERE FLT_KEY = ddt.SHP_CNTG_FLT_KEY
	    AND FLT_DATE  = ddt.SHP_CNTG_FLT_Date
	    AND AWB_NO    = DDT.AWB_NO
	    AND AWB_DATE  = DDT.AWB_DATE
	   ) as pmanPcWt,
	           
		(select sum(SHP.RECD_PCS)||'/'|| sum(SHP.RECD_WT) from  IMP_CAR_SHP SHP
		          where SHP.AWB_NO = DDT.AWB_NO and SHP.AWB_DATE = DDT.AWB_DATE
		          and  SHP.FLT_KEY = DDT.FLT_KEY and SHP.FLT_DATE = DDT.FLT_DATE group by SHP.AWB_NO,SHP.AWB_DATE,SHP.FLT_KEY,SHP.FLT_DATE) as bdPcWt, 
		(select loc_code from  ULD_INVENTORY uldInv where ddt.uld_key = uldInv.uld_key and rownum = 1) locn, 
		NVL(JODTL.PC,0) joPcs, NVL(JODTL.WT,0) joWt,          
		NVL(ddt.SHP_TRF_PC,0) trfPcs, NVL(ddt.SHP_TRF_WT,0) trfWt,
		nvl(ddt.LOADED_PCS,0) pcs,nvl(ddt.LOADED_WT,0) wt, ddt.SHP_TRF_PC trfPcs , ddt.SHP_TRF_WT  trfWt, ddt.BRK_BULK brkBulk,
		round(ddtEtd.etdChangedHrs) etdChangedHrs, 
		       round(ddtEtd.etdChangedMin) etdChangedMin,
		   FUN_GET_FLT_TDIFF_TRFYPE(ddt.shp_CNTG_FLT_KEY, ddt.shp_CNTG_FLT_Date,ddt.FLT_KEY, ddt.FLT_DATE,'TIME_DIFF' ) etdChangedHrsMin,
		   FUN_GET_FLT_TDIFF_TRFYPE(ddt.shp_CNTG_FLT_KEY, ddt.shp_CNTG_FLT_Date,ddt.FLT_KEY, ddt.FLT_DATE,'TIME_DIFF' ) etaChangedHrsMin,
		   ddt.shp_TRF_TYPE trfType, 
		   ddt.TR_NO ddtTrNo, ddt.SDOC_LINE_NO ddtSdocLineNo, ddt.UDOC_LINE_NO ddtUdocLineNo, ddt.DOC_LINE_NO ddtDocLineNo,
		   ddt.SHP_CNTG_FLT_KEY cntgFltKey, to_char(ddt.SHP_CNTG_FLT_DATE,'DDMONYY') cntgFltDate,  
		   ddt.SHP_CNTG_FLT_KEY oldCntgFltKey, to_char(ddt.SHP_CNTG_FLT_DATE,'DDMONYY') oldCntgFltDate,  
		   decode(ddt.SHP_CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY)) cntgFltCarr, REPLACE(ddt.SHP_CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY), '') cntgFltNo,
		   decode(ddt.SHP_CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY)) oldCntgFltCarr, REPLACE(ddt.SHP_CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY), '') oldCntgFltNo,
		   ddt.TRF_TYPE trfType, ddt.TRF_TYPE oldTrfType,   ddt.BRK_BULK brkBulk,ddt.BRK_BULK oldBrkBulk,   
		   (SELECT STRAGG(STRINGDELIM(SHC, ',')) 
			    	FROM (SELECT DISTINCT SHC, ULD_KEY, FLT_KEY,FLT_DATE, AWB_NO, AWB_DATE,PRIORITY FROM V_IMP_FLT_ULD_SHC ORDER BY PRIORITY DESC
			      	) WHERE AWB_NO = ddt.awb_No AND AWB_DATE = ddt.awb_date
			      	AND FLT_KEY = ddt.flt_key AND FLT_DATE = ddt.flt_Date
			      	and nvl(ULD_KEY,'BULK') = nvl(ddt.ULD_KEY,'BULK') 
		                ) shc,
		        (SELECT V.CC_CODE FROM V_CST_CC_CODE_AWB V
		                WHERE V.AWB_NO = ddt.awb_no
		          AND NVL(V.HAWB_NO, '000000000000000000') =  '000000000000000000' AND ROWNUM = 1)  ccode,
		           JO.BU_INST buildInstr, ddt.QT_BU qtBu,
		FUN_GET_FLT_TDIFF_TRFYPE(ddt.shp_CNTG_FLT_KEY, ddt.shp_CNTG_FLT_Date,ddt.FLT_KEY, ddt.FLT_DATE,'TIME_DIFF' ) timeDiifferance,
		FUN_GET_FLT_TDIFF_TRFYPE(ddt.shp_CNTG_FLT_KEY, ddt.shp_CNTG_FLT_Date,ddt.FLT_KEY, ddt.FLT_DATE,'TR_TYPE' ) proposeTrfType   
		from V_UNFIN_DDT_DTL ddt
		join (select V_UNFIN_DDT_DTL.SHP_CNTG_FLT_KEY , V_UNFIN_DDT_DTL.SHP_CNTG_FLT_DATE,  V_UNFIN_DDT_DTL.TR_NO , V_UNFIN_DDT_DTL.SDOC_LINE_NO , V_UNFIN_DDT_DTL.UDOC_LINE_NO , V_UNFIN_DDT_DTL.DOC_LINE_NO ,
		          NVL( (TO_CHAR(TO_DATE(TO_CHAR(V_UNFIN_DDT_DTL.BASELINE_ETD,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
		                      TO_DATE(TO_CHAR(FLT_OPR.SCH_DATE,'DDMONYY')|| ' ' || 
		                      TO_CHAR(NVL(FLT_OPR.EST_TIME,  FLT_OPR.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24  , 0 ) as etdChangedHrs,
				NVL( (TO_CHAR(TO_DATE(TO_CHAR(V_UNFIN_DDT_DTL.BASELINE_ETD,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
		                      TO_DATE(TO_CHAR(FLT_OPR.SCH_DATE,'DDMONYY')|| ' ' || 
		                      TO_CHAR(NVL(FLT_OPR.EST_TIME,  FLT_OPR.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24 * 60 , 0 ) as etdChangedMin
		      from V_UNFIN_DDT_DTL  , FLT_OPR  where V_UNFIN_DDT_DTL.SHP_TRF_TYPE = 'IF' and V_UNFIN_DDT_DTL.SHP_CNTG_FLT_KEY = FLT_OPR.FLT_KEY and FLT_OPR.SCH_DATE = V_UNFIN_DDT_DTL.SHP_CNTG_FLT_DATE and FLT_OPR.FLT_TYPE ='D') ddtEtd
		      on ddt.SHP_CNTG_FLT_KEY = ddtEtd.SHP_CNTG_FLT_KEY and ddt.SHP_CNTG_FLT_DATE = ddtEtd.SHP_CNTG_FLT_DATE 
		          and  ddtEtd.TR_NO = ddt.TR_NO and ddtEtd.SDOC_LINE_NO = ddt.SDOC_LINE_NO
		          and ddtEtd.UDOC_LINE_NO = ddt.UDOC_LINE_NO and ddtEtd.DOC_LINE_NO = ddt.DOC_LINE_NO
		join FLT_OPR FLT on ddt.SHP_CNTG_FLT_KEY = FLT.FLT_KEY and FLT.SCH_DATE = ddt.SHP_CNTG_FLT_DATE and FLT.FLT_TYPE ='D'
		left join awb on awb.awb_NO = ddt.awb_No and awb.awb_Date = ddt.awb_Date
		LEFT JOIN   (SELECT SUM(JO_DTL.AWB_JO_PC) PC ,SUM(JO_DTL.AWB_JO_WT) WT,JO_HD.FLT_KEY FLT_KEY, JO_HD.FLT_DATE FLT_DATE ,JO_DTL.AWB_NO AWB_NO ,JO_DTL.AWB_DATE AWB_DATE 
		FROM EXP_BU_JO JO_HD 
		JOIN EXP_BU_JO_DTL JO_DTL 
		ON JO_HD.JO_NO = JO_DTL.JO_NO
		WHERE CONFIRMED_YN='Y' 
		group by JO_HD.FLT_KEY, JO_HD.FLT_DATE, JO_DTL.AWB_NO, JO_DTL.AWB_DATE) JODTL
		ON JODTL.FLT_KEY = DDT.SHP_CNTG_FLT_KEY  AND JODTL.FLT_DATE = DDT.SHP_CNTG_FLT_DATE
		AND JODTL.AWB_NO = DDT.AWB_NO  AND JODTL.AWB_DATE =  DDT.AWB_DATE
		left join (select ffmshp.awb_no awb_no, ffmshp.awb_Date awb_Date, sum(nvl(ffmshp.MAN_PCS,0)) PCS, MIN(shmpt_code) shmpt_code,
		    SUM(nvl(ffmshp.MAN_WT,0)) WT, ffmMSG.flt_key flt_key , ffmMSG.flt_Date flt_Date
		    from EDI_FFM_MSG ffmMSG, EDI_FFM_ULD ffmULD , edi_ffm_shp ffmshp 
		    where ffmMSG.FFM_STATUS = 'P' and ffmshp.dest != 'HKG' 
		    and ffmMSG.TR_NO = ffmULD.TR_NO and ffmMSG.TR_NO = ffmshp.TR_NO and ffmULD.Doc_line_no = ffmshp.uDoc_line_no group by ffmshp.awb_no, ffmshp.awb_Date, ffmMSG.flt_key, ffmMSG.flt_Date 
		    ) ffm on ddt.FLT_KEY = ffm.flt_key and ffm.flt_DATE = ddt.FLT_DATE and ffm.awb_NO = ddt.awb_No and ffm.awb_Date = ddt.awb_Date
		left join (select BU_INST, AIRL_RMK, WH_RMK, EXP_BU_JO.FLT_KEY, EXP_BU_JO.FLT_DATE, EXP_BU_JO_DTL.AWB_NO ,EXP_BU_JO_DTL.AWB_DATE 
		            from      EXP_BU_JO ,  EXP_BU_JO_DTL where EXP_BU_JO.JO_NO =  EXP_BU_JO_DTL.JO_NO ) JO 
		            ON JO.FLT_KEY = DDT.SHP_CNTG_FLT_KEY  and JO.FLT_DATE = DDT.SHP_CNTG_FLT_DATE
		              and JO.AWB_NO =DDT.AWB_NO  and JO.AWB_DATE = ddt.awb_Date
		where ddt.SHP_CNTG_FLT_KEY = #expFltKey# and ddt.SHP_CNTG_FLT_DATE = #expFltDate#  
		and ddt.SHP_TRF_TYPE = 'IF' 
		  ]]>
		  <isNotEmpty property="unldgPt" >	 
			  	and ddt.SHP_UNLDG_PT = #unldgPt#
			</isNotEmpty>
			 <isNotEmpty property="impFltKey" >	 
			  	<isNotEmpty property="impFltDate" >	 
			  		and ddt.flt_key = #impFltKey# and ddt.flt_Date = #impFltDate#  
			  	</isNotEmpty>
			</isNotEmpty>
			ORDER BY  ddt.ULD_KEY
</select>
	<!-- Tow Order In Record Report - Passenger -->
	<select id="sqlGetTowInRecordsPAXReport" parameterClass="cargo.cms.imprt.bo.TowOrderTerminalInBO"
		resultClass="cargo.cms.imprt.bo.TowOrderTerminalInReportBO">
		<![CDATA[
			WITH FLT AS (
			  SELECT 
			  FLT_KEY, SCH_DATE FLT_DATE,
			  CGO_ACFT_TYPE AIRCRAFT_TYPE,
			  PKG_COMMON.GET_FLT_ATA(FLT_KEY, SCH_DATE, 'A', 'DD') ATA_TIME,
			  TO_DATE(
			    TRIM(
			      TO_CHAR(SCH_DATE, 'DDMONYY') || ' ' 
			        || SUBSTR(TRIM(TO_CHAR(SCH_TIME, '0000')), 0, 2) 
			        || NVL2(SCH_TIME, ':', '') 
			        || SUBSTR(TRIM(TO_CHAR(SCH_TIME, '0000')), 3, 4)
			  ), 'DDMONYY HH24:MI') STA,
			  TO_DATE(
			    TRIM(
			      TO_CHAR(ACT_DATE, 'DDMONYY') || ' ' 
			        || SUBSTR(TRIM(TO_CHAR(ACT_TIME, '0000')), 0, 2) 
			        || NVL2(ACT_TIME, ':', '') 
			        || SUBSTR(TRIM(TO_CHAR(ACT_TIME, '0000')), 3, 4)
			    ), 'DDMONYY HH24:MI') ATA,
			  NVL((SELECT RULE_VALUE FROM CMSRULES WHERE RULE_CODE = 'LAST_TOW_IN_PAX_SLA'), 65) LAST_SLA
			  FROM FLT_OPR
			  WHERE FLT_TYPE = 'A' AND CGO_ACFT_TYPE = 'PSR'
		]]>		
		<isNotEmpty property="loginCarrier">
           <![CDATA[    
               AND (CARR_CODE = #loginCarrier#
                OR CARR_CODE IN (SELECT CARR_CODE FROM MAST_CARR_GRP WHERE GRP_CARR_CODE= #loginCarrier#))
            ]]>
        </isNotEmpty>
		<isEmpty property="loginCarrier">
        <isNotEmpty property="loginCustCode">
           <![CDATA[
               AND RHO_ID = #loginCustCode#
           ]]>
        </isNotEmpty>
        </isEmpty>	
		<isEqual property="selectFlag" compareValue="STA">
			<![CDATA[
				AND SCH_DATE BETWEEN TO_DATE(#fltDateFrom#, 'DDMONYY') AND (TO_DATE(#fltDateTo#, 'DDMONYY') + 1)
			]]>
		</isEqual>
		<isEqual property="selectFlag" compareValue="ATA">
			<![CDATA[
				AND ACT_DATE BETWEEN TO_DATE(#ataDateFrom#, 'DDMONYY') AND (TO_DATE(#ataDateTo#, 'DDMONYY') + 1)
			]]>
		</isEqual>		
		<![CDATA[
			),
			TOW_RECORD AS (
			  SELECT
			  FLT_KEY, FLT_DATE, TOW_IN_TIME,
			  NVL(TYPE_P, 0) TYPE_P, NVL(TYPE_A, 0) TYPE_A, NVL(TYPE_B, 0) TYPE_B, 
			  NVL(TYPE_W, 0) TYPE_W, NVL(TYPE_U, 0) TYPE_U, NVL(TYPE_20FT, 0) TYPE_20FT,
			  NVL(TYPE_P, 0) + NVL(TYPE_A, 0) + NVL(TYPE_B, 0) + NVL(TYPE_W, 0) + NVL(TYPE_U, 0) + NVL(TYPE_20FT, 0) TOTAL_ULD
			  FROM TOW_ORDER_IN_RECORD 
			  WHERE 1 = 1
		]]>
		
		<isEqual property="selectFlag" compareValue="STA">
			<![CDATA[
				AND FLT_DATE BETWEEN TO_DATE(#fltDateFrom#, 'DDMONYY') AND (TO_DATE(#fltDateTo#, 'DDMONYY') + 1)
			]]>
		</isEqual>
		<isEqual property="selectFlag" compareValue="ATA">
			<![CDATA[
				AND FLT_DATE BETWEEN (TO_DATE(#ataDateFrom#, 'DDMONYY') - 3) AND (TO_DATE(#ataDateTo#, 'DDMONYY') + 3)
			]]>
		</isEqual>		
		<![CDATA[
			),
			SUMM AS (
				SELECT
				FLT.FLT_KEY, FLT.FLT_DATE, FLT.ATA, FLT.ATA_TIME, 
				0 FIRST_SLA, LAST_SLA, SUM((
				  TYPE_P + TYPE_A + TYPE_B + TYPE_W + TYPE_U + TYPE_20FT
				)) totalULDs, COUNT(REC.TOW_IN_TIME) towCount,
				CASE
				  WHEN TO_CHAR(MIN(REC.TOW_IN_TIME), 'DDMONYY') != TO_CHAR(FLT.FLT_DATE, 'DDMONYY') THEN
				    TO_CHAR(MIN(REC.TOW_IN_TIME), 'HH24:MI:SS/DD')
				  ELSE TO_CHAR(MIN(REC.TOW_IN_TIME), 'HH24:MI:SS')
				END firstTowTime,
				MIN(REC.TOW_IN_TIME) TOW_IN_TIME_FIRST,
				CASE
				  WHEN TO_CHAR(MAX(REC.TOW_IN_TIME), 'DDMONYY') != TO_CHAR(FLT.FLT_DATE, 'DDMONYY') THEN
				    TO_CHAR(MAX(REC.TOW_IN_TIME), 'HH24:MI:SS/DD')
				  ELSE TO_CHAR(MAX(REC.TOW_IN_TIME), 'HH24:MI:SS')
				END lastTowTime,
				MAX(REC.TOW_IN_TIME) TOW_IN_TIME_LAST, (
				  SELECT STRAGG(STRINGDELIM(TO_CHAR(TOW_IN_TIME, 'HH24:MI:SS'), '/ '))
				  FROM TOW_ORDER_IN_RECORD HIS_REC
				  WHERE HIS_REC.FLT_KEY = FLT.FLT_KEY AND HIS_REC.FLT_DATE = FLT.FLT_DATE
				) history, (
					SELECT
					DECODE(COUNT(1), 0, 'N', 'Y') completed
					FROM FLT_OPR_EVENTS OPR
					WHERE OPR.FLT_TYPE = 'A' AND
					OPR.FLT_KEY = FLT.FLT_KEY AND OPR.SCH_DATE = FLT.FLT_DATE AND RAMP_COMPL_YN = 'Y'					
				) complete
				FROM FLT
				LEFT OUTER JOIN TOW_RECORD REC
				ON REC.FLT_KEY = FLT.FLT_KEY AND REC.FLT_DATE = FLT.FLT_DATE
				WHERE 1 = 1
		]]>
		<isEqual property="selectFlag" compareValue="STA">
			<![CDATA[
				AND FLT.STA BETWEEN 
					TO_DATE(#fltDateFrom# || ' ' || TRIM(TO_CHAR(#fltDateFromHour#, '00')) || TRIM(TO_CHAR(#fltDateFromMinute#, '00')), 'DDMONYY HH24MI') AND
					TO_DATE(#fltDateTo# || ' ' || TRIM(TO_CHAR(#fltDateToHour#, '00')) || TRIM(TO_CHAR(#fltDateToMinute#, '00')), 'DDMONYY HH24MI') 
			]]>
		</isEqual>
		<isEqual property="selectFlag" compareValue="ATA">
			<![CDATA[
				AND FLT.ATA BETWEEN 
					TO_DATE(#ataDateFrom# || ' ' || TRIM(TO_CHAR(#ataDateFromHour#, '00')) || TRIM(TO_CHAR(#ataDateFromMinute#, '00')), 'DDMONYY HH24MI') AND
					TO_DATE(#ataDateTo# || ' ' || TRIM(TO_CHAR(#ataDateToHour#, '00')) || TRIM(TO_CHAR(#ataDateToMinute#, '00')), 'DDMONYY HH24MI')
			]]>
		</isEqual>
		<![CDATA[			
				GROUP BY FLT.FLT_KEY, FLT.FLT_DATE, FLT.ATA, FLT.ATA_TIME,FLT.AIRCRAFT_TYPE,FLT.STA,FLT.LAST_SLA
				ORDER BY FLT.FLT_DATE, FLT.FLT_KEY, FLT.ATA, FLT.ATA_TIME
			)
			SELECT
			SUMM.FLT_KEY fltKey, TO_CHAR(SUMM.FLT_DATE, 'DDMONYY') fltDate, SUMM.ATA_TIME ata, 
			complete, FIRST_SLA firstSLA, LAST_SLA lastSLA,
			totalULDs, towCount, firstTowTime, lastTowTime, history,
			0 slaAchievedFirst, 0 sla15first, 0 sla30first, 0 sla45first, 0 sla60first, 0 slaGt60first,  
			CASE 
				WHEN SUMM.TOW_IN_TIME_LAST <= (SUMM.ATA + (SUMM.LAST_SLA/24/60)) THEN 'Y'
		    	ELSE 'N'
			END slaAchievedLast,
			CASE WHEN SUMM.TOW_IN_TIME_LAST <= (SUMM.ATA + (SUMM.LAST_SLA/24/60))
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_LAST
		    )
		    ELSE 0
		    END slaLast,			
			CASE WHEN SUMM.TOW_IN_TIME_LAST > (SUMM.ATA + (SUMM.LAST_SLA/24/60)) AND SUMM.TOW_IN_TIME_LAST <= (SUMM.ATA + ((SUMM.LAST_SLA + 15)/24/60)) 
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_LAST
		    )
		    ELSE 0
		    END sla15last,
		    CASE WHEN SUMM.TOW_IN_TIME_LAST > (SUMM.ATA + ((SUMM.LAST_SLA + 15)/24/60)) AND SUMM.TOW_IN_TIME_LAST <= (SUMM.ATA + ((SUMM.LAST_SLA + 30)/24/60)) 
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_LAST
		    )
		    ELSE 0
		    END sla30last,
		    CASE WHEN SUMM.TOW_IN_TIME_LAST > (SUMM.ATA + ((SUMM.LAST_SLA + 30)/24/60)) AND SUMM.TOW_IN_TIME_LAST <= (SUMM.ATA + ((SUMM.LAST_SLA + 45)/24/60)) 
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_LAST
		    )
		    ELSE 0
		    END sla45last,
		    CASE WHEN SUMM.TOW_IN_TIME_LAST > (SUMM.ATA + ((SUMM.LAST_SLA + 45)/24/60)) AND SUMM.TOW_IN_TIME_LAST <= (SUMM.ATA + ((SUMM.LAST_SLA + 60)/24/60)) 
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_LAST
		    )
		    ELSE 0
		    END sla60last,
		    CASE WHEN SUMM.TOW_IN_TIME_LAST > (SUMM.ATA + ((SUMM.LAST_SLA + 60)/24/60))
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_LAST
		    )
		    ELSE 0
		    END slaGt60last, (
		    	SELECT SUM(NVL(TYPE_P, 0) + NVL(TYPE_A, 0) + NVL(TYPE_B, 0) + NVL(TYPE_W, 0) + NVL(TYPE_U, 0) + NVL(TYPE_20FT, 0)) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME <= (SUMM.ATA + (SUMM.LAST_SLA/24/60))
		    ) passPAXULDs	
			FROM SUMM WHERE  SUMM.ATA_TIME IS NOT NULL
		]]>				
	</select>
	<!-- Tow Order In Record Report - Freighter -->
	<select id="sqlGetTowInRecordsFREReport" parameterClass="cargo.cms.imprt.bo.TowOrderTerminalInBO"
		resultClass="cargo.cms.imprt.bo.TowOrderTerminalInReportBO">
		<![CDATA[
			WITH FLT AS (
			  SELECT 
			  FLT_KEY, SCH_DATE FLT_DATE,
			  CGO_ACFT_TYPE AIRCRAFT_TYPE,
			  PKG_COMMON.GET_FLT_ATA(FLT_KEY, SCH_DATE, 'A', 'DD') ATA_TIME,
			  TO_DATE(
			    TRIM(
			      TO_CHAR(SCH_DATE, 'DDMONYY') || ' ' 
			        || SUBSTR(TRIM(TO_CHAR(SCH_TIME, '0000')), 0, 2) 
			        || NVL2(SCH_TIME, ':', '') 
			        || SUBSTR(TRIM(TO_CHAR(SCH_TIME, '0000')), 3, 4)
			  ), 'DDMONYY HH24:MI') STA,
			  TO_DATE(
			    TRIM(
			      TO_CHAR(ACT_DATE, 'DDMONYY') || ' ' 
			        || SUBSTR(TRIM(TO_CHAR(ACT_TIME, '0000')), 0, 2) 
			        || NVL2(ACT_TIME, ':', '') 
			        || SUBSTR(TRIM(TO_CHAR(ACT_TIME, '0000')), 3, 4)
			    ), 'DDMONYY HH24:MI') ATA,
			  NVL((SELECT RULE_VALUE FROM CMSRULES WHERE RULE_CODE = 'FIRST_TOW_IN_FRE_SLA'), 30) FIRST_SLA,
			  NVL((SELECT RULE_VALUE FROM CMSRULES WHERE RULE_CODE = 'LAST_TOW_IN_FRE_SLA'), 70) LAST_SLA
			  FROM FLT_OPR
			  WHERE FLT_TYPE = 'A' AND CGO_ACFT_TYPE = 'FRE'
		]]>
		<isNotEmpty property="loginCarrier">
           <![CDATA[    
               AND (CARR_CODE = #loginCarrier#
                OR CARR_CODE IN (SELECT CARR_CODE FROM MAST_CARR_GRP WHERE GRP_CARR_CODE= #loginCarrier#))
            ]]>
        </isNotEmpty>	
        <isEmpty property="loginCarrier">
        <isNotEmpty property="loginCustCode">
           <![CDATA[
               AND RHO_ID = #loginCustCode#
           ]]>
        </isNotEmpty>
        </isEmpty>		
		<isEqual property="selectFlag" compareValue="STA">
			<![CDATA[
				AND SCH_DATE BETWEEN TO_DATE(#fltDateFrom#, 'DDMONYY') AND (TO_DATE(#fltDateTo#, 'DDMONYY') + 1)
			]]>
		</isEqual>
		<isEqual property="selectFlag" compareValue="ATA">
			<![CDATA[
				AND ACT_DATE BETWEEN TO_DATE(#ataDateFrom#, 'DDMONYY') AND (TO_DATE(#ataDateTo#, 'DDMONYY') + 1)
			]]>
		</isEqual>		
		<![CDATA[
			),
			TOW_RECORD AS (
			  SELECT
			  FLT_KEY, FLT_DATE, TOW_IN_TIME,
			  NVL(TYPE_P, 0) TYPE_P, NVL(TYPE_A, 0) TYPE_A, NVL(TYPE_B, 0) TYPE_B, 
			  NVL(TYPE_W, 0) TYPE_W, NVL(TYPE_U, 0) TYPE_U, NVL(TYPE_20FT, 0) TYPE_20FT,
			  NVL(TYPE_P, 0) + NVL(TYPE_A, 0) + NVL(TYPE_B, 0) + NVL(TYPE_W, 0) + NVL(TYPE_U, 0) + NVL(TYPE_20FT, 0) TOTAL_ULD
			  FROM TOW_ORDER_IN_RECORD 
			  WHERE 1 = 1
		]]>
		
		<isEqual property="selectFlag" compareValue="STA">
			<![CDATA[
				AND FLT_DATE BETWEEN TO_DATE(#fltDateFrom#, 'DDMONYY') AND (TO_DATE(#fltDateTo#, 'DDMONYY') + 1)
			]]>
		</isEqual>
		<isEqual property="selectFlag" compareValue="ATA">
			<![CDATA[
				AND FLT_DATE BETWEEN (TO_DATE(#ataDateFrom#, 'DDMONYY') - 3) AND (TO_DATE(#ataDateTo#, 'DDMONYY') + 3)
			]]>
		</isEqual>		
		<![CDATA[
			),
			SUMM AS (
				SELECT
				FLT.FLT_KEY, FLT.FLT_DATE, FLT.ATA, FLT.ATA_TIME, 
				FIRST_SLA, LAST_SLA, SUM((
				  TYPE_P + TYPE_A + TYPE_B + TYPE_W + TYPE_U + TYPE_20FT
				)) totalULDs, COUNT(REC.TOW_IN_TIME) towCount,
				CASE
				  WHEN TO_CHAR(MIN(REC.TOW_IN_TIME), 'DDMONYY') != TO_CHAR(FLT.FLT_DATE, 'DDMONYY') THEN
				    TO_CHAR(MIN(REC.TOW_IN_TIME), 'HH24:MI:SS/DD')
				  ELSE TO_CHAR(MIN(REC.TOW_IN_TIME), 'HH24:MI:SS')
				END firstTowTime,
				MIN(REC.TOW_IN_TIME) TOW_IN_TIME_FIRST,
				CASE
				  WHEN TO_CHAR(MAX(REC.TOW_IN_TIME), 'DDMONYY') != TO_CHAR(FLT.FLT_DATE, 'DDMONYY') THEN
				    TO_CHAR(MAX(REC.TOW_IN_TIME), 'HH24:MI:SS/DD')
				  ELSE TO_CHAR(MAX(REC.TOW_IN_TIME), 'HH24:MI:SS')
				END lastTowTime,
				MAX(REC.TOW_IN_TIME) TOW_IN_TIME_LAST, (
				  SELECT STRAGG(STRINGDELIM(TO_CHAR(TOW_IN_TIME, 'HH24:MI:SS'), '/ '))
				  FROM TOW_ORDER_IN_RECORD HIS_REC
				  WHERE HIS_REC.FLT_KEY = FLT.FLT_KEY AND HIS_REC.FLT_DATE = FLT.FLT_DATE
				) history, (
					SELECT
					DECODE(COUNT(1), 0, 'N', 'Y') completed
					FROM FLT_OPR_EVENTS OPR
					WHERE OPR.FLT_TYPE = 'A' AND
					OPR.FLT_KEY = FLT.FLT_KEY AND OPR.SCH_DATE = FLT.FLT_DATE AND RAMP_COMPL_YN = 'Y'
				) complete
				FROM FLT
				LEFT OUTER JOIN TOW_RECORD REC
				ON REC.FLT_KEY = FLT.FLT_KEY AND REC.FLT_DATE = FLT.FLT_DATE
				WHERE 1 = 1
		]]>
		<isEqual property="selectFlag" compareValue="STA">
			<![CDATA[
				AND FLT.STA BETWEEN 
					TO_DATE(#fltDateFrom# || ' ' || TRIM(TO_CHAR(#fltDateFromHour#, '00')) || TRIM(TO_CHAR(#fltDateFromMinute#, '00')), 'DDMONYY HH24MI') AND
					TO_DATE(#fltDateTo# || ' ' || TRIM(TO_CHAR(#fltDateToHour#, '00')) || TRIM(TO_CHAR(#fltDateToMinute#, '00')), 'DDMONYY HH24MI') 
			]]>
		</isEqual>
		<isEqual property="selectFlag" compareValue="ATA">
			<![CDATA[
				AND FLT.ATA BETWEEN 
					TO_DATE(#ataDateFrom# || ' ' || TRIM(TO_CHAR(#ataDateFromHour#, '00')) || TRIM(TO_CHAR(#ataDateFromMinute#, '00')), 'DDMONYY HH24MI') AND
					TO_DATE(#ataDateTo# || ' ' || TRIM(TO_CHAR(#ataDateToHour#, '00')) || TRIM(TO_CHAR(#ataDateToMinute#, '00')), 'DDMONYY HH24MI')
			]]>
		</isEqual>
		<![CDATA[			
				GROUP BY FLT.FLT_KEY, FLT.FLT_DATE, FLT.ATA, FLT.ATA_TIME, FIRST_SLA,LAST_SLA
				ORDER BY FLT.FLT_DATE, FLT.FLT_KEY, FLT.ATA, FLT.ATA_TIME
			)
			SELECT
			SUMM.FLT_KEY fltKey, TO_CHAR(SUMM.FLT_DATE, 'DDMONYY') fltDate, SUMM.ATA_TIME ata, 
			complete, FIRST_SLA firstSLA, LAST_SLA lastSLA,
			totalULDs, towCount, firstTowTime, lastTowTime, history,
			CASE 
				WHEN SUMM.TOW_IN_TIME_FIRST <= (SUMM.ATA + (SUMM.FIRST_SLA/24/60)) THEN 'Y'
		    	ELSE 'N'
			END slaAchievedFirst,
			CASE WHEN SUMM.TOW_IN_TIME_FIRST <= (SUMM.ATA + (SUMM.FIRST_SLA/24/60))
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_FIRST
		    )
		    ELSE 0
		    END slaFirst,			
			CASE WHEN SUMM.TOW_IN_TIME_FIRST > (SUMM.ATA + (SUMM.FIRST_SLA/24/60)) AND SUMM.TOW_IN_TIME_FIRST <= (SUMM.ATA + ((SUMM.FIRST_SLA + 15)/24/60)) 
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_FIRST
		    )
		    ELSE 0
		    END sla15first,
		    CASE WHEN SUMM.TOW_IN_TIME_FIRST > (SUMM.ATA + ((SUMM.FIRST_SLA + 15)/24/60)) AND SUMM.TOW_IN_TIME_FIRST <= (SUMM.ATA + ((SUMM.FIRST_SLA + 30)/24/60)) 
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_FIRST
		    )
		    ELSE 0
		    END sla30first,
		    CASE WHEN SUMM.TOW_IN_TIME_FIRST > (SUMM.ATA + ((SUMM.FIRST_SLA + 30)/24/60)) AND SUMM.TOW_IN_TIME_FIRST <= (SUMM.ATA + ((SUMM.FIRST_SLA + 45)/24/60)) 
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_FIRST
		    )
		    ELSE 0
		    END sla45first,
		    CASE WHEN SUMM.TOW_IN_TIME_FIRST > (SUMM.ATA + ((SUMM.FIRST_SLA + 45)/24/60)) AND SUMM.TOW_IN_TIME_FIRST <= (SUMM.ATA + ((SUMM.FIRST_SLA + 60)/24/60)) 
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_FIRST
		    )
		    ELSE 0
		    END sla60first,
		    CASE WHEN SUMM.TOW_IN_TIME_FIRST > (SUMM.ATA + ((SUMM.FIRST_SLA + 60)/24/60))
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_FIRST
		    )
		    ELSE 0
		    END slaGt60first,		
			CASE 
				WHEN SUMM.TOW_IN_TIME_LAST <= (SUMM.ATA + (SUMM.LAST_SLA/24/60)) THEN 'Y'
		    	ELSE 'N'
			END slaAchievedLast,
			CASE WHEN SUMM.TOW_IN_TIME_LAST <= (SUMM.ATA + (SUMM.LAST_SLA/24/60))
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_LAST
		    )
		    ELSE 0
		    END slaLast,			
			CASE WHEN SUMM.TOW_IN_TIME_LAST > (SUMM.ATA + (SUMM.LAST_SLA/24/60)) AND SUMM.TOW_IN_TIME_LAST <= (SUMM.ATA + ((SUMM.LAST_SLA + 15)/24/60)) 
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_LAST
		    )
		    ELSE 0
		    END sla15last,
		    CASE WHEN SUMM.TOW_IN_TIME_LAST > (SUMM.ATA + ((SUMM.LAST_SLA + 15)/24/60)) AND SUMM.TOW_IN_TIME_LAST <= (SUMM.ATA + ((SUMM.LAST_SLA + 30)/24/60)) 
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_LAST
		    )
		    ELSE 0
		    END sla30last,
		    CASE WHEN SUMM.TOW_IN_TIME_LAST > (SUMM.ATA + ((SUMM.LAST_SLA + 30)/24/60)) AND SUMM.TOW_IN_TIME_LAST <= (SUMM.ATA + ((SUMM.LAST_SLA + 45)/24/60)) 
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_LAST
		    )
		    ELSE 0
		    END sla45last,
		    CASE WHEN SUMM.TOW_IN_TIME_LAST > (SUMM.ATA + ((SUMM.LAST_SLA + 45)/24/60)) AND SUMM.TOW_IN_TIME_LAST <= (SUMM.ATA + ((SUMM.LAST_SLA + 60)/24/60)) 
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_LAST
		    )
		    ELSE 0
		    END sla60last,
		    CASE WHEN SUMM.TOW_IN_TIME_LAST > (SUMM.ATA + ((SUMM.LAST_SLA + 60)/24/60))
		    THEN (
		    	SELECT SUM(TOTAL_ULD) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME = SUMM.TOW_IN_TIME_LAST
		    )
		    ELSE 0
		    END slaGt60last, (
		    	SELECT SUM(NVL(TYPE_P, 0) + NVL(TYPE_A, 0) + NVL(TYPE_B, 0) + NVL(TYPE_W, 0) + NVL(TYPE_U, 0) + NVL(TYPE_20FT, 0)) TOTAL
		    	FROM TOW_RECORD TR
		    	WHERE TR.FLT_KEY = SUMM.FLT_KEY AND TR.FLT_DATE = SUMM.FLT_DATE AND TR.TOW_IN_TIME <= (SUMM.ATA + (SUMM.LAST_SLA/24/60))
		    ) passFREULDs		    		
			FROM SUMM	WHERE  SUMM.ATA_TIME IS NOT NULL	
		]]>				
	</select>
	<!-- Tow Order In Record Report - Summary -->
	<select id="sqlGetTowInRecordsSummaryReport" parameterClass="cargo.cms.imprt.bo.TowOrderTerminalInBO"
		resultClass="cargo.cms.imprt.bo.TowOrderTerminalInReportBO">
		<![CDATA[
			WITH DAYS AS (
			  SELECT
			  TO_DATE(#selectedMonth#, 'DDMONYY') + (ROWNUM - 1) DATETIME
			  FROM DUAL
			  CONNECT BY LEVEL <= (
			    SELECT TO_CHAR(LAST_DAY(TO_DATE(#selectedMonth#, 'DDMONYY')), 'DD') FROM DUAL
			  )
			),
			FLT AS (
			  SELECT 
			  FLT_KEY, SCH_DATE FLT_DATE,
			  CGO_ACFT_TYPE AIRCRAFT_TYPE,
			  TO_DATE(
			    TRIM(
			      TO_CHAR(ACT_DATE, 'DDMONYY') || ' ' 
			        || SUBSTR(TRIM(TO_CHAR(ACT_TIME, '0000')), 0, 2) 
			        || NVL2(ACT_TIME, ':', '') 
			        || SUBSTR(TRIM(TO_CHAR(ACT_TIME, '0000')), 3, 4)
			    ), 'DDMONYY HH24:MI') ATA,
			  NVL((SELECT RULE_VALUE FROM CMSRULES WHERE RULE_CODE = 'LAST_TOW_IN_PAX_SLA'), 65) LAST_PAX_SLA,
			  NVL((SELECT RULE_VALUE FROM CMSRULES WHERE RULE_CODE = 'LAST_TOW_IN_FRE_SLA'), 70) LAST_FRE_SLA
			  FROM FLT_OPR
			  WHERE FLT_TYPE = 'A' AND CGO_ACFT_TYPE IN('PSR', 'FRE')
			  AND ACT_DATE BETWEEN (SELECT MIN(DATETIME) FROM DAYS) AND (SELECT MAX(DATETIME) FROM DAYS)
  
              ]]>
              <isNotEmpty property="loginCarrier">
              <![CDATA[    
               AND (CARR_CODE = #loginCarrier#
                OR CARR_CODE IN (SELECT CARR_CODE FROM MAST_CARR_GRP WHERE GRP_CARR_CODE= #loginCarrier#))
               ]]>
             </isNotEmpty>
             <isEmpty property="loginCarrier">
             <isNotEmpty property="loginCustCode">
             <![CDATA[
               AND RHO_ID = #loginCustCode#
             ]]>
             </isNotEmpty>
             </isEmpty>
			
			 <![CDATA[
			),
			PAX AS (
			  SELECT TOW.FLT_KEY, TOW.FLT_DATE,
			  NVL(TYPE_P, 0) + NVL(TYPE_A, 0) + NVL(TYPE_B, 0) + NVL(TYPE_W, 0) + NVL(TYPE_U, 0) + NVL(TYPE_20FT, 0) TOTAL_ULDS,
			  CASE 
			    WHEN TOW.TOW_IN_TIME <= (FLT.ATA + (FLT.LAST_PAX_SLA/24/60)) THEN
			    	NVL(TYPE_P, 0) + NVL(TYPE_A, 0) + NVL(TYPE_B, 0) + NVL(TYPE_W, 0) + NVL(TYPE_U, 0) + NVL(TYPE_20FT, 0)
			    ELSE 0
			  END ACHIEVED,
			  LAST_PAX_SLA
			  FROM TOW_ORDER_IN_RECORD TOW
			  JOIN FLT
			  ON TOW.FLT_KEY = FLT.FLT_KEY AND TOW.FLT_DATE = FLT.FLT_DATE AND FLT.AIRCRAFT_TYPE = 'PSR'
			),
			FRE AS (
			  SELECT TOW.FLT_KEY, TOW.FLT_DATE,
			  NVL(TYPE_P, 0) + NVL(TYPE_A, 0) + NVL(TYPE_B, 0) + NVL(TYPE_W, 0) + NVL(TYPE_U, 0) + NVL(TYPE_20FT, 0) TOTAL_ULDS,
			  CASE 
			    WHEN TOW.TOW_IN_TIME <= (FLT.ATA + (FLT.LAST_FRE_SLA/24/60)) THEN
			    	NVL(TYPE_P, 0) + NVL(TYPE_A, 0) + NVL(TYPE_B, 0) + NVL(TYPE_W, 0) + NVL(TYPE_U, 0) + NVL(TYPE_20FT, 0)
			    ELSE 0
			  END ACHIEVED,
			  LAST_FRE_SLA
			  FROM TOW_ORDER_IN_RECORD TOW
			  JOIN FLT
			  ON TOW.FLT_KEY = FLT.FLT_KEY AND TOW.FLT_DATE = FLT.FLT_DATE AND FLT.AIRCRAFT_TYPE = 'FRE'
			),
			FRE_FINAL AS(
			  SELECT
			  TO_CHAR(DATETIME, 'DD/MM/YY Dy') DAYOFMONTH,
			  SUM(FRE.TOTAL_ULDS) TOTAL_ULDS, SUM(FRE.ACHIEVED) SLA_ACHIEVED,
			  ROUND((SUM(FRE.ACHIEVED) / SUM(FRE.TOTAL_ULDS)) * 100, 2) PASS_PERCENT,
			  LAST_FRE_SLA
			  FROM DAYS
			  LEFT OUTER JOIN FRE
			  ON DAYS.DATETIME = FRE.FLT_DATE
			  GROUP BY DAYS.DATETIME, LAST_FRE_SLA
			  ORDER BY DAYS.DATETIME
			),
			PAX_FINAL AS(
			  SELECT
			  TO_CHAR(DATETIME, 'DD/MM/YY Dy') DAYOFMONTH,
			  SUM(PAX.TOTAL_ULDS) TOTAL_ULDS, SUM(PAX.ACHIEVED) SLA_ACHIEVED,
			  ROUND((SUM(PAX.ACHIEVED) / SUM(PAX.TOTAL_ULDS)) * 100, 2) PASS_PERCENT,
			  LAST_PAX_SLA
			  FROM DAYS
			  LEFT OUTER JOIN PAX
			  ON DAYS.DATETIME = PAX.FLT_DATE
			  GROUP BY DAYS.DATETIME, LAST_PAX_SLA
			  ORDER BY DAYS.DATETIME
			)
			SELECT PAX.DAYOFMONTH dayOfMonth,
			PAX.TOTAL_ULDS totalPAXULDs, PAX.SLA_ACHIEVED passPAXULDs, PAX.PASS_PERCENT passPAXPercent,
			FRE.TOTAL_ULDS totalFREULDs, FRE.SLA_ACHIEVED passFREULDs, FRE.PASS_PERCENT passFREPercent,
			LAST_PAX_SLA lastPAXSLA, LAST_FRE_SLA lastFRESLA
			FROM PAX_FINAL PAX
			JOIN FRE_FINAL FRE
			ON PAX.DAYOFMONTH = FRE.DAYOFMONTH	
		]]>				
	</select>		
	
<select id="fetchInboundOnlineTrnsfrSmryUldAwbList_REPT_722_IMP" parameterClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO" resultClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO" >
	<![CDATA[ 
		select ddt.awb_no awbNo,
		SUBSTR(TRIM(ddt.awb_no),1,3)||'-'||SUBSTR(TRIM(ddt.awb_no),4) awbNoDisp,
		ddt.awb_Date awbDate, 
		nvl(ddt.ULD_KEY,'BULK')  uldKey,
		decode(ddt.CNTG_FLT_KEY,null,'BULK',ddt.ULD_KEY,null,'BULK',ddt.ULD_KEY) uldKeyShow,
		nvl(ddt.ULD_KEY,'BULK') ||'-'|| ddt.awb_no  uldKeyAwbNo,
		nvl(awb.ORIG,(SELECT ORIG FROM FLT_OPR WHERE FLT_KEY = ddt.flt_key AND SCH_DATE = ddt.flt_Date AND FLT_TYPE = 'A')) org, 
		nvl(awb.DEST,ddt.UNLDG_PT) dest, 
		nvl(awb.DEST,ddt.SHP_UNLDG_PT) shpDest, 
		nvl(awb.ORIG,(SELECT ORIG FROM FLT_OPR WHERE FLT_KEY = ddt.flt_key AND SCH_DATE = ddt.flt_Date AND FLT_TYPE = 'A')) shpldgPt, 
		case when ddt.CNTG_FLT_KEY is null then awb.catalog 
			 when (select count(1) from awb where catalog = 'TM' 
							and exists (select null from v_ddt_dtl where tr_no = ddt.TR_NO and udoc_line_no = ddt.UDOC_LINE_NO 
                                       and uld_key = ddt.ULD_KEY and awb_no = awb.awb_no and  awb_date = awb.awb_date )) > 0 then 'TM' 
              else awb.catalog end  catalog,
		NVL(AWB.PCS,NVL(ddt.SHP_TRF_PC,0)) awbPcs, NVL(AWB.WT,NVL(ddt.SHP_TRF_WT,0)) awbWt,
		ddt.flt_key fltKey , 
		ddt.flt_Date  fltDate,
		ddt.TR_NO ddtTrNo, 
		ddt.SDOC_LINE_NO ddtSdocLineNo, 
		ddt.UDOC_LINE_NO ddtUdocLineNo, 
		ddt.DOC_LINE_NO ddtDocLineNo,
		decode(ddt.CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.CNTG_FLT_KEY)) cntgFltCarr, 
		REPLACE(ddt.CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.CNTG_FLT_KEY), '') cntgFltNo,
		ddt.CNTG_FLT_KEY cntgFltKey, ddt.CNTG_FLT_DATE cntgFltDate,
		ddt.UNLDG_PT uldUnldgPt,ddt.TRF_TYPE trfType,ddt.BRK_BULK brkBulk,
		decode(ddt.SHP_CNTG_FLT_KEY,null,'',PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY)) shpCntgFltCarr, 
		REPLACE(ddt.SHP_CNTG_FLT_KEY, PKG_COMMON.get_flt_carr(ddt.SHP_CNTG_FLT_KEY), '') shpCntgFltNo,
		ddt.SHP_CNTG_FLT_KEY shpCntgFltKey, ddt.SHP_CNTG_FLT_DATE shpCntgFltDate,
		ddt.SHP_UNLDG_PT shpUnldgPt,ddt.SHP_TRF_TYPE shpTrfType,ddt.SHP_BRK_BULK shpBrkBulk,
		ddt.SHP_TRF_PC trfPcs, ddt.SHP_TRF_WT trfWt,
		(select  sum(shp_trf_pc)
		   from v_ddt_dtl 
		   where tr_no = ddt.TR_NO and udoc_line_no = ddt.UDOC_LINE_NO 
		   and uld_key = ddt.ULD_KEY  group by tr_no,udoc_line_no, flt_key, flt_date , uld_key) uldTrfPc,
		(select sum(shp_trf_wt)  
		   from v_ddt_dtl 
		   where tr_no = ddt.TR_NO and udoc_line_no = ddt.UDOC_LINE_NO 
		   and uld_key = ddt.ULD_KEY  group by tr_no,udoc_line_no, flt_key, flt_date , uld_key) uldTrfWt,		
		ddt.UNLDG_PT unldgPt,
		pkg_common.get_flt_sta(ddt.SHP_CNTG_FLT_KEY, ddt.SHP_CNTG_FLT_DATE,'D') shpStd,
        pkg_common.get_flt_eta(ddt.SHP_CNTG_FLT_KEY, ddt.SHP_CNTG_FLT_DATE,'D') shpEtd,
        pkg_common.get_flt_sta(ddt.CNTG_FLT_KEY, ddt.CNTG_FLT_DATE,'D') uldStd,
        pkg_common.get_flt_eta(ddt.CNTG_FLT_KEY, ddt.CNTG_FLT_DATE,'D') uldEtd,
		FUN_GET_FLT_TDIFF_TRFYPE(ddt.CNTG_FLT_KEY, ddt.CNTG_FLT_DATE,#fltKey#,#fltDate#,'TIME_DIFF' ) timeDiifferance,
		FUN_GET_FLT_TDIFF_TRFYPE(ddt.CNTG_FLT_KEY, ddt.CNTG_FLT_DATE,#fltKey#,#fltDate#,'TR_TYPE' ) proposeTrfType,
		FUN_GET_FLT_TDIFF_TRFYPE(ddt.SHP_CNTG_FLT_KEY, ddt.SHP_CNTG_FLT_DATE,#fltKey#,#fltDate#,'TIME_DIFF' ) shpTimeDiifferance,
		FUN_GET_FLT_TDIFF_TRFYPE(ddt.SHP_CNTG_FLT_KEY, ddt.SHP_CNTG_FLT_DATE,#fltKey#,#fltDate#,'TR_TYPE' ) shpProposeTrfType	,DDT.eta

  from (select ddtView.awb_no awb_no, to_char(ddtView.awb_DATE,'DDMONYY') awb_DATE, ddtView.flt_key flt_key , 
	                      to_char(ddtView.flt_Date,'DDMONYY') flt_Date, 
	                	ddtView.TR_NO TR_NO, ddtView.sdoc_line_no Sdoc_line_no, ddtView.uDOC_LINE_NO UDOC_LINE_NO, ddtView.DOC_LINE_NO DOC_LINE_NO,
	                	ddtView.ULD_KEY ULD_KEY , ddtView.CNTG_FLT_KEY CNTG_FLT_KEY, to_char(ddtView.CNTG_FLT_DATE,'DDMONYY') CNTG_FLT_DATE, 
	                  	ddtView.TRF_TYPE TRF_TYPE,  ddtView.BRK_BULK BRK_BULK, to_char(ddtView.BASELINE_ETA,'DDMONYY') BASELINE_ETA,
	                  	NVL( (TO_CHAR(TO_DATE(to_char(ddtView.BASELINE_ETA,'DDMONYY HH24MI'),'DDMONYY HH24MI') - 
	                   			TO_DATE(TO_CHAR(FLT.SCH_DATE,'DDMONYY')|| ' ' || 
	                   			TO_CHAR(NVL(FLT.EST_TIME,  FLT.SCH_TIME),'0000') ,'DDMONYY HH24MI')))  * 24  , 0 ) as etaChangedHrs,
	                    ddtView.Acton_code_1 Acton_code_1, ddtView.Acton_code_2 Acton_code_2, ddtView.UNLDG_PT , ddtView.SHP_UNLDG_PT,
	                    ddtView.SHP_TRF_PC , ddtView.SHP_TRF_WT, 
	                    ddtView.SHP_CNTG_FLT_KEY SHP_CNTG_FLT_KEY, to_char(ddtView.SHP_CNTG_FLT_DATE,'DDMONYY') SHP_CNTG_FLT_DATE,
	                    ddtView.SHP_TRF_TYPE SHP_TRF_TYPE,ddtView.SHP_BRK_BULK SHP_BRK_BULK,
    pkg_common.get_flt_eta(FLT.FLT_KEY, FLT.sch_DATE,'A') eta
	                  from V_DDT_DTL ddtView
	              		join FLT_OPR FLT on FLT.FLT_KEY = ddtView.FLT_KEY and FLT.SCH_DATE = ddtView.FLT_DATE and FLT_type = 'A') ddt 
  join FLT_OPR FLT on FLT.FLT_KEY = ddt.FLT_KEY and FLT.SCH_DATE = ddt.FLT_DATE and FLT_type = 'A'
	left join awb on 
	         awb.awb_no=ddt.awb_no and awb.awb_date=ddt.awb_date
	  where  ddt.flt_key = #fltKey# and ddt.flt_Date = #fltDate# 	
    and (ddt.TRF_TYPE = 'TT' or ddt.SHP_TRF_TYPE = 'TT')
	   ORDER BY  ddt.ULD_KEY, ddt.awb_no, ddt.awb_Date
	   ]]>
	</select>
	
		<select id="fetchOutBoundOnlineTrnsfrSmryUldAwbList_REPT_722_EXP" parameterClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO" resultClass="cargo.cms.imprt.report.bo.TransitUldShpmReptBO" >
	<![CDATA[ 
		select
	decode(ddt.CNTG_FLT_KEY,null,'BULK',ddt.ULD_KEY,null,'BULK',ddt.ULD_KEY) uldKeyShow,
	nvl(ddt.ULD_KEY,'BULK')  uldKey, nvl(ddt.ULD_KEY,'BULK') ||'-'|| ddt.awb_no  uldKeyAwbNo, 
	ddt.awb_no awbNo, SUBSTR(TRIM(ddt.awb_no),1,3)||'-'||SUBSTR(TRIM(ddt.awb_no),4) awbNoDisp,  to_char(ddt.awb_Date,'DDMONYY') awbDate, 
	nvl(awb.ORIG,'') org, awb.DEST dest, ddt.UNLDG_PT unldgPt,ddt.UNLDG_PT  uldUnldgPt, ddt.SHP_UNLDG_PT shpUnldgPt, 
  case when ddt.CNTG_FLT_KEY is null then awb.catalog 
			 when (select count(1) from awb where catalog = 'TM' 
							and exists (select null from v_ddt_dtl where tr_no = ddt.TR_NO and udoc_line_no = ddt.UDOC_LINE_NO 
                                       and uld_key = ddt.ULD_KEY and awb_no = awb.awb_no and  awb_date = awb.awb_date )) > 0 then 'TM' 
              else awb.catalog end  catalog,
	ddt.flt_key fltKey , to_char(ddt.flt_Date,'DDMONYY')  fltDate,
	nvl(ddt.SHP_TRF_PC,0) pcs,nvl(ddt.SHP_TRF_WT,0) wt,
	FUN_GET_FLT_TDIFF_TRFYPE(ddt.SHP_CNTG_FLT_KEY,ddt.SHP_CNTG_FLT_DATE,ddt.flt_key, ddt.flt_Date,'TIME_DIFF' ) timeDiifferance,
	FUN_GET_FLT_TDIFF_TRFYPE(ddt.SHP_CNTG_FLT_KEY,ddt.SHP_CNTG_FLT_DATE,ddt.flt_key, ddt.flt_Date,'TR_TYPE' ) proposeTrfType,
	decode(ddt.CNTG_FLT_KEY,null,'Y') awbNoRecInd,	  
   	ddt.TR_NO ddtTrNo, ddt.SDOC_LINE_NO ddtSdocLineNo, ddt.UDOC_LINE_NO ddtUdocLineNo, ddt.DOC_LINE_NO ddtDocLineNo,
   	nvl(ddt.CNTG_FLT_KEY,ddt.SHP_CNTG_FLT_KEY) cntgFltKey, to_char(nvl(ddt.CNTG_FLT_Date,ddt.SHP_CNTG_FLT_Date),'DDMONYY') cntgFltDate,  
   	REPLACE(nvl(ddt.CNTG_FLT_KEY,ddt.SHP_CNTG_FLT_KEY), PKG_COMMON.get_flt_carr(nvl(ddt.CNTG_FLT_KEY,ddt.SHP_CNTG_FLT_KEY)), '') cntgFltNo,
   	decode(ddt.CNTG_FLT_KEY,null,ddt.SHP_TRF_TYPE, ddt.TRF_TYPE) trfType,
   	ddt.BRK_BULK brkBulk, ddt.SHP_TRF_PC trfPcs, ddt.SHP_TRF_WT trfWt, 
   	(select  sum(shp_trf_pc) from v_ddt_dtl 
		   where tr_no = ddt.TR_NO and udoc_line_no = ddt.UDOC_LINE_NO and uld_key = ddt.ULD_KEY  group by tr_no,udoc_line_no, flt_key, flt_date , uld_key) uldTrfPc,
	(select sum(shp_trf_wt) from v_ddt_dtl 
		   where tr_no = ddt.TR_NO and udoc_line_no = ddt.UDOC_LINE_NO and uld_key = ddt.ULD_KEY  group by tr_no,udoc_line_no, flt_key, flt_date , uld_key) uldTrfWt,	
    (select decode(DDT_FINALISE_DATE,null,'N','Y') from FLT_OPR_EVENTS where FLT_KEY = ddt.flt_key and SCH_DATE = ddt.FLT_DATE and flt_Type ='A')  finalizedInd,
     pkg_common.get_flt_sta(ddt.flt_key, ddt.flt_Date,'A') shpStd,
  pkg_common.get_flt_eta(ddt.flt_key, ddt.flt_Date,'A') shpEtd     ,
  pkg_common.get_flt_final_ata_eta_sta(ddt.SHP_CNTG_FLT_KEY, ddt.SHP_CNTG_FLT_DATE,'D','DD') etd     
	from V_DDT_DTL ddt
	join FLT_OPR FLT on ddt.SHP_CNTG_FLT_KEY = FLT.FLT_KEY and FLT.SCH_DATE = ddt.SHP_CNTG_FLT_DATE and FLT.FLT_TYPE ='D'
	join FLT_OPR_EVENTS FLTEVENTS on FLT.FLT_KEY = FLTEVENTS.FLT_KEY and FLT.SCH_DATE = FLTEVENTS.SCH_DATE and FLT.FLT_TYPE =FLTEVENTS.FLT_TYPE 
	left join awb on awb.awb_NO = ddt.awb_No and awb.awb_Date = ddt.awb_Date	
	where ddt.SHP_CNTG_FLT_KEY = #fltKey# and ddt.SHP_CNTG_FLT_DATE = #fltDate# 
  and (ddt.TRF_TYPE = 'TT' or ddt.SHP_TRF_TYPE = 'TT')
	ORDER BY  ddt.awb_no
	   ]]>
	</select>
	
	<select  id="retireiveCSD_rept" parameterClass="cargo.cms.imprt.report.bo.RetrieveCSD_ReptBO" resultClass="cargo.cms.imprt.report.bo.RetrieveCSD_ReptBO">
		<![CDATA[
    	SELECT A.LSP_NO AS csd ,
       A.ULD_KEY AS uldKey,
       DECODE(A.ULD_KEY,'',A.LSP_NO,A.ULD_KEY) AS csdUld,
       A.LOC_CODE    AS loc ,
       A.awb_no      AS awbNo,
       TO_char(A.awb_date,'DDMONYY') as awbDate,
       A.locn_pcs as locnPcs,
       A.locn_wt as locnWt,
       DECODE((select count(1) from MAST_WH_LOC t1, mast_wh_group t2 where t1.wh_group = t2.WH_GROUP and t2.wh_type = 'MHS' and t1.code=A.LOC_CODE),'0','Y','N') AS mhcsInd,
       DECODE((select NVL(Count(1),'0') from uld_inventory where uld_key=A.ULD_KEY and  (nvl(locked,'N')='Y' or NVL(lock_rqs,'N') = 'Y')),'0','N','Y') as uldLock,
       DECODE((select NVL(Count(1),'0') from lsp_inventory where lsp_no=A.LSP_NO and  (nvl(locked,'N')='Y' or NVL(lock_rqs,'N') = 'Y')),'0','N','Y') AS lspLock,
       (SELECT TARGET FROM RTRV_MOVE_ORDER WHERE ((STATUS <>'COMPLETED' AND STATUS <> 'CANCELLED') OR STATUS IS NULL)	AND (LSP = UPPER(A.LSP_NO)	OR ULD = UPPER(A.ULD_KEY))) as existStat,
       (case when (SELECT COUNT(1) FROM AWB_INVENTORY C WHERE NVL(C.FLT_TYPE,'A') <> 'E' AND (C.ULD_KEY = A.ULD_KEY OR C.LSP_NO = A.LSP_NO)) > 1 then 'Y' else 'N' end) as mixInd
	FROM awb_inventory A, awb B
	WHERE B.awb_no = A.awb_no and B.awb_date = A.awb_date and B.awb_closed_yn = 'N' and A.awb_no=#awbNo# AND NVL(A.FLT_TYPE,'A') <> 'E'
	]]>
	
	<isEqual property="inclULD" compareValue="N">
				AND	A.ULD_KEY IS NULL
	</isEqual>
	order by lsp_no,uld_key asc
	
    	</select>
    	
    	<select id="checkeSRFs" parameterClass="java.lang.String" resultClass="java.lang.Integer">
    	   SELECT COUNT(1) FROM imp_srf WHERE Srf_No=#srfNO# and Esrf_Yn='Y'
    	</select>
    	
    	<select id="eawbPrintReports" parameterClass="cargo.cms.imprt.report.bo.EAWBPrintRept_BO" resultClass="cargo.cms.imprt.report.bo.EAWBPrintRept_BO">
			SELECT A.* FROM
			(SELECT agent_name agentNames, agent_full_name as collPerson, agent_hkid agentHkid, 
			 request_id reqId, to_char(cr_date,'DD-MON-YYYY HH24:MI:SS') reqDate,
			srf_no as srfNo	FROM imp_payment_process_queue	WHERE awb_no = #awbNoDis#AND awb_date = #awbDate# AND srf_no IS NOT NULL
			ORDER BY cr_date DESC) A WHERE rownum = 1
    	</select>
</sqlMap> 